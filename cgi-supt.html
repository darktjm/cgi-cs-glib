<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<!--
Generated using noweb; original .nw source attached as tar.gz in comment at end
Extract with uudecode, or, if uudecode chokes, use:
   tr '|~m`' '<>- ' | uudecode -o 'cgi-supt.tar.gz'
-->

<head>
  <meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org" />
  <meta name="generator" content="noweave -html -filter l2h, highlight-3" />
  <style type="text/css">
/*<![CDATA[*/
  <!--
  .code  { color:#000000; background-color:#e0eaee; font-size: smaller;}
  .code a        { color:#000000; background-color:#e0eaee; font-size: smaller;}
  .code .num { color:#b07e00; }
  .code .esc { color:#ff00ff; }
  .code .str { color:#bf0303; }
  .code .pps { color:#818100; }
  .code .slc { color:#838183; font-style:italic; }
  .code .com { color:#838183; font-style:italic; }
  .code .ppc { color:#008200; }
  .code .opt { color:#000000; }
  .code .ipl { color:#0057ae; }
  .code .lin { color:#555555; }
  .code .kwa { color:#000000; font-weight:bold; }
  .code .kwb { color:#0057ae; }
  .code .kwc { color:#000000; font-weight:bold; }
  .code .kwd { color:#010181; }
  .code li {display: block;}
  /* either above line to remove line #s, or make space for line #s with: */
  /* .code {margin-left: 2em;} */
  /* optional: add border around code */
  /* .code {border: thin solid black;} */
  code {font-style: normal;}
  pre.defn {margin-bottom: 0;}
  .code {margin-left: 10pt; margin-right: 10pt; margin-top: 0; padding: 1px}
  .code li,pre {margin-top: 0; margin-bottom: 0;}
  .code a {text-decoration: none;}
  pre.dfn a {text-decoration: none;}
  //-->
  /*]]>*/
  </style>

  <title>CGI Extensions for the ClearSilver CGI Kit</title>
</head>

<body>
  <h1><a name="toc1" id="toc1">CGI Extensions for the ClearSilver CGI Kit</a></h1>

  <address>
    Thomas J. Moore
  </address><b>Version 1.0 Revision 196<br />
  2010</b>

  <p><!--title goes here--></p>

  <h2><a name="toc2" id="toc2">Abstract</a></h2>

  <blockquote>
    This document describes and implements a few enhancements to the CGI library provided by ClearSilver, in addition to what is provided by the <em>Generic ClearSilver and GLib Module Build Support</em> document.

    <p>&copy; 2009--2010 Trustees of Indiana University. This document is licensed under the Apache License, Version 2.0 (the `License'); you may not use this document except in compliance with the License. You may obtain a copy of the License at <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>. Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an `AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>

    <p>This document was generated from the following sources, all of which are attached to the original electronic forms of this document:</p>

    <div style="margin-left: 2em" class="code">
      <ol>
        <li>
          <pre>
$Id: build.nw 197 2012-12-06 05:02:53Z darktjm $
</pre>
        </li>

        <li>
          <pre>
$Id: cs-glib.nw 196 2012-12-06 05:02:09Z darktjm $
</pre>
        </li>

        <li>
          <pre>
$Id: cgi-supt.nw 196 2012-12-06 05:02:09Z darktjm $
</pre>
        </li>
      </ol>
    </div>
  </blockquote>

  <h2>Table of Contents</h2>

  <ul compact="compact">
    <li><a href="#toc3">Introduction</a></li>

    <li><a href="#toc4">HTML Form Support Macros</a></li>

    <li><a href="#toc5">FastCGI Support</a></li>

    <li><a href="#toc6">CGI Parameter Parsing</a></li>

    <li><a href="#toc7">Content Decoding</a></li>

    <li><a href="#toc8">POST and PUT Uploads</a></li>

    <li><a href="#toc9">Common Headers</a></li>

    <li><a href="#toc10">XML Parameter Bodies</a></li>

    <li><a href="#toc11">Session Support</a></li>

    <li><a href="#toc12">Database Session Support</a></li>

    <li><a href="#toc13">CAS Authentication</a></li>

    <li><a href="#toc14">Sample Program</a></li>

    <li><a href="#toc15">Usage</a></li>

    <li><a href="#toc16">Code Dependencies</a></li>

    <li><a href="#toc17">Code Index</a></li>
  </ul>

  <h1><a name="toc3" id="toc3">Introduction</a></h1>

  <p>The CGI kit included with ClearSilver works well enough for most applications, but some improvements could be made. First, like most CGI libraries, file upload control is inadequate: all uploads are placed in the same temporary directory (which bypasses per-user quotas, among other things), and the only provided callback does not get access to already-known CGI parameters or file attributes. Second, there is no direct FastCGI<sup><a href="#fn1">1</a></sup> support. FastCGI allows the sharing of long setup times among multiple connections; for example, connections can be made to a database before the user ever connects to the web server. Third, there is no macro library for common form operations. This is probably for the better, since limitations in such a library tend to prompt either rewrite or convoluted workarounds. Fourth, there is no support for WebDAV<sup><a href="#fn2">2</a></sup> request processing. This is normally done in a web server module, but there is no reason not to do it in (Fast)CGI.</p>

  <p>In addition to the basic parsing enhancements and FastCGI support, a simple session management infrastructure is implemented, using either files or a database for session storage. This is then used to help implement authentication caching for the Central Authentication Service<sup><a href="#fn3">3</a></sup>.</p>
  <pre class="dfn">
<a name="NW0-1r3EKH-1" href="#NW0-1r3EKH-1" id="NW0-1r3EKH-1"><dfn>&lt;(build.nw) Version Strings&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="str">"$Id: cgi-supt.nw 196 2012-12-06 05:02:09Z darktjm $</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-35OSyj-1" href="#NW0-35OSyj-1" id="NW0-35OSyj-1"><dfn>&lt;(build.nw) Sources&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
$Id: cgi-supt.nw 196 2012-12-06 05:02:09Z darktjm $
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-17AJkL-1" href="#NW0-17AJkL-1" id="NW0-17AJkL-1"><dfn>&lt;(build.nw) Common NoWeb Warning&gt;=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">U-&gt;</a> <a href="#NW0-2wJhWs-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># $Id: cgi-supt.nw 196 2012-12-06 05:02:09Z darktjm $</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc4" id="toc4">HTML Form Support Macros</a></h1>

  <p>Using macros to display widgets makes the HTML harder to edit with normal tools, and also makes it more dependent on the macro language. The conditional HTML is complex enough that the use of macros is worth the potential problems.</p>
  <pre class="dfn">
<a name="NW0-9Z2yk-1" href="#NW0-9Z2yk-1" id="NW0-9Z2yk-1"><dfn>&lt;(cs-glib.nw) CS files&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
html_macros.cs \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3L4zVQ-1" href="#NW0-3L4zVQ-1" id="NW0-3L4zVQ-1"><dfn>&lt;html_macros.cs&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&lt;</span>?cs <a name="NW0-3L4zVQ-1-u1" href="#NW0-17AJkL-1" id="NW0-3L4zVQ-1-u1"><i>&lt;(build.nw) Common NoWeb Warning&gt;</i></a> ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3L4zVQ-1-u2" href="#NW0-3vAdAM-1" id="NW0-3L4zVQ-1-u2"><i>&lt;Generic ClearSilver HTML Macros&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># ?&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-33kkYH-1" href="#NW0-33kkYH-1" id="NW0-33kkYH-1"><dfn>&lt;(build.nw) Install other files&gt;=</dfn></a> <b>[D<a href="#NW0-33kkYH-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-33kkYH-1-u1" href="#nw@notdef" id="NW0-33kkYH-1-u1"><i>&lt;(cs-glib.nw) Install ClearSilver templates&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>

  <p>First, to start out a form, the form header must be printed.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-1" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-1"><dfn>&lt;Generic ClearSilver HTML Macros&gt;=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3vAdAM-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:form(fname,hasfiles)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;form </span><span class="kwb">name</span>=<span class="str">"&lt;?cs var:fname ?&gt;"</span> <span class="kwb">action</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">       var: CGI.ScriptName + CGI.PathInfo ?&gt;"</span><span class="kwa">&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
          if:hasfiles <span class="kwa">?&gt; </span><span class="kwb">enctype</span>=<span class="str">"multipart/form-data"</span><span class="kwa">&lt;?cs </span>/if <span class="kwa">?&gt;&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>For a standard text widget, only the variable name and default value are required. As with all of these macros, the CGI parameter value is retrieved from the <code>Query</code> variable hierarchy.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-2" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-2"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-1">&lt;-</a>D<a href="#NW0-3vAdAM-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:text(varn,default)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"text"</span> <span class="kwb">size</span>=<span class="str">"32"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    if: ?Query[varn] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      var:Query[varn] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    else ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      var:default ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    /if ?&gt;"</span> <span class="kwa">/&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Repeated text widgets are the same as regular text widgets, but a sequence number is attached to the variable name. The hierarchy is expected to go one level lower, using the sequence number. The first widget (0) is actually just like a normal text widget.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-3" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-3"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-2">&lt;-</a>D<a href="#NW0-3vAdAM-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:rtext(varn,seq,default)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"text"</span> <span class="kwb">size</span>=<span class="str">"32"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    if:?Query[varn][seq] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      var:Query[varn][seq] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    else ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      if:seq == "</span><span class="num">0</span><span class="str">" &amp;&amp; ?Query[varn] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        var:Query[varn] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      else ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        var:default ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      /if ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    /if ?&gt;"</span> <span class="kwa">/&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Hidden parameters are just printed once for every available value.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-4" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-4"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-3">&lt;-</a>D<a href="#NW0-3vAdAM-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:hidden(varn)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
    if:len(Query[varn]) <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
      each:v = Query[varn]
</pre>
      </li>

      <li>
        <pre>
       <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"hidden"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs var:v ?&gt;"</span> <span class="kwa">/&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;?cs  </span>/each <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
    elseif:?Query[varn]
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"hidden"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                       var:Query[varn] ?&gt;"</span> <span class="kwa">/&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
    /if <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>File selection widgets do not have defaults. Even if the variable is provided by the CGI, it does not necessarily match a local file name.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-5" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-5"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-4">&lt;-</a>D<a href="#NW0-3vAdAM-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:file(varn)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"file"</span> <span class="kwb">size</span>=<span class="str">"32"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                                          var:Query[varn] ?&gt;"</span> <span class="kwa">/&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Radio selections are checked if the CGI parameter matches the value, or if this is the default and the CGI parameter either does not exist or has no value.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-6" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-6"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-5">&lt;-</a>D<a href="#NW0-3vAdAM-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:radio(varn, val, isdef)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"radio"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs var:val ?&gt;"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span><span class="kwa">&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
    if:?Query[varn][<span class="str">"0"</span>] <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
      each:i = Query[varn] <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
        if: i == val <span class="kwa">?&gt; </span><span class="kwb">checked</span>=<span class="str">"checked"</span> <span class="kwa">&lt;?cs </span>/if <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
      /each <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
    else <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
      if: Query[varn] == val <span class="kwa">?&gt; </span><span class="kwb">checked</span>=<span class="str">"checked"</span> <span class="kwa">&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
      else <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
        if:isdef &amp;&amp; (!?Query[varn] || Query[varn] == <span class="str">""</span>) <span class="kwa">?&gt; </span><span class="kwb">checked</span>=<span class="str">"checked"</span> <span class="kwa">&lt;?cs </span>/if<span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
      /if <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
    /if <span class="kwa">?&gt; /&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Plain checkboxes always default to unchecked, as it is too hard to tell the difference between unchecked and missing. If a hidden value were added, it would be a little easier, but possibly inconsistent.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-7" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-7"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-6">&lt;-</a>D<a href="#NW0-3vAdAM-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:checkbox(varn)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"checkbox"</span> <span class="kwb">value</span>=<span class="str">"Y"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span><span class="kwa">&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
     if:Query[varn] <span class="kwa">?&gt; </span><span class="kwb">checked</span>=<span class="str">"checked"</span> <span class="kwa">&lt;?cs </span>/if <span class="kwa">?&gt;/&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Date widgets should really have a JavaScript calendar-based date selection button, but instead they are currently just plain text widgets. However, they are assigned an easy-to-identify class name to make adding the popup with dynamic HTML easier.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-8" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-8"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-7">&lt;-</a>D<a href="#NW0-3vAdAM-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:date(varn, def)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"text"</span> <span class="kwb">class</span>=<span class="str">"datesel"</span> <span class="kwb">size</span>=<span class="str">"12"</span> <span class="kwb">name</span>=<span class="str">"&lt;?cs var:varn ?&gt;"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    if: ?Query[varn] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      var:Query[varn] ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    else ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      var:default ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    /if ?&gt;"</span> <span class="kwa">/&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Submit buttons display the value as the button text, so the value cannot be used to determine the action. Instead, the parameter name is used. The label is the configuration value of <tt>labels.</tt><em>action</em>, and the parameter name is <tt>action.</tt><em>action</em>.</p>
  <pre class="dfn">
<a name="NW0-3vAdAM-9" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-9"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-8">&lt;-</a>D<a href="#NW0-3vAdAM-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:submit(action)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;&lt;input </span><span class="kwb">type</span>=<span class="str">"submit"</span> <span class="kwb">name</span>=<span class="str">"action.&lt;?cs var:action ?&gt;"</span> <span class="kwb">value</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                                           var:labels[action] ?&gt;"</span> <span class="kwa">/&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, a facility is provided for showing or hiding various HTML divisions using a selection widget (aka drop-down menu). If JavaScript is not supported by the browser, then all divisions will be displayed. The selection widget itself should not be displayed, either, so it is rendered using JavaScript. The less-than and greater-than symbols for the HTML tags are also escaped, so that simplistic HTML parsers don't get confused. Note that only one division set, and one selection widget are supported per page.</p>

  <p>In order to remain independent of web servers, this could be included entirely in-line. However, as a general rule, it is better to keep anything more complex than a function call in a separate JavaScript file to avoid quoting issues, and enable preparsing optimizations by the browser.</p>
  <pre class="dfn">
<a name="NW0-CePUR-1" href="#NW0-CePUR-1" id="NW0-CePUR-1"><dfn>&lt;JavaScript Files&gt;=</dfn></a> <b>(<a href="#NW0-13PeAG-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
html_prefix.js \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-30QJss-1" href="#NW0-30QJss-1" id="NW0-30QJss-1"><dfn>&lt;html_prefix.js&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
function <span class="kwd">showdiv</span><span class="opt">(</span>divno<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  var mydiv<span class="opt">, </span>i<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>i <span class="opt">= </span><span class="num">1</span><span class="opt">; (</span>mydiv <span class="opt">= </span>document<span class="opt">.</span><span class="kwd">getElementById</span><span class="opt">(</span><span class="str">'div'</span> <span class="opt">+ </span>i<span class="opt">)); </span>i<span class="opt">++)</span>
</pre>
      </li>

      <li>
        <pre>
    mydiv<span class="opt">.</span>style<span class="opt">.</span>display <span class="opt">= </span>divno <span class="opt">== </span>i ? <span class="str">"block"</span> <span class="opt">: </span><span class="str">"none"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3vAdAM-A" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-A"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-9">&lt;-</a>D<a href="#NW0-3vAdAM-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:optdiv_onload()
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;</span>showdiv(document.forms[<span class="num">0</span>]._ignore.selectedIndex);<span class="kwa">&lt;?cs </span>/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3vAdAM-B" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-B"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-A">&lt;-</a>D<a href="#NW0-3vAdAM-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:optdiv_start() <span class="kwa">?&gt;</span><span class="kwa">&lt;script language="javascript" type="text/javascript"&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">//&lt;![CDATA[</span>
</pre>
      </li>

      <li>
        <pre>
document<span class="opt">.</span><span class="kwd">writeln</span><span class="opt">(</span><span class="str">'</span><span class="esc">\x3C</span><span class="str">select name="_ignore" onchange="showdiv(this.value);"</span><span class="esc">\x3E</span><span class="str">'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
document<span class="opt">.</span><span class="kwd">write</span><span class="opt">(</span><span class="str">'</span><span class="esc">\x3C</span><span class="str">option value="0"</span><span class="esc">\x3E</span><span class="str">&lt;?cs var:labels.optdiv ?&gt;'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
document<span class="opt">.</span><span class="kwd">writeln</span><span class="opt">(</span><span class="str">'</span><span class="esc">\x3C</span><span class="str">/option</span><span class="esc">\x3E</span><span class="str">'</span><span class="opt">);&lt;?</span>cs <span class="opt">/</span>def <span class="opt">?&gt;&lt;?</span>cs
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3vAdAM-C" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-C"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-B">&lt;-</a>D<a href="#NW0-3vAdAM-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:optdiv_opt(n, v)
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;</span>document.write('<span class="esc">\x3C</span>option <span class="kwb">value</span>=<span class="str">"&lt;?cs var:v ?&gt;"</span><span class="esc">\x3E</span><span class="kwa">&lt;?cs </span>var:n <span class="kwa">?&gt;</span>');
</pre>
      </li>

      <li>
        <pre>
    document.writeln('<span class="esc">\x3C</span>/option<span class="esc">\x3E</span>');<span class="kwa">&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
     /def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3vAdAM-D" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-D"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-C">&lt;-</a>D<a href="#NW0-3vAdAM-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def:optdiv_end()
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">?&gt;</span>document.writeln('<span class="esc">\x3C</span>/select<span class="esc">\x3E</span>');
</pre>
      </li>

      <li>
        <pre>
//]]<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;/script&gt;&lt;?cs </span>/def <span class="kwa">?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>

  <p>This does require that yet another location must be chosen for installation. The HTML can still be kept generic enough for easy run-time override of the installation location.</p>
  <pre class="dfn">
<a name="NW0-AVbKa-1" href="#NW0-AVbKa-1" id="NW0-AVbKa-1"><dfn>&lt;CGI Support Configuration&gt;=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[D<a href="#NW0-AVbKa-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Location of JavaScript on the server</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#server_script_path = /js</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3DeDMu-1" href="#NW0-3DeDMu-1" id="NW0-3DeDMu-1"><dfn>&lt;(build.nw) makefile.config&gt;=</dfn></a> <b>[D<a href="#NW0-3DeDMu-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Installation directory for javascript files</span>
</pre>
      </li>

      <li>
        <pre>
JS_DIR<span class="opt">:=/</span>var<span class="opt">/</span>www<span class="opt">/</span>html<span class="opt">/</span>js
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-13PeAG-1" href="#NW0-13PeAG-1" id="NW0-13PeAG-1"><dfn>&lt;(build.nw) makefile.vars&gt;=</dfn></a> <b>[D<a href="#NW0-13PeAG-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
JS_FILES <span class="opt">= </span><a name="NW0-13PeAG-1-u1" href="#NW0-CePUR-1" id="NW0-13PeAG-1-u1"><i>&lt;JavaScript Files&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2kYumM-1" href="#NW0-2kYumM-1" id="NW0-2kYumM-1"><dfn>&lt;(build.nw) Plain Files&gt;=</dfn></a> <b>[D<a href="#NW0-2kYumM-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>JS_FILES<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-33kkYH-2" href="#NW0-33kkYH-1" id="NW0-33kkYH-2"><dfn>&lt;(build.nw) Install other files&gt;+=</dfn></a> <b>[<a href="#NW0-33kkYH-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
mkdir <span class="opt">-</span>p <span class="opt">$(</span>DESTDIR<span class="opt">)$(</span>JS_DIR<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
cp <span class="opt">-</span>p <span class="opt">$(</span>JS_FILES<span class="opt">) $(</span>DESTDIR<span class="opt">)$(</span>JS_DIR<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-31BAak-1" href="#NW0-31BAak-1" id="NW0-31BAak-1"><dfn>&lt;html_prefix.cs&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;script </span><span class="kwb">language</span>=<span class="str">"javascript"</span> <span class="kwb">type</span>=<span class="str">"text/javascript"</span> <span class="kwb">src</span>=<span class="str">"&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">       alt:server_script_path ?&gt;/js&lt;?cs /alt ?&gt;/html_prefix.js"</span><span class="kwa">&gt;&lt;/script&gt;</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc5" id="toc5">FastCGI Support</a></h1>

  <p>FastCGI support is implemented using the mostly undocumented direct functions of the <code>libfcgi</code> API. The standard I/O overrides are better documented, but intrusively override many standard functions. There is no standard method provided by <code>libfcgi</code> to find the libraries and include files, so standard <code>LDFLAGS</code> and <code>CFLAGS</code> overrides must be used if needed.</p>
  <pre class="dfn">
<a name="NW0-E8T1B-1" href="#NW0-E8T1B-1" id="NW0-E8T1B-1"><dfn>&lt;(cs-glib.nw) Library <code>cs-supt</code> Members&gt;=</dfn></a> <b>[D<a href="#NW0-E8T1B-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi.o
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1mOMve-1" href="#NW0-1mOMve-1" id="NW0-1mOMve-1"><dfn>&lt;(build.nw) Common C Includes&gt;=</dfn></a> <b>[D<a href="#NW0-1mOMve-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-1mOMve-1-u1" href="#NW0-3BiK3G-1" id="NW0-1mOMve-1-u1"><i>&lt;CGI Prerequisite Headers&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include </span><span class="pps">"cgi.h"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3BiK3G-1" href="#NW0-3BiK3G-1" id="NW0-3BiK3G-1"><dfn>&lt;CGI Prerequisite Headers&gt;=</dfn></a> <b>(<a href="#NW0-1mOMve-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3BiK3G-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;fcgiapp.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2wJhWs-1" href="#NW0-2wJhWs-1" id="NW0-2wJhWs-1"><dfn>&lt;cgi.h&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="com">/*</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">  <a name="NW0-2wJhWs-1-u1" href="#NW0-17AJkL-1" id="NW0-2wJhWs-1-u1"><i>&lt;(build.nw) Common NoWeb Warning&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">*/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#ifndef _CGI_H</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define _CGI_H</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2wJhWs-1-u2" href="#NW0-1ozy8z-1" id="NW0-2wJhWs-1-u2"><i>&lt;CGI Support Global Definitions&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif </span><span class="com">/* _CGI_H */</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-uQbLG-1" href="#NW0-uQbLG-1" id="NW0-uQbLG-1"><dfn>&lt;cgi.c&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-uQbLG-1-u1" href="#nw@notdef" id="NW0-uQbLG-1-u1"><i>&lt;(build.nw) Common C Header&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-uQbLG-1-u2" href="#NW0-20M5ji-1" id="NW0-uQbLG-1-u2"><i>&lt;CGI Support Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-uQbLG-1-u3" href="#NW0-wliTu-1" id="NW0-uQbLG-1-u3"><i>&lt;CGI Support Functions&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-13PeAG-2" href="#NW0-13PeAG-1" id="NW0-13PeAG-2"><dfn>&lt;(build.nw) makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-13PeAG-1">&lt;-</a>D<a href="#NW0-13PeAG-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
EXTRA_LDFLAGS <span class="opt">+= -</span>lfcgi
</pre>
      </li>
    </ol>
  </div>

  <p>Each FastCGI session is like an independent CGI program. This implies that no global variables should be used; instead, a master state structure is passed around.</p>
  <pre class="dfn">
<a name="NW0-1ozy8z-1" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-1"><dfn>&lt;CGI Support Global Definitions&gt;=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-1ozy8z-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">struct cgi_state_t cgi_state_t</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-1ozy8z-1-u1" href="#NW0-3DkYjs-1" id="NW0-1ozy8z-1-u1"><i>&lt;CGI State Dependencies&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">struct cgi_state_t </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1ozy8z-1-u2" href="#NW0-1Xz6uT-1" id="NW0-1ozy8z-1-u2"><i>&lt;CGI State Members&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">};</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-1" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-1"><dfn>&lt;(build.nw) Known Data Types&gt;=</dfn></a> <b>[D<a href="#NW0-4IhMOG-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">cgi_state_t</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The general program structure supported here is to perform global initializations before the main loop, and in the main loop spawn a thread for every incoming connection. The threads get the <code>cgi_state_t</code> structure for the current CGI execution. An initialization function is provided for the global initializations, and a generic main loop with a callback is provided for spwan loop. The callback is called from within the thread rather than as the main body of the thread so that cleanup is automatic. That means that the callback must be stored in the CGI state for the thread to call. In addition, a generic cleanup callback is provided; this should be overridden using a statically stored chain for each overrider to ensure that all cleaners are called. Calling from within the thread also allows the return code from the callback to be used; if an error is returned, that error is printed.</p>
  <pre class="dfn">
<a name="NW0-wliTu-1" href="#NW0-wliTu-1" id="NW0-wliTu-1"><dfn>&lt;CGI Support Functions&gt;=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-wliTu-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">init_cgi</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-1-u1" href="#NW0-1IHJKl-1" id="NW0-wliTu-1-u1"><i>&lt;Perform global CGI support initialization&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3DkYjs-1" href="#NW0-3DkYjs-1" id="NW0-3DkYjs-1"><dfn>&lt;CGI State Dependencies&gt;=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3DkYjs-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">struct cgi_state_t</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">cgi_callback_t</span><span class="opt">)(</span><span class="kwb">struct cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">void </span><span class="opt">(*</span><span class="kwb">cgi_cleanup_cb</span><span class="opt">)(</span><span class="kwb">struct cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-2" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-2"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-1">&lt;-</a>D<a href="#NW0-4IhMOG-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">cgi_callback_t</span><span class="opt">,</span><span class="kwb">cgi_cleanup_cb</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-1" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-1"><dfn>&lt;CGI State Members&gt;=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-1Xz6uT-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">cgi_callback_t </span>callback<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">cgi_cleanup_cb </span>cleanup<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-2" href="#NW0-wliTu-1" id="NW0-wliTu-2"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-1">&lt;-</a>D<a href="#NW0-wliTu-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static void </span><span class="opt">*</span><span class="kwd">run_cgi_thread</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>_state<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= (*</span>cgi_state<span class="opt">-&gt;</span>callback<span class="opt">)(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cleanup<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">(*</span>cgi_state<span class="opt">-&gt;</span>cleanup<span class="opt">)(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-wliTu-2-u1" href="#NW0-2yrxVk-1" id="NW0-wliTu-2-u1"><i>&lt;Display error from CGI callback&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-2-u2" href="#NW0-Y5eke-1" id="NW0-wliTu-2-u2"><i>&lt;Clean up after CGI callback&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-3" href="#NW0-wliTu-1" id="NW0-wliTu-3"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-2">&lt;-</a>D<a href="#NW0-wliTu-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">run_cgi</span><span class="opt">(</span><span class="kwb">cgi_callback_t </span>callback<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-wliTu-3-u1" href="#NW0-2eGq2f-1" id="NW0-wliTu-3-u1"><i>&lt;Allocate CGI state&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>callback <span class="opt">= </span>callback<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-wliTu-3-u2" href="#NW0-2l9Hcr-1" id="NW0-wliTu-3-u2"><i>&lt;Prepare for CGI thread&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-wliTu-3-u3" href="#NW0-1rdQ8D-1" id="NW0-wliTu-3-u3"><i>&lt;Spawn CGI thread&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-3-u4" href="#NW0-4ac5rz-1" id="NW0-wliTu-3-u4"><i>&lt;Wait for remaining CGI threads&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The most obvious global initializations are the memory pool for the CGI state structures, and the FastCGI subsystem.</p>
  <pre class="dfn">
<a name="NW0-1IHJKl-1" href="#NW0-1IHJKl-1" id="NW0-1IHJKl-1"><dfn>&lt;Perform global CGI support initialization&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-1IHJKl-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#if GLIB_MINOR_VERSION &lt; 10 </span><span class="com">/* GMemChunk is deprecated */</span>
</pre>
      </li>

      <li>
        <pre>
state_pool <span class="opt">= </span><span class="kwd">g_mem_chunk_create</span><span class="opt">(</span><span class="kwb">cgi_state_t</span><span class="opt">, </span><span class="num">16</span><span class="opt">, </span>G_ALLOC_AND_FREE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">FCGX_Init</span><span class="opt">();</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Rather than spawn a thread every time, which is what FastCGI is meant to avoid in the first place, a thread pool is used. The pool is generated in non-exclusive mode to prevent all of them from being created at once. GLib provides no control over how many idle threads to create initially. Only the maximum number of threads is configurable.</p>
  <pre class="dfn">
<a name="NW0-20M5ji-1" href="#NW0-20M5ji-1" id="NW0-20M5ji-1"><dfn>&lt;CGI Support Variables&gt;=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-20M5ji-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static GThreadPool </span><span class="opt">*</span>cgi_thread_pool <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-4" href="#NW0-wliTu-1" id="NW0-wliTu-4"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-3">&lt;-</a>D<a href="#NW0-wliTu-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static void </span><span class="kwd">run_cgi_thread_pool</span><span class="opt">(</span><span class="kwb">gpointer </span>data<span class="opt">, </span><span class="kwb">gpointer </span>user_data<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">run_cgi_thread</span><span class="opt">(</span>data<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-AVbKa-2" href="#NW0-AVbKa-1" id="NW0-AVbKa-2"><dfn>&lt;CGI Support Configuration&gt;+=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[<a href="#NW0-AVbKa-1">&lt;-</a>D<a href="#NW0-AVbKa-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Maximum number of FastCGI threads</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#max_cgi_threads = 64</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1IHJKl-2" href="#NW0-1IHJKl-1" id="NW0-1IHJKl-2"><dfn>&lt;Perform global CGI support initialization&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1IHJKl-1">&lt;-</a>D<a href="#NW0-1IHJKl-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi_thread_pool <span class="opt">= </span><span class="kwd">g_thread_pool_new</span><span class="opt">(</span>run_cgi_thread_pool<span class="opt">, </span>NULL<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                    <span class="kwd">getconf_int</span><span class="opt">(</span><span class="str">"max_cgi_threads"</span><span class="opt">, </span><span class="num">64</span><span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
                                    FALSE<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1rdQ8D-1" href="#NW0-1rdQ8D-1" id="NW0-1rdQ8D-1"><dfn>&lt;Spawn CGI thread&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-3">&lt;-U</a>)</b> <b>[D<a href="#NW0-1rdQ8D-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">g_thread_pool_push</span><span class="opt">(</span>cgi_thread_pool<span class="opt">, </span>cgi_state<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Keeping track of whether or not the threads are finished can be done several ways. The simplest is to just keep a count; in fact, the count can be retrieved from the pool. However, there is no signal associated with the pool's thread count, so waiting for the pool to empty is not possible. Instead, an integer thread counter is used, along with a lock and signal.</p>
  <pre class="dfn">
<a name="NW0-20M5ji-2" href="#NW0-20M5ji-1" id="NW0-20M5ji-2"><dfn>&lt;CGI Support Variables&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-20M5ji-1">&lt;-</a>D<a href="#NW0-20M5ji-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static pthread_mutex_t </span>cgi_state_lock <span class="opt">= </span>PTHREAD_MUTEX_INITIALIZER<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static pthread_cond_t </span>cgi_state_sig <span class="opt">= </span>PTHREAD_COND_INITIALIZER<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static int </span>cgi_thread_count <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1rdQ8D-2" href="#NW0-1rdQ8D-1" id="NW0-1rdQ8D-2"><dfn>&lt;Spawn CGI thread&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-3">&lt;-U</a>)</b> <b>[<a href="#NW0-1rdQ8D-1">&lt;-</a>D<a href="#NW0-1rdQ8D-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">++</span>cgi_thread_count<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-Y5eke-1" href="#NW0-Y5eke-1" id="NW0-Y5eke-1"><dfn>&lt;Clean up after CGI callback&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-2">&lt;-U</a>)</b> <b>[D<a href="#NW0-Y5eke-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">--</span>cgi_thread_count<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_cond_signal</span><span class="opt">(&amp;</span>cgi_state_sig<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4ac5rz-1" href="#NW0-4ac5rz-1" id="NW0-4ac5rz-1"><dfn>&lt;Wait for remaining CGI threads&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span>cgi_thread_count <span class="opt">&gt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">pthread_cond_wait</span><span class="opt">(&amp;</span>cgi_state_sig<span class="opt">, &amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Allocating a CGI state from a pool requries locking. The thread count lock can be reused for this purpose.</p>
  <pre class="dfn">
<a name="NW0-20M5ji-3" href="#NW0-20M5ji-1" id="NW0-20M5ji-3"><dfn>&lt;CGI Support Variables&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-20M5ji-2">&lt;-</a>D<a href="#NW0-20M5ji-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#if GLIB_MINOR_VERSION &lt; 10 </span><span class="com">/* GMemChunk is deprecated */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static GMemChunk </span><span class="opt">*</span>cgi_state_pool<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2eGq2f-1" href="#NW0-2eGq2f-1" id="NW0-2eGq2f-1"><dfn>&lt;Allocate CGI state&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#if GLIB_MINOR_VERSION &lt; 10 </span><span class="com">/* GMemChunk is deprecated */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state <span class="opt">= </span><span class="kwd">g_chunk_new0</span><span class="opt">(</span><span class="kwb">cgi_state_t</span><span class="opt">, </span>cgi_state_pool<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#else</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state <span class="opt">= </span><span class="kwd">g_slice_new0</span><span class="opt">(</span><span class="kwb">cgi_state_t</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-Y5eke-2" href="#NW0-Y5eke-1" id="NW0-Y5eke-2"><dfn>&lt;Clean up after CGI callback&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-2">&lt;-U</a>)</b> <b>[<a href="#NW0-Y5eke-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-Y5eke-2-u1" href="#NW0-3kDPKd-1" id="NW0-Y5eke-2-u1"><i>&lt;Free CGI state members&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if GLIB_MINOR_VERSION &lt; 10 </span><span class="com">/* GMemChunk is deprecated */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_chunk_free</span><span class="opt">(</span>cgi_state<span class="opt">, </span>cgi_state_pool<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_slice_free</span><span class="opt">(</span><span class="kwb">cgi_state_t</span><span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Since FastCGI programs are so similar to regular CGI programs, they should be expected to fall back to normal CGI behavior if invoked without FastCGI enabled. To support this, a global flag is used to distinguish the execution types, as well as macros to select the appropriate input and output funtions.</p>
  <pre class="dfn">
<a name="NW0-1mOMve-2" href="#NW0-1mOMve-1" id="NW0-1mOMve-2"><dfn>&lt;(build.nw) Common C Includes&gt;+=</dfn></a> <b>[<a href="#NW0-1mOMve-1">&lt;-</a>D<a href="#NW0-1mOMve-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;stdarg.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-2" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-2"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-1">&lt;-</a>D<a href="#NW0-1ozy8z-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">extern </span><span class="kwb">gboolean </span>is_cgi<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_puts(x) (is_cgi ? fputs(x, stdout) : \</span>
</pre>
      </li>

      <li>
        <pre>
                              <span class="kwd">FCGX_PutS</span><span class="opt">(</span>x<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>out<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_putc(x) (is_cgi ? putchar(x) : \</span>
</pre>
      </li>

      <li>
        <pre>
                              <span class="kwd">FCGX_PutChar</span><span class="opt">(</span>x<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>out<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_status(x) do { \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>is_cgi<span class="opt">) </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">FCGX_SetExitStatus</span><span class="opt">(</span>x<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>out<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">while</span><span class="opt">(</span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_raw_gets(x, l) (is_cgi ? fgets(x, l, stdin) : \</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwd">FCGX_GetLine</span><span class="opt">(</span>x<span class="opt">, </span>l<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>in<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_raw_read(x, l) (is_cgi ? fread(x, 1, l, stdin) : \</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwd">FCGX_GetStr</span><span class="opt">(</span>x<span class="opt">, </span>l<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>in<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_write(x, l) (is_cgi ? fwrite(x, 1, l, stdout) : \</span>
</pre>
      </li>

      <li>
        <pre>
                                  <span class="kwd">FCGX_PutStr</span><span class="opt">(</span>x<span class="opt">, </span>l<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>out<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_getenv(x) (is_cgi ? getenv(x) : \</span>
</pre>
      </li>

      <li>
        <pre>
                                <span class="kwd">FCGX_GetParam</span><span class="opt">(</span>x<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>envp<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_printf(f, ...) (is_cgi ? printf(f, __VA_ARGS__) : \</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwd">FCGX_FPrintF</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>out<span class="opt">, </span>f<span class="opt">, </span>\
</pre>
      </li>

      <li>
        <pre>
                                                  __VA_ARGS__<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_vprintf(f, a) (is_cgi ? vprintf(f, a) : \</span>
</pre>
      </li>

      <li>
        <pre>
                                    <span class="kwd">FCGX_VFPrintF</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>out<span class="opt">, </span>f<span class="opt">, </span>a<span class="opt">))</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-1" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-1"><dfn>&lt;(build.nw) C Prototypes&gt;=</dfn></a> <b>[D<a href="#NW0-3a9iNE-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_putc</span><span class="opt">(</span><span class="kwb">char </span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_write</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>length<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_printf</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>format<span class="opt">, ...);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_vprintf</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>fmt<span class="opt">, </span><span class="kwb">va_list </span>parms<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">cgi_status</span><span class="opt">(</span><span class="kwb">int </span>stat<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_raw_gets</span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>length<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_raw_read</span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>length<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span><span class="kwd">cgi_getenv</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-20M5ji-4" href="#NW0-20M5ji-1" id="NW0-20M5ji-4"><dfn>&lt;CGI Support Variables&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-20M5ji-3">&lt;-</a>D<a href="#NW0-20M5ji-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span>is_cgi<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1IHJKl-3" href="#NW0-1IHJKl-1" id="NW0-1IHJKl-3"><dfn>&lt;Perform global CGI support initialization&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1IHJKl-2">&lt;-</a>D<a href="#NW0-1IHJKl-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
is_cgi <span class="opt">= </span><span class="kwd">FCGX_IsCGI</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>debug <span class="opt">&amp;&amp; </span>is_cgi<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">setbuf</span><span class="opt">(</span>stdout<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1rdQ8D-3" href="#NW0-1rdQ8D-1" id="NW0-1rdQ8D-3"><dfn>&lt;Spawn CGI thread&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-3">&lt;-U</a>)</b> <b>[<a href="#NW0-1rdQ8D-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>is_cgi<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Unfortunately, not all operations are possible in threads. In particular, if there is a need to change the process identity via <code>setuid</code>(2) or similar functions, POSIX threads will change the identity for all threads in the process at the same time. Older Linux versions were buggy in that respect and in fact provided separate identities per thread, and in fact may still do so via <code>setfsuid</code>(2), but programs should not depend on buggy behavior or Linux-specific functions that may not even be exposed in the C library.</p>

  <p>Rather than maintain a separate process pool, it is expected that the callback will do a fork and wait for the subprocess to finish. A simple wrapper function is provided to make implementation easier. The wrapper will return <code>TRUE</code> if the child code is to be executed. It will not call <code>fork</code> for single-run CGI programs.</p>
  <pre class="dfn">
<a name="NW0-1mOMve-3" href="#NW0-1mOMve-1" id="NW0-1mOMve-3"><dfn>&lt;(build.nw) Common C Includes&gt;+=</dfn></a> <b>[<a href="#NW0-1mOMve-2">&lt;-</a>D<a href="#NW0-1mOMve-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;sys/wait.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-5" href="#NW0-wliTu-1" id="NW0-wliTu-5"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-4">&lt;-</a>D<a href="#NW0-wliTu-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span><span class="kwd">cgi_fork</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">pid_t </span>child_pid <span class="opt">= </span>is_cgi ? <span class="num">0 </span><span class="opt">: </span><span class="kwd">fork</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>child_pid <span class="opt">&lt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_neo_error</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"fork"</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>child_pid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">waitpid</span><span class="opt">(</span>child_pid<span class="opt">, </span>NULL<span class="opt">, </span><span class="num">0</span><span class="opt">) &lt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>errno <span class="opt">!= </span>EINTR <span class="opt">&amp;&amp; </span>errno <span class="opt">!= </span>EAGAIN<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">cgi_neo_error</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"fork"</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="opt">!</span>child_pid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Sometimes it may be useful to print strings escaped. Rather than allocating a string, escaping into that memory, and then printing and freeing that memory, these functions print their parameters escaped. These functions are not in any which way Unicode compatible.</p>
  <pre class="dfn">
<a name="NW0-wliTu-6" href="#NW0-wliTu-1" id="NW0-wliTu-6"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-5">&lt;-</a>D<a href="#NW0-wliTu-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_puts_url_escape</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>e<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*</span>s<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>e <span class="opt">= </span>s<span class="opt">; *</span>e <span class="opt">&amp;&amp; (</span><span class="kwd">isalnum</span><span class="opt">(*</span>e<span class="opt">) || *</span>e <span class="opt">== </span><span class="str">'.'</span> <span class="opt">|| *</span>e <span class="opt">== </span><span class="str">'-'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="opt">*</span>e <span class="opt">== </span><span class="str">'_'</span> <span class="opt">||*</span>e <span class="opt">== </span><span class="str">'~'</span><span class="opt">); </span>e<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>e <span class="opt">!= </span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">cgi_write</span><span class="opt">(</span>s<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>e <span class="opt">- </span>s<span class="opt">)) &lt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"CGI Write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">' '</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">cgi_putc</span><span class="opt">(</span><span class="str">'+'</span><span class="opt">) == </span>EOF<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"CGI Write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">cgi_printf</span><span class="opt">(</span><span class="str">"%%%02X"</span><span class="opt">, (</span><span class="kwb">int</span><span class="opt">)*</span>e<span class="opt">) &lt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"CGI Write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span>e <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-7" href="#NW0-wliTu-1" id="NW0-wliTu-7"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-6">&lt;-</a>D<a href="#NW0-wliTu-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="kwb">gboolean </span>is_js<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>e<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*</span>s<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>e <span class="opt">= </span>s<span class="opt">; *</span>e <span class="opt">&amp;&amp; (</span><span class="kwd">isgraph</span><span class="opt">(*</span>e<span class="opt">) || *</span>e <span class="opt">== </span><span class="str">' '</span> <span class="opt">|| *</span>e <span class="opt">== </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="opt">*</span>e <span class="opt">!= </span><span class="str">'&lt;'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'&gt;'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'&amp;'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'"'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'</span><span class="esc">\'</span><span class="str">'</span> <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="opt">(*</span>e <span class="opt">!= </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span> <span class="opt">|| !</span>is_js<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        e<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>e <span class="opt">!= </span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">cgi_write</span><span class="opt">(</span>s<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>e <span class="opt">- </span>s<span class="opt">)) &lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"CGI Write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!*</span>e<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'&lt;'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&amp;lt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'&gt;'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&amp;gt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'&amp;'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&amp;amp;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if 0  </span><span class="com">/* &amp;#34; shorter &amp; more portable than &amp;quot; - same for ' and &amp;apos; */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&amp;quot;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'</span><span class="esc">\'</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&amp;apos;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"</span><span class="esc">\\\\</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">cgi_printf</span><span class="opt">(</span><span class="str">"&amp;#%02X;"</span><span class="opt">, (</span><span class="kwb">int</span><span class="opt">)*</span>e<span class="opt">) - </span><span class="num">1</span><span class="opt">; </span><span class="com">/* &lt;= 0, not just &lt; 0 -&gt; err */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">&lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"CGI Write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span>e <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>For building strings, GLib provides <code>g_string_append_uri_escaped</code>, but no equivalent for HTML escaping. Actually, before <i>2.16</i>, it does not provide either. Since for most uses, the default behavior is fine, no support is provided for <code>reserved_chars_allowed</code> or <code>allow_utf8</code> in the reimplementation of <code>g_string_append_uri_escaped</code>.</p>
  <pre class="dfn">
<a name="NW0-wliTu-8" href="#NW0-wliTu-1" id="NW0-wliTu-8"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-7">&lt;-</a>D<a href="#NW0-wliTu-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span><span class="kwd">g_string_append_html_escaped</span><span class="opt">(</span><span class="kwb">GString </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="kwb">gboolean </span>is_js<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>e<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*</span>s<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>e <span class="opt">= </span>s<span class="opt">; *</span>e <span class="opt">&amp;&amp; </span><span class="kwd">isgraph</span><span class="opt">(*</span>e<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="opt">*</span>e <span class="opt">!= </span><span class="str">'&lt;'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'&gt;'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'&amp;'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'"'</span> <span class="opt">&amp;&amp; *</span>e <span class="opt">!= </span><span class="str">'</span><span class="esc">\'</span><span class="str">'</span> <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="opt">(*</span>e <span class="opt">!= </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span> <span class="opt">|| !</span>is_js<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        e<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>e <span class="opt">!= </span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append_len</span><span class="opt">(</span>buf<span class="opt">, </span>s<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>e <span class="opt">- </span>s<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!*</span>e<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'&lt;'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;lt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'&gt;'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;gt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'&amp;'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;amp;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if 0  </span><span class="com">/* &amp;#34; shorter &amp; more portable than &amp;quot; - same for ' and &amp;apos; */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;quot;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'</span><span class="esc">\'</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;apos;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"</span><span class="esc">\\\\</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append_printf</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;#%02X;"</span><span class="opt">, (</span><span class="kwb">int</span><span class="opt">)*</span>e<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span>e <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-9" href="#NW0-wliTu-1" id="NW0-wliTu-9"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-8">&lt;-</a>D<a href="#NW0-wliTu-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#if !GLIB_CHECK_VERSION(2,16,0)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span><span class="kwd">g_string_append_uri_escaped</span><span class="opt">(</span><span class="kwb">GString </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwb">const char </span><span class="opt">*</span>reserved<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwb">gboolean </span>utf8<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>e<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*</span>s<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>e <span class="opt">= </span>s<span class="opt">; *</span>e <span class="opt">&amp;&amp; (</span><span class="kwd">isalnum</span><span class="opt">(*</span>e<span class="opt">) || *</span>e <span class="opt">== </span><span class="str">'.'</span> <span class="opt">|| *</span>e <span class="opt">== </span><span class="str">'-'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="opt">*</span>e <span class="opt">== </span><span class="str">'_'</span> <span class="opt">||*</span>e <span class="opt">== </span><span class="str">'~'</span><span class="opt">); </span>e<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>e <span class="opt">!= </span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append_len</span><span class="opt">(</span>buf<span class="opt">, </span>s<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>e <span class="opt">- </span>s<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>e <span class="opt">== </span><span class="str">' '</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append_c</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">'+'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append_printf</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"%%%02X"</span><span class="opt">, (</span><span class="kwb">int</span><span class="opt">)*</span>e<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span>e <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>
    </ol>
  </div>

  <p>JSON encoding is provided already for strings, but converting to a string before writing to CGI output may be inefficient for large objects and arrays. For this reason, a function is provided to use the string version for the leaf values, but to output the object and array delimiters directly. This limits the total size of dynamically allocated string buffers. Since reading JSON from a CGI stream will never happen (CGI input is always parsed as CGI parameters), no equivalent input function is provided.</p>
  <pre class="dfn">
<a name="NW0-wliTu-A" href="#NW0-wliTu-1" id="NW0-wliTu-A"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-9">&lt;-</a>D<a href="#NW0-wliTu-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_output_json</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>hdf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GString </span><span class="opt">*</span>buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define io_nerr_op(op) do { \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>op <span class="opt">&lt; </span><span class="num">0</span><span class="opt">) </span>\
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"JSON output"</span><span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">while</span><span class="opt">(</span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>hdf<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">json_var_type </span>vt <span class="opt">= </span><span class="kwd">hdf_json_var_type</span><span class="opt">(</span>hdf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>vt <span class="opt">== </span>JSON_ARRAY<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">char </span>c <span class="opt">= </span><span class="str">'['</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_sort_obj</span><span class="opt">(</span>hdf<span class="opt">, </span>comp_hdf_name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>hdf <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>hdf<span class="opt">); </span>hdf<span class="opt">; </span>hdf <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>hdf<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">io_nerr_op</span><span class="opt">(</span><span class="kwd">cgi_putc</span><span class="opt">(</span>c<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        c <span class="opt">= </span><span class="str">','</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_output_json</span><span class="opt">(</span>cgi_state<span class="opt">, </span>hdf<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">io_nerr_op</span><span class="opt">(</span><span class="kwd">cgi_putc</span><span class="opt">(</span><span class="str">']'</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      buf <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">char </span>c <span class="opt">= </span><span class="str">'{'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>hdf <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>hdf<span class="opt">); </span>hdf<span class="opt">; </span>hdf <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>hdf<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">io_nerr_op</span><span class="opt">(</span><span class="kwd">cgi_putc</span><span class="opt">(</span>c<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        c <span class="opt">= </span><span class="str">','</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">g_string_truncate</span><span class="opt">(</span>buf<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">append_unicode_quoted</span><span class="opt">(</span>buf<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>hdf<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">io_nerr_op</span><span class="opt">(</span><span class="kwd">cgi_puts</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">io_nerr_op</span><span class="opt">(</span><span class="kwd">cgi_putc</span><span class="opt">(</span><span class="str">':'</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_output_json</span><span class="opt">(</span>cgi_state<span class="opt">, </span>hdf<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">io_nerr_op</span><span class="opt">(</span><span class="kwd">cgi_putc</span><span class="opt">(</span><span class="str">'}'</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  buf <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append_json</span><span class="opt">(</span>buf<span class="opt">, </span>hdf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Any errors that occur should be printed to the user, but not with the standard error reporting mechanism. Instead, they should be reported via the CGI output stream. Unfortunately, that is impossible during initial setup for FastCGI programs, so a dummy <code>NULL</code> CGI state indicates that regular output should be used instead. If the CGI state exists, it is assumed that the call is from a NEOERR returning function, so the error is simply returned. This breaks usage in the mainline even though it never gets invoked, so <code>DIE_IF_ERR</code> is toggled from the error to a static 1 in the mainline. Once an error is returned from the primary callback, it is displayed to the user.</p>
  <pre class="dfn">
<a name="NW0-pXiuJ-1" href="#NW0-pXiuJ-1" id="NW0-pXiuJ-1"><dfn>&lt;CGI Message Overrides&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-B">U-&gt;</a> <a href="#NW0-n15ju-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#undef die_if_err</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define die_if_err(err) do { \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>_err <span class="opt">= </span>err<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
 \
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>_err <span class="opt">!= </span>STATUS_OK<span class="opt">) { </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">) </span>\
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>DIE_IF_ERR<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(!</span>is_cgi<span class="opt">) </span>\
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_log_error</span><span class="opt">(</span>_err<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else </span>\
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">cgi_log_error_stdout</span><span class="opt">(</span>_err<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">exit</span><span class="opt">(</span><span class="num">1</span><span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span>\
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">while</span><span class="opt">(</span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define DIE_IF_ERR _err</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-B" href="#NW0-wliTu-1" id="NW0-wliTu-B"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-A">&lt;-</a>D<a href="#NW0-wliTu-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-wliTu-B-u1" href="#NW0-pXiuJ-1" id="NW0-wliTu-B-u1"><i>&lt;CGI Message Overrides&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4fQs2w-1" href="#NW0-4fQs2w-1" id="NW0-4fQs2w-1"><dfn>&lt;CGI Mainline Variables&gt;=</dfn></a> <b>(<a href="#NW0-n15ju-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-4fQs2w-1-u1" href="#nw@notdef" id="NW0-4fQs2w-1-u1"><i>&lt;(cs-glib.nw) Common Mainline Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="kwb">unused_attr </span><span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#undef DIE_IF_ERR</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define DIE_IF_ERR 1</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3zffVE-1" href="#NW0-3zffVE-1" id="NW0-3zffVE-1"><dfn>&lt;CGI Per-Run Variables&gt;=</dfn></a> <b>(<a href="#NW0-n15ju-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-3zffVE-1-u1" href="#nw@notdef" id="NW0-3zffVE-1-u1"><i>&lt;(cs-glib.nw) Common Mainline Variables&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>

  <p>The error itself is printed as HTML or HTTP text, from a template. The HTTP header can be suppressed by setting the <code>header_printed</code> variable to non-blank in the CGI state's HDF. The default status of 500 can also be overridden by setting the <code>error_status</code> variable. The text to print can also be overridden by a template by setting the <code>error_tmpl</code> variable, which may use the error text in <code>error_text</code>. If the HTML tags have already been printed, the XML will become invalid, and if they haven't, the document type will not be printed. In either case, most browsers will print the message anyway, and don't care. Note that in addition to the ability to override the header, this differs from the standard kit's <code>cgi_neo_error</code> in that it will HTML-escape the message.</p>
  <pre class="dfn">
<a name="NW0-wliTu-C" href="#NW0-wliTu-1" id="NW0-wliTu-C"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-B">&lt;-</a>D<a href="#NW0-wliTu-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">cgi_log_error_stdout</span><span class="opt">(</span><span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  is_cgi <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_log_error</span><span class="opt">(</span>nerr<span class="opt">, </span>NULL<span class="opt">, </span>local_config<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">cgi_log_error</span><span class="opt">(</span><span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>hdf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span>_cgi_state<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state <span class="opt">= &amp;</span>_cgi_state<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>hdf <span class="opt">= </span>hdf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!*</span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"header_printed"</span><span class="opt">, </span><span class="str">""</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">const char </span><span class="opt">*</span>status <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>status <span class="opt">|| !*</span>status<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      status <span class="opt">= </span><span class="str">"500 Internal Server Error"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_status</span><span class="opt">(</span><span class="kwd">atoi</span><span class="opt">(</span>status<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Content-type: text/html</span><span class="esc">\n</span><span class="str">Status: "</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span>status<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"</span><span class="esc">\n\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-C-u1" href="#nw@notdef" id="NW0-wliTu-C-u1"><i>&lt;(cs-glib.nw) Convert <code>nerr</code> to <code>err_str</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>tmpl <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"error_tmpl"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>tmpl <span class="opt">&amp;&amp; *</span>tmpl<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">NEOERR </span><span class="opt">*</span>nerr2 <span class="opt">= </span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_text"</span><span class="opt">, </span>err_str<span class="opt">.</span>buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr2 <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      nerr2 <span class="opt">= </span><span class="kwd">tmpl_to_cgi</span><span class="opt">(</span>tmpl<span class="opt">, </span>cgi_state<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr2 <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      tmpl <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr2<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>tmpl <span class="opt">|| !*</span>tmpl<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;html&gt;&lt;body&gt;An error occurred:&lt;pre&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>err_str<span class="opt">.</span>buf<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">string_clear</span><span class="opt">(&amp;</span>err_str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2yrxVk-1" href="#NW0-2yrxVk-1" id="NW0-2yrxVk-1"><dfn>&lt;Display error from CGI callback&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">cgi_log_error</span><span class="opt">(</span>nerr<span class="opt">, </span>cgi_state<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-AVbKa-3" href="#NW0-AVbKa-1" id="NW0-AVbKa-3"><dfn>&lt;CGI Support Configuration&gt;+=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[<a href="#NW0-AVbKa-2">&lt;-</a>D<a href="#NW0-AVbKa-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Set to non-blank to override message to print on errors</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># This is evaluated as a ClearSilver template in the CGI environment; the</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># text of the error message is in the error_text variable.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># The default message prints:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#  &lt;html&gt;&lt;body&gt;&lt;h3&gt;An error occurred while processing your request:&lt;/h3&gt;&lt;pre&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#  &lt;?cs var:error_text ?&gt;&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#error_tmpl = &lt;html&gt;&lt;body&gt;&lt;h3&gt;An error occurred while processing ...</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Set to non-blank to override the status to return on errors</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#error_status = 500 Internal Server Error</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Set to non-blank to disable printing the HTTP header for error messages</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># This is usually set by any template which prints an HTTP header.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#header_printed =</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The only thing that really needs to be prepared for the CGI thread other than allocating the CGI state is to wait for a CGI request and assign the appropriate information to the FastCGI request structure. For plain CGI requests, there is no need to fill in a request at all.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-2" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-2"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-1">&lt;-</a>D<a href="#NW0-1Xz6uT-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">FCGX_Request </span>req<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2l9Hcr-1" href="#NW0-2l9Hcr-1" id="NW0-2l9Hcr-1"><dfn>&lt;Prepare for CGI thread&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>is_cgi<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">FCGX_InitRequest</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">, </span><span class="num">0</span><span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">FCGX_Accept_r</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">) &lt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">--</span>cgi_thread_count<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if GLIB_MINOR_VERSION &lt; 10 </span><span class="com">/* GMemChunk is deprecated */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_chunk_free</span><span class="opt">(</span>cgi_state<span class="opt">, </span>cgi_state_pool<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_slice_free</span><span class="opt">(</span><span class="kwb">cgi_state_t</span><span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>cgi_state_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kDPKd-1" href="#NW0-3kDPKd-1" id="NW0-3kDPKd-1"><dfn>&lt;Free CGI state members&gt;=</dfn></a> <b>(<a href="#NW0-Y5eke-2">&lt;-U</a>)</b> <b>[D<a href="#NW0-3kDPKd-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>is_cgi<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">FCGX_Finish_r</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* FCGX_Free(&amp;cgi_state-&gt;req); */</span> <span class="com">/* freeing supposedly done by Finish */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Support for macros in FastCGI programs is partially provided by the HDF forms of the template processing routines. However, the ones providing just file output are inappropriate. Instead, CGI output versions are provided.</p>
  <pre class="dfn">
<a name="NW0-wliTu-D" href="#NW0-wliTu-1" id="NW0-wliTu-D"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-C">&lt;-</a>D<a href="#NW0-wliTu-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cs_to_cgi</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>user<span class="opt">, </span><span class="kwb">char </span><span class="opt">*</span>str<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>user<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">cgi_puts</span><span class="opt">(</span>str<span class="opt">) &lt; </span><span class="num">0 </span>? <span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Writing"</span><span class="opt">) : </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-E" href="#NW0-wliTu-1" id="NW0-wliTu-E"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-D">&lt;-</a>D<a href="#NW0-wliTu-F">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">tmpl_to_cgi_hdf</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>tmpl<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>parms<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwb">gboolean </span>raw<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_pass</span><span class="opt">(</span><span class="kwd">tmpl_string_to</span><span class="opt">(</span>tmpl<span class="opt">, </span>parms<span class="opt">, </span>cs_to_cgi<span class="opt">, </span>cgi_state<span class="opt">, </span>raw<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">tmpl_to_cgi</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>tmpl<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>raw<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_pass</span><span class="opt">(</span><span class="kwd">tmpl_to_cgi_hdf</span><span class="opt">(</span>tmpl<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span>cgi_state<span class="opt">, </span>raw<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-F" href="#NW0-wliTu-1" id="NW0-wliTu-F"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-E">&lt;-</a>D<a href="#NW0-wliTu-G">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">tmpl_file_to_cgi_hdf</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>tmpl<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>parms<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>raw<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_pass</span><span class="opt">(</span><span class="kwd">tmpl_file_to</span><span class="opt">(</span>tmpl<span class="opt">, </span>parms<span class="opt">, </span>cs_to_cgi<span class="opt">, </span>cgi_state<span class="opt">, </span>raw<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">tmpl_file_to_cgi</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>tmpl<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>raw<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_pass</span><span class="opt">(</span><span class="kwd">tmpl_file_to_cgi_hdf</span><span class="opt">(</span>tmpl<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span>cgi_state<span class="opt">, </span>raw<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc6" id="toc6">CGI Parameter Parsing</a></h1>

  <p>Once in the thread, though, the real work starts. A function is provided to do most of the initialization work. First, the CGI kit environment must be initialized. This includes setting the function overrides that will enable FastCGI. The <code>putenv</code> and <code>iterenv</code> functions are not provided; this means that the CGI kit's <code>debug_init</code> for reading parameters from configuration files will not work, and the <code>cgi_output</code> and <code>cgi_display</code> functions will not work with debugging turned on. The CGI parameters will be merged with the global program-wide parameters, so a copy of those global parameters must be made to pass into the kit.</p>
  <pre class="dfn">
<a name="NW0-wliTu-G" href="#NW0-wliTu-1" id="NW0-wliTu-G"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-F">&lt;-</a>D<a href="#NW0-wliTu-H">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static int </span><span class="kwd">read_fcgi</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>parm<span class="opt">, </span><span class="kwb">char </span><span class="opt">*</span>data<span class="opt">, </span><span class="kwb">int </span>len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>parm<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-G-u1" href="#NW0-qLGmJ-1" id="NW0-wliTu-G-u1"><i>&lt;Read data from CGI stream&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static int </span><span class="kwd">writef_fcgi</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>parm<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>fmt<span class="opt">, </span><span class="kwb">va_list </span>args<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>parm<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">cgi_vprintf</span><span class="opt">(</span>fmt<span class="opt">, </span>args<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static int </span><span class="kwd">write_fcgi</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>parm<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>data<span class="opt">, </span><span class="kwb">int </span>len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>parm<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">cgi_write</span><span class="opt">(</span>data<span class="opt">, </span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static char </span><span class="opt">*</span><span class="kwd">getenv_fcgi</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>parm<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>parm<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* NOTE: return value *must* be malloc'd */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>s <span class="opt">= </span><span class="kwd">cgi_getenv</span><span class="opt">(</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">strdup</span><span class="opt">(</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-3" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-3"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-2">&lt;-</a>D<a href="#NW0-1Xz6uT-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>hdf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">CGI </span><span class="opt">*</span>cgi<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-H" href="#NW0-wliTu-1" id="NW0-wliTu-H"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-G">&lt;-</a>D<a href="#NW0-wliTu-I">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">init_cgi_run</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">hdf_init</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">hdf_copy</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span>NULL<span class="opt">, </span>local_config<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgiwrap_init_emu</span><span class="opt">(</span>cgi_state<span class="opt">, </span>read_fcgi<span class="opt">, </span>writef_fcgi<span class="opt">, </span>write_fcgi<span class="opt">, </span>getenv_fcgi<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                   NULL<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">cgi_init</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>hdf <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">-&gt;</span>hdf<span class="opt">; </span><span class="com">/* in case it changed */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-H-u1" href="#NW0-1Jgq0O-1" id="NW0-wliTu-H-u1"><i>&lt;Initialize this CGI run&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kDPKd-2" href="#NW0-3kDPKd-1" id="NW0-3kDPKd-2"><dfn>&lt;Free CGI state members&gt;+=</dfn></a> <b>(<a href="#NW0-Y5eke-2">&lt;-U</a>)</b> <b>[<a href="#NW0-3kDPKd-1">&lt;-</a>D<a href="#NW0-3kDPKd-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-3kDPKd-2-u1" href="#NW0-2DIX1I-1" id="NW0-3kDPKd-2-u1"><i>&lt;Perform cleanups requiring valid CGI parameters&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_destroy</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>For convenience, the CGI parameters and cookies are stored separately in the CGI state structure. If none were created by <code>cgi_init</code> from the environment, empty HDF entries will be created. A few macros are provided as well for quick access.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-4" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-4"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-3">&lt;-</a>D<a href="#NW0-1Xz6uT-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>cgi_parms<span class="opt">, *</span>cookies<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-3" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-3"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-2">&lt;-</a>D<a href="#NW0-1ozy8z-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define cgi_env_val(n, d) hdf_get_value(cgi_state-&gt;hdf, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_env_val_int(n, d) hdf_get_int64_value(cgi_state-&gt;hdf, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_env_set(n, v) hdf_set_value(cgi_state-&gt;hdf, n, v)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_env_set_int(n, v) hdf_set_int64_value(cgi_state-&gt;hdf, n, v)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_env_obj(n) hdf_get_obj(cgi_state-&gt;hdf, n)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_parm_val(n, d) hdf_get_value(cgi_state-&gt;cgi_parms, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_parm_val_int(n, d) hdf_get_int64_value(cgi_state-&gt;cgi_parms, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_parm_obj(n) hdf_get_obj(cgi_state-&gt;cgi_parms, n)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_parm_set(n, v) hdf_set_value(cgi_state-&gt;cgi_parms, n, v)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_parm_set_int(n, v) hdf_set_int64_value(cgi_state-&gt;cgi_parms, n, v)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_cookie_val(n, d) hdf_get_value(cgi_state-&gt;cookies, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_cookie_val_int(n, d) hdf_get_int64_value(cgi_state-&gt;cookies, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_cookie_obj(n) hdf_get_obj(cgi_state-&gt;cookies, n)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_cookie_set(n, v) hdf_set_value(cgi_state-&gt;cookies, n, v)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_cookie_set_int(n, v) hdf_set_int64_value(cgi_state-&gt;cookies, n, v)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-2" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-2"><dfn>&lt;(build.nw) C Prototypes&gt;+=</dfn></a> <b>[<a href="#NW0-3a9iNE-1">&lt;-</a>D<a href="#NW0-3a9iNE-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>def<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gint64 </span><span class="kwd">cgi_env_val_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>def<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>value<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_env_set_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>value<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span><span class="kwd">cgi_env_obj</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>def<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gint64 </span><span class="kwd">cgi_parm_val_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>def<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span><span class="kwd">cgi_parm_obj</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_parm_set</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>value<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_parm_set_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>value<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>def<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gint64 </span><span class="kwd">cgi_cookie_val_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>def<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span><span class="kwd">cgi_cookie_obj</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_cookie_set</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>value<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_cookie_set_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>value<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-1" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-1"><dfn>&lt;Initialize this CGI run&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[D<a href="#NW0-1Jgq0O-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">hdf_get_node</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"Query"</span><span class="opt">, &amp;</span>cgi_state<span class="opt">-&gt;</span>cgi_parms<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">hdf_get_node</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"Cookie"</span><span class="opt">, &amp;</span>cgi_state<span class="opt">-&gt;</span>cookies<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In addition, some looping macros are provided to support the standard method of storing a single-valued CGI parameter as just a value, and a multi-valued parameter as children.</p>
  <pre class="dfn">
<a name="NW0-1ozy8z-4" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-4"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-3">&lt;-</a>D<a href="#NW0-1ozy8z-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define for_each_cgi_parm_obj(obj, f, ...) do { \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>obj<span class="opt">)) { </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>obj <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>obj<span class="opt">); </span>obj <span class="opt">&amp;&amp; </span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                                                    obj <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>obj<span class="opt">)) </span>\
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">f</span><span class="opt">(</span>obj<span class="opt">, </span>__VA_ARGS__<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">f</span><span class="opt">(</span>obj<span class="opt">, </span>__VA_ARGS__<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">while</span><span class="opt">(</span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define for_each_cgi_parm(p, f, ...) do { \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>__p <span class="opt">= </span><span class="kwd">cgi_parm_obj</span><span class="opt">(</span>p<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">for_each_cgi_parm_obj</span><span class="opt">(</span>__p<span class="opt">, </span>f<span class="opt">, </span>__VA_ARGS__<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">while</span><span class="opt">(</span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-3" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-3"><dfn>&lt;(build.nw) C Prototypes&gt;+=</dfn></a> <b>[<a href="#NW0-3a9iNE-2">&lt;-</a>D<a href="#NW0-3a9iNE-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="opt">(*</span><span class="kwb">for_each_cb</span><span class="opt">)(</span><span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">, ...);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">for_each_cgi_parm_obj</span><span class="opt">(</span><span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">, </span><span class="kwb">for_each_cb </span>f<span class="opt">, ...);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">for_each_cgi_parm</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">for_each_cb </span>f<span class="opt">, ...);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-3" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-3"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-2">&lt;-</a>D<a href="#NW0-4IhMOG-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">for_each_cb</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>

  <p>There are a number of HTTP headers which the CGI kit does not turn into HDF parameters, but which are relevant. Instead of picking headers to add, all HTTP headers are added as HDF parameters. Case is converted the same way as the standard ones, and all are added under the HTTP hierarchy. The only one that will end up duplicated is the differently named <code>HTTP_SOAPACTION</code> translation to Soap.Action. For convenience, the HTTP headers are also stored in the CGI state directly.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-5" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-5"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-4">&lt;-</a>D<a href="#NW0-1Xz6uT-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>headers<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-2" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-2"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-1">&lt;-</a>D<a href="#NW0-1Jgq0O-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>header_env <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* const */</span> <span class="kwb">char </span><span class="opt">**</span>envp<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* NOTE: POSIX says environ should be in unistd.h, but GNU considers it */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* an extension.  It could also come from 3rd main() parm, but adding */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* that to CGI apps would cause cproto to break apps that don't use it */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">extern </span><span class="kwb">char </span><span class="opt">**</span>environ<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for</span><span class="opt">(</span>envp <span class="opt">= </span>is_cgi ? environ <span class="opt">: </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>envp<span class="opt">; *</span>envp<span class="opt">; </span>envp<span class="opt">++)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strncmp</span><span class="opt">(*</span>envp<span class="opt">, </span><span class="str">"HTTP_"</span><span class="opt">, </span><span class="num">5</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">char </span><span class="opt">*</span>d<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>firstc <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_assign</span><span class="opt">(</span>header_env<span class="opt">, *</span>envp<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    header_env<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">4</span><span class="opt">] = </span><span class="str">'.'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>s <span class="opt">= </span>d <span class="opt">= </span>header_env<span class="opt">-&gt;</span>str <span class="opt">+ </span><span class="num">5</span><span class="opt">; *</span>s <span class="opt">&amp;&amp; *</span>s <span class="opt">!= </span><span class="str">'='</span><span class="opt">; </span>s<span class="opt">++, </span>d<span class="opt">++) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'_'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        firstc <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        d<span class="opt">--;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>firstc<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        firstc <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>d <span class="opt">= </span><span class="kwd">toupper</span><span class="opt">(*</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>d <span class="opt">= </span><span class="kwd">tolower</span><span class="opt">(*</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'='</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>d <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_env_obj</span><span class="opt">(</span>header_env<span class="opt">-&gt;</span>str<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span>header_env<span class="opt">-&gt;</span>str<span class="opt">, </span>s <span class="opt">+ </span><span class="num">1</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_free</span><span class="opt">(</span>header_env<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_get_node</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"HTTP"</span><span class="opt">, &amp;</span>cgi_state<span class="opt">-&gt;</span>headers<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-5" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-5"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-4">&lt;-</a>D<a href="#NW0-1ozy8z-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define cgi_header_obj(n) hdf_get_obj(cgi_state-&gt;headers, n)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_header_val(n, d) hdf_get_value(cgi_state-&gt;headers, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_header_val_int(n, d) hdf_get_int64_value(cgi_state-&gt;headers, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_header_set(n, v) hdf_set_value(cgi_state-&gt;headers, n, v)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_header_set_int(n, v) hdf_set_int64_value(cgi_state-&gt;headers, n, v)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-4" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-4"><dfn>&lt;(build.nw) C Prototypes&gt;+=</dfn></a> <b>[<a href="#NW0-3a9iNE-3">&lt;-</a>D<a href="#NW0-3a9iNE-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>def_val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gint64 </span><span class="kwd">cgi_header_val_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>def_val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_header_set</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_header_set_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>val<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>A few other shortcuts could be set in the CGI state as well. For now, only the user ID is stored.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-6" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-6"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-5">&lt;-</a>D<a href="#NW0-1Xz6uT-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>userid<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-3" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-3"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-2">&lt;-</a>D<a href="#NW0-1Jgq0O-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>userid <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.RemoteUser"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>After all of the CGI parameters have been parsed, it might be useful to print them. This is only done if debugging is enabled. Although this prints an HTTP header, the <code>header_printed</code> variable is not set, so that the intended headers are displayed in the debugging output as well.</p>
  <pre class="dfn">
<a name="NW0-1Jgq0O-4" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-4"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-3">&lt;-</a>D<a href="#NW0-1Jgq0O-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_status</span><span class="opt">(</span><span class="num">200</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Status: 200</span><span class="esc">\n</span><span class="str">Content-type: text/html</span><span class="esc">\n\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
           <span class="str">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Debug output&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_dump_hdf</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-I" href="#NW0-wliTu-1" id="NW0-wliTu-I"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-H">&lt;-</a>D<a href="#NW0-wliTu-J">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">cgi_dump_hdf</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">STRING </span>ps<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"CGI Parameters:&lt;pre&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">string_init</span><span class="opt">(&amp;</span>ps<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">hdf_dump_str</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">""</span><span class="opt">, </span><span class="num">2</span><span class="opt">, &amp;</span>ps<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>ps<span class="opt">.</span>buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>ps<span class="opt">.</span>buf<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">string_clear</span><span class="opt">(&amp;</span>ps<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"--------&lt;/pre&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Traditional CGI programs only need to deal with a few request methods; usually just GET and POST, and maybe HEAD. However, WebDAV adds a whole bunch of new methods, so this library must support dealing with a large number of methods. In order to avoid repeated string comparisons, the method is converted into an integer code, stored in the CGI state, if it is one of the known methods.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-7" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-7"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-6">&lt;-</a>D<a href="#NW0-1Xz6uT-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">http_req_t </span>req_method<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-5" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-5"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-4">&lt;-</a>D<a href="#NW0-1Jgq0O-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>method <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.RequestMethod"</span><span class="opt">, </span><span class="str">"GET"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">http_req_t </span>req_method <span class="opt">= </span><span class="kwd">http_req_id</span><span class="opt">(</span>method<span class="opt">, </span><span class="kwd">strlen</span><span class="opt">(</span>method<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>req_method <span class="opt">= </span>req_method<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3DkYjs-2" href="#NW0-3DkYjs-1" id="NW0-3DkYjs-2"><dfn>&lt;CGI State Dependencies&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3DkYjs-1">&lt;-</a>D<a href="#NW0-3DkYjs-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include </span><span class="pps">"cgi.h.gperf"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-J" href="#NW0-wliTu-1" id="NW0-wliTu-J"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-I">&lt;-</a>D<a href="#NW0-wliTu-K">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include </span><span class="pps">"cgi.c.gperf"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1m0FKP-1" href="#NW0-1m0FKP-1" id="NW0-1m0FKP-1"><dfn>&lt;cgi-gperf-nc-http_req&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-1m0FKP-1-u1" href="#NW0-UdWlO-1" id="NW0-1m0FKP-1-u1"><i>&lt;Known HTTP Requests&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-4" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-4"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-3">&lt;-</a>D<a href="#NW0-4IhMOG-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">http_req_t</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1zNc0p-1" href="#NW0-1zNc0p-1" id="NW0-1zNc0p-1"><dfn>&lt;(build.nw) makefile.rules&gt;=</dfn></a> <b>[D<a href="#NW0-1zNc0p-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi.h<span class="opt">: </span>cgi.h.gperf
</pre>
      </li>

      <li>
        <pre>
cgi.c<span class="opt">: </span>cgi.c.gperf
</pre>
      </li>
    </ol>
  </div>

  <p>Methods known and possibly dealt with here are:</p>

  <dl>
    <dt>RFC 2616<sup><a href="#fn4">4</a></sup></dt>

    <dd>HTTP: OPTIONS GET HEAD POST PUT DELETE TRACE CONNECT</dd>

    <dt>RFC 4918<sup><a href="#fn5">5</a></sup></dt>

    <dd>WebDAV: PROPFIND PROPPATCH MKCOL COPY MOVE LOCK UNLOCK</dd>

    <dt>RFC 3253<sup><a href="#fn6">6</a></sup></dt>

    <dd>WebDAV Versioning: REPORT VERSION-CONTROL CHECKOUT CHECKIN UNCHECKOUT MKWORKSPACE UPDATE LABEL MERGE BASELINE-CONTROL MKACTIVITY</dd>

    <dt>RFC 3648<sup><a href="#fn7">7</a></sup></dt>

    <dd>WebDAV Ordered Collections: ORDERPATCH</dd>

    <dt>RFC 3744<sup><a href="#fn8">8</a></sup></dt>

    <dd>WebDAV Access Control: ACL</dd>

    <dt>RFC 4437<sup><a href="#fn9">9</a></sup></dt>

    <dd>WebDAV Redirect References: MKREDIRECTREF UPDATEREDIRECTREF</dd>

    <dt>RFC 4791<sup><a href="#fn10">10</a></sup></dt>

    <dd>WebDAV Calendaring: MKCALENDAR</dd>

    <dt>RFC 5323<sup><a href="#fn11">11</a></sup></dt>

    <dd>WebDAV Search: SEARCH</dd>
  </dl>

  <p>Any methods not covered here can be added by extending <code><a href="#NW0-UdWlO-1"><i>&lt;Known HTTP Requests&gt;</i></a></code>.</p>
  <pre class="dfn">
<a name="NW0-UdWlO-1" href="#NW0-UdWlO-1" id="NW0-UdWlO-1"><dfn>&lt;Known HTTP Requests&gt;=</dfn></a> <b>(<a href="#NW0-1m0FKP-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
OPTIONS GET HEAD POST PUT DELETE TRACE CONNECT
</pre>
      </li>

      <li>
        <pre>
PROPFIND PROPPATCH MKCOL COPY MOVE LOCK UNLOCK
</pre>
      </li>

      <li>
        <pre>
REPORT VERSION-CONTROL CHECKOUT CHECKIN UNCHECKOUT MKWORKSPACE UPDATE LABEL
</pre>
      </li>

      <li>
        <pre>
MERGE BASELINE-CONTROL MKACTIVITY
</pre>
      </li>

      <li>
        <pre>
ORDERPATCH
</pre>
      </li>

      <li>
        <pre>
ACL
</pre>
      </li>

      <li>
        <pre>
MKREDIRECTREF UPDATEREDIRECTREF
</pre>
      </li>

      <li>
        <pre>
MKCALENDAR
</pre>
      </li>

      <li>
        <pre>
SEARCH
</pre>
      </li>
    </ol>
  </div>

  <p>Most requests take paths as their argument: either from the request URI (actually <code>PATH_INFO</code>), from headers, or from CGI parameters. All of these paths must be normalized before real use. One way of normalizing them is to just use the underlying file system to resolve to an absolute path. Another is to normalize just the path itself. A normalization function is provided to transform an HDF object's value into a path similar to <code>PATH_INFO</code>: an absolute path with the CGI program information optionally removed. This function takes the path it may be relative to as an argument; setting that argument to NULL means that the value must be either an absolute path or an absolute URL. No URL detection takes place if the path may be relative. Also, if a relative parent is provided, it must be normalized. If it is a directory, it must have a terminating slash. Otherwise, the trailing component is removed for relative references. Any further filesystem-specific normalization, such as home directory and soft link resolution, must be done by the applicaiton program.</p>
  <pre class="dfn">
<a name="NW0-wliTu-K" href="#NW0-wliTu-1" id="NW0-wliTu-K"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-J">&lt;-</a>D<a href="#NW0-wliTu-L">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">normalize_path_obj</span><span class="opt">(</span><span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="kwb">const char </span><span class="opt">*</span>relative_to<span class="opt">, </span><span class="kwb">gboolean </span>utf_8<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="kwb">gboolean </span>strip_cgi_script<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>oval <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>obj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-K-u1" href="#NW0-1xLQ9y-1" id="NW0-wliTu-K-u1"><i>&lt;Normalize path <code>obj</code>/<code>oval</code> UTF-8&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>oval <span class="opt">!= </span><span class="str">'/'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>relative_to<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-wliTu-K-u2" href="#NW0-29LoAm-1" id="NW0-wliTu-K-u2"><i>&lt;Prepend <code>relative_to</code> to <code>obj</code>/<code>oval</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* relative_to is assumed to be already stripped */</span>
</pre>
      </li>

      <li>
        <pre>
      strip_cgi_script <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-wliTu-K-u3" href="#NW0-3YtoGM-1" id="NW0-wliTu-K-u3"><i>&lt;Strip URL from <code>obj</code>/<code>oval</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>strip_cgi_script<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-wliTu-K-u4" href="#NW0-47lNt9-1" id="NW0-wliTu-K-u4"><i>&lt;Strip CGI script from <code>obj</code>/<code>oval</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-K-u5" href="#NW0-1zTt0P-1" id="NW0-wliTu-K-u5"><i>&lt;Strip <code>.</code> and <code>..</code> from <code>obj</code>/<code>oval</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1xLQ9y-1" href="#NW0-1xLQ9y-1" id="NW0-1xLQ9y-1"><dfn>&lt;Normalize path <code>obj</code>/<code>oval</code> UTF-8&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-K">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>utf_8<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>nv <span class="opt">= </span><span class="kwd">g_utf8_normalize</span><span class="opt">(</span>oval<span class="opt">, -</span><span class="num">1</span><span class="opt">, </span>G_NORMALIZE_DEFAULT<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>nv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid UTF-8 path"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strcmp</span><span class="opt">(</span>nv<span class="opt">, </span>oval<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_free</span><span class="opt">(</span>nv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_set_buf</span><span class="opt">(</span>obj<span class="opt">, </span>NULL<span class="opt">, </span>nv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    oval <span class="opt">= </span>nv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-29LoAm-1" href="#NW0-29LoAm-1" id="NW0-29LoAm-1"><dfn>&lt;Prepend <code>relative_to</code> to <code>obj</code>/<code>oval</code>&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-K">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>full_path <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span>relative_to<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>rtls <span class="opt">= </span><span class="kwd">strrchr</span><span class="opt">(</span>full_path<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">'/'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>rtls<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_truncate</span><span class="opt">(</span>full_path<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>rtls <span class="opt">- </span>full_path<span class="opt">-&gt;</span>str<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append_c</span><span class="opt">(</span>full_path<span class="opt">, </span><span class="str">'/'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>full_path<span class="opt">, </span>oval<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">hdf_set_buf</span><span class="opt">(</span>obj<span class="opt">, </span>NULL<span class="opt">, </span><span class="kwd">g_string_free</span><span class="opt">(</span>full_path<span class="opt">, </span>FALSE<span class="opt">));</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3YtoGM-1" href="#NW0-3YtoGM-1" id="NW0-3YtoGM-1"><dfn>&lt;Strip URL from <code>obj</code>/<code>oval</code>&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-K">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span>is_https <span class="opt">= !!</span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.HTTPS"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>cmpstr <span class="opt">= </span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="str">"Host"</span><span class="opt">, </span><span class="str">"localhost"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>cmplen <span class="opt">= </span><span class="kwd">strlen</span><span class="opt">(</span>cmpstr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">strncmp</span><span class="opt">(</span>oval<span class="opt">, </span><span class="str">"http"</span><span class="opt">, </span><span class="num">4</span><span class="opt">) || (</span>is_https <span class="opt">&amp;&amp; (++</span>oval<span class="opt">)[</span><span class="num">4</span><span class="opt">] != </span><span class="str">'s'</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">strncmp</span><span class="opt">((</span>oval <span class="opt">+= </span><span class="num">4</span><span class="opt">), </span><span class="str">"://"</span><span class="opt">, </span><span class="num">3</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">strncasecmp</span><span class="opt">((</span>oval <span class="opt">+= </span><span class="num">3</span><span class="opt">), </span>cmpstr<span class="opt">, </span>cmplen<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid URL"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
oval <span class="opt">+= </span>cmplen<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(*</span>oval <span class="opt">== </span><span class="str">':'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  cmpstr <span class="opt">= </span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="str">"CGI.ServerPort"</span><span class="opt">, </span>is_https ? <span class="str">"443"</span> <span class="opt">: </span><span class="str">"80"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  cmplen <span class="opt">= </span><span class="kwd">strlen</span><span class="opt">(</span>cmpstr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">strncasecmp</span><span class="opt">(</span>oval <span class="opt">+ </span><span class="num">1</span><span class="opt">, </span>cmpstr<span class="opt">, </span>cmplen<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid URL"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  oval <span class="opt">+= </span>cmplen <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-3YtoGM-1-u1" href="#NW0-47lNt9-1" id="NW0-3YtoGM-1-u1"><i>&lt;Strip CGI script from <code>obj</code>/<code>oval</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(*</span>oval <span class="opt">!= </span><span class="str">'/'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid URL"</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-47lNt9-1" href="#NW0-47lNt9-1" id="NW0-47lNt9-1"><dfn>&lt;Strip CGI script from <code>obj</code>/<code>oval</code>&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-K">&lt;-U</a> <a href="#NW0-3YtoGM-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>scrn <span class="opt">= </span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="str">"CGI.ScriptName"</span><span class="opt">, </span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>scrlen <span class="opt">= </span><span class="kwd">strlen</span><span class="opt">(</span>scrn<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">strncmp</span><span class="opt">(</span>oval<span class="opt">, </span>scrn<span class="opt">, </span>scrlen<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid URL"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
oval <span class="opt">+= </span>scrlen<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>obj<span class="opt">, </span>NULL<span class="opt">, </span>oval<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
oval <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>obj<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1zTt0P-1" href="#NW0-1zTt0P-1" id="NW0-1zTt0P-1"><dfn>&lt;Strip <code>.</code> and <code>..</code> from <code>obj</code>/<code>oval</code>&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-K">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>s <span class="opt">= </span><span class="kwd">strchr</span><span class="opt">(</span>oval<span class="opt">, </span><span class="str">'/'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>s <span class="opt">&amp;&amp; (</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'/'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">(</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'.'</span> <span class="opt">&amp;&amp; (!</span>s<span class="opt">[</span><span class="num">2</span><span class="opt">] || </span>s<span class="opt">[</span><span class="num">2</span><span class="opt">] == </span><span class="str">'/'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                          <span class="opt">(</span>s<span class="opt">[</span><span class="num">2</span><span class="opt">] == </span><span class="str">'.'</span> <span class="opt">&amp;&amp; (!</span>s<span class="opt">[</span><span class="num">3</span><span class="opt">] || </span>s<span class="opt">[</span><span class="num">3</span><span class="opt">] == </span><span class="str">'/'</span><span class="opt">)))))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>d <span class="opt">= </span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">do </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'/'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>s<span class="opt">[</span><span class="num">2</span><span class="opt">] != </span><span class="str">'.'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      s <span class="opt">+= </span><span class="num">2</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>d <span class="opt">== </span>oval<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid relative path (..)"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(--</span>d <span class="opt">&gt; </span>oval <span class="opt">&amp;&amp; *</span>d <span class="opt">!= </span><span class="str">'/'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      s <span class="opt">+= </span><span class="num">3</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(*</span>s <span class="opt">&amp;&amp; (*</span>s <span class="opt">!= </span><span class="str">'/'</span> <span class="opt">|| (</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] != </span><span class="str">'/'</span> <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                               <span class="opt">(</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] != </span><span class="str">'.'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                                <span class="opt">(</span>s<span class="opt">[</span><span class="num">2</span><span class="opt">] &amp;&amp; </span>s<span class="opt">[</span><span class="num">2</span><span class="opt">] != </span><span class="str">'/'</span> <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                                 <span class="opt">(</span>s<span class="opt">[</span><span class="num">2</span><span class="opt">] != </span><span class="str">'.'</span> <span class="opt">|| (</span>s<span class="opt">[</span><span class="num">3</span><span class="opt">] &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                                                  s<span class="opt">[</span><span class="num">3</span><span class="opt">] != </span><span class="str">'/'</span><span class="opt">)))))))</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">*</span>d<span class="opt">++ = *</span>s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">while</span><span class="opt">(*</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc7" id="toc7">Content Decoding</a></h1>

  <p>Normally, the CGI input stream is read directly, using e.g. <code>fread</code>. However, reading data from is not always that simple. For apache, at least, transport encoding is taken care of by the web server<sup><a href="#fn12">12</a></sup> , but content encoding is not. There may be value in saving the encoded stream directly, if the CGI program will just end up serving the same data encoded the same way, but most applications want their data decoded. There are several things that can be done about this. First of all, the content encoding and content length are stored in the CGI state for quick reference. Since the content length might not be accurate due to apache's losing it with chunked transfer-encoding, execution from the command line, or other reasons, a zero length is not trusted. If the content length is zero, a single character is read from the input stream; if it wasnt end-of-file, then content length is set to <i>-1</i> to indicate data is present, but of unknown length.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-8" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-8"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-7">&lt;-</a>D<a href="#NW0-1Xz6uT-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>body_enc<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gint64 </span>body_len<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-6" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-6"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-5">&lt;-</a>D<a href="#NW0-1Jgq0O-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>body_enc <span class="opt">= </span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="str">"ContentEncoding"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc <span class="opt">&amp;&amp; (!*</span>cgi_state<span class="opt">-&gt;</span>body_enc <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="opt">!</span><span class="kwd">strcmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"identity"</span><span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>body_enc <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>body_len <span class="opt">= </span><span class="kwd">cgi_env_val_int</span><span class="opt">(</span><span class="str">"CGI.ContentLength"</span><span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>body_len<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>c <span class="opt">= </span>is_cgi ? <span class="kwd">getchar</span><span class="opt">() : </span><span class="kwd">FCGX_GetChar</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>in<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>c <span class="opt">!= </span>EOF<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set_int</span><span class="opt">(</span><span class="str">"CGI.ContentLength"</span><span class="opt">, (</span>cgi_state<span class="opt">-&gt;</span>body_len <span class="opt">= -</span><span class="num">1</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>is_cgi<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">ungetc</span><span class="opt">(</span>c<span class="opt">, </span>stdin<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">FCGX_UnGetChar</span><span class="opt">(</span>c<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>req<span class="opt">.</span>in<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Next, the standard encoding methods should be supported. A new set of input functions and macros is used to select the decoded stream. The first call initializes the decoder, and the final cleanup cleans it up.</p>
  <pre class="dfn">
<a name="NW0-1ozy8z-6" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-6"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-5">&lt;-</a>D<a href="#NW0-1ozy8z-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define cgi_gets(s, l) cgi_decode_gets(cgi_state, s, l)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_read(s, l, rl) cgi_decode_read(cgi_state, s, l, rl)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-5" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-5"><dfn>&lt;(build.nw) C Prototypes&gt;+=</dfn></a> <b>[<a href="#NW0-3a9iNE-4">&lt;-</a>D<a href="#NW0-3a9iNE-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_gets</span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>length<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_read</span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>length<span class="opt">, </span><span class="kwb">int </span><span class="opt">*</span>retlength<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-L" href="#NW0-wliTu-1" id="NW0-wliTu-L"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-K">&lt;-</a>D<a href="#NW0-wliTu-M">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_decode_gets</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>length<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_raw_gets</span><span class="opt">(</span>buf<span class="opt">, </span>length<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Error reading body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-L-u1" href="#NW0-1ETzHp-1" id="NW0-wliTu-L-u1"><i>&lt;Initialize body decoder&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-L-u2" href="#NW0-pbqM0-1" id="NW0-wliTu-L-u2"><i>&lt;Decode a string into <code>buf</code>/<code>length</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_decode_read</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>length<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwb">int </span><span class="opt">*</span>retlength<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>retlength <span class="opt">= </span>ret <span class="opt">= </span><span class="kwd">cgi_raw_read</span><span class="opt">(</span>buf<span class="opt">, </span>length<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">&lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Error reading body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-L-u3" href="#NW0-1ETzHp-1" id="NW0-wliTu-L-u3"><i>&lt;Initialize body decoder&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-L-u4" href="#NW0-U0J7v-1" id="NW0-wliTu-L-u4"><i>&lt;Decode data into <code>buf</code>/<code>length</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-qLGmJ-1" href="#NW0-qLGmJ-1" id="NW0-qLGmJ-1"><dfn>&lt;Read data from CGI stream&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-G">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span><span class="kwd">cgi_read</span><span class="opt">(</span>data<span class="opt">, </span>len<span class="opt">, &amp;</span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">return </span><span class="opt">-</span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The gzip, x-gzip, and deflate methods can be handled by zlib<sup><a href="#fn13">13</a></sup>. There is no simple library which supports the compress method, but beginning with version <i>2.8</i>, libarchive<sup><a href="#fn14">14</a></sup> can be used for this. This was originally tested using <i>2.7.902</i>a; thus the version barrier uses this number rather than <i>2.8</i>. The undefined bzip2 methods are handled by libarchive as well. Both of these methods require a separate buffer for I/O; zlib needs one for input and one for output, and libarchive allocates output buffers internally, so it only needs one for input.</p>
  <pre class="dfn">
<a name="NW0-13PeAG-3" href="#NW0-13PeAG-1" id="NW0-13PeAG-3"><dfn>&lt;(build.nw) makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-13PeAG-2">&lt;-</a>D<a href="#NW0-13PeAG-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
EXTRA_LDFLAGS <span class="opt">+= -</span>lz <span class="opt">$(</span>LIBAR_LDFLAGS<span class="opt">) -</span>larchive
</pre>
      </li>

      <li>
        <pre>
EXTRA_CFLAGS <span class="opt">+= $(</span>LIBAR_CFLAGS<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3DeDMu-2" href="#NW0-3DeDMu-1" id="NW0-3DeDMu-2"><dfn>&lt;(build.nw) makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3DeDMu-1">&lt;-</a>D<a href="#NW0-3DeDMu-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Extra flags needed to find libarchive 2.8</span>
</pre>
      </li>

      <li>
        <pre>
LIBAR_CFLAGS <span class="opt">= -</span>I<span class="opt">/</span>usr<span class="opt">/</span>local<span class="opt">/</span><span class="kwb">include</span>
</pre>
      </li>

      <li>
        <pre>
LIBAR_LDFLAGS <span class="opt">= -</span>L<span class="opt">/</span>usr<span class="opt">/</span>local<span class="opt">/</span>lib
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3BiK3G-2" href="#NW0-3BiK3G-1" id="NW0-3BiK3G-2"><dfn>&lt;CGI Prerequisite Headers&gt;+=</dfn></a> <b>(<a href="#NW0-1mOMve-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3BiK3G-1">&lt;-</a>D<a href="#NW0-3BiK3G-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;zlib.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;archive.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;archive_entry.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-9" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-9"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-8">&lt;-</a>D<a href="#NW0-1Xz6uT-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">z_stream </span><span class="opt">*</span>dec_zs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">struct archive </span><span class="opt">*</span>dec_ar<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>dec_buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define DEC_BUF_LEN 65536</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ETzHp-1" href="#NW0-1ETzHp-1" id="NW0-1ETzHp-1"><dfn>&lt;Initialize body decoder&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-L">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* decoding invalidates body length */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>body_len <span class="opt">&gt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set_int</span><span class="opt">(</span><span class="str">"CGI.ContentLength"</span><span class="opt">, (</span>cgi_state<span class="opt">-&gt;</span>body_len <span class="opt">= -</span><span class="num">1</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"gzip"</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"x-gzip"</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"deflate"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* type is auto-detected by zlib, although we probably ought */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* to verify that advertised method matches detected method */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-1ETzHp-1-u1" href="#NW0-1I4CzE-1" id="NW0-1ETzHp-1-u1"><i>&lt;Initialize decoding for zlib&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if ARCHIVE_VERSION_NUMBER &gt;= 2007902</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"compress"</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"x-compress"</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"bzip2"</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">, </span><span class="str">"x-bzip2"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-1ETzHp-1-u2" href="#NW0-2Y3OmL-1" id="NW0-1ETzHp-1-u2"><i>&lt;Initialize decoding for libarchive&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"415 Unsupported Media Type"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise</span><span class="opt">(</span>GENERIC_ERR<span class="opt">, </span><span class="str">"Encoding type %s not supported"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                      cgi_state<span class="opt">-&gt;</span>body_enc<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1I4CzE-1" href="#NW0-1I4CzE-1" id="NW0-1I4CzE-1"><dfn>&lt;Initialize decoding for zlib&gt;=</dfn></a> <b>(<a href="#NW0-1ETzHp-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>dec_buf <span class="opt">= </span><span class="kwd">malloc</span><span class="opt">(</span><span class="num">2 </span><span class="opt">* </span>DEC_BUF_LEN<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>dec_zs <span class="opt">= </span><span class="kwd">calloc</span><span class="opt">(</span><span class="kwa">sizeof</span><span class="opt">(*</span>cgi_state<span class="opt">-&gt;</span>dec_zs<span class="opt">), </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>dec_zs<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Error decoding body"</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2Y3OmL-1" href="#NW0-2Y3OmL-1" id="NW0-2Y3OmL-1"><dfn>&lt;Initialize decoding for libarchive&gt;=</dfn></a> <b>(<a href="#NW0-1ETzHp-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">struct archive_entry </span><span class="opt">*</span>ae<span class="opt">; </span><span class="com">/* dummy */</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>dec_buf <span class="opt">= </span><span class="kwd">malloc</span><span class="opt">(</span>DEC_BUF_LEN<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>dec_ar <span class="opt">= </span><span class="kwd">archive_read_new</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
ae <span class="opt">= </span><span class="kwd">archive_entry_new</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>dec_ar <span class="opt">|| !</span>ae <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">archive_read_support_compression_compress</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">archive_read_support_compression_bzip2</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">archive_read_support_format_raw</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">archive_read_open</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">, </span>cgi_state<span class="opt">, </span>NULL<span class="opt">, </span>read_cgi_for_ar<span class="opt">, </span>NULL<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">archive_read_next_header2</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">, </span>ae<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>ae<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">archive_entry_free</span><span class="opt">(</span>ae<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Error decoding body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kDPKd-3" href="#NW0-3kDPKd-1" id="NW0-3kDPKd-3"><dfn>&lt;Free CGI state members&gt;+=</dfn></a> <b>(<a href="#NW0-Y5eke-2">&lt;-U</a>)</b> <b>[<a href="#NW0-3kDPKd-2">&lt;-</a>D<a href="#NW0-3kDPKd-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_zs<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">inflateEnd</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_zs<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_zs<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if ARCHIVE_VERSION_NUMBER &gt;= 2007902</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">archive_read_finish</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The decoders should be run independently of the data requests, filling an output buffer as needed. This requires that an output buffer pointer and length be stored in the CGI state. Since the existence of the decoding buffer, rather than the existence of either decoder's state, is used to indicate decoding is needed, the decoder's state can be closed and freed on end of file, while still allowing the last output buffer to be used. This is really only possible with zlib, because libarchive allocates output buffers internally. Instead, libarchive decoding is cleared after the last read.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-A" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-A"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-9">&lt;-</a>D<a href="#NW0-1Xz6uT-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>dec_out<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>dec_out_len<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-M" href="#NW0-wliTu-1" id="NW0-wliTu-M"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-L">&lt;-</a>D<a href="#NW0-wliTu-N">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">fill_decode_buffer</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_zs<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">int </span>ret <span class="opt">= </span>Z_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">z_stream </span><span class="opt">*</span>zs <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>dec_zs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span>ret <span class="opt">== </span>Z_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>zs<span class="opt">-&gt;</span>avail_in<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        zs<span class="opt">-&gt;</span>next_in <span class="opt">= (</span>Bytef <span class="opt">*)</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        zs<span class="opt">-&gt;</span>avail_in <span class="opt">= </span><span class="kwd">cgi_raw_read</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">, </span>DEC_BUF_LEN<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>zs<span class="opt">-&gt;</span>avail_in <span class="opt">&lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Error decoding body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      zs<span class="opt">-&gt;</span>next_out <span class="opt">= (</span>Bytef <span class="opt">*)</span>cgi_state<span class="opt">-&gt;</span>dec_buf <span class="opt">+ </span>DEC_BUF_LEN<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      zs<span class="opt">-&gt;</span>avail_out <span class="opt">= </span>DEC_BUF_LEN<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">inflate</span><span class="opt">(</span>zs<span class="opt">, </span>Z_SYNC_FLUSH<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>zs<span class="opt">-&gt;</span>avail_out <span class="opt">&lt; </span>DEC_BUF_LEN <span class="opt">|| </span>ret <span class="opt">== </span>Z_STREAM_END<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        cgi_state<span class="opt">-&gt;</span>dec_out <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>dec_buf <span class="opt">+ </span>DEC_BUF_LEN<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        cgi_state<span class="opt">-&gt;</span>dec_out_len <span class="opt">= </span>DEC_BUF_LEN <span class="opt">- </span>zs<span class="opt">-&gt;</span>avail_out<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">== </span>Z_STREAM_END<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">inflateEnd</span><span class="opt">(</span>zs<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">free</span><span class="opt">(</span>zs<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>dec_zs <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>ret <span class="opt">!= </span>Z_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Error decoding body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if ARCHIVE_VERSION_NUMBER &gt;= 2007902</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">const void </span><span class="opt">*</span>outbuf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">off_t </span>outoff<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">size_t </span>outlen<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">int </span>ret <span class="opt">= </span><span class="kwd">archive_read_data_block</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">, &amp;</span>outbuf<span class="opt">, &amp;</span>outlen<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="opt">&amp;</span>outoff<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">!= </span>ARCHIVE_OK <span class="opt">&amp;&amp; </span>ret <span class="opt">!= </span>ARCHIVE_EOF<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="kwd">archive_error_string</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>dec_out <span class="opt">= </span>outbuf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>dec_out_len <span class="opt">= </span>outlen<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* raw format has no gaps, so outoff can be ignored */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">== </span>ARCHIVE_EOF<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">archive_read_finish</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_ar<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>dec_ar <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-N" href="#NW0-wliTu-1" id="NW0-wliTu-N"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-M">&lt;-</a>D<a href="#NW0-wliTu-O">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#if ARCHIVE_VERSION_NUMBER &gt;= 2007902</span>
</pre>
      </li>

      <li>
        <pre>
ssize_t <span class="kwd">read_cgi_for_ar</span><span class="opt">(</span><span class="kwb">struct archive </span><span class="opt">*</span>ar<span class="opt">, </span><span class="kwb">void </span><span class="opt">*</span>cbdata<span class="opt">, </span><span class="kwb">const void </span><span class="opt">**</span>buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>cbdata<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>buf <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">cgi_raw_read</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">, </span>DEC_BUF_LEN<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">&lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">archive_set_error</span><span class="opt">(</span>ar<span class="opt">, </span>errno<span class="opt">, </span><span class="str">"Error decoding body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The specific action for the read function is to just return as much available data as possible, and to update the output buffer pointers.</p>
  <pre class="dfn">
<a name="NW0-4gTpBs-1" href="#NW0-4gTpBs-1" id="NW0-4gTpBs-1"><dfn>&lt;Get more decoded data&gt;=</dfn></a> <b>(<a href="#NW0-U0J7v-1">U-&gt;</a> <a href="#NW0-pbqM0-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>dec_out_len<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">fill_decode_buffer</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK <span class="opt">|| !</span>cgi_state<span class="opt">-&gt;</span>dec_out_len<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">free</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>dec_buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>dec_buf <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-U0J7v-1" href="#NW0-U0J7v-1" id="NW0-U0J7v-1"><dfn>&lt;Decode data into <code>buf</code>/<code>length</code>&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-L">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">*</span>retlength <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>length <span class="opt">&lt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-U0J7v-1-u1" href="#NW0-4gTpBs-1" id="NW0-U0J7v-1-u1"><i>&lt;Get more decoded data&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>length <span class="opt">&gt; </span>cgi_state<span class="opt">-&gt;</span>dec_out_len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  length <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>dec_out_len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">*</span>retlength <span class="opt">= </span>length<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">memcpy</span><span class="opt">(</span>buf<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>dec_out<span class="opt">, </span>length<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>dec_out_len <span class="opt">-= </span>length<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>dec_out <span class="opt">+= </span>length<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>For getting a line, the decode buffer needs to be scanned for newlines.</p>
  <pre class="dfn">
<a name="NW0-pbqM0-1" href="#NW0-pbqM0-1" id="NW0-pbqM0-1"><dfn>&lt;Decode a string into <code>buf</code>/<code>length</code>&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-L">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>length <span class="opt">&lt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">*</span>buf <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!--</span>length<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>cp_len <span class="opt">= </span>length<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-pbqM0-1-u1" href="#NW0-4gTpBs-1" id="NW0-pbqM0-1-u1"><i>&lt;Get more decoded data&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cp_len <span class="opt">&gt; </span>cgi_state<span class="opt">-&gt;</span>dec_out_len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cp_len <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>dec_out_len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  length <span class="opt">-= </span>cp_len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>dec_out_len <span class="opt">-= </span>cp_len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span>cp_len<span class="opt">--)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((*</span>buf<span class="opt">++ = *</span>cgi_state<span class="opt">-&gt;</span>dec_out<span class="opt">++) == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>buf <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>dec_out_len <span class="opt">+= </span>cp_len <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cp_len <span class="opt">&gt;= </span><span class="num">0 </span><span class="opt">|| </span>buf<span class="opt">[-</span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc8" id="toc8">POST and PUT Uploads</a></h1>

  <p>In order to handle POST parameters correctly, a parsing handler could be provided to the CGI kit. There are two problems with the CGI kit's handler mechanism, though. First, the handler can be selected by content type, but only by exact matches, so POST uploads which tack on an arbitrary boundary cannot be easily intercepted. Second, the handler is run in addition to the built-in handler, rather than instead of the built-in handler.</p>

  <p>The first problem could be worked around by handling all content types and filtering in the function, or by only adding the handler if the content type is multi-part, using the exact content type string that was passed. The second problem could be worked around by returning a dummy error, which will abort the built-in parser.</p>

  <p>Instead of these workarounds, the <code>cgi_parse</code> function is avoided entirely for multi-part POST parameters. Also, in order to be more forgiving to browsers, any unrecognized content type for POST parameters is converted to <code>application/x-www-form-urlencoded</code> to force reading the query string from standard input<sup><a href="#fn15">15</a></sup> . In fact, since the <code>cgi_parse</code> function doesn't do anything but upload and POST parameter parsing, it is bypassed for anything but simple POST parsing. Since the request method and content type are used to decide what to do, the content type is placed directly in the CGI state for quick access.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-B" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-B"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-A">&lt;-</a>D<a href="#NW0-1Xz6uT-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>body_type<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-O" href="#NW0-wliTu-1" id="NW0-wliTu-O"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-N">&lt;-</a>D<a href="#NW0-wliTu-P">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">cgi_parse_multpart</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>ctype<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wliTu-O-u1" href="#NW0-1DDebI-1" id="NW0-wliTu-O-u1"><i>&lt;Parse multi-part CGI parameters&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-7" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-7"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-6">&lt;-</a>D<a href="#NW0-1Jgq0O-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>body_type <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.ContentType"</span><span class="opt">, </span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>req_method <span class="opt">== </span>HTTP_REQ_POST<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strncasecmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_type<span class="opt">, </span><span class="str">"multipart/form-data"</span><span class="opt">, </span><span class="num">19</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">cgi_parse_multpart</span><span class="opt">(</span>cgi_state<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>body_type<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span><span class="kwd">strcmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_type<span class="opt">, </span><span class="str">"application/soap+xml"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">strcmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_type<span class="opt">, </span><span class="str">"application/x-www-form-urlencoded"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_set_value</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"CGI.ContentType"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="str">"application/x-www-form-urlencoded"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">cgi_parse</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>hdf <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">-&gt;</span>hdf<span class="opt">; </span><span class="com">/* in case it changed */</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Parsing multi-part POST parameters per RFC 2388<sup><a href="#fn16">16</a></sup> is straightforward:</p>
  <pre class="dfn">
<a name="NW0-1DDebI-1" href="#NW0-1DDebI-1" id="NW0-1DDebI-1"><dfn>&lt;Parse multi-part CGI parameters&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-O">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-1DDebI-1-u1" href="#NW0-gJg1L-1" id="NW0-1DDebI-1-u1"><i>&lt;Multi-part Parse Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-1DDebI-1-u2" href="#NW0-1DgxfU-1" id="NW0-1DDebI-1-u2"><i>&lt;Find multi-part boundary&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-1DDebI-1-u3" href="#NW0-3J3Bh8-1" id="NW0-1DDebI-1-u3"><i>&lt;Create buffer at least large enough for multi-part boundary&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1DDebI-1-u4" href="#NW0-1NfExj-1" id="NW0-1DDebI-1-u4"><i>&lt;Find next multi-part boundary and <code>break</code> if last&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1DDebI-1-u5" href="#NW0-OcIai-1" id="NW0-1DDebI-1-u5"><i>&lt;Parse multi-part headers until blank line&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!(<a name="NW0-1DDebI-1-u6" href="#NW0-ylIxa-1" id="NW0-1DDebI-1-u6"><i>&lt;Found multi-part file&gt;</i></a>)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-1DDebI-1-u7" href="#NW0-2004gC-1" id="NW0-1DDebI-1-u7"><i>&lt;Parse multi-part body as parameter&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1DDebI-1-u8" href="#NW0-2DC5zU-1" id="NW0-1DDebI-1-u8"><i>&lt;Set multi-part parameters&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(<a name="NW0-1DDebI-1-u9" href="#NW0-ylIxa-1" id="NW0-1DDebI-1-u9"><i>&lt;Found multi-part file&gt;</i></a>) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-1DDebI-1-u10" href="#NW0-2Uz4pb-1" id="NW0-1DDebI-1-u10"><i>&lt;Parse multi-part body as file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-1DDebI-1-u11" href="#NW0-3xCCwq-1" id="NW0-1DDebI-1-u11"><i>&lt;Clean up multi-part parse&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>

  <p>There are two ways to read lines: read everything in a line, like <code>g_string_fgets</code>, or read just enough to fill a buffer, like <code>fgets</code>. Both have disadvantages. Reading everything has the potential to use too much memory. Reading just the amount there is room for has problems with long lines. The HTTP and MIME specifications try to keep line lengths reasonable, but there is never any guarantee. For this reason, only file reads will use a limited-length buffer. The rest will use the CGI equivalent of <code>g_string_fgets</code>, but with ASCII NUL support:</p>
  <pre class="dfn">
<a name="NW0-wliTu-P" href="#NW0-wliTu-1" id="NW0-wliTu-P"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-O">&lt;-</a>D<a href="#NW0-wliTu-Q">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static char </span><span class="opt">*</span><span class="kwd">cgi_gets_cb</span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>len<span class="opt">, </span><span class="kwb">void </span><span class="opt">*</span>str<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>str<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span><span class="kwd">cgi_gets</span><span class="opt">(</span>buf<span class="opt">, </span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span><span class="kwd">g_string_cgi_gets</span><span class="opt">(</span><span class="kwb">GString </span><span class="opt">**</span>_buf<span class="opt">, </span><span class="kwb">guint </span>offset<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">g_string_gets_generic</span><span class="opt">(</span>_buf<span class="opt">, </span>offset<span class="opt">, </span>cgi_gets_cb<span class="opt">, </span>cgi_state<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Most of the time, the boundary is passed in with the content type. However, the perl CGI module allows for the boundary to be missing, and instead uses the first line read from input as the boundary. This code will do the same. However, since the first line may be part of a file, the buffer will be limited to 128 characters. 78 is the most a boundary should contain, anyway.</p>
  <pre class="dfn">
<a name="NW0-1DgxfU-1" href="#NW0-1DgxfU-1" id="NW0-1DgxfU-1"><dfn>&lt;Find multi-part boundary&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span>boundary_buf<span class="opt">[</span><span class="num">128</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>boundary <span class="opt">= </span><span class="kwd">strstr</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_type <span class="opt">+ </span><span class="num">19</span><span class="opt">, </span><span class="str">"boundary="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>boundary<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  boundary <span class="opt">+= </span><span class="num">9</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_gets</span><span class="opt">(</span>boundary_buf<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>boundary_buf<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* in use, each boundary is preceeded by -- */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">memcmp</span><span class="opt">(</span>boundary_buf<span class="opt">, </span><span class="str">"--"</span><span class="opt">, </span><span class="num">2</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    boundary <span class="opt">= </span>boundary_buf <span class="opt">+ </span><span class="num">2</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise</span><span class="opt">(</span>NERR_PARSE<span class="opt">, </span><span class="str">"Malformed input; no boundary"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>blen <span class="opt">= </span><span class="kwd">strlen</span><span class="opt">(</span>boundary<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>As is usual with this code, a <code>GString</code> is used to buffer the input. To make I/O more efficient, the buffer is at least 8192 bytes long.</p>
  <pre class="dfn">
<a name="NW0-3J3Bh8-1" href="#NW0-3J3Bh8-1" id="NW0-3J3Bh8-1"><dfn>&lt;Create buffer at least large enough for multi-part boundary&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3J3Bh8-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>buf <span class="opt">= </span><span class="kwd">g_string_sized_new</span><span class="opt">(</span>blen <span class="opt">&gt; </span><span class="num">8192 </span><span class="opt">- </span><span class="num">7 </span>? blen <span class="opt">+ </span><span class="num">7 </span><span class="opt">: </span><span class="num">8192</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                                  <span class="com">/* 7 extra for --&lt;b&gt;--\r\n\0 */</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3xCCwq-1" href="#NW0-3xCCwq-1" id="NW0-3xCCwq-1"><dfn>&lt;Clean up multi-part parse&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3xCCwq-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The first thing to do in the loop is to read the next line. However, if the boundary line needed to be read, one line has already been read. Also, searching for the end of the body will usually result with the next boundary line having been read. For this reason, a line is always read before entring the loop.</p>
  <pre class="dfn">
<a name="NW0-3J3Bh8-2" href="#NW0-3J3Bh8-1" id="NW0-3J3Bh8-2"><dfn>&lt;Create buffer at least large enough for multi-part boundary&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3J3Bh8-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>boundary <span class="opt">== </span>boundary_buf <span class="opt">+ </span><span class="num">2</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_assign</span><span class="opt">(</span>buf<span class="opt">, </span>boundary_buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_gets</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span>buf<span class="opt">-&gt;</span>allocated_len<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The loop should be entered with the boundary, prefixed by a double dash, in the read buffer. However, there may be some sort of corruption in the headers. In that case, the next line is read using a limited buffer read and the loop is started over. If the boundary is valid, then the final boundary is indicated by an additional trailing double dash.</p>
  <pre class="dfn">
<a name="NW0-1NfExj-1" href="#NW0-1NfExj-1" id="NW0-1NfExj-1"><dfn>&lt;Find next multi-part boundary and <code>break</code> if last&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">memcmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">"--"</span><span class="opt">, </span><span class="num">2</span><span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">memcmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span><span class="num">2</span><span class="opt">, </span>boundary<span class="opt">, </span>blen<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_gets</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span>buf<span class="opt">-&gt;</span>allocated_len<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">; </span><span class="com">/* end of input */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">continue</span><span class="opt">; </span><span class="com">/* invalid boundary; find next */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strncmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span><span class="num">2 </span><span class="opt">+ </span>blen<span class="opt">, </span><span class="str">"--"</span><span class="opt">, </span><span class="num">2</span><span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">2 </span><span class="opt">+ </span>blen <span class="opt">+ </span><span class="num">2</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
    buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">2 </span><span class="opt">+ </span>blen <span class="opt">+ </span><span class="num">2</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">!</span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">2 </span><span class="opt">+ </span>blen <span class="opt">+ </span><span class="num">2</span><span class="opt">]))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">; </span><span class="com">/* valid end boundary */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">2 </span><span class="opt">+ </span>blen<span class="opt">] != </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">2 </span><span class="opt">+ </span>blen<span class="opt">] != </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* invalid boundary */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_gets</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span>buf<span class="opt">-&gt;</span>allocated_len<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">; </span><span class="com">/* end of input */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">continue</span><span class="opt">; </span><span class="com">/* invalid boundary; find next */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The header consists of keywords, followed by a colon, followed by values. The values may be semicolon-separated keyword-value pairs. The only headers of interest are <code>content-dispostion</code>, which has keyword-value pairs as its value that include <code>name</code> and <code>filename</code>, <code>content-transfer-encoding</code>, and <code>content-length</code>. The <code>content-type</code> is returned by the CGI kit, so it needs to be saved as well. This will allow post-processors to deal with multipart files; otherwise such files would have to be rejected.</p>
  <pre class="dfn">
<a name="NW0-gJg1L-1" href="#NW0-gJg1L-1" id="NW0-gJg1L-1"><dfn>&lt;Multi-part Parse Variables&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-gJg1L-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gint64 </span>flen <span class="opt">= -</span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>content_type <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-OcIai-1" href="#NW0-OcIai-1" id="NW0-OcIai-1"><dfn>&lt;Parse multi-part headers until blank line&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-OcIai-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_cgi_gets</span><span class="opt">(&amp;</span>buf<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">0</span><span class="opt">] || </span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">0</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">|| </span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">0</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">; </span><span class="com">/* blank line @ end of header */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>c <span class="opt">= </span><span class="kwd">strchr</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">':'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>c<span class="opt">) </span><span class="com">/* invalid line; just ignore */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>c <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">"content-disposition"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-OcIai-1-u1" href="#NW0-Ow21m-1" id="NW0-OcIai-1-u1"><i>&lt;Parse content-disposition&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">"content-transfer-encoding"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-OcIai-1-u2" href="#NW0-2zs4Ho-1" id="NW0-OcIai-1-u2"><i>&lt;Parse content-transfer-encoding&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">"content-length"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>c<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">isdigit</span><span class="opt">(*</span>c<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      flen <span class="opt">= </span><span class="kwd">strtoull</span><span class="opt">(</span>c<span class="opt">, </span>NULL<span class="opt">, </span><span class="num">10</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">"content-type"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>c<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>content_type<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      content_type <span class="opt">= </span><span class="kwd">strdup</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* ignore other header lines */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3xCCwq-2" href="#NW0-3xCCwq-1" id="NW0-3xCCwq-2"><dfn>&lt;Clean up multi-part parse&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3xCCwq-1">&lt;-</a>D<a href="#NW0-3xCCwq-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>content_type<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>content_type<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The content-transfer-encoding field indicates encodings other than `7bit', which indicates plain text, sans the final newline. Any unknown encoding will be ignored. Note that this is another improvement over ClearSilver: ClearSilver only supports the plain encoding types.</p>
  <pre class="dfn">
<a name="NW0-gJg1L-2" href="#NW0-gJg1L-1" id="NW0-gJg1L-2"><dfn>&lt;Multi-part Parse Variables&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-gJg1L-1">&lt;-</a>D<a href="#NW0-gJg1L-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">enum </span><span class="opt">{ </span>CT_ENC_PLAIN<span class="opt">, </span>CT_ENC_Q<span class="opt">, </span>CT_ENC_B<span class="opt">, </span>CT_ENC_INV <span class="opt">} </span>enct <span class="opt">= </span>CT_ENC_PLAIN<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2zs4Ho-1" href="#NW0-2zs4Ho-1" id="NW0-2zs4Ho-1"><dfn>&lt;Parse content-transfer-encoding&gt;=</dfn></a> <b>(<a href="#NW0-OcIai-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>c<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>t <span class="opt">= </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(*</span>t <span class="opt">&amp;&amp; !</span><span class="kwd">isspace</span><span class="opt">(*</span>t<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  t<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">*</span>t <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>c<span class="opt">, </span><span class="str">"7bit"</span><span class="opt">) || !</span><span class="kwd">strcasecmp</span><span class="opt">(</span>c<span class="opt">, </span><span class="str">"8bit"</span><span class="opt">) || !</span><span class="kwd">strcasecmp</span><span class="opt">(</span>c<span class="opt">, </span><span class="str">"binary"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  enct <span class="opt">= </span>CT_ENC_PLAIN<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>c<span class="opt">, </span><span class="str">"quoted-printable"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  enct <span class="opt">= </span>CT_ENC_Q<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>c<span class="opt">, </span><span class="str">"base64"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  enct <span class="opt">= </span>CT_ENC_B<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else if</span><span class="opt">(*</span>c<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  enct <span class="opt">= </span>CT_ENC_INV<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-OcIai-2" href="#NW0-OcIai-1" id="NW0-OcIai-2"><dfn>&lt;Parse multi-part headers until blank line&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-OcIai-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>enct <span class="opt">== </span>CT_ENC_INV<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">continue</span><span class="opt">; </span><span class="com">/* scan for next header; enctype not supported */</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Parsing the multi-valued content-disposition field<sup><a href="#fn17">17</a></sup> is the hardest. First it must locate semicolon-separated fields, ignoring whitespace. The first field is ignored entirely, because it is the content disposition itself. Spurious semicolons are just ignored. The field name is always literal text, so it is fairly easy to parse out. The specfic field name is checked after the full pair has been parsed. After the field name comes an equals sign, surrounded by optional whitespace. Then comes the value, which can be either a token or a quoted string. Quotes embedded in values are not always properly escaped, so an ending quote is only accepted if followed immediately by a semicolon or end of line. Since the values need to be saved, the entire header line is saved as well.</p>
  <pre class="dfn">
<a name="NW0-gJg1L-3" href="#NW0-gJg1L-1" id="NW0-gJg1L-3"><dfn>&lt;Multi-part Parse Variables&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-gJg1L-2">&lt;-</a>D<a href="#NW0-gJg1L-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>content_disposition <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>pname <span class="opt">= </span>NULL<span class="opt">, *</span>fname <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>mdate <span class="opt">= </span>NULL<span class="opt">, *</span>cdate <span class="opt">= </span>NULL<span class="opt">, *</span>rdate <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3xCCwq-3" href="#NW0-3xCCwq-1" id="NW0-3xCCwq-3"><dfn>&lt;Clean up multi-part parse&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3xCCwq-2">&lt;-</a>D<a href="#NW0-3xCCwq-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>content_disposition<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>content_disposition<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-Ow21m-1" href="#NW0-Ow21m-1" id="NW0-Ow21m-1"><dfn>&lt;Parse content-disposition&gt;=</dfn></a> <b>(<a href="#NW0-OcIai-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>s<span class="opt">, *</span>n<span class="opt">, *</span>ne<span class="opt">, *</span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gboolean </span>restore_semi <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>content_disposition<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  content_disposition <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">continue</span><span class="opt">; </span><span class="com">/* multiple disposition lines not supported */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for</span><span class="opt">(</span>s <span class="opt">= </span><span class="kwd">strchr</span><span class="opt">(</span>content_disposition<span class="opt">-&gt;</span>str <span class="opt">+ </span><span class="num">20</span><span class="opt">, </span><span class="str">';'</span><span class="opt">); </span>s <span class="opt">&amp;&amp; *</span>s<span class="opt">; ) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">';'</span> <span class="opt">|| </span><span class="kwd">isspace</span><span class="opt">(*</span>s<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!*</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  n <span class="opt">= </span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* RFC 2183 would have me filter more chars, but this is good enough */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isgraph</span><span class="opt">(*</span>s<span class="opt">) &amp;&amp; *</span>s <span class="opt">!= </span><span class="str">';'</span> <span class="opt">&amp;&amp; *</span>s <span class="opt">!= </span><span class="str">'='</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  ne <span class="opt">= </span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>s<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!*</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">!= </span><span class="str">'='</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>ne <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>s<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  v <span class="opt">= </span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>v <span class="opt">!= </span><span class="str">'"'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isgraph</span><span class="opt">(*++</span>s<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    ne <span class="opt">= </span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">&amp;&amp; !</span><span class="kwd">isspace</span><span class="opt">(*</span>s<span class="opt">) &amp;&amp; *</span>s <span class="opt">!= </span><span class="str">';'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* invalid token; ignore */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>s<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">&amp;&amp; *</span>s <span class="opt">!= </span><span class="str">';'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* invalid token again; ignore */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    restore_semi <span class="opt">= *</span>ne <span class="opt">== </span><span class="str">';'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>ne <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    ne <span class="opt">= ++</span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>s <span class="opt">= </span>v<span class="opt">; *</span>s<span class="opt">; </span>s<span class="opt">++) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span> <span class="opt">&amp;&amp; </span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] &amp;&amp; </span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] != </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">&amp;&amp; </span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] != </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>ne <span class="opt">= *++</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'"'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">char </span><span class="opt">*</span>ss<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">for</span><span class="opt">(</span>ss <span class="opt">= </span>s <span class="opt">+ </span><span class="num">1</span><span class="opt">; </span><span class="kwd">isspace</span><span class="opt">(*</span>ss<span class="opt">); </span>ss<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!*</span>ss <span class="opt">|| *</span>ss <span class="opt">== </span><span class="str">';'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>ne <span class="opt">= *</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>ne <span class="opt">= *</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>ne <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>n<span class="opt">, </span><span class="str">"name"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    pname <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>n<span class="opt">, </span><span class="str">"filename"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    fname <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>n<span class="opt">, </span><span class="str">"creation-date"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    cdate <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>n<span class="opt">, </span><span class="str">"modification-date"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    mdate <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>n<span class="opt">, </span><span class="str">"read-date"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    rdate <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strcasecmp</span><span class="opt">(</span>n<span class="opt">, </span><span class="str">"size"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">isdigit</span><span class="opt">(*</span>v<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      flen <span class="opt">= </span><span class="kwd">strtoull</span><span class="opt">(</span>v<span class="opt">, </span>NULL<span class="opt">, </span><span class="num">10</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* else ignore */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>restore_semi<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>ne <span class="opt">= </span><span class="str">';'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    restore_semi <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-ylIxa-1" href="#NW0-ylIxa-1" id="NW0-ylIxa-1"><dfn>&lt;Found multi-part file&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
fname
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, the body is parsed. This must take content encoding into consideration, but otherwise includes all text up to the last end-of-line followed by a boundary line. For CGI values, the value is assumed to be small enough to fit in memory, so it is sucked into a buffer and assigned to the parameter.</p>
  <pre class="dfn">
<a name="NW0-gJg1L-4" href="#NW0-gJg1L-1" id="NW0-gJg1L-4"><dfn>&lt;Multi-part Parse Variables&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-gJg1L-3">&lt;-</a>D<a href="#NW0-gJg1L-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>val <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3xCCwq-4" href="#NW0-3xCCwq-1" id="NW0-3xCCwq-4"><dfn>&lt;Clean up multi-part parse&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3xCCwq-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>val<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>val<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2004gC-1" href="#NW0-2004gC-1" id="NW0-2004gC-1"><dfn>&lt;Parse multi-part body as parameter&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">int </span>off <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="kwd">g_string_cgi_gets</span><span class="opt">(&amp;</span>val<span class="opt">, </span>off<span class="opt">, </span>cgi_state<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>val<span class="opt">-&gt;</span>str<span class="opt">[</span>off<span class="opt">] == </span><span class="str">'-'</span> <span class="opt">&amp;&amp; </span>val<span class="opt">-&gt;</span>str<span class="opt">[</span>off <span class="opt">+ </span><span class="num">1</span><span class="opt">] == </span><span class="str">'-'</span> <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">strncmp</span><span class="opt">(</span>val<span class="opt">-&gt;</span>str <span class="opt">+ </span>off <span class="opt">+ </span><span class="num">2</span><span class="opt">, </span>boundary<span class="opt">, </span>blen<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    off <span class="opt">+= </span>val<span class="opt">-&gt;</span>len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>val<span class="opt">-&gt;</span>len <span class="opt">&gt; </span>off<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_assign</span><span class="opt">(</span>buf<span class="opt">, </span>val<span class="opt">-&gt;</span>str <span class="opt">+ </span>off<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_assign</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>off <span class="opt">&gt; </span><span class="num">0 </span><span class="opt">&amp;&amp; </span>val<span class="opt">-&gt;</span>str<span class="opt">[</span>off <span class="opt">- </span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  off<span class="opt">--;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>off <span class="opt">&gt; </span><span class="num">0 </span><span class="opt">&amp;&amp; </span>val<span class="opt">-&gt;</span>str<span class="opt">[</span>off <span class="opt">- </span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  off<span class="opt">--;</span>
</pre>
      </li>

      <li>
        <pre>
val<span class="opt">-&gt;</span>len <span class="opt">= </span>off<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
val<span class="opt">-&gt;</span>str<span class="opt">[</span>off<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>enct <span class="opt">== </span>CT_ENC_Q<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  val<span class="opt">-&gt;</span>len <span class="opt">= </span><span class="kwd">decode_quoted_printable</span><span class="opt">(</span>val<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  val<span class="opt">-&gt;</span>str<span class="opt">[</span>val<span class="opt">-&gt;</span>len<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>enct <span class="opt">== </span>CT_ENC_B<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gint </span>b64_state <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint </span>b64_save <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  val<span class="opt">-&gt;</span>len <span class="opt">= </span><span class="kwd">g_base64_decode_step</span><span class="opt">(</span>val<span class="opt">-&gt;</span>str<span class="opt">, </span>val<span class="opt">-&gt;</span>len<span class="opt">, (</span><span class="kwb">guchar </span><span class="opt">*)</span>val<span class="opt">-&gt;</span>str<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                  <span class="opt">&amp;</span>b64_state<span class="opt">, &amp;</span>b64_save<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  val<span class="opt">-&gt;</span>str<span class="opt">[</span>val<span class="opt">-&gt;</span>len<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-Q" href="#NW0-wliTu-1" id="NW0-wliTu-Q"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-P">&lt;-</a>D<a href="#NW0-wliTu-R">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">decode_quoted_printable</span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>s<span class="opt">, *</span>d<span class="opt">, *</span>l<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>d <span class="opt">= </span>s <span class="opt">= </span>buf<span class="opt">; *</span>s<span class="opt">; </span>s<span class="opt">++) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* note: RFC says upper-case only, but allow lower-case since */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* otherwise lower-case just makes it invalid */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'='</span> <span class="opt">&amp;&amp; </span><span class="kwd">isxdigit</span><span class="opt">(</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">]) &amp;&amp; </span><span class="kwd">isxdigit</span><span class="opt">(</span>s<span class="opt">[</span><span class="num">2</span><span class="opt">])) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>d<span class="opt">++ = *++</span>s <span class="opt">&amp; </span><span class="num">0xf</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">&gt; </span><span class="str">'9'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>d <span class="opt">+= </span><span class="num">10 </span><span class="opt">- (</span><span class="str">'a'</span> <span class="opt">&amp; </span><span class="num">0xf</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>d <span class="opt">&lt;&lt;= </span><span class="num">4</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>d <span class="opt">+= *++</span>s <span class="opt">&amp; </span><span class="num">0xf</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">&gt; </span><span class="str">'9'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>d <span class="opt">+= </span><span class="num">10 </span><span class="opt">- (</span><span class="str">'a'</span> <span class="opt">&amp; </span><span class="num">0xf</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      d<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'='</span> <span class="opt">&amp;&amp; (!</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] || </span><span class="kwd">isspace</span><span class="opt">(</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">]))) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>l <span class="opt">= </span>s <span class="opt">+ </span><span class="num">1</span><span class="opt">; </span><span class="kwd">isspace</span><span class="opt">(*</span>l<span class="opt">) &amp;&amp; *</span>l <span class="opt">!= </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">&amp;&amp; *</span>l <span class="opt">!= </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">; </span>l<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!*</span>l <span class="opt">|| *</span>l <span class="opt">== </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">|| *</span>l <span class="opt">== </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        s <span class="opt">= </span>l<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">|| </span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="com">/* otherwise invalid, but go ahead and retain = */</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>d<span class="opt">++ = *</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">|| *</span>s <span class="opt">== </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>d<span class="opt">++ = *</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span> <span class="opt">|| </span>s<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>d<span class="opt">++ = *++</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">isspace</span><span class="opt">(*</span>s<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* invalid if =, but go ahead and retain */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>d<span class="opt">++ = *</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* for every space, see if it's at end of line, in which case remove */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>l <span class="opt">= </span>s <span class="opt">+ </span><span class="num">1</span><span class="opt">; </span><span class="kwd">isspace</span><span class="opt">(*</span>l<span class="opt">) &amp;&amp; *</span>l <span class="opt">!= </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">&amp;&amp; *</span>l <span class="opt">!= </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">; </span>l<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>l <span class="opt">== </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">|| *</span>l <span class="opt">== </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        s <span class="opt">= </span>l<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">memmove</span><span class="opt">(</span>d<span class="opt">, </span>s<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>l <span class="opt">- </span>s<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        d <span class="opt">+= (</span><span class="kwb">int</span><span class="opt">)(</span>l <span class="opt">- </span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        s <span class="opt">+= (</span><span class="kwb">int</span><span class="opt">)(</span>l <span class="opt">- </span>s<span class="opt">) - </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="opt">(</span><span class="kwb">int</span><span class="opt">)(</span>d <span class="opt">- </span>buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The algorithm for setting the correct HDF values was lifted from the ClearSilver source with minor modification. The file-related attributes are added as a hierarchy under the parameter. The value of the file parameter itself is also the file name. Since the primary value is a string, NUL characters in the value and all subsequent characters are lost. If lost NUL characters are detected, the raw buffer is duplicated and assigned to the value, and a `Length' subparameter is set to the parameter length. It is up to the user to check for the presence of this subparameter if binary values are expected. In most cases, though, the user will likely silently ignore that as an error.</p>
  <pre class="dfn">
<a name="NW0-gJg1L-5" href="#NW0-gJg1L-1" id="NW0-gJg1L-5"><dfn>&lt;Multi-part Parse Variables&gt;+=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-gJg1L-4">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">int </span>unnamed_parms <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">20</span><span class="opt">];</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2DC5zU-1" href="#NW0-2DC5zU-1" id="NW0-2DC5zU-1"><dfn>&lt;Set multi-part parameters&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>pname<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">snprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>nbuf<span class="opt">), </span><span class="str">"_%d"</span><span class="opt">, </span>unnamed_parms<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
  pname <span class="opt">= </span>nbuf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>obj <span class="opt">= </span><span class="kwd">cgi_parm_obj</span><span class="opt">(</span>pname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>obj<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* multiple values get assigned to .0, ,1, ... */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* but first one remains on named node, and is copied to .0 */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>i <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>child<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* don't count FileName &amp; other non-numeric parms */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>child <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>obj<span class="opt">); </span>child<span class="opt">; </span>child <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>child<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">isdigit</span><span class="opt">(</span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>child<span class="opt">)[</span><span class="num">0</span><span class="opt">]))</span>
</pre>
      </li>

      <li>
        <pre>
      i<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>i<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"0"</span><span class="opt">, </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>obj<span class="opt">)));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* note that doing an hdf_copy() would cause an infinite recursion */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* same for soft link */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">HDF </span><span class="opt">*</span>zero <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"0"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>child <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>obj<span class="opt">); </span>child<span class="opt">; </span>child <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>child<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">isdigit</span><span class="opt">(</span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>child<span class="opt">)[</span><span class="num">0</span><span class="opt">]))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>zero<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>child<span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwd">hdf_obj_value</span><span class="opt">(</span>child<span class="opt">))))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    i <span class="opt">= </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>i<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  pname <span class="opt">= </span>nbuf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* single value gets assigned to named node */</span>
</pre>
      </li>

      <li>
        <pre>
  obj <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>cgi_parms<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* pname is now parm to set, and obj is parent HDF */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>fname<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>obj<span class="opt">, </span>pname<span class="opt">, </span>fname<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else if</span><span class="opt">(</span><span class="kwd">strlen</span><span class="opt">(</span>val<span class="opt">-&gt;</span>str<span class="opt">) == </span>val<span class="opt">-&gt;</span>len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>obj<span class="opt">, </span>pname<span class="opt">, </span>val<span class="opt">-&gt;</span>str<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>vbuf <span class="opt">= </span><span class="kwd">malloc</span><span class="opt">(</span>val<span class="opt">-&gt;</span>len <span class="opt">+ </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>vbuf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_NOMEM<span class="opt">, </span><span class="str">"parameter too long"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">memcpy</span><span class="opt">(</span>vbuf<span class="opt">, </span>val<span class="opt">-&gt;</span>str<span class="opt">, </span>val<span class="opt">-&gt;</span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">hdf_set_buf</span><span class="opt">(</span>obj<span class="opt">, </span>pname<span class="opt">, </span>vbuf<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
      obj <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>obj<span class="opt">, </span>pname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* obj is ready for setting children of newly added parm */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_int_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"Length"</span><span class="opt">, </span>val<span class="opt">-&gt;</span>len<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>fname<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  obj <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>obj<span class="opt">, </span>pname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* obj is ready for setting children of newly added parm */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>mdate<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">((</span><span class="kwd">hdf_set_int64_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"ModTime"</span><span class="opt">, </span><span class="kwd">parse_http_date</span><span class="opt">(</span>mdate<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                                                 FALSE<span class="opt">))));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>cdate<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_int64_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"CreationTime"</span><span class="opt">, </span><span class="kwd">parse_http_date</span><span class="opt">(</span>cdate<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                                                     FALSE<span class="opt">)));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>rdate<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_int64_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"AccessTime"</span><span class="opt">, </span><span class="kwd">parse_http_date</span><span class="opt">(</span>rdate<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                                                   FALSE<span class="opt">)));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>content_type<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"Type"</span><span class="opt">, </span>content_type<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>flen <span class="opt">&gt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_set_int64_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"Length"</span><span class="opt">, </span>flen<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The date fields are converted to a standard UNIX GMT timestamp as per RFC 822 or RFC 2616, which references RFC 1123/822 and RFC 850. HTTP dates are a bit stricter than the MIME dates, so a flag chooses which. The timezone format requires glibc or similar extensions. This function proceeds similarly to the more generic <code>parse_date</code> function, but limits the acceptable formats more.</p>
  <pre class="dfn">
<a name="NW0-wliTu-R" href="#NW0-wliTu-1" id="NW0-wliTu-R"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-Q">&lt;-</a>D<a href="#NW0-wliTu-S">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static const char const </span><span class="opt">* </span>http_date_fmts<span class="opt">[] = {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* RFC 1123, RFC 2616 rfc1123-date */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%a, %d %b %Y %T %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* RFC 1123 */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%d %b %Y %T %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%a, %d %b %Y %R %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%d %b %Y %R %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* RFC 822 */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%a, %d %b %y %T %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%d %b %y %T %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%a, %d %b %y %R %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%d %b %y %R %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* RFC 2616 rfc850-date */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%a, %d-%b-%y %T %z"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* RFC 2616 asctime-date */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"TZ=GMT"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="str">"%a %b %d %T"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  NULL
</pre>
      </li>

      <li>
        <pre>
<span class="opt">};</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">time_t </span><span class="kwd">parse_http_date</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>date<span class="opt">, </span><span class="kwb">gboolean </span>http_only<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>e<span class="opt">, *</span>fmt<span class="opt">, **</span>fmtp<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">struct </span>tm tm_parsed<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">time_t </span>t<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>old_tz <span class="opt">= </span>NULL<span class="opt">; </span><span class="com">/* init to shut gcc up */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>set_tz <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>date <span class="opt">|| !*</span>date<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="opt">-</span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>fmtp <span class="opt">= </span>http_date_fmts<span class="opt">, </span>e <span class="opt">= </span>NULL<span class="opt">; (!</span>e <span class="opt">|| *</span>e<span class="opt">) &amp;&amp; (</span>fmt <span class="opt">= *</span>fmtp<span class="opt">); </span>fmtp<span class="opt">++) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strncmp</span><span class="opt">(</span>fmt<span class="opt">, </span><span class="str">"TZ="</span><span class="opt">, </span><span class="num">3</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>set_tz<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>tz_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        old_tz <span class="opt">= </span><span class="kwd">getenv</span><span class="opt">(</span><span class="str">"TZ"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        set_tz <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">setenv</span><span class="opt">(</span><span class="str">"TZ"</span><span class="opt">, </span>fmt <span class="opt">+ </span><span class="num">3</span><span class="opt">, </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">tzset</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">memset</span><span class="opt">(&amp;</span>tm_parsed<span class="opt">, </span><span class="num">0</span><span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>tm_parsed<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      e <span class="opt">= </span><span class="kwd">strptime</span><span class="opt">(</span>date<span class="opt">, </span>fmt<span class="opt">, &amp;</span>tm_parsed<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* HTTP requires GMT time zone */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* guaranteed more than 3 chars; time alone is 5 chars */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>http_only <span class="opt">&amp;&amp; </span>e <span class="opt">&amp;&amp; !*</span>e <span class="opt">&amp;&amp; </span><span class="kwd">strstr</span><span class="opt">(</span>fmt<span class="opt">, </span><span class="str">"%z"</span><span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="kwd">strcmp</span><span class="opt">(</span>e <span class="opt">- </span><span class="num">4</span><span class="opt">, </span><span class="str">" GMT"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        e <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>e <span class="opt">&amp;&amp; !*</span>e<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    t <span class="opt">= </span><span class="kwd">mktime</span><span class="opt">(&amp;</span>tm_parsed<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    t <span class="opt">= -</span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>set_tz<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>old_tz<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">setenv</span><span class="opt">(</span><span class="str">"TZ"</span><span class="opt">, </span>old_tz<span class="opt">, </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">unsetenv</span><span class="opt">(</span><span class="str">"TZ"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">tzset</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>tz_lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>t<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>As a last step for files, the contents are read into either a temporary file in the same way that the CGI kit does it, or, if provided, callbacks are called. The callbacks are defined in the CGI state structure rather than passed as arguments. They are placed in a substructure, though, to make storage of existing callbacks easier when chaining multiple callbacks together.</p>
  <pre class="dfn">
<a name="NW0-3DkYjs-3" href="#NW0-3DkYjs-1" id="NW0-3DkYjs-3"><dfn>&lt;CGI State Dependencies&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3DkYjs-2">&lt;-</a>D<a href="#NW0-3DkYjs-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">cgi_open_cb</span><span class="opt">)(</span><span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">cgi_write_cb</span><span class="opt">)(</span><span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="kwb">guint64 </span>off<span class="opt">, </span><span class="kwb">const void </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">cgi_progress_cb</span><span class="opt">)(</span><span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                         <span class="kwb">guint64 </span>off<span class="opt">, </span><span class="kwb">int </span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">cgi_close_cb</span><span class="opt">)(</span><span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="kwb">NEOERR </span><span class="opt">*</span>write_errors<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">struct </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_open_cb </span>open<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_write_cb </span>write<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_progress_cb </span>progress<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_close_cb </span>close<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">void </span><span class="opt">*</span>data<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwb">cgi_upload_cb</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-5" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-5"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-4">&lt;-</a>D<a href="#NW0-4IhMOG-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">cgi_open_cb</span><span class="opt">,</span><span class="kwb">cgi_write_cb</span><span class="opt">,</span><span class="kwb">cgi_progress_cb</span><span class="opt">,</span><span class="kwb">cgi_close_cb</span><span class="opt">,</span><span class="kwb">cgi_upload_cb</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-C" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-C"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-B">&lt;-</a>D<a href="#NW0-1Xz6uT-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">cgi_upload_cb </span>upload_cb<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2Uz4pb-1" href="#NW0-2Uz4pb-1" id="NW0-2Uz4pb-1"><dfn>&lt;Parse multi-part body as file&gt;=</dfn></a> <b>(<a href="#NW0-1DDebI-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-2Uz4pb-1-u1" href="#NW0-2LAFNX-1" id="NW0-2Uz4pb-1-u1"><i>&lt;Open multi-part body file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>off <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>eof <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2Uz4pb-1-u2" href="#NW0-2hKb8X-1" id="NW0-2Uz4pb-1-u2"><i>&lt;Prepare to read multi-part body file lines&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; <a name="NW0-2Uz4pb-1-u3" href="#NW0-4MY9X4-1" id="NW0-2Uz4pb-1-u3"><i>&lt;Read a multi-part body line&gt;</i></a>) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2Uz4pb-1-u4" href="#NW0-2O4kP-1" id="NW0-2Uz4pb-1-u4"><i>&lt;Break multi-part file read and set <code>eof</code> if boundary found&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2Uz4pb-1-u5" href="#NW0-13DiIo-1" id="NW0-2Uz4pb-1-u5"><i>&lt;Decode multi-part file line&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2Uz4pb-1-u6" href="#NW0-3TzsX1-1" id="NW0-2Uz4pb-1-u6"><i>&lt;Write multi-part body line to file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2Uz4pb-1-u7" href="#NW0-16Ohqw-1" id="NW0-2Uz4pb-1-u7"><i>&lt;Prepare for next multi-part body file line&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>eof<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(<a name="NW0-2Uz4pb-1-u8" href="#NW0-4MY9X4-1" id="NW0-2Uz4pb-1-u8"><i>&lt;Read a multi-part body line&gt;</i></a>) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-2Uz4pb-1-u9" href="#NW0-2O4kP-1" id="NW0-2Uz4pb-1-u9"><i>&lt;Break multi-part file read and set <code>eof</code> if boundary found&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-2Uz4pb-1-u10" href="#NW0-16Ohqw-1" id="NW0-2Uz4pb-1-u10"><i>&lt;Prepare for next multi-part body file line&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2Uz4pb-1-u11" href="#NW0-RIFgo-1" id="NW0-2Uz4pb-1-u11"><i>&lt;Close multi-part body file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Opening the file the CGI kit way is made a little easier via the `internal use only' <code>open_upload</code> function. This will likely disappear in a future revision of ClearSilver, but it works for now. Just as the original code which calls this function does, the unlinking parameter (which should probably always be on anyway) must be read manually and passed into the function, and the `file descriptor' must be read as the number of files opened so far. Errors writing the file should result in an unlink anyway, so the path name is saved for later if unlinking is disabled.</p>
  <pre class="dfn">
<a name="NW0-2LAFNX-1" href="#NW0-2LAFNX-1" id="NW0-2LAFNX-1"><dfn>&lt;Open multi-part body file&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a> <a href="#NW0-1Jgq0O-8">U-&gt;</a>)</b> <b>[D<a href="#NW0-2LAFNX-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">FILE </span><span class="opt">*</span>f <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>path <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>open<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">((*</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>open<span class="opt">)(</span>obj<span class="opt">, </span>cgi_state<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>unlink_it <span class="opt">= </span><span class="kwd">hdf_get_int_value</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">-&gt;</span>hdf<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                    <span class="str">"Config.Upload.Unlink"</span><span class="opt">, </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">nerr_pass_ctx</span><span class="opt">(</span><span class="kwd">open_upload</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span>unlink_it<span class="opt">, &amp;</span>f<span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
                       <span class="str">"Can't open file for %s upload"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwd">hdf_obj_name</span><span class="opt">(</span>obj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>entryno <span class="opt">= </span><span class="kwd">uListLength</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">-&gt;</span>files<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">hdf_set_int_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"FileHandle"</span><span class="opt">, </span>entryno<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* rfc2388.c checks errors on uListGet, but there should never be any */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">uListGet</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">-&gt;</span>files<span class="opt">, </span>entryno <span class="opt">- </span><span class="num">1</span><span class="opt">, (</span><span class="kwb">void </span><span class="opt">*)&amp;</span>f<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>unlink_it<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">uListGet</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">-&gt;</span>filenames<span class="opt">, </span>entryno <span class="opt">- </span><span class="num">1</span><span class="opt">, (</span><span class="kwb">void </span><span class="opt">*)&amp;</span>path<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"FileName"</span><span class="opt">, </span>path<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Reading lines requires stripping off the trailing carriage return and line feed for the last line. Since the last line is only known to be the last line after the boundary is read (i.e., this code does not use content-length), the trailing characters (either a newline alone or a carriage returned followed by a newline, even though the RFC only supports the latter) are always stripped off, and then re-added to the beginning of the next line's buffer. Since the buffer length is limited, lines may span multiple buffers. The boundary line is only sensed at the start of a new line, so a flag is used to indicate that the last read was a full line. It would be nice to use the indication of chracters to prepend as a flag that the buffer starts a new line (and may therefore be a boundary), but that would skip the first line.</p>

  <p>Just like the infinite line reader, this must find the end of the read by means other than the return value. For this reason, the buffer is always pre-filled, and the last terminator is found to determine length.</p>
  <pre class="dfn">
<a name="NW0-2hKb8X-1" href="#NW0-2hKb8X-1" id="NW0-2hKb8X-1"><dfn>&lt;Prepare to read multi-part body file lines&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-2hKb8X-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span>was_line <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>eol_len <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">memset</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="num">255</span><span class="opt">, </span>buf<span class="opt">-&gt;</span>allocated_len<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4MY9X4-1" href="#NW0-4MY9X4-1" id="NW0-4MY9X4-1"><dfn>&lt;Read a multi-part body line&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">cgi_gets</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span>eol_len<span class="opt">, </span>buf<span class="opt">-&gt;</span>allocated_len <span class="opt">- </span>eol_len<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2O4kP-1" href="#NW0-2O4kP-1" id="NW0-2O4kP-1"><dfn>&lt;Break multi-part file read and set <code>eof</code> if boundary found&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="com">/* no need to detect binary data in boundary */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>was_line <span class="opt">&amp;&amp; </span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span>eol_len<span class="opt">] == </span><span class="str">'-'</span> <span class="opt">&amp;&amp; </span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span>eol_len <span class="opt">+ </span><span class="num">1</span><span class="opt">] == </span><span class="str">'-'</span> <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">!</span><span class="kwd">strncmp</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span><span class="num">2</span><span class="opt">, </span>boundary<span class="opt">, </span>blen<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>ep<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for</span><span class="opt">(</span>ep <span class="opt">= </span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span>buf<span class="opt">-&gt;</span>allocated_len <span class="opt">- </span><span class="num">1</span><span class="opt">; *</span>ep<span class="opt">; --</span>ep<span class="opt">); </span><span class="com">/* memrchr is GNU */</span>
</pre>
      </li>

      <li>
        <pre>
buf<span class="opt">-&gt;</span>len <span class="opt">= (</span><span class="kwb">int</span><span class="opt">)(</span>ep <span class="opt">- </span>buf<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>len <span class="opt">== </span>eol_len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">; </span><span class="com">/* ignore EOL chars at EOF as well */</span>
</pre>
      </li>

      <li>
        <pre>
was_line <span class="opt">= </span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span>buf<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>was_line<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>len <span class="opt">&gt; </span><span class="num">1 </span><span class="opt">&amp;&amp; </span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span>buf<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    eol_len <span class="opt">= </span><span class="num">2</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    eol_len <span class="opt">= </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>len <span class="opt">-= </span>eol_len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>buf<span class="opt">-&gt;</span>len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">continue</span><span class="opt">; </span><span class="com">/* 1st 1-2 chars are already [\r]\n */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-16Ohqw-1" href="#NW0-16Ohqw-1" id="NW0-16Ohqw-1"><dfn>&lt;Prepare for next multi-part body file line&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>eol_len<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">0</span><span class="opt">] = </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>str<span class="opt">[</span>eol_len <span class="opt">- </span><span class="num">1</span><span class="opt">] = </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>str<span class="opt">[</span>eol_len<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>len <span class="opt">= </span>eol_len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The CGI kit only supports plain data; there is no decoding required for that. This library also supports the standard text encoding methods. These are slightly more complicated than the decoding done for parameter values, because only one line at a time is available for decoding.</p>
  <pre class="dfn">
<a name="NW0-13DiIo-1" href="#NW0-13DiIo-1" id="NW0-13DiIo-1"><dfn>&lt;Decode multi-part file line&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>enct <span class="opt">== </span>CT_ENC_Q<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* RFC states that no line shall exceed 79 chars, so assume EOL present */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* handle line continuation here */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>len <span class="opt">&gt; </span><span class="num">0 </span><span class="opt">&amp;&amp; </span><span class="kwd">isspace</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span>buf<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">]))</span>
</pre>
      </li>

      <li>
        <pre>
    buf<span class="opt">-&gt;</span>len<span class="opt">--;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>len <span class="opt">&gt; </span><span class="num">0 </span><span class="opt">&amp;&amp; </span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span>buf<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">] == </span><span class="str">'='</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    eol_len <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    buf<span class="opt">-&gt;</span>len<span class="opt">--;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>str<span class="opt">[</span>buf<span class="opt">-&gt;</span>len<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>init_eol <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span><span class="num">0</span><span class="opt">] == </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    init_eol <span class="opt">= </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">[</span>init_eol<span class="opt">] == </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    init_eol<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>len <span class="opt">= </span><span class="kwd">decode_quoted_printable</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span>init_eol<span class="opt">) + </span>init_eol<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>str<span class="opt">[</span>buf<span class="opt">-&gt;</span>len<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>enct <span class="opt">== </span>CT_ENC_B<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>len <span class="opt">= </span><span class="kwd">g_base64_decode_step</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span>buf<span class="opt">-&gt;</span>len<span class="opt">, (</span><span class="kwb">guchar </span><span class="opt">*)</span>buf<span class="opt">-&gt;</span>str<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                  <span class="opt">&amp;</span>b64_state<span class="opt">, &amp;</span>b64_save<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>str<span class="opt">[</span>buf<span class="opt">-&gt;</span>len<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2hKb8X-2" href="#NW0-2hKb8X-1" id="NW0-2hKb8X-2"><dfn>&lt;Prepare to read multi-part body file lines&gt;+=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2hKb8X-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gint </span>b64_state <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">guint </span>b64_save <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Writing the result is straightforward. Unfortunately, there is no way to control how much data has been read; accumulating a large amount into a buffer would make the writes more efficient. A progress callback is also called to replace the standard kit's upload callback; like that callback, it is called before the associated write. If a user callback was provided for opening the file, a user call back must be provided for the write, as well, since no assumption can be made that the callback data is a file descriptor.</p>
  <pre class="dfn">
<a name="NW0-3TzsX1-1" href="#NW0-3TzsX1-1" id="NW0-3TzsX1-1"><dfn>&lt;Write multi-part body line to file&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a> <a href="#NW0-1Jgq0O-8">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>progress<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">nerr_op_ok</span><span class="opt">((*</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>progress<span class="opt">)(</span>obj<span class="opt">, </span>cgi_state<span class="opt">, </span>off<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                                  buf<span class="opt">-&gt;</span>len<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>write<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">((*</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>write<span class="opt">)(</span>obj<span class="opt">, </span>cgi_state<span class="opt">, </span>off<span class="opt">, </span>buf<span class="opt">-&gt;</span>str<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                        buf<span class="opt">-&gt;</span>len<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else if</span><span class="opt">(</span>f<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">fwrite</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span>buf<span class="opt">-&gt;</span>len<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>f<span class="opt">) != </span><span class="num">1</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"Failed write for %s upload"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwd">hdf_obj_name</span><span class="opt">(</span>obj<span class="opt">));</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, the standard kit does not actually close the file. Instead, it seeks to the beginning and saves the pseudo file descriptor. This code also flushes the data to ensure it has been written. Any write errors cause the resulting file to be removed. This all is done in addition to the close callback, since it is not likely that the close callback will not also override the open callback.</p>
  <pre class="dfn">
<a name="NW0-RIFgo-1" href="#NW0-RIFgo-1" id="NW0-RIFgo-1"><dfn>&lt;Close multi-part body file&gt;=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a> <a href="#NW0-1Jgq0O-8">U-&gt;</a>)</b> <b>[D<a href="#NW0-RIFgo-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>f <span class="opt">&amp;&amp; </span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">fflush</span><span class="opt">(</span>f<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"Failed write for %s upload"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwd">hdf_obj_name</span><span class="opt">(</span>obj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">fseek</span><span class="opt">(</span>f<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>SEEK_SET<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>f <span class="opt">&amp;&amp; </span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">fclose</span><span class="opt">(</span>f<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  f <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>path<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">unlink</span><span class="opt">(</span>path<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>close<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= (*</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>close<span class="opt">)(</span>obj<span class="opt">, </span>cgi_state<span class="opt">, </span>nerr<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In case the standard open routine is used, but callbacks want to access the file, the file descriptor is assigned to the callback data if it was <code>NULL</code>. On close, the callback data is set back to <code>NULL</code> if it matches the file descriptor (very unlikely if it is not actually the file descriptor).</p>
  <pre class="dfn">
<a name="NW0-2LAFNX-2" href="#NW0-2LAFNX-1" id="NW0-2LAFNX-2"><dfn>&lt;Open multi-part body file&gt;+=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a> <a href="#NW0-1Jgq0O-8">U-&gt;</a>)</b> <b>[<a href="#NW0-2LAFNX-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>data<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>data <span class="opt">= </span>f<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-RIFgo-2" href="#NW0-RIFgo-1" id="NW0-RIFgo-2"><dfn>&lt;Close multi-part body file&gt;+=</dfn></a> <b>(<a href="#NW0-2Uz4pb-1">&lt;-U</a> <a href="#NW0-1Jgq0O-8">U-&gt;</a>)</b> <b>[<a href="#NW0-RIFgo-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span><span class="kwb">void </span><span class="opt">*)</span>f <span class="opt">== </span>cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>data<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>upload_cb<span class="opt">.</span>data <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The POST method is not the only method with a body. The PUT method is normally handled by <code>cgi_parse</code>, but the above code disables that processing. The built-in PUT processing, like the POST processing, has a few deficiencies. There is no callback at all, and the uploaded file is placed in a common temporary directory. It also does not support any content encoding. For this implementation, the upload parameters are saved to the <code>PUT</code> variable as with the standard library, and the upload callbacks are used with this parameter. Since the callback has access to the method, that can be used to distinguish the cases.</p>
  <pre class="dfn">
<a name="NW0-1Jgq0O-8" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-8"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-7">&lt;-</a>D<a href="#NW0-1Jgq0O-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>req_method <span class="opt">== </span>HTTP_REQ_PUT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>off <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>obj<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">struct </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">char </span><span class="opt">*</span>str<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">int </span>len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span>_buf<span class="opt">, *</span>buf <span class="opt">= &amp;</span>_buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>pi <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.PathInfo"</span><span class="opt">, </span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"PUT"</span><span class="opt">, </span>pi<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>cgi_state<span class="opt">-&gt;</span>body_type<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"PUT.Type"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>body_type<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* this is done by cgi_decode_read as well, but that's too late for */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* open callback */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_enc <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>body_len <span class="opt">&gt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set_int</span><span class="opt">(</span><span class="str">"CGI.ContentLength"</span><span class="opt">, (</span>cgi_state<span class="opt">-&gt;</span>body_len <span class="opt">= -</span><span class="num">1</span><span class="opt">)));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set_int</span><span class="opt">(</span><span class="str">"PUT.Length"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>body_len<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  obj <span class="opt">= </span><span class="kwd">cgi_env_obj</span><span class="opt">(</span><span class="str">"PUT"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!(</span>_buf<span class="opt">.</span>str <span class="opt">= </span><span class="kwd">malloc</span><span class="opt">(</span>DEC_BUF_LEN<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Error reading upload stream"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1Jgq0O-8-u1" href="#NW0-2LAFNX-1" id="NW0-1Jgq0O-8-u1"><i>&lt;Open multi-part body file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">free</span><span class="opt">(</span>_buf<span class="opt">.</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">cgi_read</span><span class="opt">(</span>_buf<span class="opt">.</span>str<span class="opt">, </span>DEC_BUF_LEN<span class="opt">, &amp;</span>_buf<span class="opt">.</span>len<span class="opt">)) &amp;&amp; </span>_buf<span class="opt">.</span>len <span class="opt">&gt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-1Jgq0O-8-u2" href="#NW0-3TzsX1-1" id="NW0-1Jgq0O-8-u2"><i>&lt;Write multi-part body line to file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1Jgq0O-8-u3" href="#NW0-RIFgo-1" id="NW0-1Jgq0O-8-u3"><i>&lt;Close multi-part body file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc9" id="toc9">Common Headers</a></h1>

  <p>Some headers are handled differently depening on the request method. However, for headers that are sufficiently well defined by RFCs, some syntax checking and parsing can be done for any CGI program that needs it.</p>
  <pre class="dfn">
<a name="NW0-1Jgq0O-9" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-9"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-8">&lt;-</a>D<a href="#NW0-1Jgq0O-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>hobj<span class="opt">; </span><span class="com">/* the header value under consideration */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-1Jgq0O-9-u1" href="#NW0-2WZQ2h-1" id="NW0-1Jgq0O-9-u1"><i>&lt;Process common HTTP headers&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"401 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>First are the ones defined by RFC 2616. Many of these require processing tokens and quoted strings.</p>
  <pre class="dfn">
<a name="NW0-wliTu-S" href="#NW0-wliTu-1" id="NW0-wliTu-S"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-R">&lt;-</a>D<a href="#NW0-wliTu-T">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span><span class="kwd">skip_http_token</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*</span>s <span class="opt">&gt; </span><span class="num">32 </span><span class="opt">&amp;&amp; !</span><span class="kwd">strchr</span><span class="opt">(</span><span class="str">"()&lt;&gt;@,;:</span><span class="esc">\\\"</span><span class="str">/[]?={}</span><span class="esc">\177</span><span class="str">"</span><span class="opt">, *</span>s<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*)</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-T" href="#NW0-wliTu-1" id="NW0-wliTu-T"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-S">&lt;-</a>D<a href="#NW0-wliTu-U">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span><span class="kwd">skip_http_quoted_string</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">!= </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*++</span>s <span class="opt">!= </span><span class="str">'"'</span> <span class="opt">&amp;&amp; *</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span> <span class="opt">&amp;&amp; </span>s<span class="opt">[</span><span class="num">1</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
      s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">!= </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*)</span>s <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-U" href="#NW0-wliTu-1" id="NW0-wliTu-U"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-T">&lt;-</a>D<a href="#NW0-wliTu-V">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span><span class="kwd">mangle_and_skip_http_quoted_string</span><span class="opt">(</span><span class="kwb">char </span><span class="opt">*</span>s<span class="opt">, </span><span class="kwb">char </span><span class="opt">**</span>ms<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>d<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">!= </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  d <span class="opt">= </span>s <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>ms<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>ms <span class="opt">= </span>d<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(*++</span>s <span class="opt">!= </span><span class="str">'"'</span> <span class="opt">&amp;&amp; *</span>s<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">== </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span> <span class="opt">&amp;&amp; </span>s<span class="opt">[</span><span class="num">1</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
      s<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>d<span class="opt">++ = *</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>s <span class="opt">!= </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>d <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>s <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The Accept header takes a list of media types, with optional keyword-value pairs describing each type. The <code>q</code> keyword has a particular format and interpretation. Errors cause the header to be ignored rather than giving a 401 or 406 error. Each supplied content-type is added as a child to the header, and the keyword-value pairs are stored as attributes for those children. No attempt is made to sort by precedence.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-1" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-1"><dfn>&lt;Process common HTTP headers&gt;=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[D<a href="#NW0-2WZQ2h-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Accept"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>cno <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>hv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">), *</span>ev<span class="opt">, *</span>vp<span class="opt">, *</span>vs<span class="opt">, </span>ec<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>cobj<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span>hv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    vs <span class="opt">= </span>hv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">== </span><span class="str">'*'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      ev <span class="opt">= </span>hv <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      ev <span class="opt">= </span><span class="kwd">skip_http_token</span><span class="opt">(</span>hv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>ev <span class="opt">!= </span>hv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      vp <span class="opt">= </span>ev<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>ev<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ev<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>ev <span class="opt">== </span><span class="str">'/'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>vp<span class="opt">++ = </span><span class="str">'/'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>ev<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(*</span>ev <span class="opt">== </span><span class="str">'*'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          hv <span class="opt">= </span>ev <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">else if</span><span class="opt">(*</span>vs <span class="opt">!= </span><span class="str">'*'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          hv <span class="opt">= </span><span class="kwd">skip_http_token</span><span class="opt">(</span>ev<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          hv <span class="opt">= </span>ev<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>hv <span class="opt">!= </span>ev<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>ev <span class="opt">!= </span>vp<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwd">memmove</span><span class="opt">(</span>ev<span class="opt">, </span>vp<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>hv <span class="opt">- </span>ev<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
          vp <span class="opt">+= (</span><span class="kwb">int</span><span class="opt">)(</span>hv <span class="opt">- </span>ev<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          ec <span class="opt">= *</span>vp<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>cno<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_get_node</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, &amp;</span>cobj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>vp <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">hdf_set_value</span><span class="opt">(</span>cobj<span class="opt">, </span>NULL<span class="opt">, </span>vs<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>vp <span class="opt">= </span>ec<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">while</span><span class="opt">(</span>hv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwb">char </span><span class="opt">*</span>as<span class="opt">, *</span>ae<span class="opt">, *</span>avs<span class="opt">, *</span>ave<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>hv<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
              hv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">!= </span><span class="str">';'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            as <span class="opt">= </span>hv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            ae <span class="opt">= </span>hv <span class="opt">= </span><span class="kwd">skip_http_token</span><span class="opt">(</span>hv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(</span>ae <span class="opt">!= </span>as<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>hv<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
                hv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">== </span><span class="str">'='</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>hv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
                avs <span class="opt">= </span>hv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">== </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
                  ave <span class="opt">= </span><span class="kwd">mangle_and_skip_http_quoted_string</span><span class="opt">(</span>hv<span class="opt">, &amp;</span>avs<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
                  ave <span class="opt">= </span><span class="kwd">skip_http_token</span><span class="opt">(</span>avs<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwa">if</span><span class="opt">(</span>ave <span class="opt">== </span>avs<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
                    ave <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
                avs <span class="opt">= </span>ave <span class="opt">= </span>ae<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(</span>ave<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                ec <span class="opt">= *</span>ave<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">*</span>ave <span class="opt">= *</span>ae <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_attr</span><span class="opt">(</span>cobj<span class="opt">, </span>NULL<span class="opt">, </span>as<span class="opt">, </span>avs<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strcmp</span><span class="opt">(</span>as<span class="opt">, </span><span class="str">"q"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwa">if</span><span class="opt">(*</span>avs <span class="opt">!= </span><span class="str">'0'</span> <span class="opt">|| *</span>avs <span class="opt">!= </span><span class="str">'1'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                     <span class="opt">(</span>avs<span class="opt">[</span><span class="num">1</span><span class="opt">] &amp;&amp; (</span>avs<span class="opt">[</span><span class="num">1</span><span class="opt">] != </span><span class="str">'.'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                                 <span class="opt">(</span>avs<span class="opt">[</span><span class="num">2</span><span class="opt">] &amp;&amp; !</span><span class="kwd">isdigit</span><span class="opt">(</span>avs<span class="opt">[</span><span class="num">2</span><span class="opt">])) ||</span>
</pre>
      </li>

      <li>
        <pre>
                                 <span class="opt">(</span>avs<span class="opt">[</span><span class="num">3</span><span class="opt">] &amp;&amp; !</span><span class="kwd">isdigit</span><span class="opt">(</span>avs<span class="opt">[</span><span class="num">3</span><span class="opt">])) ||</span>
</pre>
      </li>

      <li>
        <pre>
                                 <span class="opt">(</span>avs<span class="opt">[</span><span class="num">4</span><span class="opt">] &amp;&amp; !</span><span class="kwd">isdigit</span><span class="opt">(</span>avs<span class="opt">[</span><span class="num">4</span><span class="opt">])) ||</span>
</pre>
      </li>

      <li>
        <pre>
                                 avs<span class="opt">[</span><span class="num">5</span><span class="opt">])))</span>
</pre>
      </li>

      <li>
        <pre>
                    hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
                hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
              hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>hv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>hv<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        hv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!*</span>hv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">!= </span><span class="str">','</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>hv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>hv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>headers<span class="opt">, </span><span class="str">"Accept"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The Accept-Charset header takes a list of character set identifiers, with optional <code>q</code> keywords to describe preference order. It is processed the same way as the Accept header, except that the character set format is different from a content type, and only the <code>q</code> keyword is allowed. The format for the Accept-Encoding header is the same. The format for Accept-Language is stricter, but a non-matching language is a non-matching language regardless of the reason, so they are parsed the same way as well.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-2" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-2"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-1">&lt;-</a>D<a href="#NW0-2WZQ2h-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"AcceptCharset"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2WZQ2h-2-u1" href="#NW0-tPLhs-1" id="NW0-2WZQ2h-2-u1"><i>&lt;Process priority http token list&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>hv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>headers<span class="opt">, </span><span class="str">"AcceptCharset"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"AcceptEncoding"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2WZQ2h-2-u2" href="#NW0-tPLhs-1" id="NW0-2WZQ2h-2-u2"><i>&lt;Process priority http token list&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>hv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>headers<span class="opt">, </span><span class="str">"AcceptEncoding"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"AcceptLanguage"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2WZQ2h-2-u3" href="#NW0-tPLhs-1" id="NW0-2WZQ2h-2-u3"><i>&lt;Process priority http token list&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>hv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>headers<span class="opt">, </span><span class="str">"AcceptLanguage"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-tPLhs-1" href="#NW0-tPLhs-1" id="NW0-tPLhs-1"><dfn>&lt;Process priority http token list&gt;=</dfn></a> <b>(<a href="#NW0-2WZQ2h-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>cno <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>hv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">), *</span>ev<span class="opt">, </span>ec<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>cobj<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span>hv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">== </span><span class="str">'*'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    ev <span class="opt">= </span>hv <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    ev <span class="opt">= </span><span class="kwd">skip_http_token</span><span class="opt">(</span>hv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>ev <span class="opt">!= </span>hv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    ec <span class="opt">= *</span>ev<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>cno<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_get_node</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, &amp;</span>cobj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>ev <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_set_value</span><span class="opt">(</span>cobj<span class="opt">, </span>NULL<span class="opt">, </span>hv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>ev <span class="opt">= </span>ec<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>hv<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      hv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">== </span><span class="str">';'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>hv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">== </span><span class="str">'q'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>hv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">== </span><span class="str">'='</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>hv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
          ev <span class="opt">= </span><span class="kwd">skip_http_token</span><span class="opt">(</span>hv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          ec <span class="opt">= *</span>ev<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>ev <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">!= </span><span class="str">'0'</span> <span class="opt">|| *</span>hv <span class="opt">!= </span><span class="str">'1'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
             <span class="opt">(</span>hv<span class="opt">[</span><span class="num">1</span><span class="opt">] &amp;&amp; (</span>hv<span class="opt">[</span><span class="num">1</span><span class="opt">] != </span><span class="str">'.'</span> <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="opt">(</span>hv<span class="opt">[</span><span class="num">2</span><span class="opt">] &amp;&amp; !</span><span class="kwd">isdigit</span><span class="opt">(</span>hv<span class="opt">[</span><span class="num">2</span><span class="opt">])) ||</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="opt">(</span>hv<span class="opt">[</span><span class="num">3</span><span class="opt">] &amp;&amp; !</span><span class="kwd">isdigit</span><span class="opt">(</span>hv<span class="opt">[</span><span class="num">3</span><span class="opt">])) ||</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="opt">(</span>hv<span class="opt">[</span><span class="num">4</span><span class="opt">] &amp;&amp; !</span><span class="kwd">isdigit</span><span class="opt">(</span>hv<span class="opt">[</span><span class="num">4</span><span class="opt">])) ||</span>
</pre>
      </li>

      <li>
        <pre>
                        hv<span class="opt">[</span><span class="num">5</span><span class="opt">])))</span>
</pre>
      </li>

      <li>
        <pre>
            hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_attr</span><span class="opt">(</span>cobj<span class="opt">, </span>NULL<span class="opt">, </span><span class="str">"q"</span><span class="opt">, </span>hv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>ev <span class="opt">= </span>ec<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>hv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>hv<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        hv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!*</span>hv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>hv <span class="opt">!= </span><span class="str">','</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        hv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>hv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The Allow header's utility is limited, so it is left alone. The Authorization header and proxy, cache, and protocol control headers should be taken care of by the server, so they are also left alone. Entity headers may be useful for PUT requests, but they are ignored in the general case. The From, Host, and Referer fields are free-format. The application must process these headers if required.</p>

  <p>The conditional headers are checked and adjusted. The If-Match and If-None-Match take a list of quoted strings, which are stored as children of the header parameter. The list of entity tags is split out into children of the HDF parameter after having the string quoting removed. The existence tag (<code>*</code>) is encoded as no children of the HDF parameter; if there are really no tags, an error 400 is returned. Although the string quoting is removed, the first character is retained as either a quote for strong tags, or a capital W for weak tags.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-3" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-3"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-2">&lt;-</a>D<a href="#NW0-2WZQ2h-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"IfMatch"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2WZQ2h-3-u1" href="#NW0-2tk60i-1" id="NW0-2WZQ2h-3-u1"><i>&lt;Set match children of <code>hobj</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"IfNoneMatch"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2WZQ2h-3-u2" href="#NW0-2tk60i-1" id="NW0-2WZQ2h-3-u2"><i>&lt;Set match children of <code>hobj</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2tk60i-1" href="#NW0-2tk60i-1" id="NW0-2tk60i-1"><dfn>&lt;Set match children of <code>hobj</code>&gt;=</dfn></a> <b>(<a href="#NW0-2WZQ2h-3">&lt;-U</a> <a href="#NW0-2WZQ2h-5">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>v <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!*</span>v<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Invalid match format"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">strcmp</span><span class="opt">(</span>v<span class="opt">, </span><span class="str">"*"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>s<span class="opt">, *</span>e<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>cno <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">toupper</span><span class="opt">(*</span>v<span class="opt">) == </span><span class="str">'W'</span> <span class="opt">&amp;&amp; </span>v<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'/'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      v <span class="opt">+= </span><span class="num">2</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>v <span class="opt">!= </span><span class="str">'"'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>s <span class="opt">!= </span>v<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>v <span class="opt">= </span><span class="str">'W'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    e <span class="opt">= ++</span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(*</span>v <span class="opt">&amp;&amp; *</span>v <span class="opt">!= </span><span class="str">'"'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>v <span class="opt">== </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span>v<span class="opt">[</span><span class="num">1</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">++</span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>e<span class="opt">++ = *</span>v<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!*</span>v<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">--</span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>cno<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>e <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, </span>s<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>v<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!*</span>v <span class="opt">|| *</span>v <span class="opt">!= </span><span class="str">','</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>v<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!*</span>v<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">--</span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>v<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Invalid match format"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The If-Modified-Since and If-Unmodified-Since take a date parameter; this is converted to its numeric equivalent. The standard says that headers with invalid dates are to be ignored, rather than rejected with a request error.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-4" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-4"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-3">&lt;-</a>D<a href="#NW0-2WZQ2h-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"IfModifiedSince"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2WZQ2h-4-u1" href="#NW0-185f0Y-1" id="NW0-2WZQ2h-4-u1"><i>&lt;Parse <code>hobj</code> as HTTP date&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"IfUnmodifiedSince"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2WZQ2h-4-u2" href="#NW0-185f0Y-1" id="NW0-2WZQ2h-4-u2"><i>&lt;Parse <code>hobj</code> as HTTP date&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-185f0Y-1" href="#NW0-185f0Y-1" id="NW0-185f0Y-1"><dfn>&lt;Parse <code>hobj</code> as HTTP date&gt;=</dfn></a> <b>(<a href="#NW0-2WZQ2h-4">&lt;-U</a> <a href="#NW0-2WZQ2h-5">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">time_t </span>t <span class="opt">= </span><span class="kwd">parse_http_date</span><span class="opt">(</span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">), </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>t <span class="opt">&lt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if 0</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Invalid header date format"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_header_set</span><span class="opt">(</span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>hobj<span class="opt">), </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">hdf_set_int64_value</span><span class="opt">(</span>hobj<span class="opt">, </span>NULL<span class="opt">, </span>t<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The If-Range header gets either an entity tag, which is stored as a single child for consistency with the IfMatch header, or a date, which is converted to a numeric date for consistency with the If-Modified-Since header. It is to be ignored if no Range header is present.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-5" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-5"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-4">&lt;-</a>D<a href="#NW0-2WZQ2h-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"IfRange"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>cv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Range"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_header_set</span><span class="opt">(</span><span class="str">"IfRange"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'"'</span> <span class="opt">|| (</span><span class="kwd">toupper</span><span class="opt">(*</span>cv<span class="opt">) == </span><span class="str">'W'</span> <span class="opt">&amp;&amp; </span>cv<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'/'</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-2WZQ2h-5-u1" href="#NW0-2tk60i-1" id="NW0-2WZQ2h-5-u1"><i>&lt;Set match children of <code>hobj</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">hdf_obj_next</span><span class="opt">(</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>hobj<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Only specify one entity tag for If-Range"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-2WZQ2h-5-u2" href="#NW0-185f0Y-1" id="NW0-2WZQ2h-5-u2"><i>&lt;Parse <code>hobj</code> as HTTP date&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The next supported header is the partial download specifier, Range. This takes an arbitrary named range specifier, but the RFC only defines one, so that is what is supported: the byte range. Each range is converted into a child whose name is the start of the range and whose value is the end of the range. This makes it easier to sort and merge the ranges. If multiple ranges have the same start, the highest end value is used. Note that unknown range types are ignored by not having any children, and that the RFC recommendation of returning ranges in order is violated by merging overlapping ranges. Once the children are sorted, it will become impossible to match the requested ordering.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-6" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-6"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-5">&lt;-</a>D<a href="#NW0-2WZQ2h-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Range"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>cv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strncasecmp</span><span class="opt">(</span>cv<span class="opt">, </span><span class="str">"bytes"</span><span class="opt">, </span><span class="num">5</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    cv <span class="opt">+= </span><span class="num">4</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>cv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">guint64 </span>start <span class="opt">= </span><span class="num">0</span><span class="opt">, </span>end <span class="opt">= ~</span><span class="num">0</span><span class="opt">; </span><span class="com">/* open range */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">HDF </span><span class="opt">*</span>ov<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">gboolean </span>got_start <span class="opt">= </span>FALSE<span class="opt">, </span>got_end <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">isdigit</span><span class="opt">(*</span>cv<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        got_start <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        start <span class="opt">= </span><span class="kwd">strtoull</span><span class="opt">(</span>cv<span class="opt">, (</span><span class="kwb">char </span><span class="opt">**)&amp;</span>cv<span class="opt">, </span><span class="num">10</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>cv<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          cv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'-'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>cv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span><span class="kwd">isdigit</span><span class="opt">(*</span>cv<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
          got_end <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          end <span class="opt">= </span><span class="kwd">strtoull</span><span class="opt">(</span>cv<span class="opt">, (</span><span class="kwb">char </span><span class="opt">**)&amp;</span>cv<span class="opt">, </span><span class="num">10</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>cv<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            cv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((*</span>cv <span class="opt">&amp;&amp; *</span>cv <span class="opt">!= </span><span class="str">','</span><span class="opt">) || (!</span>got_start <span class="opt">&amp;&amp; !</span>got_end<span class="opt">) || </span>end <span class="opt">&lt; </span>start<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Invalid range specification"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%llu"</span><span class="opt">, (</span><span class="kwb">ullong</span><span class="opt">)</span>start<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span>ov <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
        start <span class="opt">= </span><span class="kwd">hdf_get_int64_value</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>start <span class="opt">&lt; </span>end<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_int64_value</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, </span>end<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_int64_value</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, </span>end<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Next are the headers described by the WebDAV RFCs. RFC 4918 describes the Depth header, which should be ignored if not needed, but otherwise must consist of one of three values. Rather than ignore it as required, the header causes an error 400 if it is not one of the three known values.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-7" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-7"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-6">&lt;-</a>D<a href="#NW0-2WZQ2h-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Depth"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>v <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>v <span class="opt">&amp;&amp; </span><span class="kwd">strcmp</span><span class="opt">(</span>v<span class="opt">, </span><span class="str">"0"</span><span class="opt">) &amp;&amp; </span><span class="kwd">strcmp</span><span class="opt">(</span>v<span class="opt">, </span><span class="str">"1"</span><span class="opt">) &amp;&amp; </span><span class="kwd">strcasecmp</span><span class="opt">(</span>v<span class="opt">, </span><span class="str">"infinity"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">); </span><span class="com">/* 422? */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Depth is invalid"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The next header is the Destination header, which must be a so-called <em>simple reference</em>. This is either an absolute URI or an absolute path with no relative references (<code>.</code> or <code>..</code>) which also normally matches the request URI as much as possible. For the Destination header, the last requirement is relaxed. For this library, URIs are expected to be relative to the same CGI program. To use this with a program that supports alternate targets, such as for thrid party copies, simply use the environment variable directly rather than the stored version, and delete it from the environment to avoid errors generated here.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-8" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-8"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-7">&lt;-</a>D<a href="#NW0-2WZQ2h-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Destination"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">normalize_path_obj</span><span class="opt">(</span>hobj<span class="opt">, </span>cgi_state<span class="opt">, </span>NULL<span class="opt">, </span>TRUE<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_pass_ctx</span><span class="opt">(</span>nerr<span class="opt">, </span><span class="str">"Destination"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The RFC 4918 conditional header, If, is a bit more complex than the plain HTTP conditionals. It can specify conditions on several resources, via resource tags (the request URI by default). Multiple lists are then specified which apply to that resource. For each such list, a child is created whose value is the resource to which it applies, and whose children are the conditions which must all apply for the child to evaluate to true. The overall header evaluates to true if any of its immediate children evaluate to true, which implies that all of that child's children evaluate to true. The conditions themselves are an entity tag or a state token. The entity tags are encoded as above, except that inversion is specified by using a lower-case w for weak tags and a single quote for strong tags. State tokens are enclosed in angle brackets, so the less-than sign is retained as a prefix to distinguish them, or a greater-than sign for inverted state tokens. The only validation done on state tokens and entity tags is to verify that state tokens have a protocol separator (<code>:</code>).</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-9" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-9"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-8">&lt;-</a>D<a href="#NW0-2WZQ2h-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"If"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>cv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>rtag_allowed <span class="opt">= *</span>cv <span class="opt">== </span><span class="str">'&lt;'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>path_info <span class="opt">= </span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="str">"CGI.PathInfo"</span><span class="opt">, </span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>res <span class="opt">= </span>path_info<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>orn <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>rtag_allowed <span class="opt">&amp;&amp; *</span>cv <span class="opt">== </span><span class="str">'&lt;'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      res <span class="opt">= ++</span>cv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(*</span>cv <span class="opt">&amp;&amp; *</span>cv <span class="opt">!= </span><span class="str">'&gt;'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        cv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!*</span>cv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>cv <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>cv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-2WZQ2h-9-u1" href="#nw@notdef" id="NW0-2WZQ2h-9-u1"><i>&lt;Check and adjust resource URI <code>res</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">!= </span><span class="str">'('</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>cv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">int </span>andn <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">HDF </span><span class="opt">*</span>res_obj<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>orn<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_get_node</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, &amp;</span>res_obj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>res_obj<span class="opt">, </span>NULL<span class="opt">, </span>res<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>res <span class="opt">!= </span>path_info<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-2WZQ2h-9-u2" href="#NW0-11loCj-1" id="NW0-2WZQ2h-9-u2"><i>&lt;Check and adjust resource URI <code>res_obj</code>/<code>res</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
      path_info <span class="opt">= </span>res<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">gboolean </span>is_not <span class="opt">= !</span><span class="kwd">strncasecmp</span><span class="opt">(</span>cv<span class="opt">, </span><span class="str">"Not"</span><span class="opt">, </span><span class="num">3</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">const char </span><span class="opt">*</span>sv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>is_not<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        cv <span class="opt">+= </span><span class="num">2</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>cv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'&lt;'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        sv <span class="opt">= </span>cv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>is_not<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>cv <span class="opt">= </span><span class="str">'&gt;'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(*++</span>cv <span class="opt">&amp;&amp; *</span>cv <span class="opt">!= </span><span class="str">'&gt;'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">!= </span><span class="str">'&gt;'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>cv <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strchr</span><span class="opt">(</span>sv<span class="opt">, </span><span class="str">':'</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
          cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'['</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        sv <span class="opt">= </span>cv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span><span class="kwd">toupper</span><span class="opt">(*++</span>cv<span class="opt">) == </span><span class="str">'W'</span> <span class="opt">&amp;&amp; </span>cv<span class="opt">[</span><span class="num">1</span><span class="opt">] == </span><span class="str">'/'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          cv <span class="opt">+= </span><span class="num">2</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">!= </span><span class="str">'"'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>sv <span class="opt">!= </span>cv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          sv <span class="opt">= </span>cv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>cv <span class="opt">= </span>is_not ? <span class="str">'w'</span> <span class="opt">: </span><span class="str">'W'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>is_not<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>cv <span class="opt">= </span><span class="str">'</span><span class="esc">\'</span><span class="str">'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">char </span><span class="opt">*</span>e <span class="opt">= </span>cv <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(*++</span>cv <span class="opt">&amp;&amp; *</span>cv <span class="opt">!= </span><span class="str">'"'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'</span><span class="esc">\\</span><span class="str">'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(!</span>cv<span class="opt">[</span><span class="num">1</span><span class="opt">]) {</span>
</pre>
      </li>

      <li>
        <pre>
              cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
            cv<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">*</span>e<span class="opt">++ = *</span>cv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">!= </span><span class="str">'"'</span> <span class="opt">|| *++</span>cv <span class="opt">!= </span><span class="str">']'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>e <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
        cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>andn<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>res_obj<span class="opt">, </span>nbuf<span class="opt">, </span>sv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>cv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">')'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>cv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>cv<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!*</span>cv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Bad If syntax"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The resource tags actually specify entities which must be checked for the applicable conditions. They have the simple reference conditions described for the Destination header, except that in this case, the restriction of being the same or beneath the request URI is a requirement. Or at least that is what the RFC says; in actuality, it can also match the Destination header. In fact, some samples in the RFCs indicate that the path only needs to match after normalization, including sloppy hostname matching, resolution of home directories, and so forth. For this reason, the path is only subjected to standard normalization of absolute URLs, with no further processing. This at least requires that URLs be on the same host.</p>
  <pre class="dfn">
<a name="NW0-11loCj-1" href="#NW0-11loCj-1" id="NW0-11loCj-1"><dfn>&lt;Check and adjust resource URI <code>res_obj</code>/<code>res</code>&gt;=</dfn></a> <b>(<a href="#NW0-2WZQ2h-9">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">cgi_url_unescape</span><span class="opt">(</span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>res_obj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">normalize_path_obj</span><span class="opt">(</span>res_obj<span class="opt">, </span>cgi_state<span class="opt">, </span>NULL<span class="opt">, </span>TRUE<span class="opt">, </span>TRUE<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
res <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>res_obj<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The Lock-Token header specifies a lock token, which is a URL enclosed in angle brackets. The only check is that it contains a colon.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-A" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-A"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-9">&lt;-</a>D<a href="#NW0-2WZQ2h-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"LockToken"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>cv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">), *</span>gt<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>cv <span class="opt">!= </span><span class="str">'&lt;'</span> <span class="opt">|| !</span><span class="kwd">strchr</span><span class="opt">(</span>cv<span class="opt">, </span><span class="str">':'</span><span class="opt">) || !(</span>gt <span class="opt">= </span><span class="kwd">strrchr</span><span class="opt">(</span>cv<span class="opt">, </span><span class="str">'&gt;'</span><span class="opt">)) || </span>gt<span class="opt">[</span><span class="num">1</span><span class="opt">]) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Invalid state token Lock-Token"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The Overwrite header must match the value T or F. It is converted to upper-case.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-B" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-B"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-A">&lt;-</a>D<a href="#NW0-2WZQ2h-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Overwrite"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>cv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cv<span class="opt">[</span><span class="num">1</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
    cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'t'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>cv <span class="opt">= </span><span class="str">'T'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'f'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>cv <span class="opt">= </span><span class="str">'F'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">!= </span><span class="str">'T'</span> <span class="opt">&amp;&amp; *</span>cv <span class="opt">!= </span><span class="str">'F'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Overwrite must be T or F"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The Timeout header consists of one or more comma-separated timeout values, which are a number of seconds or the word Infinite. If there is only one, it is simply checked for validity. If there is more than one, children are created with the values.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-C" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-C"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-B">&lt;-</a>D<a href="#NW0-2WZQ2h-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Timeout"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>v <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">), *</span>vs<span class="opt">, *</span>ve<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>cno <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    vs <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">strncasecmp</span><span class="opt">(</span>v<span class="opt">, </span><span class="str">"Infinite"</span><span class="opt">, </span><span class="num">8</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      v <span class="opt">+= </span><span class="num">8</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span><span class="kwd">strncasecmp</span><span class="opt">(</span>v<span class="opt">, </span><span class="str">"Second-"</span><span class="opt">, </span><span class="num">7</span><span class="opt">) &amp;&amp; </span><span class="kwd">isdigit</span><span class="opt">(</span>v<span class="opt">[</span><span class="num">7</span><span class="opt">])) {</span>
</pre>
      </li>

      <li>
        <pre>
      v <span class="opt">+= </span><span class="num">7</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isdigit</span><span class="opt">(*++</span>v<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      v<span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>v<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    ve <span class="opt">= </span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*</span>v<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      v<span class="opt">++;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>v <span class="opt">&amp;&amp; *</span>v <span class="opt">!= </span><span class="str">','</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      v <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>cno <span class="opt">|| *</span>v <span class="opt">== </span><span class="str">','</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">char </span>c <span class="opt">= *</span>ve<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>ve <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>cno<span class="opt">++);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>hobj<span class="opt">, </span>nbuf<span class="opt">, </span>vs<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>ve <span class="opt">= </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(*</span>v <span class="opt">== </span><span class="str">','</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">isspace</span><span class="opt">(*++</span>v<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>v<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">); </span><span class="com">/* 422? */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Timeout is invalid"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>RFC 3253 defines the Label header, which is an arbitray URL-encoded string.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-D" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-D"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-C">&lt;-</a>D<a href="#NW0-2WZQ2h-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"Label"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>cv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_url_unescape</span><span class="opt">(</span>cv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, RFC 4437 defines the Apply-To-Redirect-Ref header, which also takes either T or F. Since it applies universally, it is removed if it matches its default value of F.</p>
  <pre class="dfn">
<a name="NW0-2WZQ2h-E" href="#NW0-2WZQ2h-1" id="NW0-2WZQ2h-E"><dfn>&lt;Process common HTTP headers&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-9">&lt;-U</a>)</b> <b>[<a href="#NW0-2WZQ2h-D">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>hobj <span class="opt">= </span><span class="kwd">cgi_header_obj</span><span class="opt">(</span><span class="str">"ApplyToRedirectRef"</span><span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>cv <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hobj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cv<span class="opt">[</span><span class="num">1</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
    cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'t'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>cv <span class="opt">= </span><span class="str">'T'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'f'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>cv <span class="opt">= </span><span class="str">'F'</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">!= </span><span class="str">'T'</span> <span class="opt">&amp;&amp; *</span>cv <span class="opt">!= </span><span class="str">'F'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cv <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Apply-To-Redirect-Ref must be T or F"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(*</span>cv <span class="opt">== </span><span class="str">'F'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_header_set</span><span class="opt">(</span><span class="str">"AplyToRedirectRef"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc10" id="toc10">XML Parameter Bodies</a></h1>

  <p>Another group of requests that take bodies is the set of WebDAV requests. These take XML bodies and special headers instead of plain CGI request parameters. What methods take what parameters, and how they are interpreted, is determined by which RFCs the underlying CGI supports. For this reason, if the method is anything but PUT, POST, HEAD, or GET, and the content type is XML, the XML is just sucked verbatim into an XML parse tree stored in the CGI state. This means that POST parameters with SOAP requests must be parsed manually after CGI initialization. The parsing is done using libxml2<sup><a href="#fn18">18</a></sup> using the document-at-once parser<sup><a href="#fn19">19</a></sup>. While incremental (xmlreader) mode would probably minimize the extra storage required for the XML tree, the size of the trees should be fairly small, anyway, and HDF is not much better for excess storage minimization (60-112 bytes per node vs. 60-120 bytes per node). A separate upload limit parameter is provided to limit incoming XML requests.</p>
  <pre class="dfn">
<a name="NW0-AVbKa-4" href="#NW0-AVbKa-1" id="NW0-AVbKa-4"><dfn>&lt;CGI Support Configuration&gt;+=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[<a href="#NW0-AVbKa-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># If set, limit XML request bodies (not PUT or POST) to this size, in bytes</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#max_xml_body = 100000</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-20M5ji-5" href="#NW0-20M5ji-1" id="NW0-20M5ji-5"><dfn>&lt;CGI Support Variables&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-20M5ji-4">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">guint64 </span>max_xml_body<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1IHJKl-4" href="#NW0-1IHJKl-1" id="NW0-1IHJKl-4"><dfn>&lt;Perform global CGI support initialization&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1IHJKl-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
max_xml_body <span class="opt">= </span><span class="kwd">getconf_int</span><span class="opt">(</span><span class="str">"max_xml_body"</span><span class="opt">, </span><span class="num">100000</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">xmlInitParser</span><span class="opt">();</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-13PeAG-4" href="#NW0-13PeAG-1" id="NW0-13PeAG-4"><dfn>&lt;(build.nw) makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-13PeAG-3">&lt;-</a>D<a href="#NW0-13PeAG-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
EXTRA_CFLAGS <span class="opt">+= $(</span><span class="kwa">shell </span>xml2-config <span class="opt">--</span><span class="kwa">cflags</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
EXTRA_LDFLAGS <span class="opt">+= $(</span><span class="kwa">shell </span>xml2-config <span class="opt">--</span>libs<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3BiK3G-3" href="#NW0-3BiK3G-1" id="NW0-3BiK3G-3"><dfn>&lt;CGI Prerequisite Headers&gt;+=</dfn></a> <b>(<a href="#NW0-1mOMve-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3BiK3G-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;libxml/parser.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;libxml/xmlerror.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-D" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-D"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-C">&lt;-</a>D<a href="#NW0-1Xz6uT-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">xmlDocPtr </span>xmlbody<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">guint64 </span>xmllen<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-A" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-A"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-9">&lt;-</a>D<a href="#NW0-1Jgq0O-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="com">/* actually, content-type should be text/xml or application/xml */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* but we are not required to be that picky */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_len <span class="opt">&amp;&amp; </span><span class="kwd">strstr</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>body_type<span class="opt">, </span><span class="str">"/xml"</span><span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   req_method <span class="opt">!= </span>HTTP_REQ_GET <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   req_method <span class="opt">!= </span>HTTP_REQ_POST <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   req_method <span class="opt">!= </span>HTTP_REQ_PUT <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   req_method <span class="opt">!= </span>HTTP_REQ_HEAD<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlDocPtr </span>xml <span class="opt">= </span><span class="kwd">xmlReadIO</span><span class="opt">(</span>xml_read_cgi<span class="opt">, </span>NULL<span class="opt">, </span>cgi_state<span class="opt">, </span>NULL<span class="opt">, </span>NULL<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            XML_PARSE_NOENT <span class="opt">| </span>XML_PARSE_NONET <span class="opt">|</span>
</pre>
      </li>

      <li>
        <pre>
                            XML_PARSE_NOWARNING <span class="opt">| </span>XML_PARSE_NOERROR <span class="opt">|</span>
</pre>
      </li>

      <li>
        <pre>
                            XML_PARSE_NOCDATA <span class="opt">| </span>XML_PARSE_COMPACT<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>xml<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    xmlErrorPtr err <span class="opt">= </span><span class="kwd">xmlGetLastError</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>err <span class="opt">&amp;&amp; </span>err<span class="opt">-&gt;</span>code <span class="opt">!= </span>XML_ERR_OK <span class="opt">&amp;&amp; </span>err<span class="opt">-&gt;</span>code <span class="opt">!= </span>XML_ERR_NO_MEMORY <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       err<span class="opt">-&gt;</span>code <span class="opt">!= </span>XML_ERR_INTERNAL_ERROR <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="opt">!</span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span>NULL<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"400 Bad Request"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>err <span class="opt">&amp;&amp; </span>err<span class="opt">-&gt;</span>message<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span>err<span class="opt">-&gt;</span>message<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_pass_ctx</span><span class="opt">(</span>nerr<span class="opt">, </span><span class="str">"Unable to parse body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Unable to parse body"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>xmlbody <span class="opt">= </span>xml<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kDPKd-4" href="#NW0-3kDPKd-1" id="NW0-3kDPKd-4"><dfn>&lt;Free CGI state members&gt;+=</dfn></a> <b>(<a href="#NW0-Y5eke-2">&lt;-U</a>)</b> <b>[<a href="#NW0-3kDPKd-3">&lt;-</a>D<a href="#NW0-3kDPKd-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>xmlbody<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">xmlFreeDoc</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>xmlbody<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-V" href="#NW0-wliTu-1" id="NW0-wliTu-V"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-U">&lt;-</a>D<a href="#NW0-wliTu-W">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">xml_read_cgi</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>context<span class="opt">, </span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">int </span>len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>context<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>xmllen <span class="opt">+ </span>len <span class="opt">&gt; </span>max_xml_body<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"413 Request Entity Too Large"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    errno <span class="opt">= </span>ENOMEM<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="opt">-</span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">cgi_read</span><span class="opt">(</span>buf<span class="opt">, </span>len<span class="opt">, &amp;</span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="opt">-</span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Now that the XML parameters have been processed, it might be nice to print them if debugging is enabled.</p>
  <pre class="dfn">
<a name="NW0-1Jgq0O-B" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-B"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-A">&lt;-</a>D<a href="#NW0-1Jgq0O-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>debug <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>xmlbody<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  xmlChar <span class="opt">*</span>mem<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>size<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;pre&gt;XML:</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  xmlIndentTreeOutput <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">xmlDocDumpFormatMemory</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>xmlbody<span class="opt">, &amp;</span>mem<span class="opt">, &amp;</span>size<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>mem<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, (</span><span class="kwb">const char </span><span class="opt">*)</span>mem<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">xmlFree</span><span class="opt">(</span>mem<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"--------</span><span class="esc">\n</span><span class="str">&lt;/pre&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The WebDAV RFCs specify what constitutes valid XML bodies for the WebDAV requests, so they are validated here. That does mean this code will need to be modified if the RFCs change. Validating the XML with a DTD is impossible. Although a DTD-like specification is given in the RFCs, there are requirements which cannot be specified in the DTD language. For example, when specifying multiple elements as children, the DTD imposes an order, but WebDAV does not impose any ordering. Therefore, all checking is just done manually. Empty XML should probably be considered invalid, but instead it is treated as a missing body.</p>
  <pre class="dfn">
<a name="NW0-1Jgq0O-C" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-C"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-B">&lt;-</a>D<a href="#NW0-1Jgq0O-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span>valid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">xmlNodePtr </span>node <span class="opt">= </span>NULL<span class="opt">; </span><span class="com">/* init to shut gcc up */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">xmlNsPtr </span>dav_ns <span class="opt">= </span>NULL<span class="opt">; </span><span class="com">/* cache for DAV: namespace */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>xmlbody <span class="opt">|| !(</span>node <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>xmlbody<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span>TRUE <span class="opt"><a name="NW0-1Jgq0O-C-u1" href="#NW0-dHST1-1" id="NW0-1Jgq0O-C-u1"><i>&lt;unless method requires XML body&gt;</i></a>;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>xmlbody <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>body_len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span>TRUE <span class="opt"><a name="NW0-1Jgq0O-C-u2" href="#NW0-3kk3wH-1" id="NW0-1Jgq0O-C-u2"><i>&lt;unless method requires no body or XML body&gt;</i></a>;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>body_len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span>TRUE <span class="opt"><a name="NW0-1Jgq0O-C-u3" href="#NW0-43ZQFa-1" id="NW0-1Jgq0O-C-u3"><i>&lt;unless method requires no body&gt;</i></a>;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"415 Unsupported Media Type"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Body not supported for this method"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>xmlbody<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">switch</span><span class="opt">(</span>req_method<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-1Jgq0O-C-u4" href="#NW0-14DC4I-1" id="NW0-1Jgq0O-C-u4"><i>&lt;Check WebDAV XML body&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">default</span><span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">; </span><span class="com">/* ignore unknown methods */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"error_status"</span><span class="opt">, </span><span class="str">"422 Unprocessable Entity"</span><span class="opt">); </span><span class="com">/* RFC 4918 */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"XML Invalid"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>XML tag names are converted to integer constants to be stored in the <code>_private</code> field of the XML nodes. Name comparisons other than that cannot be cached.</p>
  <pre class="dfn">
<a name="NW0-2HrrIc-1" href="#NW0-2HrrIc-1" id="NW0-2HrrIc-1"><dfn>&lt;cgi-gperf-xml_name&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-2HrrIc-1-u1" href="#NW0-1VmJ8d-1" id="NW0-2HrrIc-1-u1"><i>&lt;XML validator names&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-6" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-6"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-5">&lt;-</a>D<a href="#NW0-4IhMOG-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">xml_name_t</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-7" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-7"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-6">&lt;-</a>D<a href="#NW0-1ozy8z-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define xml_str_id(s) xml_name_id((const char *)s, strlen((const char *)s))</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-W" href="#NW0-wliTu-1" id="NW0-wliTu-W"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-V">&lt;-</a>D<a href="#NW0-wliTu-X">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">xml_name_t </span><span class="kwd">xml_tag</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>node<span class="opt">-&gt;</span>_private<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    node<span class="opt">-&gt;</span>_private <span class="opt">= (</span><span class="kwb">void </span><span class="opt">*)(</span><span class="kwb">guint64</span><span class="opt">)</span><span class="kwd">xml_str_id</span><span class="opt">(</span>node<span class="opt">-&gt;</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="opt">(</span><span class="kwb">xml_name_t</span><span class="opt">)(</span><span class="kwb">guint64</span><span class="opt">)</span>node<span class="opt">-&gt;</span>_private<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Also, since most comparisons will be done in a single namespace, the namespace comparison can be done by comparing namespace pointers rather than the name itself. If the identifier being used changes from one tag to the next, though, only a direct name comparison can be used. Since there may be further checks against the <code>DAV:</code> namespace, it is stored in the CGI state as well. Although unset namespaces are technically not allowed, attributes should inherit the namespace from the tag, but do not in libxml2. Instead, if a NULL namespace is detected, it is always set to the cache.</p>
  <pre class="dfn">
<a name="NW0-wliTu-X" href="#NW0-wliTu-1" id="NW0-wliTu-X"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-W">&lt;-</a>D<a href="#NW0-wliTu-Y">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span><span class="kwd">check_ns</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xml_name_t </span>ns<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nscache<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nscache <span class="opt">&amp;&amp; *</span>nscache <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>ns <span class="opt">== *</span>nscache<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>node<span class="opt">-&gt;</span>ns <span class="opt">|| !</span>node<span class="opt">-&gt;</span>ns<span class="opt">-&gt;</span>href<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nscache <span class="opt">&amp;&amp; (</span>node<span class="opt">-&gt;</span>ns <span class="opt">= *</span>nscache<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_str_id</span><span class="opt">(</span>node<span class="opt">-&gt;</span>ns<span class="opt">-&gt;</span>href<span class="opt">) != </span>ns<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nscache<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>nscache <span class="opt">= </span>node<span class="opt">-&gt;</span>ns<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-1" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-1"><dfn>&lt;XML validator names&gt;=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-1VmJ8d-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
DAV<span class="opt">:</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-8" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-8"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-7">&lt;-</a>D<a href="#NW0-1ozy8z-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define DAV_NS XML_NAME_DAV_</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-E" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-E"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-D">&lt;-</a>D<a href="#NW0-1Xz6uT-F">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">xmlNsPtr </span>dav_ns<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Jgq0O-D" href="#NW0-1Jgq0O-1" id="NW0-1Jgq0O-D"><dfn>&lt;Initialize this CGI run&gt;+=</dfn></a> <b>(<a href="#NW0-wliTu-H">&lt;-U</a>)</b> <b>[<a href="#NW0-1Jgq0O-C">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>dav_ns <span class="opt">= </span>dav_ns<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Blanks and comments are mostly irrelevant, and get in the way. Comments never need to be saved, so they are just dropped. Just in case a processing instruction creeps through, they can be dropped as well. Blanks can be dropped everywhere except in property values: even if the XML declares that whitespace is not relevant, it is always relevant in property values. This means that things cannot be cleaned recursively very easily, but that is probably not necessary, anyway. Instead, a function to return the children with the ignorable elements stripped out is provided. Since comments may split text segments, any consecutive text segments resulting from the deletion are merged.</p>
  <pre class="dfn">
<a name="NW0-wliTu-Y" href="#NW0-wliTu-1" id="NW0-wliTu-Y"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-X">&lt;-</a>D<a href="#NW0-wliTu-Z">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">xmlNodePtr </span><span class="kwd">xml_strip_children</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">gboolean </span>strip_blanks<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlNodePtr </span>first <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">, </span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>first<span class="opt">; </span>node<span class="opt">; </span>node <span class="opt">= </span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    next <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">switch</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">case </span>XML_TEXT_NODE<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span>strip_blanks <span class="opt">|| !</span><span class="kwd">xmlIsBlankNode</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="com">/* fall through */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">case </span>XML_PI_NODE<span class="opt">: </span><span class="com">/* processing instruction */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">case </span>XML_COMMENT_NODE<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>first <span class="opt">== </span>node<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          first <span class="opt">= </span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">xmlUnlinkNode</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">xmlFreeNode</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>next <span class="opt">&amp;&amp; </span>next<span class="opt">-&gt;</span>prev <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
           <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>next<span class="opt">) &amp;&amp; </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>next<span class="opt">-&gt;</span>prev<span class="opt">) &amp;&amp; </span>
</pre>
      </li>

      <li>
        <pre>
           <span class="opt">(!</span>strip_blanks <span class="opt">|| !</span><span class="kwd">xmlIsBlankNode</span><span class="opt">(</span>next<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xmlTextMerge</span><span class="opt">(</span>next<span class="opt">-&gt;</span>prev<span class="opt">, </span>next<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          node <span class="opt">= </span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          next <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xmlUnlinkNode</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xmlFreeNode</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">default</span><span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>first<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-9" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-9"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-8">&lt;-</a>D<a href="#NW0-1ozy8z-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define xml_child(n) xml_strip_children(n, TRUE)</span>
</pre>
      </li>
    </ol>
  </div>

  <p>For properties only, a recursive function is provided to strip comments and processing instructions.</p>
  <pre class="dfn">
<a name="NW0-wliTu-Z" href="#NW0-wliTu-1" id="NW0-wliTu-Z"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-Y">&lt;-</a>D<a href="#NW0-wliTu-a">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">xml_clean_prop</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_strip_children</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">); </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">xml_clean_prop</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The PROPFIND request takes an optional body containing exactly one propfind element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-1" href="#NW0-EIFsf-1" id="NW0-EIFsf-1"><dfn>&lt;webdav.dtd&gt;=</dfn></a> <b>[D<a href="#NW0-EIFsf-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
&lt;!-- PROPFIND method, optional body with exactly one propfind --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>propfind ( propname | (allprop, include?) | prop ) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>propname EMPTY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>allprop EMPTY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>include ANY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    &lt;!-- children must be only empty tags --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>prop ANY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    &lt;!-- children must be only empty tags --<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-2" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-2"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-1">&lt;-</a>D<a href="#NW0-1VmJ8d-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
propfind propname allprop include prop
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-1" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-1"><dfn>&lt;unless method requires no body or XML body&gt;=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[D<a href="#NW0-3kk3wH-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_PROPFIND
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-1" href="#NW0-14DC4I-1" id="NW0-14DC4I-1"><dfn>&lt;Check WebDAV XML body&gt;=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[D<a href="#NW0-14DC4I-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_PROPFIND<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_PROPFIND <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) || </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ALLPROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* allprop + optional include */</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">) == </span>XML_NAME_INCLUDE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; !</span>node<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_INCLUDE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* include + allprop */</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; !</span>node<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              node<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">) == </span>XML_NAME_ALLPROP <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROPNAME<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-a" href="#NW0-wliTu-1" id="NW0-wliTu-a"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-Z">&lt;-</a>D<a href="#NW0-wliTu-b">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_prop</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">gboolean </span>has_val<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| (!</span>has_val <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) ||</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="opt">!</span>node<span class="opt">-&gt;</span>ns <span class="opt">|| !</span>node<span class="opt">-&gt;</span>ns<span class="opt">-&gt;</span>href<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The PROPPATCH method requires an XML body with exactly one propertyupdate element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-2" href="#NW0-EIFsf-1" id="NW0-EIFsf-2"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-1">&lt;-</a>D<a href="#NW0-EIFsf-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
&lt;!-- PROPPATCH method, required XML body, exactly one propertyupdate --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>propertyupdate (remove | set)+ <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>remove (prop) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>prop ANY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        &lt;!-- children must be only empty tags --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">&lt;!ELEMENT </span>set (prop) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>prop ANY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        &lt;!-- children must be tags with valid XML values --<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-3" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-3"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-2">&lt;-</a>D<a href="#NW0-1VmJ8d-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
propertyupdate remove set
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-1" href="#NW0-dHST1-1" id="NW0-dHST1-1"><dfn>&lt;unless method requires XML body&gt;=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[D<a href="#NW0-dHST1-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_PROPPATCH
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-2" href="#NW0-14DC4I-1" id="NW0-14DC4I-2"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-1">&lt;-</a>D<a href="#NW0-14DC4I-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_PROPPATCH<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* exactly one child element called propertyupdate, with at least one child */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_PROPERTYUPDATE <span class="opt">|| !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>no_val <span class="opt">= </span>FALSE<span class="opt">; </span><span class="com">/* init to shut gcc up */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* one or more set/reset nodes */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) == </span>XML_NAME_REMOVE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      no_val <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_SET<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      no_val <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* with a single prop child whose children are property tags */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; (!(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) || </span>c<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                 c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) != </span>XML_NAME_PROP <span class="opt">|| !</span><span class="kwd">check_prop</span><span class="opt">(</span>c<span class="opt">, !</span>no_val<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The LOCK method takes an optional body with exactly one lockinfo element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-3" href="#NW0-EIFsf-1" id="NW0-EIFsf-3"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-2">&lt;-</a>D<a href="#NW0-EIFsf-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
&lt;!-- LOCK method, optional body, exactly one lockinfo (def: refresh) --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>lockinfo (lockscope, locktype, owner?)  <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>lockscope (exclusive | shared) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>exclusive EMPTY <span class="kwa">&gt;  </span>&lt;!-- empty tag flag (what a waste) --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>shared EMPTY <span class="kwa">&gt; </span>&lt;!-- empty tag flag --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>locktype (write) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>write EMPTY <span class="kwa">&gt; </span>&lt;!-- empty tag flag --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>owner ANY <span class="kwa">&gt; </span>&lt;!-- preserve value verbatim like a property --<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-4" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-4"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-3">&lt;-</a>D<a href="#NW0-1VmJ8d-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
lockinfo lockscope locktype owner exclusive shared write
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-2" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-2"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-1">&lt;-</a>D<a href="#NW0-3kk3wH-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_LOCK
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-3" href="#NW0-14DC4I-1" id="NW0-14DC4I-3"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-2">&lt;-</a>D<a href="#NW0-14DC4I-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_LOCK<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* exactly one child element called lockinfo, with at least one child */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_LOCKINFO <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_ls <span class="opt">= </span>FALSE<span class="opt">, </span>got_lt <span class="opt">= </span>FALSE<span class="opt">, </span>got_o <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) == </span>XML_NAME_LOCKSCOPE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_ls<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_ls <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| </span>c<span class="opt">-&gt;</span>next <span class="opt">|| </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
           <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
           <span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">)) != </span>XML_NAME_EXCLUSIVE <span class="opt">&amp;&amp; </span>tn <span class="opt">!= </span>XML_NAME_SHARED<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_LOCKTYPE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_lt<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_lt <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| </span>c<span class="opt">-&gt;</span>next <span class="opt">|| </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
           <span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) != </span>XML_NAME_WRITE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_OWNER<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_o<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_o <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>got_ls <span class="opt">|| !</span>got_lt<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The SEARCH method requires a body with exactly one element which is either searchrequest or query-schema-discovery. Each child is an element whose name is that of a supported search method; the only search method which is checked for validity is the basicsearch method. It is up to the application to validate and throw errors for unsupported search methods. The specification is unclear on how to handle multiple search methods in a single request, but the implication is that only one should be supported, so that is what is enforced here.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-4" href="#NW0-EIFsf-1" id="NW0-EIFsf-4"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-3">&lt;-</a>D<a href="#NW0-EIFsf-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
&lt;!-- SEARCH method, required body with searchrequest or query-schema-discovery --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>searchrequest ANY <span class="kwa">&gt; </span>&lt;!-- one child whose name determines grammar --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <a name="NW0-EIFsf-4-u1" href="#NW0-3KZJKV-1" id="NW0-EIFsf-4-u1"><i>&lt;basicsearch DTD&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>query-schema-discovery ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- child is query grammar and scope --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>basicsearch   (from) <span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3KZJKV-1" href="#NW0-3KZJKV-1" id="NW0-3KZJKV-1"><dfn>&lt;basicsearch DTD&gt;=</dfn></a> <b>(<a href="#NW0-EIFsf-4">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>basicsearch   (select, from, where?, orderby?, limit?) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>select        (allprop | prop) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    &lt;!-- props are just tags, and allprop is a flag --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>from          (scope+) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>scope         (href, depth, include-versions?) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>include-versions EMPTY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- where --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ENTITY </span>% all_ops      <span class="str">"%comp_ops; | %log_ops; | %special_ops; |</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                             %string_ops; | %content_ops;"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ENTITY </span>% comp_ops     <span class="str">"eq | lt | gt| lte | gte"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ENTITY </span>% log_ops      <span class="str">"and | or | not"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ENTITY </span>% special_ops  <span class="str">"is-collection | is-defined |</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                             language-defined | language-matches"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ENTITY </span>% string_ops   <span class="str">"like"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ENTITY </span>% content_ops  <span class="str">"contains"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>where         ( %all_ops; ) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>and           ( %all_ops; )+ <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>or            ( %all_ops; )+ <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>not           ( %all_ops; ) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>lt            (prop, (literal|typed-literal)) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>lt            caseless   (yes|no) #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>lte           (prop, (literal|typed-literal)) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>lte           caseless   (yes|no) #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>gt           (prop, (literal|typed-literal)) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>gt           caseless   (yes|no) #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>gte           (prop, (literal|typed-literal)) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>gte           caseless   (yes|no) #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>eq           (prop, (literal|typed-literal)) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>eq           caseless   (yes|no) #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>literal       (#PCDATA)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>typed-literal (#PCDATA)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>typed-literal xsi:type CDATA #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>is-collection EMPTY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>is-defined    (prop) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>language-defined    (prop) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>language-matches    (prop, literal) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>like          (prop, literal) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>like          caseless   (yes|no) #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>contains      (#PCDATA)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>orderby       (order+) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>order         ((prop | score), (ascending | descending)?)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ATTLIST </span>order         caseless   (yes|no) #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>ascending     EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>descending    EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>limit         (nresults) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>nresults      (#PCDATA) <span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-5" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-5"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-4">&lt;-</a>D<a href="#NW0-1VmJ8d-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
searchrequest query-schema-discovery basicsearch select from scope href
</pre>
      </li>

      <li>
        <pre>
depth <span class="num">0 1 </span>infinity include-versions where and or not lt caseless yes no lte
</pre>
      </li>

      <li>
        <pre>
gt gte eq literal typed-literal is-collection is-defined language-defined
</pre>
      </li>

      <li>
        <pre>
language-matches like contains orderby order score ascending descending
</pre>
      </li>

      <li>
        <pre>
limit nresults
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-2" href="#NW0-dHST1-1" id="NW0-dHST1-2"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-1">&lt;-</a>D<a href="#NW0-dHST1-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_SEARCH
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-4" href="#NW0-14DC4I-1" id="NW0-14DC4I-4"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-3">&lt;-</a>D<a href="#NW0-14DC4I-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_SEARCH<span class="opt">: {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* exactly one child element called searchrequest or query-schema-discovery,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">     with at least one child */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) != </span>XML_NAME_SEARCHREQUEST <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
      tn <span class="opt">!= </span>XML_NAME_QUERY_SCHEMA_DISCOVERY<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) || !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>is_search <span class="opt">= </span>valid <span class="opt">&amp;&amp; </span>tn <span class="opt">== </span>XML_NAME_SEARCHREQUEST<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* searchrequest has exactly one child element specifying search */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* not sure if query-schema-discovery should support &gt;1 child element */</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; !</span>node<span class="opt">-&gt;</span>next<span class="opt">; </span><span class="com">/* not sure this is made clear in RFC */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* make it a loop in case above condition is removed */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">( ; </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* name check is done after ns check so _private isn't set if it isn't */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* DAV:basicsearch; this allows the client to avoid check_ns */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_BASICSEARCH<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_sel<span class="opt">, </span>got_from<span class="opt">, </span>got_where<span class="opt">, </span>got_oby<span class="opt">, </span>got_limit<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    got_sel <span class="opt">= </span>got_where <span class="opt">= </span>got_oby <span class="opt">= </span>got_limit <span class="opt">= !</span>is_search<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    got_from <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(; </span>c <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xmlNodePtr </span>subc<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) || !(</span>subc <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">)) ||</span>
</pre>
      </li>

      <li>
        <pre>
         subc<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>subc<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">)) == </span>XML_NAME_SELECT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_sel <span class="opt">&amp;&amp; !</span>subc<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_sel <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>subc<span class="opt">)) == </span>XML_NAME_ALLPROP<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>subc<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span><span class="kwd">check_prop</span><span class="opt">(</span>subc<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_FROM<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_from<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_from <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xmlNodePtr </span>scope<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">for</span><span class="opt">(; </span>subc <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>subc <span class="opt">= </span>subc<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span>subc<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp; (</span>scope <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>subc<span class="opt">)) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xml_tag</span><span class="opt">(</span>subc<span class="opt">) == </span>XML_NAME_SCOPE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">check_ns</span><span class="opt">(</span>subc<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwb">gboolean </span>got_href <span class="opt">= </span>FALSE<span class="opt">, </span>got_depth <span class="opt">= </span>FALSE<span class="opt">, </span>got_incv <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">for</span><span class="opt">(; </span>scope <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>scope <span class="opt">= </span>scope<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_ns</span><span class="opt">(</span>scope<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>scope<span class="opt">)) == </span>XML_NAME_HREF<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= !</span>got_href <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>scope<span class="opt">) &amp;&amp; !</span>scope<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                      <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>scope<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
              got_href <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_DEPTH<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= !</span>got_depth<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              got_depth <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwb">xmlNodePtr </span>val<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; (</span>val <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>scope<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= !</span>val<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>val<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_str_id</span><span class="opt">(</span>val<span class="opt">-&gt;</span>content<span class="opt">)) == </span>XML_NAME_0 <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                         tn <span class="opt">== </span>XML_NAME_1 <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_INFINITY<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_INCLUDE_VERSIONS<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= !</span>got_incv <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>scope<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
              got_incv <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(!</span>got_href <span class="opt">|| !</span>got_depth<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_WHERE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_where <span class="opt">&amp;&amp; </span><span class="kwd">check_where_ops</span><span class="opt">(</span>subc<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        got_where <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ORDERBY<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_oby<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_oby <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">for</span><span class="opt">(; </span>subc <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>subc <span class="opt">= </span>subc<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwb">xmlNodePtr </span>order<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>subc<span class="opt">) || </span><span class="kwd">xml_tag</span><span class="opt">(</span>subc<span class="opt">) != </span>XML_NAME_ORDER <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
             <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>subc<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwb">gboolean </span>got_prop <span class="opt">= </span>FALSE<span class="opt">, </span>got_asc <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">for</span><span class="opt">(</span>order <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>subc<span class="opt">); </span>order<span class="opt">; </span>order <span class="opt">= </span>order<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_ns</span><span class="opt">(</span>order<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>order<span class="opt">)) == </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= !</span>got_prop <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>order<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_SCORE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= !</span>got_prop <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>order<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="opt">!</span>order<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>order<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwb">const char </span><span class="opt">*</span>s <span class="opt">= (</span><span class="kwb">const char </span><span class="opt">*)</span>order<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>content<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwa">for</span><span class="opt">(; *</span>s<span class="opt">; </span>s<span class="opt">++)</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">isdigit</span><span class="opt">(*</span>s<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
                      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ASCENDING <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                        tn <span class="opt">== </span>XML_NAME_DESCENDING<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= !</span>got_asc <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>order<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                got_asc <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span><span class="kwd">check_caseless_attr</span><span class="opt">(</span>subc<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_LIMIT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_limit <span class="opt">&amp;&amp; !</span>subc<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>subc<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">!</span>subc<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>subc<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">xml_tag</span><span class="opt">(</span>subc<span class="opt">) == </span>XML_NAME_NRESULTS <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">check_ns</span><span class="opt">(</span>subc<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        got_limit <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">for</span><span class="opt">(</span>s <span class="opt">= (</span><span class="kwb">const char </span><span class="opt">*)</span>subc<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>content<span class="opt">; *</span>s<span class="opt">; </span>s<span class="opt">++)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">isdigit</span><span class="opt">(*</span>s<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>got_sel <span class="opt">|| !</span>got_from<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-b" href="#NW0-wliTu-1" id="NW0-wliTu-b"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-a">&lt;-</a>D<a href="#NW0-wliTu-c">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_caseless_attr</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlAttrPtr </span>attrs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>valid <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>attrs <span class="opt">= </span>node<span class="opt">-&gt;</span>properties<span class="opt">; </span>attrs <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>attrs <span class="opt">= </span>attrs<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_tag</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">) == </span>XML_NAME_CASELESS <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="kwd">check_ns</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>attrs<span class="opt">-&gt;</span>children <span class="opt">&amp;&amp; !</span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_str_id</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>content<span class="opt">)) == </span>XML_NAME_NO <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
               tn <span class="opt">== </span>XML_NAME_YES<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>valid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-c" href="#NW0-wliTu-1" id="NW0-wliTu-c"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-b">&lt;-</a>D<a href="#NW0-wliTu-d">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_where_ops</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>node<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(; </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* comp_ops */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_EQ  <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_LT <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_GT <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
       tn <span class="opt">== </span>XML_NAME_LTE <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_GTE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>c <span class="opt">|| !</span>c<span class="opt">-&gt;</span>next <span class="opt">|| </span>c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next <span class="opt">|| </span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xmlNodePtr </span>p<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">)) == </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        p <span class="opt">= </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
        p <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_tag</span><span class="opt">(</span>p<span class="opt">) != </span>XML_NAME_PROP<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>p<span class="opt">) || </span>p<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">check_prop</span><span class="opt">(</span>p<span class="opt">, </span>FALSE<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) &amp;&amp; (</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">))) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">(</span>tn <span class="opt">!= </span>XML_NAME_LITERAL <span class="opt">&amp;&amp; </span>tn <span class="opt">!= </span>XML_NAME_TYPED_LITERAL<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_caseless_attr</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* log_ops */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_AND <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_OR<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_where_ops</span><span class="opt">(</span>c<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_NOT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>c <span class="opt">|| </span>c<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">check_where_ops</span><span class="opt">(</span>c<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* special_ops */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_IS_COLLECTION<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>c<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_IS_DEFINED <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_LANGUAGE_DEFINED<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>c <span class="opt">|| </span>c<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">)) || </span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">) || </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) != </span>XML_NAME_PROP <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_prop</span><span class="opt">(</span>c<span class="opt">, </span>FALSE<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_LANGUAGE_MATCHES<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-wliTu-c-u1" href="#NW0-1NOS5s-1" id="NW0-wliTu-c-u1"><i>&lt;Check <code>c</code> for prop and literal&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* string_ops */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_LIKE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-wliTu-c-u2" href="#NW0-1NOS5s-1" id="NW0-wliTu-c-u2"><i>&lt;Check <code>c</code> for prop and literal&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_caseless_attr</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* content_ops */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_CONTAINS<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>c <span class="opt">&amp;&amp; (</span>c<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1NOS5s-1" href="#NW0-1NOS5s-1" id="NW0-1NOS5s-1"><dfn>&lt;Check <code>c</code> for prop and literal&gt;=</dfn></a> <b>(<a href="#NW0-wliTu-c">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>c <span class="opt">|| !</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) || </span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| !</span>c<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">!</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">) || </span>c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| </span>c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">) || !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">)) == </span>XML_NAME_LITERAL<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">!= </span>XML_NAME_PROP <span class="opt">|| !</span><span class="kwd">check_prop</span><span class="opt">(</span>c<span class="opt">, </span>FALSE<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">) &amp;&amp; (</span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) != </span>XML_NAME_LITERAL <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                     <span class="opt">!</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The ACL method requires an XML body with exactly one acl element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-5" href="#NW0-EIFsf-1" id="NW0-EIFsf-5"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-4">&lt;-</a>D<a href="#NW0-EIFsf-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
&lt;!-- ACL method, required body with single acl element --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>acl (ace*) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>ace ((principal | invert), (grant|deny))<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>principal (href | all | authenticated | unauthenticated |
</pre>
      </li>

      <li>
        <pre>
                         property | self)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>all EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>authenticated EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>unauthenticated EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>property ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        &lt;!-- child is exactly one property name --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>self EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>invert principal<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>grant (privilege+)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>deny (privilege+)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>privilege ANY<span class="kwa">&gt; </span>&lt;!-- actually, only valid empty priv tags --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>read EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>write EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>write-properties EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>write-content EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>unlock EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>read-acl EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>read-current-user-privilege-set EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>write-acl EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>bind EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>unbind EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>all EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-6" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-6"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-5">&lt;-</a>D<a href="#NW0-1VmJ8d-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
acl ace principal invert grant deny all authenticated unauthenticated
</pre>
      </li>

      <li>
        <pre>
property self privilege read write-properties write-content unlock
</pre>
      </li>

      <li>
        <pre>
read-acl read-current-user-privilege-set write-acl bind unbind
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-5" href="#NW0-14DC4I-1" id="NW0-14DC4I-5"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-4">&lt;-</a>D<a href="#NW0-14DC4I-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_ACL<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* exactly one child element called acl, with zero or more ace children */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_ACL <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* 2 children: [!]principal, grant|deny */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span>c<span class="opt">-&gt;</span>next <span class="opt">|| </span>c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next <span class="opt">|| </span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) || </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_ACE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) || !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">gboolean </span>got_g <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xmlNodePtr </span>p <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">for</span><span class="opt">(; </span>c <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">)) == </span>XML_NAME_INVERT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(</span>p <span class="opt">|| </span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
               c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">) != </span>XML_NAME_PRINCIPAL<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
              p <span class="opt">= </span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PRINCIPAL<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(</span>p<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
              p <span class="opt">= </span>c<span class="opt">-&gt;</span>children<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_GRANT <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_DENY<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= !</span>got_g<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            got_g <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwb">xmlNodePtr </span>priv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">for</span><span class="opt">(</span>priv <span class="opt">= </span>c<span class="opt">-&gt;</span>children<span class="opt">; </span>priv <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>priv <span class="opt">= </span>priv<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="com">/* each privilege tag has a single empty child tag */</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="com">/* each child tag can be anything, just like a property */</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(</span>priv<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">xml_child</span><span class="opt">(</span>priv<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
                 priv<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">check_prop</span><span class="opt">(</span>priv<span class="opt">, </span>FALSE<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="kwd">xml_tag</span><span class="opt">(</span>priv<span class="opt">) != </span>XML_NAME_PRIVILEGE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>priv<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) { </span><span class="com">/* finish principal processing */</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(</span>p<span class="opt">-&gt;</span>next <span class="opt">|| </span>p<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>p<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>p<span class="opt">)) == </span>XML_NAME_HREF<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>p<span class="opt">) &amp;&amp; !</span>p<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                      <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>p<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ALL <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_AUTHENTICATED <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                    tn <span class="opt">== </span>XML_NAME_UNAUTHENTICATED <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_SELF<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= !</span>p<span class="opt">-&gt;</span>children<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROPERTY<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>p<span class="opt">) &amp;&amp; !</span>p<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>p<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
              valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span>got_g <span class="opt">|| !</span>p<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>According to RFC 4918, MKCOL takes no body. However, RFC 5689<sup><a href="#fn20">20</a></sup> allows a body, which must be a single mkcol element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-6" href="#NW0-EIFsf-1" id="NW0-EIFsf-6"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-5">&lt;-</a>D<a href="#NW0-EIFsf-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
&lt;!-- MKCOL method, optional XML body, exactly one mkcol --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>mkcol (set+)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">&lt;!ELEMENT </span>set (prop) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>prop ANY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        &lt;!-- children must be tags with valid XML values --<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-7" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-7"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-6">&lt;-</a>D<a href="#NW0-1VmJ8d-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
mkcol
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-3" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-3"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-2">&lt;-</a>D<a href="#NW0-3kk3wH-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_MKCOL
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-6" href="#NW0-14DC4I-1" id="NW0-14DC4I-6"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-5">&lt;-</a>D<a href="#NW0-14DC4I-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_MKCOL<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* exactly one child element called propertyupdate, with at least one child */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_MKCOL <span class="opt">|| !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* one or more set nodes */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* with a single prop child whose children are property tags */</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp; (</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">!</span>c<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>c<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp; </span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_SET <span class="opt">&amp;&amp; </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) == </span>XML_NAME_PROP <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwd">check_prop</span><span class="opt">(</span>c<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The REPORT method requires an XML body, but allows any single root tag as its body content. Several RFCs define bodies, though. Unfortunately, one of those defines a different namespace (urn:ietf:params:xml:ns:caldav), as well, so this can't be a simple switch after checking for the usual DAV: namespace. Any report types not covered by known RFCs must be dealt with by the application.</p>
  <pre class="dfn">
<a name="NW0-dHST1-3" href="#NW0-dHST1-1" id="NW0-dHST1-3"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-2">&lt;-</a>D<a href="#NW0-dHST1-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_REPORT
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-A" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-A"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-9">&lt;-</a>D<a href="#NW0-1ozy8z-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define CALDAV_NS XML_NAME_URN_IETF_PARAMS_XML_NS_CALDAV</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-7" href="#NW0-14DC4I-1" id="NW0-14DC4I-7"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-6">&lt;-</a>D<a href="#NW0-14DC4I-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_REPORT<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">switch</span><span class="opt">(</span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-14DC4I-7-u1" href="#NW0-2p89cw-1" id="NW0-14DC4I-7-u1"><i>&lt;Check known DAV: report types&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">default</span><span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">; </span><span class="com">/* ignore unknown tags */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xmlNsPtr </span>caldav_ns <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>CALDAV_NS<span class="opt">, &amp;</span>caldav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">switch</span><span class="opt">(</span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt"><a name="NW0-14DC4I-7-u2" href="#NW0-3D8NQd-1" id="NW0-14DC4I-7-u2"><i>&lt;Check known CALDAV: report types&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">default</span><span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">; </span><span class="com">/* ignore unkown tags */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-8" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-8"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-7">&lt;-</a>D<a href="#NW0-1VmJ8d-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
urn<span class="opt">:</span>ietf<span class="opt">:</span>params<span class="opt">:</span>xml<span class="opt">:</span>ns<span class="opt">:</span>caldav
</pre>
      </li>
    </ol>
  </div>

  <p>RFC 3253 defines a number of version control-related report types.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-7" href="#NW0-EIFsf-1" id="NW0-EIFsf-7"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-6">&lt;-</a>D<a href="#NW0-EIFsf-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>version-tree ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- <span class="num">0 </span>or more elements, at most one DAV:prop --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- other elements undefined --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>expand-property (property*)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>property (property*)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ATTLIST </span>property name NMTOKEN #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ATTLIST </span>property namespace NMTOKEN <span class="str">"DAV:"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>locate-by-history (version-history-set, prop)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>version-history-set (href+)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>merge-preview (source)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>source (href)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>compare-baseline (href)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>latest-activity-version (href)<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-9" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-9"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-8">&lt;-</a>D<a href="#NW0-1VmJ8d-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
version-tree expand-property locate-by-history merge-preview
</pre>
      </li>

      <li>
        <pre>
compare-baseline latest-activity-version
</pre>
      </li>

      <li>
        <pre>
name namespace version-history-set
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-1" href="#NW0-2p89cw-1" id="NW0-2p89cw-1"><dfn>&lt;Check known DAV: report types&gt;=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[D<a href="#NW0-2p89cw-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_VERSION_TREE<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">((</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_prop <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(; </span>valid <span class="opt">&amp;&amp; </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; </span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_prop <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-2" href="#NW0-2p89cw-1" id="NW0-2p89cw-2"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-1">&lt;-</a>D<a href="#NW0-2p89cw-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_EXPAND_PROPERTY<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span><span class="kwd">check_property</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">), &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-3" href="#NW0-2p89cw-1" id="NW0-2p89cw-3"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-2">&lt;-</a>D<a href="#NW0-2p89cw-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_LOCATE_BY_HISTORY<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= (</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">!</span>node<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">) == </span>XML_NAME_PROP <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_VERSION_HISTORY_SET <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-4" href="#NW0-2p89cw-1" id="NW0-2p89cw-4"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-3">&lt;-</a>D<a href="#NW0-2p89cw-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_MERGE_PREVIEW<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= (</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_SOURCE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp; (</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">!</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">!</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-5" href="#NW0-2p89cw-1" id="NW0-2p89cw-5"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-4">&lt;-</a>D<a href="#NW0-2p89cw-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_COMPARE_BASELINE<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_LATEST_ACTIVITY_VERSION<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= (</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">!</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-d" href="#NW0-wliTu-1" id="NW0-wliTu-d"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-c">&lt;-</a>D<a href="#NW0-wliTu-e">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_property</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(; </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xmlAttrPtr </span>attrs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_name <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xml_name_t </span>an<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_PROPERTY <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>attrs <span class="opt">= </span>node<span class="opt">-&gt;</span>properties<span class="opt">; </span>attrs<span class="opt">; </span>attrs <span class="opt">= </span>attrs<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">, </span>DAV_NS<span class="opt">, </span>nsc<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">((</span>an <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">)) == </span>XML_NAME_NAME <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
           an <span class="opt">== </span>XML_NAME_NAMESPACE<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="com">/* no attempt to validate the actual text value as a name token */</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span>attrs<span class="opt">-&gt;</span>children <span class="opt">|| </span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
           <span class="opt">!</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>an <span class="opt">== </span>XML_NAME_NAME<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          got_name <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>got_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_property</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">), </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>RFC 3744 defines a few ACL-related report types.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-8" href="#NW0-EIFsf-1" id="NW0-EIFsf-8"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-7">&lt;-</a>D<a href="#NW0-EIFsf-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>acl-principal-prop-set ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- one or more children, with at most one prop element --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- all others to be ignored.  Note that lack of prop makes no sense --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>principal-match ((principal-property | self), prop?)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>principal-property ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- ANY: an element whose value identifies a property --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>self EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>principal-property-search
</pre>
      </li>

      <li>
        <pre>
    ((property-search+), prop?, apply-to-principal-collection-set?) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>property-search (prop, match) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>match #PCDATA <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- apply-to-principal-collection-set unspecified, but presumed EMPTY --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>principal-search-property-set EMPTY <span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-A" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-A"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-9">&lt;-</a>D<a href="#NW0-1VmJ8d-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
acl-principal-prop-set principal-match principal-property-search
</pre>
      </li>

      <li>
        <pre>
principal-search-property-set
</pre>
      </li>

      <li>
        <pre>
principal-property property-search match apply-to-principal-collection-set
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-6" href="#NW0-2p89cw-1" id="NW0-2p89cw-6"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-5">&lt;-</a>D<a href="#NW0-2p89cw-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_ACL_PRINCIPAL_PROP_SET<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_prop <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_PROP <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_prop <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-7" href="#NW0-2p89cw-1" id="NW0-2p89cw-7"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-6">&lt;-</a>D<a href="#NW0-2p89cw-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_PRINCIPAL_MATCH<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= (</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp; (!</span>node<span class="opt">-&gt;</span>next <span class="opt">|| !</span>node<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp; </span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">(!</span>node<span class="opt">-&gt;</span>next <span class="opt">|| (</span>node<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">) &amp;&amp; </span>node<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_SELF<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PRINCIPAL_PROPERTY<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">) == </span>XML_NAME_PROP <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-8" href="#NW0-2p89cw-1" id="NW0-2p89cw-8"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-7">&lt;-</a>D<a href="#NW0-2p89cw-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_PRINCIPAL_PROPERTY_SEARCH<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_ps <span class="opt">= </span>FALSE<span class="opt">, </span>got_prop <span class="opt">= </span>FALSE<span class="opt">, </span>got_atpcs <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROPERTY_SEARCH<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        got_ps <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; </span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwb">xmlNodePtr </span>c <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span><span class="kwd">check_prop</span><span class="opt">(</span>c<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
            c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">) == </span>XML_NAME_PROP <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">check_prop</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>tn <span class="opt">== </span>XML_NAME_MATCH <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="opt">!</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_prop <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_APPLY_TO_PRINCIPAL_COLLECTION_SET<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_atpcs <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        got_atpcs <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; </span>got_ps<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2p89cw-9" href="#NW0-2p89cw-1" id="NW0-2p89cw-9"><dfn>&lt;Check known DAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-2p89cw-8">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_PRINCIPAL_SEARCH_PROPERTY_SET<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, RFC 4791 defines a few calendaring report types in the urn:ietf:params:xml:ns:caldav namespace. Note that unlike the other methods, calendaring reports specify properties using children of calendar-data rather than using properties directly under prop.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-9" href="#NW0-EIFsf-1" id="NW0-EIFsf-9"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-8">&lt;-</a>D<a href="#NW0-EIFsf-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>calendar-query ((DAV:allprop |
</pre>
      </li>

      <li>
        <pre>
                                 DAV:propname |
</pre>
      </li>

      <li>
        <pre>
                                 DAV:prop)?, filter, timezone?)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>filter (comp-filter)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>comp-filter (is-not-defined | (time-range?,
</pre>
      </li>

      <li>
        <pre>
                             prop-filter*, comp-filter*))<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ATTLIST </span>comp-filter name CDATA #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>is-not-defined EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>time-range EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>time-range start CDATA #IMPLIED
</pre>
      </li>

      <li>
        <pre>
                             end   CDATA #IMPLIED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>prop-filter (is-not-defined |
</pre>
      </li>

      <li>
        <pre>
                             ((time-range | text-match)?,
</pre>
      </li>

      <li>
        <pre>
                              param-filter*))<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ATTLIST </span>prop-filter name CDATA #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>text-match (#PCDATA)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">&lt;!ATTLIST </span>text-match collation        CDATA <span class="str">"i;ascii-casemap"</span>
</pre>
      </li>

      <li>
        <pre>
                               negate-condition (yes | no) <span class="str">"no"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">&lt;!ELEMENT </span>param-filter (is-not-defined | text-match?)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">&lt;!ATTLIST </span>param-filter name CDATA #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>timezone (#PCDATA)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>calendar-multiget ((DAV:allprop |
</pre>
      </li>

      <li>
        <pre>
                                   DAV:propname |
</pre>
      </li>

      <li>
        <pre>
                                   DAV:prop)?, DAV:href+)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>free-busy-query (time-range)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>calendar-data (comp?, (expand | limit-recurrence-set)?,
</pre>
      </li>

      <li>
        <pre>
                                limit-freebusy-set?)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ATTLIST </span>calendar-data content-type CDATA <span class="str">"text/calendar"</span>
</pre>
      </li>

      <li>
        <pre>
                              version CDATA <span class="str">"2.0"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- actual samples seem to indicate there should ?s after all{prop,comp} --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>comp ((allprop | prop*), (allcomp | comp*))<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ATTLIST </span>comp name CDATA #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>allcomp EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>allprop EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>prop EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ATTLIST </span>prop name CDATA #REQUIRED
</pre>
      </li>

      <li>
        <pre>
                     novalue (yes | no) <span class="str">"no"</span><span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>expand EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ATTLIST </span>expand start CDATA #REQUIRED
</pre>
      </li>

      <li>
        <pre>
                       end   CDATA #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>limit-recurrence-set EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ATTLIST </span>limit-recurrence-set start CDATA #REQUIRED
</pre>
      </li>

      <li>
        <pre>
                                     end   CDATA #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>limit-freebusy-set EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ATTLIST </span>limit-freebusy-set start CDATA #REQUIRED
</pre>
      </li>

      <li>
        <pre>
                                   end   CDATA #REQUIRED<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-B" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-B"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-A">&lt;-</a>D<a href="#NW0-1VmJ8d-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
calendar-query calendar-multiget free-busy-query
</pre>
      </li>

      <li>
        <pre>
filter comp-filter is-not-defined time-range prop-filter start end text-match
</pre>
      </li>

      <li>
        <pre>
collation negate-condition timezone param-filter
</pre>
      </li>

      <li>
        <pre>
calendar-data comp expand limit-recurrence-set limit-freebusy-set
</pre>
      </li>

      <li>
        <pre>
content-type version allcomp novalue
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3D8NQd-1" href="#NW0-3D8NQd-1" id="NW0-3D8NQd-1"><dfn>&lt;Check known CALDAV: report types&gt;=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[D<a href="#NW0-3D8NQd-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_CALENDAR_QUERY<span class="opt">: {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>got_prop <span class="opt">= </span>FALSE<span class="opt">, </span>got_filt <span class="opt">= </span>FALSE<span class="opt">, </span>got_tz <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= (</span>tn <span class="opt">== </span>XML_NAME_ALLPROP <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_PROP <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
               tn <span class="opt">== </span>XML_NAME_PROPNAME<span class="opt">) &amp;&amp; !</span>got_prop<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span><span class="kwd">check_caldav_prop</span><span class="opt">(</span>node<span class="opt">, &amp;</span>caldav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>CALDAV_NS<span class="opt">, &amp;</span>caldav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_FILTER<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_filt <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">!</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">, </span>CALDAV_NS<span class="opt">, &amp;</span>caldav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) == </span>XML_NAME_COMP_FILTER<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_filt <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= </span><span class="kwd">check_comp_filter</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">, &amp;</span>caldav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_TIMEZONE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="com">/* no attempt to validate tz format */</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">!</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; !</span>got_tz<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_tz <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; </span>got_filt<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-e" href="#NW0-wliTu-1" id="NW0-wliTu-e"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-d">&lt;-</a>D<a href="#NW0-wliTu-f">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_caldav_prop</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span>node<span class="opt">-&gt;</span>ns <span class="opt">|| !</span>node<span class="opt">-&gt;</span>ns<span class="opt">-&gt;</span>href<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_CALENDAR_DATA<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xmlAttrPtr </span>attrs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>attrs <span class="opt">= </span>node<span class="opt">-&gt;</span>properties<span class="opt">; </span>attrs<span class="opt">; </span>attrs <span class="opt">= </span>attrs<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
           <span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">)) == </span>XML_NAME_CONTENT_TYPE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
            tn <span class="opt">== </span>XML_NAME_VERSION<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
           attrs<span class="opt">-&gt;</span>children <span class="opt">&amp;&amp; (</span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
                               <span class="opt">!</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">gboolean </span>got_comp <span class="opt">= </span>FALSE<span class="opt">, </span>got_explrs <span class="opt">= </span>FALSE<span class="opt">, </span>got_lfs <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>c<span class="opt">; </span>c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_COMP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>got_comp <span class="opt">|| !</span><span class="kwd">check_caldav_comp</span><span class="opt">(</span>c<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_comp <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_EXPAND <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_LIMIT_RECURRENCE_SET<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>got_explrs <span class="opt">|| </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
             <span class="opt">!</span><span class="kwd">check_timerange_attr</span><span class="opt">(</span>c<span class="opt">, </span>FALSE<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_explrs <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_LIMIT_FREEBUSY_SET<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>got_lfs <span class="opt">|| </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
             <span class="opt">!</span><span class="kwd">check_timerange_attr</span><span class="opt">(</span>c<span class="opt">, </span>FALSE<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_lfs <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-f" href="#NW0-wliTu-1" id="NW0-wliTu-f"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-e">&lt;-</a>D<a href="#NW0-wliTu-g">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_comp_filter</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_name_attr</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* no explicit text to guarantee children, so x | (? * *)  means optional */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>got_ind <span class="opt">= </span>FALSE<span class="opt">, </span>got_tr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>children<span class="opt">; </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) == </span>XML_NAME_IS_NOT_DEFINED <span class="opt">&amp;&amp; </span>got_ind<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    got_ind <span class="opt">= </span>TRUE<span class="opt">; </span><span class="com">/* prevent ind later even if tag wasn't ind */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_IS_NOT_DEFINED<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_TIME_RANGE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_timerange_attr</span><span class="opt">(</span>node<span class="opt">, </span>TRUE<span class="opt">, </span>nsc<span class="opt">) || </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) || </span>got_tr<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      got_tr <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_COMP_FILTER<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_comp_filter</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP_FILTER<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwb">gboolean </span>got_trm <span class="opt">= </span>FALSE<span class="opt">, </span>got_ind2 <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_name_attr</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>c<span class="opt">; </span>c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">)) == </span>XML_NAME_IS_NOT_DEFINED <span class="opt">&amp;&amp; </span>got_ind2<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        got_ind2 <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_IS_NOT_DEFINED<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_TIME_RANGE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_timerange_attr</span><span class="opt">(</span>c<span class="opt">, </span>TRUE<span class="opt">, </span>nsc<span class="opt">) || </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) || </span>got_trm<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_trm <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_TEXT_MATCH<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>got_trm <span class="opt">|| !</span><span class="kwd">check_text_match</span><span class="opt">(</span>c<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_trm <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PARAM_FILTER<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_name_attr</span><span class="opt">(</span>c<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| </span>c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">)) == </span>XML_NAME_IS_NOT_DEFINED<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_TEXT_MATCH<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_text_match</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-g" href="#NW0-wliTu-1" id="NW0-wliTu-g"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-f">&lt;-</a>D<a href="#NW0-wliTu-h">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_timerange_attr</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">gboolean </span>open_range<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlAttrPtr </span>attrs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>got_start <span class="opt">= </span>FALSE<span class="opt">, </span>got_end <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>attrs <span class="opt">= </span>node<span class="opt">-&gt;</span>properties<span class="opt">; </span>attrs<span class="opt">; </span>attrs <span class="opt">= </span>attrs<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">)) == </span>XML_NAME_START<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        got_start <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_END<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        got_end <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* no attempt to verify date is valid */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>attrs<span class="opt">-&gt;</span>children <span class="opt">|| </span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>open_range ? got_start <span class="opt">|| </span>got_end <span class="opt">: </span>got_start <span class="opt">&amp;&amp; </span>got_end<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-h" href="#NW0-wliTu-1" id="NW0-wliTu-h"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-g">&lt;-</a>D<a href="#NW0-wliTu-i">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_name_attr</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlAttrPtr </span>attrs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>attrs <span class="opt">= </span>node<span class="opt">-&gt;</span>properties<span class="opt">; </span>attrs<span class="opt">; </span>attrs <span class="opt">= </span>attrs<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">xml_tag</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">) == </span>XML_NAME_NAME <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="kwd">check_ns</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* no attempt to verify name is valid */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>attrs<span class="opt">-&gt;</span>children <span class="opt">&amp;&amp; !</span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
             <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-i" href="#NW0-wliTu-1" id="NW0-wliTu-i"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-h">&lt;-</a>D<a href="#NW0-wliTu-j">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_caldav_comp</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* actual samples indicate children not really necessary */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if 0</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) || !</span><span class="kwd">check_name_attr</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_name_attr</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>got_prop <span class="opt">= </span>FALSE<span class="opt">, </span>got_allprop <span class="opt">= </span>FALSE<span class="opt">, </span>got_comp <span class="opt">= </span>FALSE<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
           got_allcomp <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ALLCOMP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>got_comp <span class="opt">|| </span>got_allcomp <span class="opt">|| </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      got_allcomp <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ALLPROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>got_prop <span class="opt">|| </span>got_allprop <span class="opt">|| </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      got_allprop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_COMP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>got_allcomp <span class="opt">|| !</span><span class="kwd">check_caldav_comp</span><span class="opt">(</span>node<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      got_comp <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>got_allprop<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">xmlAttrPtr </span>attrs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">gboolean </span>got_name <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for</span><span class="opt">(</span>attrs <span class="opt">= </span>node<span class="opt">-&gt;</span>properties<span class="opt">; </span>attrs<span class="opt">; </span>attrs <span class="opt">= </span>attrs<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_ns</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">)) == </span>XML_NAME_NAME<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          got_name <span class="opt">= </span>attrs<span class="opt">-&gt;</span>children <span class="opt">&amp;&amp; !</span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                     <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_NOVALUE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_str_id</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">)) != </span>XML_NAME_YES <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
             tn <span class="opt">!= </span>XML_NAME_NO<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>got_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if 0</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* actual samples seem to indicate allprop/allcomp is implicit */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="opt">(</span>got_prop <span class="opt">|| </span>got_allprop<span class="opt">) &amp;&amp; (</span>got_comp <span class="opt">|| </span>got_allcomp<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wliTu-j" href="#NW0-wliTu-1" id="NW0-wliTu-j"><dfn>&lt;CGI Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-uQbLG-1">&lt;-U</a>)</b> <b>[<a href="#NW0-wliTu-i">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span><span class="kwd">check_text_match</span><span class="opt">(</span><span class="kwb">xmlNodePtr </span>node<span class="opt">, </span><span class="kwb">xmlNsPtr </span><span class="opt">*</span>nsc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlAttrPtr </span>attrs<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) || </span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">|| !</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>attrs <span class="opt">= </span>node<span class="opt">-&gt;</span>properties<span class="opt">; </span>attrs<span class="opt">; </span>attrs <span class="opt">= </span>attrs<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">check_ns</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>nsc<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">((</span><span class="kwb">xmlNodePtr</span><span class="opt">)</span>attrs<span class="opt">)) == </span>XML_NAME_COLLATION<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>attrs<span class="opt">-&gt;</span>children <span class="opt">|| </span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_NEGATE_CONDITION<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>attrs<span class="opt">-&gt;</span>children <span class="opt">|| </span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_str_id</span><span class="opt">(</span>attrs<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>content<span class="opt">)) != </span>XML_NAME_YES <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
         tn <span class="opt">!= </span>XML_NAME_NO<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3D8NQd-2" href="#NW0-3D8NQd-1" id="NW0-3D8NQd-2"><dfn>&lt;Check known CALDAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-3D8NQd-1">&lt;-</a>D<a href="#NW0-3D8NQd-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_CALENDAR_MULTIGET<span class="opt">: {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>got_prop <span class="opt">= </span>FALSE<span class="opt">, </span>got_hr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ALLPROP <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>got_prop<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= !</span>got_prop <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_HREF<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      valid  <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_HREF<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      got_hr <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; </span>got_hr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3D8NQd-3" href="#NW0-3D8NQd-1" id="NW0-3D8NQd-3"><dfn>&lt;Check known CALDAV: report types&gt;+=</dfn></a> <b>(<a href="#NW0-14DC4I-7">&lt;-U</a>)</b> <b>[<a href="#NW0-3D8NQd-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>XML_NAME_FREE_BUSY_QUERY<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= (</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp; !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>CALDAV_NS<span class="opt">, &amp;</span>caldav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_TIME_RANGE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_timerange_attr</span><span class="opt">(</span>node<span class="opt">, </span>TRUE<span class="opt">, &amp;</span>caldav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The VERSION-CONTROL method takes an optional body with a version-control element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-A" href="#NW0-EIFsf-1" id="NW0-EIFsf-A"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-9">&lt;-</a>D<a href="#NW0-EIFsf-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>version-control ANY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-C" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-C"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-B">&lt;-</a>D<a href="#NW0-1VmJ8d-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
version-control
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-4" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-4"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-3">&lt;-</a>D<a href="#NW0-3kk3wH-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_VERSION_CONTROL
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-8" href="#NW0-14DC4I-1" id="NW0-14DC4I-8"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-7">&lt;-</a>D<a href="#NW0-14DC4I-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_VERSION_CONTROL<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_VERSION_CONTROL <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The CHECKOUT method takes an optional body with a checkout element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-B" href="#NW0-EIFsf-1" id="NW0-EIFsf-B"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-A">&lt;-</a>D<a href="#NW0-EIFsf-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>checkout ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- children may have at most one fork-ok, but otherwise elements --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>fork-ok EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- or at most one apply-to-version --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>apply-to-version EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-D" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-D"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-C">&lt;-</a>D<a href="#NW0-1VmJ8d-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
checkout fork-ok apply-to-version
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-5" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-5"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-4">&lt;-</a>D<a href="#NW0-3kk3wH-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_CHECKOUT
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-9" href="#NW0-14DC4I-1" id="NW0-14DC4I-9"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-8">&lt;-</a>D<a href="#NW0-14DC4I-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_CHECKOUT<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_CHECKOUT <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_fok <span class="opt">= </span>FALSE<span class="opt">, </span>got_atv <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_FORK_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_fok <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_fok <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_APPLY_TO_VERSION<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_atv <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_atv <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The CHECKIN method takes an optional body with a checkin element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-C" href="#NW0-EIFsf-1" id="NW0-EIFsf-C"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-B">&lt;-</a>D<a href="#NW0-EIFsf-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>checkin ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- children may have at most one fork-ok and keep-checked-out + other el --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>keep-checked-out EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>fork-ok EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-E" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-E"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-D">&lt;-</a>D<a href="#NW0-1VmJ8d-F">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
checkin keep-checked-out
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-6" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-6"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-5">&lt;-</a>D<a href="#NW0-3kk3wH-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_CHECKIN
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-A" href="#NW0-14DC4I-1" id="NW0-14DC4I-A"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-9">&lt;-</a>D<a href="#NW0-14DC4I-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_CHECKIN<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_CHECKOUT <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_fok <span class="opt">= </span>FALSE<span class="opt">, </span>got_kco <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_FORK_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_fok <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_fok <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_KEEP_CHECKED_OUT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_kco <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_kco <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The UNCHECKOUT method takes an optional body with an uncheckout element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-D" href="#NW0-EIFsf-1" id="NW0-EIFsf-D"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-C">&lt;-</a>D<a href="#NW0-EIFsf-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>uncheckout ANY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-F" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-F"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-E">&lt;-</a>D<a href="#NW0-1VmJ8d-G">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
uncheckout
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-7" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-7"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-6">&lt;-</a>D<a href="#NW0-3kk3wH-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_UNCHECKOUT
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-B" href="#NW0-14DC4I-1" id="NW0-14DC4I-B"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-A">&lt;-</a>D<a href="#NW0-14DC4I-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_UNCHECKOUT<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_UNCHECKOUT <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The MKWORKSPACE method takes an optional body with a mkworkspace element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-E" href="#NW0-EIFsf-1" id="NW0-EIFsf-E"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-D">&lt;-</a>D<a href="#NW0-EIFsf-F">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>mkworkspace ANY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-G" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-G"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-F">&lt;-</a>D<a href="#NW0-1VmJ8d-H">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
mkworkspace
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-8" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-8"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-7">&lt;-</a>D<a href="#NW0-3kk3wH-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_MKWORKSPACE
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-C" href="#NW0-14DC4I-1" id="NW0-14DC4I-C"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-B">&lt;-</a>D<a href="#NW0-14DC4I-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_MKWORKSPACE<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_MKWORKSPACE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The UPDATE method requires an XML body with a an update element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-F" href="#NW0-EIFsf-1" id="NW0-EIFsf-F"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-E">&lt;-</a>D<a href="#NW0-EIFsf-G">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>update ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- ANY: elements with at most one version &amp; one prop --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>version (href)<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-H" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-H"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-G">&lt;-</a>D<a href="#NW0-1VmJ8d-I">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
update
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-4" href="#NW0-dHST1-1" id="NW0-dHST1-4"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-3">&lt;-</a>D<a href="#NW0-dHST1-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_UPDATE
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-D" href="#NW0-14DC4I-1" id="NW0-14DC4I-D"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-C">&lt;-</a>D<a href="#NW0-14DC4I-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_UPDATE<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_UPDATE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_vers <span class="opt">= </span>FALSE<span class="opt">, </span>got_prop <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_VERSION<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_vers <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_vers <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_PROP<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="com">/* no help in RFC on what format is, so be inclusive */</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_prop <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_prop <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The LABEL method requires an XML body with a label element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-G" href="#NW0-EIFsf-1" id="NW0-EIFsf-G"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-F">&lt;-</a>D<a href="#NW0-EIFsf-H">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>label ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- any elements, but at most one add, set, or remove --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>add (label-name)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>label-name (#PCDATA)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>set (label-name)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>remove (label-name)<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-I" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-I"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-H">&lt;-</a>D<a href="#NW0-1VmJ8d-J">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
label add label-name
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-5" href="#NW0-dHST1-1" id="NW0-dHST1-5"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-4">&lt;-</a>D<a href="#NW0-dHST1-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_LABEL
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-E" href="#NW0-14DC4I-1" id="NW0-14DC4I-E"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-D">&lt;-</a>D<a href="#NW0-14DC4I-F">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_LABEL<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_LABEL <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_one <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_SET <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_ADD <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_REMOVE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_one <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) == </span>XML_NAME_LABEL_NAME <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_one <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The MERGE method requires an XML body with a merge element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-H" href="#NW0-EIFsf-1" id="NW0-EIFsf-H"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-G">&lt;-</a>D<a href="#NW0-EIFsf-I">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>merge ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- ANY is elements with one source, at most one no-auto-merge, no-checkout,
</pre>
      </li>

      <li>
        <pre>
       prop, update parms (fork-ok, apply-to-version) --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>source (href+)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>no-auto-merge EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>no-checkout EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>fork-ok EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>apply-to-version EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-J" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-J"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-I">&lt;-</a>D<a href="#NW0-1VmJ8d-K">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
merge source no-auto-merge no-checkout
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-6" href="#NW0-dHST1-1" id="NW0-dHST1-6"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-5">&lt;-</a>D<a href="#NW0-dHST1-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_MERGE
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-F" href="#NW0-14DC4I-1" id="NW0-14DC4I-F"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-E">&lt;-</a>D<a href="#NW0-14DC4I-G">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_MERGE<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_MERGE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_src <span class="opt">= </span>FALSE<span class="opt">, </span>got_noam <span class="opt">= </span>FALSE<span class="opt">, </span>got_nc <span class="opt">= </span>FALSE<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
             got_fok <span class="opt">= </span>FALSE<span class="opt">, </span>got_atv <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_NO_AUTO_MERGE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>got_noam<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_noam <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_NO_CHECKOUT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>got_nc<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_nc <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_FORK_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>got_fok<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_fok <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_APPLY_TO_VERSION<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>got_atv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          got_atv <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_SOURCE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_src <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_src <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">for</span><span class="opt">(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>c <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>c<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) &amp;&amp; !</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; </span>got_src<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The BASELINE-CONTROL method takes an optional body with a baseline-control element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-I" href="#NW0-EIFsf-1" id="NW0-EIFsf-I"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-H">&lt;-</a>D<a href="#NW0-EIFsf-J">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>baseline-control ANY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  &lt;!-- ANY is elements w/ at most one baseline --<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>baseline (href)<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-K" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-K"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-J">&lt;-</a>D<a href="#NW0-1VmJ8d-L">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
baseline-control baseline
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-9" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-9"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-8">&lt;-</a>D<a href="#NW0-3kk3wH-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_BASELINE_CONTROL
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-G" href="#NW0-14DC4I-1" id="NW0-14DC4I-G"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-F">&lt;-</a>D<a href="#NW0-14DC4I-H">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_BASELINE_CONTROL<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_BASELINE_CONTROL <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_bl <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">(</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">xml_name_t </span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_BASELINE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          valid <span class="opt">= !</span>got_bl <span class="opt">&amp;&amp; </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp; !</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>node<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          got_bl <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The MKACTIVITY method takes an optional body with a mkactivity element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-J" href="#NW0-EIFsf-1" id="NW0-EIFsf-J"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-I">&lt;-</a>D<a href="#NW0-EIFsf-K">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>mkactivity ANY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-L" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-L"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-K">&lt;-</a>D<a href="#NW0-1VmJ8d-M">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
mkactivity
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-A" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-A"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-9">&lt;-</a>D<a href="#NW0-3kk3wH-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_MKACTIVITY
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-H" href="#NW0-14DC4I-1" id="NW0-14DC4I-H"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-G">&lt;-</a>D<a href="#NW0-14DC4I-I">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_MKACTIVITY<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_MKACTIVITY <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The ORDERPATCH requires an XML body with an orderpatch element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-K" href="#NW0-EIFsf-1" id="NW0-EIFsf-K"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-J">&lt;-</a>D<a href="#NW0-EIFsf-L">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>orderpatch (ordering-type?, order-member*) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>ordering-type (href) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>order-member (segment, position) <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>segment (#PCDATA)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>position (first | last | before | after)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>first EMPTY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>last EMPTY <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>before segment <span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">&lt;!ELEMENT </span>after segment <span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-M" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-M"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-L">&lt;-</a>D<a href="#NW0-1VmJ8d-N">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
orderpatch ordering-type order-member segment position first last before after
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-7" href="#NW0-dHST1-1" id="NW0-dHST1-7"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-6">&lt;-</a>D<a href="#NW0-dHST1-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_ORDERPATCH
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-I" href="#NW0-14DC4I-1" id="NW0-14DC4I-I"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-H">&lt;-</a>D<a href="#NW0-14DC4I-J">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_ORDERPATCH<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_ORDERPATCH <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">gboolean </span>got_ot <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) ||</span>
</pre>
      </li>

      <li>
        <pre>
         c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) ||</span>
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) == </span>XML_NAME_ORDERING_TYPE<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= !</span>got_ot <span class="opt">&amp;&amp; !</span>c<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) &amp;&amp; !</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        got_ot <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_ORDER_MEMBER<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>c<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; !</span>c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) &amp;&amp; !</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">-&gt;</span>next<span class="opt">) &amp;&amp; !</span>c<span class="opt">-&gt;</span>next<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_SEGMENT<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
            c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; </span>tn <span class="opt">== </span>XML_NAME_POSITION<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(</span>valid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
              tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_FIRST <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_LAST<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= !</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>children<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">else if</span><span class="opt">(</span>tn <span class="opt">== </span>XML_NAME_BEFORE <span class="opt">|| </span>tn <span class="opt">== </span>XML_NAME_AFTER<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwb">xmlNodePtr </span>subc <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= </span>subc <span class="opt">&amp;&amp; !</span>subc<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        subc<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwd">check_ns</span><span class="opt">(</span>subc<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwd">xml_tag</span><span class="opt">(</span>subc<span class="opt">) == </span>XML_NAME_SEGMENT <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwd">xml_child</span><span class="opt">(</span>subc<span class="opt">) &amp;&amp; !</span>subc<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="kwd">xmlNodeIsText</span><span class="opt">(</span>subc<span class="opt">-&gt;</span>children<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
                valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>valid <span class="opt">&amp;&amp; (</span>c <span class="opt">= </span>c<span class="opt">-&gt;</span>next<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
            valid <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) == </span>XML_NAME_SEGMENT <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="kwd">xmlNodeIsText</span><span class="opt">(</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The MKREDIRECTREF method requires an XML body with a mkredirectref element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-L" href="#NW0-EIFsf-1" id="NW0-EIFsf-L"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-K">&lt;-</a>D<a href="#NW0-EIFsf-M">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>mkredirectref (reftarget, redirect-lifetime?)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>reftarget (href)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">&lt;!ELEMENT </span>redirect-lifetime (permanent | temporary)<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>permanent EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">&lt;!ELEMENT </span>temporary EMPTY<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-N" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-N"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-M">&lt;-</a>D<a href="#NW0-1VmJ8d-O">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
mkredirectref reftarget redirect-lifetime permanent temporary
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-8" href="#NW0-dHST1-1" id="NW0-dHST1-8"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-7">&lt;-</a>D<a href="#NW0-dHST1-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_MKREDIRECTREF
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-J" href="#NW0-14DC4I-1" id="NW0-14DC4I-J"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-I">&lt;-</a>D<a href="#NW0-14DC4I-K">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_MKREDIRECTREF<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_MKREDIRECTREF <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-14DC4I-J-u1" href="#NW0-1cOGzC-1" id="NW0-14DC4I-J-u1"><i>&lt;Check redirect reference creation XML&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>valid <span class="opt">&amp;&amp; </span>got_rt<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1cOGzC-1" href="#NW0-1cOGzC-1" id="NW0-1cOGzC-1"><dfn>&lt;Check redirect reference creation XML&gt;=</dfn></a> <b>(<a href="#NW0-14DC4I-J">&lt;-U</a> <a href="#NW0-14DC4I-K">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span>got_rt <span class="opt">= </span>FALSE<span class="opt">, </span>got_rl <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for</span><span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">); </span>node <span class="opt">&amp;&amp; </span>valid<span class="opt">; </span>node <span class="opt">= </span>node<span class="opt">-&gt;</span>next<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xml_name_t </span>tn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">xmlNodePtr </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| !(</span>c <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) ||</span>
</pre>
      </li>

      <li>
        <pre>
     c<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">|| </span>c<span class="opt">-&gt;</span>next <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) || !</span><span class="kwd">check_ns</span><span class="opt">(</span>c<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) == </span>XML_NAME_REFTARGET<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= !</span>got_rt <span class="opt">&amp;&amp; </span><span class="kwd">xml_tag</span><span class="opt">(</span>c<span class="opt">) == </span>XML_NAME_HREF <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) &amp;&amp; </span><span class="kwd">xmlNodeIsText</span><span class="opt">(</span>c<span class="opt">-&gt;</span>children<span class="opt">) &amp;&amp; !</span>c<span class="opt">-&gt;</span>children<span class="opt">-&gt;</span>next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    got_rt <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) == </span>XML_NAME_REDIRECT_LIFETIME<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= !</span>got_rl <span class="opt">&amp;&amp; !</span><span class="kwd">xml_child</span><span class="opt">(</span>c<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">((</span>tn <span class="opt">= </span><span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">)) == </span>XML_NAME_PERMANENT <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
             tn <span class="opt">== </span>XML_NAME_TEMPORARY<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    got_rl <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The UPDATEREDIRECTREF method requires an XML body with an updateredirectref element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-M" href="#NW0-EIFsf-1" id="NW0-EIFsf-M"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-L">&lt;-</a>D<a href="#NW0-EIFsf-N">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>updateredirectref (reftarget?, redirect-lifetime?)<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-O" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-O"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-N">&lt;-</a>D<a href="#NW0-1VmJ8d-P">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
updateredirectref
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-dHST1-9" href="#NW0-dHST1-1" id="NW0-dHST1-9"><dfn>&lt;unless method requires XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-dHST1-8">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_UPDATEREDIRECTREF
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-K" href="#NW0-14DC4I-1" id="NW0-14DC4I-K"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-J">&lt;-</a>D<a href="#NW0-14DC4I-L">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_UPDATEREDIRECTREF<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>node<span class="opt">-&gt;</span>next <span class="opt">|| </span>node<span class="opt">-&gt;</span>type <span class="opt">!= </span>XML_ELEMENT_NODE <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) != </span>XML_NAME_UPDATEREDIRECTREF <span class="opt">||</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">!</span><span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    valid <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-14DC4I-K-u1" href="#NW0-1cOGzC-1" id="NW0-14DC4I-K-u1"><i>&lt;Check redirect reference creation XML&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The MKCALENDAR method takes an optional body with a mkcalendar element.</p>
  <pre class="dfn">
<a name="NW0-EIFsf-N" href="#NW0-EIFsf-1" id="NW0-EIFsf-N"><dfn>&lt;webdav.dtd&gt;+=</dfn></a> <b>[<a href="#NW0-EIFsf-M">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">&lt;!ELEMENT </span>mkcalendar (DAV:set)<span class="kwa">&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VmJ8d-P" href="#NW0-1VmJ8d-1" id="NW0-1VmJ8d-P"><dfn>&lt;XML validator names&gt;+=</dfn></a> <b>(<a href="#NW0-2HrrIc-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VmJ8d-O">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
mkcalendar
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kk3wH-B" href="#NW0-3kk3wH-1" id="NW0-3kk3wH-B"><dfn>&lt;unless method requires no body or XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-3kk3wH-A">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_MKCALENDAR
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-14DC4I-L" href="#NW0-14DC4I-1" id="NW0-14DC4I-L"><dfn>&lt;Check WebDAV XML body&gt;+=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b> <b>[<a href="#NW0-14DC4I-K">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span>HTTP_REQ_MKCALENDAR<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
  valid <span class="opt">= !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_MKCALENDAR <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>CALDAV_NS<span class="opt">, </span>NULL<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">(</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp; !</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_SET <span class="opt">&amp;&amp; (</span>node <span class="opt">= </span><span class="kwd">xml_child</span><span class="opt">(</span>node<span class="opt">)) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">!</span>node<span class="opt">-&gt;</span>next <span class="opt">&amp;&amp; </span>node<span class="opt">-&gt;</span>type <span class="opt">== </span>XML_ELEMENT_NODE <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">check_ns</span><span class="opt">(</span>node<span class="opt">, </span>DAV_NS<span class="opt">, &amp;</span>dav_ns<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">xml_tag</span><span class="opt">(</span>node<span class="opt">) == </span>XML_NAME_PROP <span class="opt">&amp;&amp; </span><span class="kwd">check_prop</span><span class="opt">(</span>node<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Methods which require that no body be present are the GET, HEAD, DELETE, COPY, MOVE, and UNLOCK requests. There is no defined use for the OPTIONS body, but the standard implies that it should be accepted and ignored. The TRACE and CONNECT methods are assumed to be handled by the server; if not, any checks can be done in the application.</p>
  <pre class="dfn">
<a name="NW0-43ZQFa-1" href="#NW0-43ZQFa-1" id="NW0-43ZQFa-1"><dfn>&lt;unless method requires no body&gt;=</dfn></a> <b>(<a href="#NW0-1Jgq0O-C">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_DELETE <span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_COPY
</pre>
      </li>

      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_MOVE   <span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_UNLOCK
</pre>
      </li>

      <li>
        <pre>
<span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_GET    <span class="opt">&amp;&amp; </span>req_method <span class="opt">!= </span>HTTP_REQ_HEAD
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc11" id="toc11">Session Support</a></h1>

  <p>Persistent sessions require shared state between independent CGI invocations, possibly in different processes. If those independent CGI invocations are also on different machines, the shared state will need to be served off of a central server. With this in mind, the traditional approach is to use a database connection to a central server to store session state. Implementing this in a generic manner for all databases is not practical, so a simple single-host file-based session manager is presented here.</p>
  <pre class="dfn">
<a name="NW0-E8T1B-2" href="#NW0-E8T1B-1" id="NW0-E8T1B-2"><dfn>&lt;(cs-glib.nw) Library <code>cs-supt</code> Members&gt;+=</dfn></a> <b>[<a href="#NW0-E8T1B-1">&lt;-</a>D<a href="#NW0-E8T1B-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
session<span class="opt">.</span>o
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2q5XL8-1" href="#NW0-2q5XL8-1" id="NW0-2q5XL8-1"><dfn>&lt;session.c&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-2q5XL8-1-u1" href="#nw@notdef" id="NW0-2q5XL8-1-u1"><i>&lt;(build.nw) Common C Header&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2q5XL8-1-u2" href="#NW0-1oOHaH-1" id="NW0-2q5XL8-1-u2"><i>&lt;CGI Session Support Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2q5XL8-1-u3" href="#NW0-16wLRV-1" id="NW0-2q5XL8-1-u3"><i>&lt;CGI Session Support Functions&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>

  <p>Initialization of the session routines is dependent on the method used to store the session. The default <code>init_cgi_session</code> is only to be used when the simple file-based sessions are used. Any other such routine should probably call <code>init_cgi</code> as well, since it is intended to be a replacement.</p>
  <pre class="dfn">
<a name="NW0-16wLRV-1" href="#NW0-16wLRV-1" id="NW0-16wLRV-1"><dfn>&lt;CGI Session Support Functions&gt;=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-16wLRV-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">init_cgi_session</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">init_cgi</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-1-u1" href="#NW0-3lUry0-1" id="NW0-16wLRV-1-u1"><i>&lt;Initialize file-based session support&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>A session requires a unique identifier, and of course the associated persistent state. The identifier and session ID are stored in the CGI state. The session ID's memory is expected to be allocated from the heap, so it is automatically freed when necessary. The session HDF is likewise a freshly allocated HDF; transferring the state for template users will require an HDF copy.</p>
  <pre class="dfn">
<a name="NW0-1Xz6uT-F" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-F"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-E">&lt;-</a>D<a href="#NW0-1Xz6uT-G">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>sessionid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>session<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kDPKd-5" href="#NW0-3kDPKd-1" id="NW0-3kDPKd-5"><dfn>&lt;Free CGI state members&gt;+=</dfn></a> <b>(<a href="#NW0-Y5eke-2">&lt;-U</a>)</b> <b>[<a href="#NW0-3kDPKd-4">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The unique identifier is generated by a session creation function. It is expected that the state is already initialized with session identification information, so it expects that the <code>session</code> is non-empty, and creates the session with those initial values. If there happens to already be a session ID, it is simply ignored.</p>
  <pre class="dfn">
<a name="NW0-3DkYjs-4" href="#NW0-3DkYjs-1" id="NW0-3DkYjs-4"><dfn>&lt;CGI State Dependencies&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3DkYjs-3">&lt;-</a>D<a href="#NW0-3DkYjs-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">session_create_cb</span><span class="opt">)(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-G" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-G"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-F">&lt;-</a>D<a href="#NW0-1Xz6uT-H">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">session_create_cb </span>create_session<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="opt">*</span>session_cb_data<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-16wLRV-2" href="#NW0-16wLRV-1" id="NW0-16wLRV-2"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-1">&lt;-</a>D<a href="#NW0-16wLRV-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">create_session_state</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">time_t </span>now<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>session <span class="opt">|| !</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Empty session"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">free</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>create_session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="opt">(*</span>cgi_state<span class="opt">-&gt;</span>create_session<span class="opt">)(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-2-u1" href="#NW0-36PIaC-1" id="NW0-16wLRV-2-u1"><i>&lt;Create session using local files&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-7" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-7"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-6">&lt;-</a>D<a href="#NW0-4IhMOG-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">session_create_cb</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>

  <p>For files, the session ID is also a unqiue file name, as created by <code>mkstemp</code> in a configurable directory.</p>
  <pre class="dfn">
<a name="NW0-2SuyVE-1" href="#NW0-2SuyVE-1" id="NW0-2SuyVE-1"><dfn>&lt;CGI Session Support Configuration&gt;=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The default directory where local sessions are stored</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Clearing this parameter disables local file session support</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#cgi_session_dir = /var/cache/cgi-sessions</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1oOHaH-1" href="#NW0-1oOHaH-1" id="NW0-1oOHaH-1"><dfn>&lt;CGI Session Support Variables&gt;=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static const char </span><span class="opt">*</span>session_dir<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3lUry0-1" href="#NW0-3lUry0-1" id="NW0-3lUry0-1"><dfn>&lt;Initialize file-based session support&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
session_dir <span class="opt">= </span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"cgi_session_dir"</span><span class="opt">, </span><span class="str">"/var/cache/cgi-sessions"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!*</span>session_dir<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  session_dir <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">mkdir</span><span class="opt">(</span>session_dir<span class="opt">, </span><span class="num">0700</span><span class="opt">); </span><span class="com">/* in case it doesn't exist yet */</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-p78BY-1" href="#NW0-p78BY-1" id="NW0-p78BY-1"><dfn>&lt;Build session file name&gt;=</dfn></a> <b>(<a href="#NW0-36PIaC-1">U-&gt;</a> <a href="#NW0-3n2jvq-1">U-&gt;</a> <a href="#NW0-3agnOG-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>path <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span>session_dir<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">[</span>path<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">] != </span><span class="str">'/'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append_c</span><span class="opt">(</span>path<span class="opt">, </span><span class="str">'/'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>path<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>New ticket IDs include the current date, masked to 32 bits. This guarantees that there will never be a repeated ticket, as long as the expiration time is longer than a few seconds, and no session lasts longer than 68 years. It is not necessary to lock the file from concurrent access, as the newly created file's name is not known to anyone but the creation function.</p>
  <pre class="dfn">
<a name="NW0-36PIaC-1" href="#NW0-36PIaC-1" id="NW0-36PIaC-1"><dfn>&lt;Create session using local files&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>session_dir<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= (</span><span class="kwb">char </span><span class="opt">*)</span><span class="str">"CS"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-36PIaC-1-u1" href="#NW0-p78BY-1" id="NW0-36PIaC-1-u1"><i>&lt;Build session file name&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">time</span><span class="opt">(&amp;</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append_printf</span><span class="opt">(</span>path<span class="opt">, </span><span class="str">"%08XXXXXXX"</span><span class="opt">, (</span><span class="kwb">int</span><span class="opt">)</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>fd <span class="opt">= </span><span class="kwd">mkstemp</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>fd <span class="opt">&lt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>path<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"Cannot create session state in %s"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                   session_dir<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span><span class="kwd">strdup</span><span class="opt">(</span><span class="kwd">strrchr</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">'/'</span><span class="opt">) + </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">close</span><span class="opt">(</span>fd<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">unlink</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>path<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_NOMEM<span class="opt">, </span><span class="str">"cannot create session id"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-36PIaC-1-u2" href="#NW0-31rNNf-1" id="NW0-36PIaC-1-u2"><i>&lt;Write session file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">close</span><span class="opt">(</span>fd<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_free</span><span class="opt">(</span>path<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The format of the session file is the standard HDF format. Writing the session file is harder than just <code>hdf_write_file</code>, because the session file is already open, and there is no direct access to <code>hdf_dump_format</code>, which takes an open file as a parameter. Writing to a memory string is the only simple alternative, so memory will be wasted for this operation.</p>
  <pre class="dfn">
<a name="NW0-31rNNf-1" href="#NW0-31rNNf-1" id="NW0-31rNNf-1"><dfn>&lt;Write session file&gt;=</dfn></a> <b>(<a href="#NW0-36PIaC-1">&lt;-U</a> <a href="#NW0-3agnOG-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">hdf_write_string</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">, &amp;</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;pre&gt;Write session:</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>s<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"--------</span><span class="esc">\n</span><span class="str">&lt;/pre&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>n<span class="opt">, </span>todo <span class="opt">= </span><span class="kwd">strlen</span><span class="opt">(</span>s<span class="opt">), </span>off <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span>todo<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    n <span class="opt">= </span><span class="kwd">write</span><span class="opt">(</span>fd<span class="opt">, </span>s <span class="opt">+ </span>off<span class="opt">, </span>todo<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>n <span class="opt">&lt; </span><span class="num">0 </span><span class="opt">&amp;&amp; </span>errno <span class="opt">!= </span>EAGAIN <span class="opt">&amp;&amp; </span>errno <span class="opt">!= </span>EINTR<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"writing session"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">unlink</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>n <span class="opt">&gt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      off <span class="opt">+= </span>n<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      todo <span class="opt">-= </span>n<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Reading the session state should be an incremental operation. That way, a large amount of state can be stored, but only the needed state is passed around in the state structure. All elements under the passed-in root are destroyed. If there is no persistent state under the desired root, the root node itself will be created anyway. In order to make it easier to read in a particular part of the state based on a CGI parameter, the name is specified in two parts. Either part may be <code>NULL</code>. If both are non-<code>NULL</code>, the second is a child of the first.</p>
  <pre class="dfn">
<a name="NW0-3DkYjs-5" href="#NW0-3DkYjs-1" id="NW0-3DkYjs-5"><dfn>&lt;CGI State Dependencies&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3DkYjs-4">&lt;-</a>D<a href="#NW0-3DkYjs-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">session_read_cb</span><span class="opt">)(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>child<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                   <span class="kwb">HDF </span><span class="opt">*</span>target<span class="opt">, </span><span class="kwb">gboolean </span>recursive<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                   <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-H" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-H"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-G">&lt;-</a>D<a href="#NW0-1Xz6uT-I">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">session_read_cb </span>read_session<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-16wLRV-3" href="#NW0-16wLRV-1" id="NW0-16wLRV-3"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-2">&lt;-</a>D<a href="#NW0-16wLRV-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">read_session_state</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>root_name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>child_name<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="kwb">gboolean </span>recursive<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>root<span class="opt">, *</span>child<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise</span><span class="opt">(</span>NERR_PARSE<span class="opt">, </span><span class="str">"No session ID"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>child_name <span class="opt">&amp;&amp; !*</span>child_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    child_name <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>root_name <span class="opt">|| !*</span>root_name<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    root_name <span class="opt">= </span>child_name<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    child_name <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>root_name <span class="opt">&amp;&amp; !*</span>root_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    root_name <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>root_name<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((</span>nerr <span class="opt">= </span><span class="kwd">hdf_init</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    root <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>session <span class="opt">&amp;&amp; (</span>nerr <span class="opt">= </span><span class="kwd">hdf_init</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((</span>nerr <span class="opt">= </span><span class="kwd">hdf_get_node</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">, </span>root_name<span class="opt">, &amp;</span>root<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>child_name <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="opt">(</span>nerr <span class="opt">= </span><span class="kwd">hdf_get_node</span><span class="opt">(</span>root<span class="opt">, </span>child_name<span class="opt">, &amp;</span>root<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">((</span>child <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>root<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>root<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>child<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>read_session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="opt">(*</span>cgi_state<span class="opt">-&gt;</span>read_session<span class="opt">)(</span>root_name<span class="opt">, </span>child_name<span class="opt">, </span>root<span class="opt">, </span>recursive<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-3-u1" href="#NW0-3n2jvq-1" id="NW0-16wLRV-3-u1"><i>&lt;Read session from local files&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-8" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-8"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-7">&lt;-</a>D<a href="#NW0-4IhMOG-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">session_read_cb</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>

  <p>However, reading just part of a full HDF file is not that simple. Instead, the entire file is read in, and the selected node is copied to the persistent state. Unlike with creation, no assumption can be made about simultaneous access. For this reason, the file is locked during the read. Also, in order to support expiring old sessions, the state files are touched at every access. This allows an external daemon to be used to flush out sessions with old modification times. Access times are often disabled in modern systems, so that is not sufficient.</p>
  <pre class="dfn">
<a name="NW0-1mOMve-4" href="#NW0-1mOMve-1" id="NW0-1mOMve-4"><dfn>&lt;(build.nw) Common C Includes&gt;+=</dfn></a> <b>[<a href="#NW0-1mOMve-3">&lt;-</a>D<a href="#NW0-1mOMve-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;utime.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3n2jvq-1" href="#NW0-3n2jvq-1" id="NW0-3n2jvq-1"><dfn>&lt;Read session from local files&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">int </span>fd<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>hdf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>session_dir<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">((</span>nerr <span class="opt">= </span><span class="kwd">hdf_init</span><span class="opt">(&amp;</span>hdf<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-3n2jvq-1-u1" href="#NW0-p78BY-1" id="NW0-3n2jvq-1-u1"><i>&lt;Build session file name&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">utime</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-3n2jvq-1-u2" href="#NW0-1QkOtL-1" id="NW0-3n2jvq-1-u2"><i>&lt;Open and lock session file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_free</span><span class="opt">(</span>path<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>hdf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-3n2jvq-1-u3" href="#NW0-1rJvEn-1" id="NW0-3n2jvq-1-u3"><i>&lt;Read session file into <code>hdf</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">close</span><span class="opt">(</span>fd<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>root_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>session <span class="opt">= </span>root <span class="opt">= </span>hdf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    child <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>hdf<span class="opt">, </span>root_name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>child <span class="opt">&amp;&amp; </span>child_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      child <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>child<span class="opt">, </span>child_name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>child<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span><span class="kwd">hdf_copy</span><span class="opt">(</span>root<span class="opt">, </span><span class="str">""</span><span class="opt">, </span>child<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>hdf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>recursive<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    root <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span>root<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">((</span>child <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>root<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>root<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>child<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      root <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The locks are done using advisory locks (<code>lockf</code>(3)). This means that even when locking others out isn't necessary, a lock must be obtained to obey others' locks on the file. Since these are write locks, the file is always opened in read-write mode.</p>
  <pre class="dfn">
<a name="NW0-1mOMve-5" href="#NW0-1mOMve-1" id="NW0-1mOMve-5"><dfn>&lt;(build.nw) Common C Includes&gt;+=</dfn></a> <b>[<a href="#NW0-1mOMve-4">&lt;-</a>D<a href="#NW0-1mOMve-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;sys/stat.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;fcntl.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1QkOtL-1" href="#NW0-1QkOtL-1" id="NW0-1QkOtL-1"><dfn>&lt;Open and lock session file&gt;=</dfn></a> <b>(<a href="#NW0-3n2jvq-1">&lt;-U</a> <a href="#NW0-3agnOG-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
fd <span class="opt">= </span><span class="kwd">open</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">, </span>O_RDWR<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>fd <span class="opt">&lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"opening session file %s"</span><span class="opt">, </span>path<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwd">lockf</span><span class="opt">(</span>fd<span class="opt">, </span>F_LOCK<span class="opt">, </span><span class="num">0</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>errno <span class="opt">== </span>EINTR <span class="opt">|| </span>errno <span class="opt">== </span>EAGAIN<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">close</span><span class="opt">(</span>fd<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"locking session"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Once again, the file is already open, so reading the session is harder than just <code>hdf_read_file</code>. In this case the underlying function is not much different in that the entire file is sucked into memory before processing.</p>
  <pre class="dfn">
<a name="NW0-1rJvEn-1" href="#NW0-1rJvEn-1" id="NW0-1rJvEn-1"><dfn>&lt;Read session file into <code>hdf</code>&gt;=</dfn></a> <b>(<a href="#NW0-3n2jvq-1">&lt;-U</a> <a href="#NW0-3agnOG-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>fcont <span class="opt">= </span><span class="kwd">g_string_sized_new</span><span class="opt">(</span><span class="num">64</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span>off <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>l <span class="opt">= </span><span class="kwd">read</span><span class="opt">(</span>fd<span class="opt">, </span>fcont<span class="opt">-&gt;</span>str <span class="opt">+ </span>off<span class="opt">, </span>fcont<span class="opt">-&gt;</span>allocated_len <span class="opt">- </span>off<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>l <span class="opt">&gt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    off <span class="opt">+= </span>l<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>off <span class="opt">== </span>fcont<span class="opt">-&gt;</span>allocated_len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_set_size</span><span class="opt">(</span>fcont<span class="opt">, </span>fcont<span class="opt">-&gt;</span>allocated_len <span class="opt">* </span><span class="num">2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span>l<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">(</span>errno <span class="opt">!= </span>EAGAIN <span class="opt">&amp;&amp; </span>errno <span class="opt">!= </span>EINTR<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"reading session"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
fcont<span class="opt">-&gt;</span>str<span class="opt">[</span>off<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;pre&gt;Read session:</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>fcont<span class="opt">-&gt;</span>str<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"--------</span><span class="esc">\n</span><span class="str">&lt;/pre&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">hdf_read_string</span><span class="opt">(</span>hdf<span class="opt">, </span>fcont<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_free</span><span class="opt">(</span>fcont<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, updating is potentially the most complex method. Updates do not write the entire state information out, especially since no flags are provided to indicate how much of the state has been read. Instead, the root of the state to update is provided. It is up to the caller to ensure that the result is stored in the in-memory session, if necessary. If the provided root is empty, the associated named root is cleared, both in the persistent storage and in the in-memory session. If the named root is blank or NULL, the entire session is destroyed.</p>

  <p>It may also be necessary to generate a unique ID while updating the session data. In other words, rather than replacing a key, it may be necessary to append a new child to the key. Rather than requiring external locking and making the user do it, a pointer may be passed in which will be filled in with a node whose name is unique under the root, and under which the passed-in values are stored rather than the root itself. When deleting, the unique root parameter may point to a node which names a child of <code>root_name</code> to be be deleted instead of <code>root_name</code>.</p>
  <pre class="dfn">
<a name="NW0-3DkYjs-6" href="#NW0-3DkYjs-1" id="NW0-3DkYjs-6"><dfn>&lt;CGI State Dependencies&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3DkYjs-5">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">NEOERR </span><span class="opt">*(*</span><span class="kwb">session_update_cb</span><span class="opt">)(</span><span class="kwb">const char </span><span class="opt">*</span>root_name<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>root<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwb">HDF </span><span class="opt">**</span>unique_root<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1Xz6uT-I" href="#NW0-1Xz6uT-1" id="NW0-1Xz6uT-I"><dfn>&lt;CGI State Members&gt;+=</dfn></a> <b>(<a href="#NW0-1ozy8z-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1Xz6uT-H">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">session_update_cb </span>update_session<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-16wLRV-4" href="#NW0-16wLRV-1" id="NW0-16wLRV-4"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-3">&lt;-</a>D<a href="#NW0-16wLRV-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">update_session_state</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>root_name<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>root<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="kwb">HDF </span><span class="opt">**</span>unique_root<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise</span><span class="opt">(</span>NERR_PARSE<span class="opt">, </span><span class="str">"No session ID"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>root <span class="opt">&amp;&amp; !</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>root<span class="opt">) &amp;&amp; !</span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>root<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    root <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>root_name <span class="opt">&amp;&amp; !*</span>root_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    root_name <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>unique_root <span class="opt">&amp;&amp; !</span>root <span class="opt">&amp;&amp; !*</span>unique_root<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise</span><span class="opt">(</span>NERR_PARSE<span class="opt">, </span><span class="str">"Cannot create unique key while deleting"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>unique_root <span class="opt">&amp;&amp; !</span>root_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise</span><span class="opt">(</span>NERR_PARSE<span class="opt">, </span><span class="str">"Cannot create unique key under root"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>root<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>root_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(!</span>unique_root<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">, </span>root_name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">HDF </span><span class="opt">*</span>child <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">, </span>root_name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>child<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>child<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(*</span>unique_root<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>update_session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="opt">(*</span>cgi_state<span class="opt">-&gt;</span>update_session<span class="opt">)(</span>root_name<span class="opt">, </span>root<span class="opt">, </span>unique_root<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-4-u1" href="#NW0-3agnOG-1" id="NW0-16wLRV-4-u1"><i>&lt;Update session using local files&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-9" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-9"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-8">&lt;-</a>D<a href="#NW0-4IhMOG-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">session_update_cb</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>

  <p>To update the state file, the entire file must be read into memory while locked, and after updating the requested information, it must be written back before unlocking.</p>
  <pre class="dfn">
<a name="NW0-3agnOG-1" href="#NW0-3agnOG-1" id="NW0-3agnOG-1"><dfn>&lt;Update session using local files&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-4">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>session_dir<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-3agnOG-1-u1" href="#NW0-p78BY-1" id="NW0-3agnOG-1-u1"><i>&lt;Build session file name&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>root_name <span class="opt">&amp;&amp; !</span>root<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">unlink</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>fd<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>hdf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>root_name <span class="opt">&amp;&amp; (</span>nerr <span class="opt">= </span><span class="kwd">hdf_init</span><span class="opt">(&amp;</span>hdf<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_free</span><span class="opt">(</span>path<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3agnOG-1-u2" href="#NW0-1QkOtL-1" id="NW0-3agnOG-1-u2"><i>&lt;Open and lock session file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>root_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>hdf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_free</span><span class="opt">(</span>path<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>root_name<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-3agnOG-1-u3" href="#NW0-1rJvEn-1" id="NW0-3agnOG-1-u3"><i>&lt;Read session file into <code>hdf</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">lseek</span><span class="opt">(</span>fd<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>SEEK_SET<span class="opt">) &lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">;  </span><span class="com">/* there is no reason this should fail */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>unique_root<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>root_name<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>hdf<span class="opt">, </span>root_name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>root<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          nerr <span class="opt">= </span><span class="kwd">hdf_copy</span><span class="opt">(</span>hdf<span class="opt">, </span>root_name<span class="opt">, </span>root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>root<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>hdf<span class="opt">, </span>root_name<span class="opt">, </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>root<span class="opt">)));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        hdf <span class="opt">= </span>root<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(!</span>root<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">HDF </span><span class="opt">*</span>child <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>hdf<span class="opt">, </span>root_name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>child<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>child<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(*</span>unique_root<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">11</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">HDF </span><span class="opt">*</span>child<span class="opt">, *</span>parent<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">int </span>i <span class="opt">= </span><span class="num">0</span><span class="opt">, </span>j<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span><span class="kwd">hdf_get_node</span><span class="opt">(</span>hdf<span class="opt">, </span>root_name<span class="opt">, &amp;</span>parent<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">for</span><span class="opt">(</span>child <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>parent<span class="opt">); </span>child<span class="opt">; </span>child <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>child<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
          j <span class="opt">= </span><span class="kwd">atoi</span><span class="opt">(</span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>child<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">if</span><span class="opt">(</span>j <span class="opt">&gt;= </span>i<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
            i <span class="opt">= </span>j <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">sprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="str">"%d"</span><span class="opt">, </span>i<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        nerr <span class="opt">= </span><span class="kwd">hdf_get_node</span><span class="opt">(</span>parent<span class="opt">, </span>nbuf<span class="opt">, </span>unique_root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_copy</span><span class="opt">(*</span>unique_root<span class="opt">, </span><span class="str">""</span><span class="opt">, </span>root<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>root<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>parent<span class="opt">, </span>nbuf<span class="opt">, </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>root<span class="opt">)));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">ftruncate</span><span class="opt">(</span>fd<span class="opt">, </span><span class="num">0</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">; </span><span class="com">/* ignore return value */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">HDF </span><span class="opt">*</span>olds <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>session <span class="opt">= </span>hdf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-3agnOG-1-u4" href="#NW0-31rNNf-1" id="NW0-3agnOG-1-u4"><i>&lt;Write session file&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>session <span class="opt">= </span>olds<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">close</span><span class="opt">(</span>fd<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>hdf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) </span><span class="com">/* prevent corrupt sessions */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">unlink</span><span class="opt">(</span>path<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>path<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In this simple session file scheme, session expiration is performed by a separate program. This program examines all files in the session directory, and deletes any older than a specified age. It can be called just once, and remain alive forever, or it can be called from cron on a regular basis; calling it from cron may incur significant overhead. It just uses <code>ftw</code> to look for old files. Since the <code>ftw</code> callback takes no user data, the expiration time is kept in a static variable.</p>

  <p>Another option would be to run this in addition to the CGI threads in the main program. That approach has several advantages. There is no need to rememmber to start up a separate process. Sessions will not linger unintentionally, causing potential security issues. On the other hand, if the CGI is run with normal CGI rather than FastCGI, the directory scan will have to be done on every invocation. It is also so simple that it is unlikely to ever crash, so starting it up at system initialization is something that only needs to be remembered once. For added security, it can be added to inittab for the unlikely event of a crash.</p>
  <pre class="dfn">
<a name="NW0-2uk6GO-1" href="#NW0-2uk6GO-1" id="NW0-2uk6GO-1"><dfn>&lt;(build.nw) C Executables&gt;=</dfn></a> <b>[D<a href="#NW0-2uk6GO-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
delete_old_files \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2aaetw-1" href="#NW0-2aaetw-1" id="NW0-2aaetw-1"><dfn>&lt;delete_old_files.c&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-2aaetw-1-u1" href="#nw@notdef" id="NW0-2aaetw-1-u1"><i>&lt;(build.nw) Common C Header&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;ftw.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">help</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">fputs</span><span class="opt">(</span><span class="str">"Delete old state files</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="str">"Usage: delete_old_files &lt;dir&gt; &lt;exp_time sec&gt; [&lt;next check sec&gt;]</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="str">"If &lt;next check sec&gt; is given, sleep that amount and check again</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="str">"forever.  If &lt;next check sec&gt; is 0, use &lt;exp time sec&gt; / 2.</span><span class="esc">\n</span><span class="str">"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
        stderr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">exit</span><span class="opt">(</span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static time_t </span>exp_time<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">delete_old_files</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>fpath<span class="opt">, </span><span class="kwb">const struct </span>stat <span class="opt">*</span>sb<span class="opt">, </span><span class="kwb">int </span>typeflag<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>typeflag <span class="opt">== </span>FTW_F <span class="opt">&amp;&amp; </span>sb<span class="opt">-&gt;</span>st_mtime <span class="opt">&lt; </span>exp_time<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">unlink</span><span class="opt">(</span>fpath<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">main</span><span class="opt">(</span><span class="kwb">int </span>argc<span class="opt">, </span><span class="kwb">const char </span><span class="opt">**</span>argv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>next<span class="opt">, </span>exps<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>argc <span class="opt">&lt; </span><span class="num">3 </span><span class="opt">|| </span>argc <span class="opt">&gt; </span><span class="num">4</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">help</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">chdir</span><span class="opt">(</span>argv<span class="opt">[</span><span class="num">1</span><span class="opt">])) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">perror</span><span class="opt">(</span>argv<span class="opt">[</span><span class="num">1</span><span class="opt">]);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">help</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  exps <span class="opt">= </span><span class="kwd">atoi</span><span class="opt">(</span>argv<span class="opt">[</span><span class="num">2</span><span class="opt">]);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>exps <span class="opt">&lt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">help</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>argc <span class="opt">&gt; </span><span class="num">3</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    next <span class="opt">= </span><span class="kwd">atoi</span><span class="opt">(</span>argv<span class="opt">[</span><span class="num">3</span><span class="opt">]);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>next <span class="opt">&lt;= </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      next <span class="opt">= </span>exps <span class="opt">/ </span><span class="num">2</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    next <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">time</span><span class="opt">(&amp;</span>exp_time<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  exp_time <span class="opt">-= </span>exps<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>next<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">ftw</span><span class="opt">(</span><span class="str">"."</span><span class="opt">, </span>delete_old_files<span class="opt">, </span><span class="num">2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">sleep</span><span class="opt">(</span>next<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">time</span><span class="opt">(&amp;</span>exp_time<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
       exp_time <span class="opt">-= </span>exps<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">ftw</span><span class="opt">(</span><span class="str">"."</span><span class="opt">, </span>delete_old_files<span class="opt">, </span><span class="num">2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Although finding an active session's ID is not likely, the session must still be keyed to the client. The client can never be completely reliably identified, but a few attributes tend to be fairly stable:</p>

  <ul>
    <li>REMOTE_ADDR (<code>CGI.RemoteAddress</code>) --- This is only unstable if the user switches between a caching proxy and direct access, or is behind a firewall that masks this. For security, these cases will be ignored and this parameter is always used.</li>

    <li>HTTP_USER_AGENT (<code>HTTP.UserAgent</code>) --- Again, this is unstable if the user switches between a caching proxy and direct access, but the proxy should use the same user agent anyway to ensure that the correct compatibility flags are set on remote applications. Again, this parameter will always be used.</li>

    <li>REMOTE_USER (<code>CGI.RemoteUser</code>) --- Users may log on, or not. The session should definitely terminate if the user ID changes.</li>

    <li>An arbitrary CGI parameter or cookie passed around with the session ID --- the previous parameters prevent the cookie from being passed around to other people for authentication. However, if the REMOTE_USER parameter is not set by the web server on every access, it should be passed around with the session ID.</li>
  </ul>

  <p>These parameters are saved in the state with the same base name, but <code>Session</code> as the parent.</p>
  <pre class="dfn">
<a name="NW0-1GLan6-1" href="#NW0-1GLan6-1" id="NW0-1GLan6-1"><dfn>&lt;Get Session Invariants&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-5">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>remote_addr<span class="opt">, *</span>user_agent<span class="opt">, *</span>remote_user<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
remote_addr <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.RemoteAddress"</span><span class="opt">, </span><span class="str">"127.0.0.1"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
user_agent <span class="opt">= </span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="str">"UserAgent"</span><span class="opt">, </span><span class="str">"telnet"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
remote_user <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>userid ? cgi_state<span class="opt">-&gt;</span>userid <span class="opt">: </span><span class="str">""</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ozy8z-B" href="#NW0-1ozy8z-1" id="NW0-1ozy8z-B"><dfn>&lt;CGI Support Global Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-2wJhWs-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1ozy8z-A">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define cgi_session_val(n, d) hdf_get_value(cgi_state-&gt;session, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_session_val_int(n, d) hdf_get_int64_value(cgi_state-&gt;session, n, d)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_session_obj(n) hdf_get_obj(cgi_state-&gt;session, n)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_session_set(n, v) hdf_set_value(cgi_state-&gt;session, n, v)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define cgi_session_set_int(n, v) hdf_set_int64_value(cgi_state-&gt;session, n, v)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-6" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-6"><dfn>&lt;(build.nw) C Prototypes&gt;+=</dfn></a> <b>[<a href="#NW0-3a9iNE-5">&lt;-</a>D<a href="#NW0-3a9iNE-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span><span class="kwd">cgi_session_val</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>def_val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gint64 </span><span class="kwd">cgi_session_val_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>def_val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span><span class="kwd">cgi_session_obj</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_session_set</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>value<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cgi_session_set_int</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">gint64 </span>value<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-16wLRV-5" href="#NW0-16wLRV-1" id="NW0-16wLRV-5"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-4">&lt;-</a>D<a href="#NW0-16wLRV-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">set_session_validation</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-5-u1" href="#NW0-1GLan6-1" id="NW0-16wLRV-5-u1"><i>&lt;Get Session Invariants&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">hdf_init</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">cgi_session_set</span><span class="opt">(</span><span class="str">"Session.RemoteAddress"</span><span class="opt">, </span>remote_addr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">cgi_session_set</span><span class="opt">(</span><span class="str">"Session.UserAgent"</span><span class="opt">, </span>user_agent<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">cgi_session_set</span><span class="opt">(</span><span class="str">"Session.RemoteUser"</span><span class="opt">, </span>remote_user<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gboolean </span><span class="kwd">validate_session</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-5-u2" href="#NW0-1GLan6-1" id="NW0-16wLRV-5-u2"><i>&lt;Get Session Invariants&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">!</span><span class="kwd">strcmp</span><span class="opt">(</span><span class="kwd">cgi_session_val</span><span class="opt">(</span><span class="str">"Session.RemoteAddress"</span><span class="opt">, </span><span class="str">""</span><span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
            remote_addr<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">!</span><span class="kwd">strcmp</span><span class="opt">(</span><span class="kwd">cgi_session_val</span><span class="opt">(</span><span class="str">"Session.UserAgent"</span><span class="opt">, </span><span class="str">""</span><span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
            user_agent<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">!</span><span class="kwd">strcmp</span><span class="opt">(</span><span class="kwd">cgi_session_val</span><span class="opt">(</span><span class="str">"Session.RemoteUser"</span><span class="opt">, </span><span class="str">""</span><span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
            remote_user<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Integration of the session into a CGI program requires use of either CGI parameters or cookies. Some people turn cookies off in the browser, so the best approach is to use both, and remove the CGI parameters if the cookies appear to be working. An additional CGI parameter is set to indicate that cookies should no longer be tried. The parameter names begin with a short prefix to avoid sending long names around all the time (<code>ses.</code>). The session ID is sent as <code>id</code> and the user ID is sent as <code>un</code>. The no-cookie flag is <code>nc</code>.</p>
  <pre class="dfn">
<a name="NW0-16wLRV-6" href="#NW0-16wLRV-1" id="NW0-16wLRV-6"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-5">&lt;-</a>D<a href="#NW0-16wLRV-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">print_session_cgi_parms</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>force<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>force <span class="opt">&amp;&amp; </span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;input type=</span><span class="esc">\"</span><span class="str">hidden</span><span class="esc">\" </span><span class="str">name=</span><span class="esc">\"</span><span class="str">ses.id</span><span class="esc">\" </span><span class="str">value=</span><span class="esc">\"</span><span class="str">"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"cgi write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">((</span>nerr <span class="opt">= </span><span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">, </span>FALSE<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"</span><span class="esc">\"</span><span class="str">&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"cgi write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">&amp;&amp; !</span><span class="kwd">cgi_getenv</span><span class="opt">(</span><span class="str">"REMOTE_USER"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;input type=</span><span class="esc">\"</span><span class="str">hidden</span><span class="esc">\" </span><span class="str">name=</span><span class="esc">\"</span><span class="str">ses.un</span><span class="esc">\" </span><span class="str">value=</span><span class="esc">\"</span><span class="str">"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"cgi write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((</span>nerr <span class="opt">= </span><span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">, </span>FALSE<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"</span><span class="esc">\"</span><span class="str">&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"cgi write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>force <span class="opt">&amp;&amp; </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">)) </span><span class="com">/* 2nd go around */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;input type=</span><span class="esc">\"</span><span class="str">hidden</span><span class="esc">\" </span><span class="str">name=</span><span class="esc">\"</span><span class="str">ses.nc</span><span class="esc">\" </span><span class="str">value=</span><span class="esc">\"</span><span class="str">y</span><span class="esc">\"</span><span class="str">&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"cgi write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-16wLRV-7" href="#NW0-16wLRV-1" id="NW0-16wLRV-7"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-6">&lt;-</a>D<a href="#NW0-16wLRV-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">g_string_append_session_cgi_parms</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>first<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                       <span class="kwb">GString </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">gboolean </span>force<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>force <span class="opt">&amp;&amp; </span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>first<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append_c</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">'?'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append_c</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">'&amp;'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"ses.id="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append_uri_escaped</span><span class="opt">(</span>buf<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">, </span>NULL<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">&amp;&amp; !</span><span class="kwd">cgi_getenv</span><span class="opt">(</span><span class="str">"REMOTE_USER"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;ses.un="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append_uri_escaped</span><span class="opt">(</span>buf<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">, </span>NULL<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>force <span class="opt">&amp;&amp; </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">)) </span><span class="com">/* 2nd go around */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"&amp;ses.nc=y"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-16wLRV-8" href="#NW0-16wLRV-1" id="NW0-16wLRV-8"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-7">&lt;-</a>D<a href="#NW0-16wLRV-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">print_session_cookie</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>force<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  s <span class="opt">= </span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>s <span class="opt">&amp;&amp; !</span>force <span class="opt">&amp;&amp; </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"ses.nc"</span><span class="opt">, </span>NULL<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>s <span class="opt">|| </span><span class="kwd">strcmp</span><span class="opt">(</span>s<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">cgi_printf</span><span class="opt">(</span><span class="str">"Set-Cookie: ses.id=%s; path=/</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">) &lt; </span><span class="num">1</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"CGI Write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">&amp;&amp; !</span><span class="kwd">cgi_getenv</span><span class="opt">(</span><span class="str">"REMOTE_USER"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.un"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>s <span class="opt">|| </span><span class="kwd">strcmp</span><span class="opt">(</span>s<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">cgi_printf</span><span class="opt">(</span><span class="str">"Set-Cookie: ses.un=%s; path=/</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">) &lt; </span><span class="num">1</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        nerr <span class="opt">= </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_IO<span class="opt">, </span><span class="str">"CGI Write"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Supporting the same things in templates is a bit tricker. If a template is to print the cookie, the easiest way to convey that is to set a variable. Likewise, a variable is set to request dumping the form variables. Rather than setting the variable to the text to be printed, ClearSilver macros are provided to dump the variable's hierarchy in the appropriate format. This makes adding more session variables easier, and simplifies the memory managment in the C code.</p>
  <pre class="dfn">
<a name="NW0-16wLRV-9" href="#NW0-16wLRV-1" id="NW0-16wLRV-9"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-8">&lt;-</a>D<a href="#NW0-16wLRV-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">set_session_tmpl_vars</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>force_cookie<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                              <span class="kwb">gboolean </span>force_form<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>force_form <span class="opt">|| !</span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.SessionParms.ses.id"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">&amp;&amp; !</span><span class="kwd">cgi_getenv</span><span class="opt">(</span><span class="str">"REMOTE_USER"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.SessionParms.ses.un"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>force_form <span class="opt">&amp;&amp; </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">)) </span><span class="com">/* 2nd go around */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.SessionParms.ses.nc"</span><span class="opt">, </span><span class="str">"y"</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>s <span class="opt">= </span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>s <span class="opt">&amp;&amp; !</span>force_cookie <span class="opt">&amp;&amp; </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"ses.nc"</span><span class="opt">, </span>NULL<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>s <span class="opt">|| </span><span class="kwd">strcmp</span><span class="opt">(</span>s<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.SessionCookies.ses.id"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">&amp;&amp; !</span><span class="kwd">cgi_getenv</span><span class="opt">(</span><span class="str">"REMOTE_USER"</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.SessionCookies.ses.un"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3vAdAM-E" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-E"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-D">&lt;-</a>D<a href="#NW0-3vAdAM-F">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def<span class="opt">:</span><span class="kwd">print_session_cookie</span><span class="opt">(</span>prefix<span class="opt">, </span>cookie<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">:</span><span class="kwd">subcount</span><span class="opt">(</span>cookie<span class="opt">) &gt; </span><span class="num">0 </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
   each<span class="opt">:</span>c <span class="opt">= </span>cookie ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
      call<span class="opt">:</span><span class="kwd">print_session_cookie</span><span class="opt">(</span>prefix <span class="opt">+ </span><span class="kwd">name</span><span class="opt">(</span>cookie<span class="opt">) + </span><span class="str">"."</span><span class="opt">, </span>c<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">/</span>each ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
 <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
   ?<span class="opt">&gt;</span>Set<span class="opt">-</span>Coookie<span class="opt">: &lt;</span>?cs var<span class="opt">:</span>prefix <span class="opt">+ </span><span class="kwd">name</span><span class="opt">(</span>cookie<span class="opt">) </span>?<span class="opt">&gt;=&lt;</span>?cs var<span class="opt">:</span>cookie ?<span class="opt">&gt;; </span>path<span class="opt">=/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
 <span class="opt">/</span><span class="kwa">if </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
<span class="opt">/</span>def
</pre>
      </li>

      <li>
        <pre>
?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
def<span class="opt">:</span><span class="kwd">print_session_cookies</span><span class="opt">() </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
  each<span class="opt">:</span>parm <span class="opt">= </span><span class="kwb">CGI</span><span class="opt">.</span>SessionCookies ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
    call<span class="opt">:</span><span class="kwd">print_session_cookie</span><span class="opt">(</span><span class="str">""</span><span class="opt">, </span>parm<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">/</span>each ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
<span class="opt">/</span>def ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3vAdAM-F" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-F"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-E">&lt;-</a>D<a href="#NW0-3vAdAM-G">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def<span class="opt">:</span><span class="kwd">print_session_parm</span><span class="opt">(</span>prefix<span class="opt">, </span>parm<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">:</span><span class="kwd">subcount</span><span class="opt">(</span>parm<span class="opt">) &gt; </span><span class="num">0 </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
   each<span class="opt">:</span>c <span class="opt">= </span>parm ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
      call<span class="opt">:</span><span class="kwd">print_session_parm</span><span class="opt">(</span>prefix <span class="opt">+ </span><span class="kwd">name</span><span class="opt">(</span>parm<span class="opt">) + </span><span class="str">"."</span><span class="opt">, </span>c<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">/</span>each ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
 <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
   ?<span class="opt">&gt;&lt;</span>input type<span class="opt">=</span><span class="str">"hidden"</span> name<span class="opt">=</span><span class="str">"&lt;?cs var:prefix + name(parm)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">            ?&gt; value="</span><span class="opt">&lt;</span>?cs var<span class="opt">:</span>parm ?<span class="opt">&gt;</span><span class="str">"&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str"> /if ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">/def</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">def:print_session_parms() ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">  each:parm = CGI.SessionParms ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">    call:print_session_parm("</span><span class="str">", parm) ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">  /each ?&gt;&lt;?cs</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">/def ?&gt;&lt;?cs</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3vAdAM-G" href="#NW0-3vAdAM-1" id="NW0-3vAdAM-G"><dfn>&lt;Generic ClearSilver HTML Macros&gt;+=</dfn></a> <b>(<a href="#NW0-3L4zVQ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3vAdAM-F">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
def<span class="opt">:</span><span class="kwd">add_session_parm</span><span class="opt">(</span>prefix<span class="opt">, </span>parm<span class="opt">, </span>first<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">:</span><span class="kwd">subcount</span><span class="opt">(</span>parm<span class="opt">) &gt; </span><span class="num">0 </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
   each<span class="opt">:</span>c <span class="opt">= </span>parm ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
      call<span class="opt">:</span><span class="kwd">add_session_parm</span><span class="opt">(</span>prefix <span class="opt">+ </span><span class="kwd">name</span><span class="opt">(</span>parm<span class="opt">) + </span><span class="str">"."</span><span class="opt">, </span>c<span class="opt">, </span>first<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
      set<span class="opt">:</span>first <span class="opt">= </span><span class="num">0 </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">/</span>each ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
 <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
   ?<span class="opt">&gt;&lt;</span>?cs <span class="kwa">if</span><span class="opt">:</span>first ?<span class="opt">&gt;</span>?<span class="opt">&lt;</span>?cs <span class="kwa">else </span>?<span class="opt">&gt;&amp;&lt;</span>?cs <span class="opt">/</span><span class="kwa">if </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
      var<span class="opt">:</span><span class="kwd">url_escape</span><span class="opt">(</span>prefix <span class="opt">+ </span><span class="kwd">name</span><span class="opt">(</span>parm<span class="opt">)) </span>?<span class="opt">&gt;=&lt;</span>?cs var<span class="opt">:</span><span class="kwd">url_escape</span><span class="opt">(</span>parm<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
      set<span class="opt">:</span>first <span class="opt">= </span><span class="num">0 </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
 <span class="opt">/</span><span class="kwa">if </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
<span class="opt">/</span>def
</pre>
      </li>

      <li>
        <pre>
?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
def<span class="opt">:</span><span class="kwd">add_session_parms</span><span class="opt">(</span>first<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
  each<span class="opt">:</span>parm <span class="opt">= </span><span class="kwb">CGI</span><span class="opt">.</span>SessionParms ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
    call<span class="opt">:</span><span class="kwd">add_session_parm</span><span class="opt">(</span><span class="str">""</span><span class="opt">, </span>parm<span class="opt">, </span>first<span class="opt">) </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
    set<span class="opt">:</span>first <span class="opt">= </span><span class="num">0 </span>?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">/</span>each ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>

      <li>
        <pre>
<span class="opt">/</span>def ?<span class="opt">&gt;&lt;</span>?cs
</pre>
      </li>
    </ol>
  </div>

  <p>To actually set the session ID, the parameters are checked first, and if the parameters do not indicate a valid session, a new session is created. If this function is called multiple times, the session already in progress is retained with no further action.</p>
  <pre class="dfn">
<a name="NW0-16wLRV-A" href="#NW0-16wLRV-1" id="NW0-16wLRV-A"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-9">&lt;-</a>D<a href="#NW0-16wLRV-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">update_cgi_session</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-A-u1" href="#NW0-20azRg-1" id="NW0-16wLRV-A-u1"><i>&lt;Check CGI session parameters&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-16wLRV-A-u2" href="#NW0-2YEY-1" id="NW0-16wLRV-A-u2"><i>&lt;Verify CGI session returning <code>STATUS_OK</code> if OK&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">update_session_state</span><span class="opt">(</span>NULL<span class="opt">, </span>NULL<span class="opt">, </span>NULL<span class="opt">, </span>cgi_state<span class="opt">); </span><span class="com">/* delete session */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-16wLRV-A-u3" href="#NW0-EwGae-1" id="NW0-16wLRV-A-u3"><i>&lt;Create new CGI session&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The session parameter can come from the cookies or the CGI parameters.</p>
  <pre class="dfn">
<a name="NW0-20azRg-1" href="#NW0-20azRg-1" id="NW0-20azRg-1"><dfn>&lt;Check CGI session parameters&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-A">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span><span class="kwd">strdup</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_NOMEM<span class="opt">, </span><span class="str">"Session"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gboolean </span>userid_from_session <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>userid <span class="opt">= </span><span class="kwd">cgi_cookie_val</span><span class="opt">(</span><span class="str">"ses.un"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>userid <span class="opt">= </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"ses.un"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  userid_from_session <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>To verify a session ID, the session parameters are read from the file and the user location is verified. No lock needs to be retained, because the user identification information should never change.</p>
  <pre class="dfn">
<a name="NW0-2YEY-1" href="#NW0-2YEY-1" id="NW0-2YEY-1"><dfn>&lt;Verify CGI session returning <code>STATUS_OK</code> if OK&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-A">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">read_session_state</span><span class="opt">(</span><span class="str">"Session"</span><span class="opt">, </span>NULL<span class="opt">, </span>TRUE<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; !</span><span class="kwd">validate_session</span><span class="opt">(</span>cgi_state<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid session"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>userid_from_session <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.RemoteUser"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2YEY-1-u1" href="#nw@notdef" id="NW0-2YEY-1-u1"><i>&lt;(cs-glib.nw) Convert <code>nerr</code> to <code>err_str</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;pre&gt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>err_str<span class="opt">.</span>buf<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;/pre&gt;"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">string_clear</span><span class="opt">(&amp;</span>err_str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>To create a session ID, the user location becomes the session state, and a new state is created. If the user ID changes after this, the state must be updated.</p>
  <pre class="dfn">
<a name="NW0-EwGae-1" href="#NW0-EwGae-1" id="NW0-EwGae-1"><dfn>&lt;Create new CGI session&gt;=</dfn></a> <b>(<a href="#NW0-16wLRV-A">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>userid_from_session<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>userid <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">set_session_validation</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">create_session_state</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>To destroy a session, the file is removed. No attempt is made to clear the cookies, because the fact that they are invalid will make them be ignored anyway. On the other hand, if the caller really wants to try to clear the cookies, the appropriate flag can be set.</p>
  <pre class="dfn">
<a name="NW0-16wLRV-B" href="#NW0-16wLRV-1" id="NW0-16wLRV-B"><dfn>&lt;CGI Session Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2q5XL8-1">&lt;-U</a>)</b> <b>[<a href="#NW0-16wLRV-A">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">logout_cgi_session</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span>print_cookies<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">update_session_state</span><span class="opt">(</span>NULL<span class="opt">, </span>NULL<span class="opt">, </span>NULL<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>print_cookies<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_cookie_clear</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span><span class="str">"ses.id"</span><span class="opt">, </span>NULL<span class="opt">, </span><span class="str">"/"</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_cookie_clear</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span><span class="str">"ses.un"</span><span class="opt">, </span>NULL<span class="opt">, </span><span class="str">"/"</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc12" id="toc12">Database Session Support</a></h1>

  <p>Since the session support is intended to work with databases as well, a sample implementation using ODBC<sup><a href="#fn21">21</a></sup></p>
  <pre class="dfn">
<a name="NW0-E8T1B-3" href="#NW0-E8T1B-1" id="NW0-E8T1B-3"><dfn>&lt;(cs-glib.nw) Library <code>cs-supt</code> Members&gt;+=</dfn></a> <b>[<a href="#NW0-E8T1B-2">&lt;-</a>D<a href="#NW0-E8T1B-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
db_session<span class="opt">.</span>o
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2mrnmy-1" href="#NW0-2mrnmy-1" id="NW0-2mrnmy-1"><dfn>&lt;db_session.c&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-2mrnmy-1-u1" href="#nw@notdef" id="NW0-2mrnmy-1-u1"><i>&lt;(build.nw) Common C Header&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2mrnmy-1-u2" href="#NW0-2ixk5s-1" id="NW0-2mrnmy-1-u2"><i>&lt;CGI Database Session Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2mrnmy-1-u3" href="#NW0-3i0nme-1" id="NW0-2mrnmy-1-u3"><i>&lt;CGI Database Session Functions&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1mOMve-6" href="#NW0-1mOMve-1" id="NW0-1mOMve-6"><dfn>&lt;(build.nw) Common C Includes&gt;+=</dfn></a> <b>[<a href="#NW0-1mOMve-5">&lt;-</a>D<a href="#NW0-1mOMve-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define _OBJC_OBJC_H_ 1 </span><span class="com">/* suppress iodbc BOOL */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;sql.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;sqlext.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3DeDMu-3" href="#NW0-3DeDMu-1" id="NW0-3DeDMu-3"><dfn>&lt;(build.nw) makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3DeDMu-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># CFLAGS for ODBC</span>
</pre>
      </li>

      <li>
        <pre>
ODBC_INC<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># ODBC library</span>
</pre>
      </li>

      <li>
        <pre>
ODBC_LIB<span class="opt">=-</span>lodbc
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-13PeAG-5" href="#NW0-13PeAG-1" id="NW0-13PeAG-5"><dfn>&lt;(build.nw) makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-13PeAG-4">&lt;-</a>D<a href="#NW0-13PeAG-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
EXTRA_CFLAGS <span class="opt">+= $(</span>ODBC_INC<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
EXTRA_LDFLAGS <span class="opt">+= $(</span>ODBC_LIB<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In order to remain as database-neutral as possible, some efficiencies provided by various databases must be avoided. These include auto-incrementing integer fields and foreign key constraints with cascading deletes. The only feature which is required is transaction support, and even that is limited as much as possible. Also, in order to allow non-session access to the database, some database support is provided in a separate header file, and some required functions are also exported.</p>
  <pre class="dfn">
<a name="NW0-3pmRHJ-1" href="#NW0-3pmRHJ-1" id="NW0-3pmRHJ-1"><dfn>&lt;dbase.h&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#ifndef _DBASE_H</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define _DBASE_H</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-3pmRHJ-1-u1" href="#NW0-yctzv-1" id="NW0-3pmRHJ-1-u1"><i>&lt;Database Support Definitions&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1mOMve-7" href="#NW0-1mOMve-1" id="NW0-1mOMve-7"><dfn>&lt;(build.nw) Common C Includes&gt;+=</dfn></a> <b>[<a href="#NW0-1mOMve-6">&lt;-</a>D<a href="#NW0-1mOMve-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include </span><span class="pps">"dbase.h"</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In particular, the ODBC connection parameters are made available, along with some functions to use those parameters, assuming a local variable named <code>conn</code> holds a pointer to them.</p>
  <pre class="dfn">
<a name="NW0-yctzv-1" href="#NW0-yctzv-1" id="NW0-yctzv-1"><dfn>&lt;Database Support Definitions&gt;=</dfn></a> <b>(<a href="#NW0-3pmRHJ-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-yctzv-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">typedef </span><span class="kwb">struct db_conn </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLHDBC </span>dbc<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLHSTMT </span>stmt<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-yctzv-1-u1" href="#NW0-3K4jCX-1" id="NW0-yctzv-1-u1"><i>&lt;CGI Database Session Parameters&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwb">db_conn</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4IhMOG-A" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-A"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-9">&lt;-</a>D<a href="#NW0-4IhMOG-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">db_conn</span><span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-yctzv-2" href="#NW0-yctzv-1" id="NW0-yctzv-2"><dfn>&lt;Database Support Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-3pmRHJ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-yctzv-1">&lt;-</a>D<a href="#NW0-yctzv-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define db_exec(s)  SQLExecDirect(conn-&gt;stmt, (SQLCHAR *)s, SQL_NTS)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_prep(s)  SQLPrepare(conn-&gt;stmt, (SQLCHAR *)s, SQL_NTS)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_trans(t) SQLEndTran(SQL_HANDLE_DBC, conn-&gt;dbc, t)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_commit() do { \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) { </span>\
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_trans</span><span class="opt">(</span>SQL_COMMIT<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) </span>\
</pre>
      </li>

      <li>
        <pre>
      dbcerr <span class="opt">= </span>TRUE<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span>\
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">while</span><span class="opt">(</span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_commit_keeperr() do { \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_commit</span><span class="opt">(); </span>\
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span>\
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_trans</span><span class="opt">(</span>SQL_COMMIT<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">while</span><span class="opt">(</span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_next() SQLFreeStmt(conn-&gt;stmt, SQL_CLOSE);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_bind64(p, i) \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">SQLBindParameter</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span>p<span class="opt">, </span>SQL_PARAM_INPUT<span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, </span>SQL_BIGINT<span class="opt">, </span>\
</pre>
      </li>

      <li>
        <pre>
                   <span class="num">0</span><span class="opt">, </span><span class="num">0</span><span class="opt">, &amp;</span>i<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>NULL<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_bindsl(p, s, l) \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">SQLBindParameter</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span>p<span class="opt">, </span>SQL_PARAM_INPUT<span class="opt">, </span>SQL_C_CHAR<span class="opt">, </span>SQL_VARCHAR<span class="opt">, </span>\
</pre>
      </li>

      <li>
        <pre>
                   l<span class="opt">, </span><span class="num">0</span><span class="opt">, (</span><span class="kwb">void </span><span class="opt">*)</span>s<span class="opt">, </span><span class="num">0</span><span class="opt">, &amp;</span>l<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">extern </span><span class="kwb">SQLLEN </span>db_nullen<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_bindnull(p) \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">SQLBindParameter</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span>p<span class="opt">, </span>SQL_PARAM_INPUT<span class="opt">, </span>SQL_C_CHAR<span class="opt">, </span>SQL_VARCHAR<span class="opt">, </span>\
</pre>
      </li>

      <li>
        <pre>
                   <span class="num">0</span><span class="opt">, </span><span class="num">0</span><span class="opt">, </span>NULL<span class="opt">, </span><span class="num">0</span><span class="opt">, &amp;</span>db_nullen<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define db_binds(p, s)     (s) == NULL ? db_bindnull(p) : \</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">SQLBindParameter</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span>p<span class="opt">, </span>SQL_PARAM_INPUT<span class="opt">, </span>SQL_C_CHAR<span class="opt">, </span>SQL_VARCHAR<span class="opt">, </span>\
</pre>
      </li>

      <li>
        <pre>
                   <span class="num">0</span><span class="opt">, </span><span class="num">0</span><span class="opt">, (</span><span class="kwb">void </span><span class="opt">*)</span>s<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>NULL<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ixk5s-1" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-1"><dfn>&lt;CGI Database Session Variables&gt;=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-2ixk5s-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">SQLLEN </span>db_nullen <span class="opt">= </span>SQL_NULL_DATA<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-7" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-7"><dfn>&lt;(build.nw) C Prototypes&gt;+=</dfn></a> <b>[<a href="#NW0-3a9iNE-6">&lt;-</a>D<a href="#NW0-3a9iNE-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_exec</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>sql<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>sql<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_trans</span><span class="opt">(</span><span class="kwb">SQLSMALLINT </span>type<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">db_commit</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">db_commit_keeperr</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_next</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="kwb">int </span>param<span class="opt">, </span><span class="kwb">guint64 </span><span class="opt">&amp;</span>val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_bindsl</span><span class="opt">(</span><span class="kwb">int </span>param<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>str<span class="opt">, </span><span class="kwb">SQLLEN </span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_bindnull</span><span class="opt">(</span><span class="kwb">int </span>param<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="kwb">int </span>param<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>str<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In addition, debugging may be enabled. This is all session-specific and should normally not be needed, so it is enabled by compile directive.</p>
  <pre class="dfn">
<a name="NW0-2ixk5s-2" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-2"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-1">&lt;-</a>D<a href="#NW0-2ixk5s-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#ifdef DEBUG_DBSESS</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">debug_sqlendtran</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">SQLSMALLINT </span>c<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret <span class="opt">= </span><span class="kwd">SQLEndTran</span><span class="opt">(</span>SQL_HANDLE_DBC<span class="opt">, </span>conn<span class="opt">-&gt;</span>dbc<span class="opt">, </span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">SQLExecDirect</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, (</span>SQLCHAR <span class="opt">*)</span><span class="str">"select * from sessval"</span><span class="opt">, </span>SQL_NTS<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">puts</span><span class="opt">(</span><span class="str">"commiting; new values:"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">guint64 </span>id<span class="opt">, </span>parent<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">char </span>name<span class="opt">[</span><span class="num">33</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">char </span>value<span class="opt">[</span><span class="num">1025</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">SQLLEN </span>vallen<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>id<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">2</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>parent<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">3</span><span class="opt">, </span>SQL_C_CHAR<span class="opt">, </span>name<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>name<span class="opt">), </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">4</span><span class="opt">, </span>SQL_C_CHAR<span class="opt">, </span>value<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>value<span class="opt">), &amp;</span>vallen<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>vallen <span class="opt">== </span>SQL_NULL_DATA<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">strcpy</span><span class="opt">(</span>value<span class="opt">, </span><span class="str">"*NULL*"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">printf</span><span class="opt">(</span><span class="str">"%08d %08d %32s %s</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, (</span><span class="kwb">int</span><span class="opt">)</span>id<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)</span>parent<span class="opt">, </span>name<span class="opt">, </span>value<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">puts</span><span class="opt">(</span><span class="str">"-----"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">fflush</span><span class="opt">(</span>stdout<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static SQLRETURN </span><span class="kwd">debug_execdirect</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">const </span>SQLCHAR <span class="opt">*</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">printf</span><span class="opt">(</span><span class="str">"SQLR: %s</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">fflush</span><span class="opt">(</span>stdout<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">db_exec</span><span class="opt">(</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static SQLRETURN </span><span class="kwd">debug_prep</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">const </span>SQLCHAR <span class="opt">*</span>s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">printf</span><span class="opt">(</span><span class="str">"SQLP: %s</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">fflush</span><span class="opt">(</span>stdout<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">db_prep</span><span class="opt">(</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static SQLRETURN </span><span class="kwd">debug_bind</span><span class="opt">(</span><span class="kwb">SQLHSTMT </span>st<span class="opt">, </span><span class="kwb">int </span>n<span class="opt">, </span><span class="kwb">int </span>t2<span class="opt">, </span><span class="kwb">int </span>t3<span class="opt">, </span><span class="kwb">int </span>l<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="kwb">void </span><span class="opt">*</span>v<span class="opt">, </span><span class="kwb">SQLLEN </span><span class="opt">*</span>lp<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>t2 <span class="opt">== </span>SQL_C_CHAR<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">printf</span><span class="opt">(</span><span class="str">"bind %d: %s</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>n<span class="opt">, </span>v ? <span class="opt">(</span><span class="kwb">char </span><span class="opt">*)</span>v <span class="opt">: </span><span class="str">"*NULL*"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">printf</span><span class="opt">(</span><span class="str">"bind %d: %llu</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>n<span class="opt">, (</span><span class="kwb">ullong</span><span class="opt">)*(</span><span class="kwb">guint64 </span><span class="opt">*)</span>v<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">fflush</span><span class="opt">(</span>stdout<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">SQLBindParameter</span><span class="opt">(</span>st<span class="opt">, </span>n<span class="opt">, </span>SQL_PARAM_INPUT<span class="opt">, </span>t2<span class="opt">, </span>t3<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                          l<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>v<span class="opt">, </span><span class="num">0</span><span class="opt">, </span>lp<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define SQLEndTran(a,b,c) debug_sqlendtran(conn, c)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define SQLExecDirect(st, sql, l) debug_execdirect(conn, sql)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define SQLPrepare(st, sql, l) debug_prep(conn, sql)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#define SQLBindParameter(st, n, t1, t2, t3, l, p, v, ol, lp) \</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwd">debug_bind</span><span class="opt">(</span>st<span class="opt">, </span>n<span class="opt">, </span>t2<span class="opt">, </span>t3<span class="opt">, </span>l<span class="opt">, </span>v<span class="opt">, </span>lp<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Creating tables is not always possible, and may require additional steps (like creating a database to store the table), so a separate script is provided. This is a sample script, and may need to be edited for the specific database to be used.</p>
  <pre class="dfn">
<a name="NW0-2kYumM-2" href="#NW0-2kYumM-1" id="NW0-2kYumM-2"><dfn>&lt;(build.nw) Plain Files&gt;+=</dfn></a> <b>[<a href="#NW0-2kYumM-1">&lt;-</a>D<a href="#NW0-2kYumM-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
sessdbcreate<span class="opt">.</span>sql \
</pre>
      </li>
    </ol>
  </div>

  <p>The names for the session variables can be controlled, so leaving them at a relatively short length, such as 32, is not unreasonable. However, the values are supplied by the user, so it is not possible to force an arbitrary limit. For some databaseses, this is not an issue: they can store and manipulate strings of arbitrary length in any field. Others treat long strings as binary objects, though, and disallow searching and other forms of manipulation. For this reason a separate table is used to store extension chains for the values. Searching by value would have to be done in two steps: using the database to search on the primary table's value, and then searching the remainder manually. The database cannot be relied on to append strings of indefinite length, so it cannot be used directly. A pointer is stored to the parent record as well, to make deletes (especially with cascading) easier. This column must be created after the parent table or the reference will not get created.</p>
  <pre class="dfn">
<a name="NW0-4BxKvC-1" href="#NW0-4BxKvC-1" id="NW0-4BxKvC-1"><dfn>&lt;sessdbcreate.sql&gt;=</dfn></a> <b>[D<a href="#NW0-4BxKvC-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">create table </span><span class="kwd">sessvalext </span><span class="opt">(</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">id     </span><span class="kwb">bigint </span><span class="kwa">primary key not null unique</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  ext    <span class="kwb">bigint </span><span class="kwa">references </span>sessvalext <span class="kwa">on delete cascade</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc">-- parent bigint;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc">-- make this a large text field of any arbitrary type</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc">-- probably best to use text in postgres &amp; sqlite</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">value  </span><span class="kwb">varchar</span><span class="opt">(</span><span class="num">32768</span><span class="opt">) </span><span class="kwa">not null</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Everything is managed with one session table, since the API provides no special fields which would make a separate session table more useful. Each value has of course a <code>name</code> and an optional <code>value</code>. Children are linked in via the <code>parent</code> field; rather than using the name as the parent key, a separate integer <code>id</code> field is used. Uniqueness in the hierarchy is enforced via a uniqueness constraint on the <code>name</code> and <code>parent</code> fields, but the constraint is not relied upon.</p>
  <pre class="dfn">
<a name="NW0-4BxKvC-2" href="#NW0-4BxKvC-1" id="NW0-4BxKvC-2"><dfn>&lt;sessdbcreate.sql&gt;+=</dfn></a> <b>[<a href="#NW0-4BxKvC-1">&lt;-</a>D<a href="#NW0-4BxKvC-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">create table </span><span class="kwd">sessval </span><span class="opt">(</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">id     </span><span class="kwb">bigint </span><span class="kwa">primary key not null unique</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  parent <span class="kwb">bigint </span><span class="kwa">not null references </span>sessval <span class="kwa">on delete cascade</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">name   </span><span class="kwb">varchar</span><span class="opt">(</span><span class="num">32</span><span class="opt">) </span><span class="kwa">not null</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">value  </span><span class="kwb">varchar</span><span class="opt">(</span><span class="num">126</span><span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
  valext <span class="kwb">bigint </span><span class="kwa">references </span>sessvalext<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">unique </span><span class="opt">(</span>parent<span class="opt">, </span><span class="kwa">name</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">alter table </span>sessvalext <span class="kwa">add </span>parent <span class="kwb">bigint </span><span class="kwa">references </span>sessval <span class="kwa">on delete cascade</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">-- create index sessval_fk on sessval (parent);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">-- create index sessval_uk on sessval (parent, name);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Since auto-incrementing fields are non-portable, new <code>id</code> values could either be the largest current value plus one, or they could come from a manually incremented field. The former enables a race condition wherein a record is identified, but before an additional operation is performed, other processess delete the record and create a new one with the same <code>id</code> but different values, so the latter is used. By incementing the field within a transaction, a unique identifier can be obtained every time. This does limit the total number of record insertions to the maximum integer value, but this can be alleviated by occasionally dropping and recreating the table during maintenance periods. Any database which does not support transactions of this sort cannot be used.</p>

  <p>Rather than creating a new table with a field meant for the automatic increment function, a dummy entry is used. This could either use the <code>value</code> field for the counter, which would require integer-to-string conversions more frequently than necessary, or it could use the <code>id</code> field itself as the counter, always providing a value and then updating to the next available value. The latter option would probably be more efficient, but using the <code>value</code> field is easier to implement. The first value is always the root of all other entries, and its value is always the last inserted <code>id</code>.</p>

  <p>The SQL requires a type cast, so the underlying data type must be known. For most databases, this will the the SQL standard <code>bigint</code> type. For databases which do not support this type, another type can be configured. Also, even though it is possible to query the length of the value field from ODBC, the queried length may be inaccurate, and it is easier to just get the length from configuration.</p>
  <pre class="dfn">
<a name="NW0-4BxKvC-3" href="#NW0-4BxKvC-1" id="NW0-4BxKvC-3"><dfn>&lt;sessdbcreate.sql&gt;+=</dfn></a> <b>[<a href="#NW0-4BxKvC-2">&lt;-</a>D<a href="#NW0-4BxKvC-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">insert into </span><span class="kwd">sessval </span><span class="opt">(</span><span class="kwa">id</span><span class="opt">, </span>parent<span class="opt">, </span><span class="kwa">name</span><span class="opt">, </span><span class="kwa">value</span><span class="opt">) </span><span class="kwa">values</span><span class="opt">(</span><span class="num">1</span><span class="opt">,</span><span class="num">1</span><span class="opt">,</span><span class="num">1</span><span class="opt">,</span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-TuSGW-1" href="#NW0-TuSGW-1" id="NW0-TuSGW-1"><dfn>&lt;Session Value Support Configuration&gt;=</dfn></a> <b>(<a href="#NW0-B9EcR-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The SQL data type used for database table keys</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#id_field_type = bigint</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># The maximum length of a session value before extension</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># 0 means there is no maximum</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#sessval_length = 126</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># The maximum length of an extension before further extension</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># 0 means there is no maximum</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#strext_length = 32768</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ixk5s-3" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-3"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-2">&lt;-</a>D<a href="#NW0-2ixk5s-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>id_field_type <span class="opt">= </span><span class="str">"bigint"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static guint64 </span>sessval_length <span class="opt">= </span><span class="num">126</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">guint64 </span>strext_length <span class="opt">= </span><span class="num">32768</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-yctzv-3" href="#NW0-yctzv-1" id="NW0-yctzv-3"><dfn>&lt;Database Support Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-3pmRHJ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-yctzv-2">&lt;-</a>D<a href="#NW0-yctzv-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">extern </span><span class="kwb">const char </span><span class="opt">*</span>id_field_type<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">extern </span><span class="kwb">guint64 </span>strext_length<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-1" href="#NW0-3i0nme-1" id="NW0-3i0nme-1"><dfn>&lt;CGI Database Session Functions&gt;=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3i0nme-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">db_get_next_id</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>table<span class="opt">, </span><span class="kwb">guint64 </span><span class="opt">*</span>newid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>dbcerr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GString </span><span class="opt">*</span>query <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_printf</span><span class="opt">(</span>query<span class="opt">, </span><span class="str">"update %s set value = cast(value as %s) + 1"</span>
</pre>
      </li>

      <li>
        <pre>
                         <span class="str">" where id = 1"</span><span class="opt">, </span>table<span class="opt">, </span>id_field_type<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_exec</span><span class="opt">(</span>query<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_truncate</span><span class="opt">(</span>query<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_printf</span><span class="opt">(</span>query<span class="opt">, </span><span class="str">"select value from %s where id = 1"</span><span class="opt">, </span>table<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_exec</span><span class="opt">(</span>query<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, </span>newid<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(*</span>newid<span class="opt">), </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-3i0nme-1-u1" href="#NW0-3qySoB-1" id="NW0-3i0nme-1-u1"><i>&lt;Set <code>nerr</code> for ODBC error&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>query<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-2" href="#NW0-3i0nme-1" id="NW0-3i0nme-2"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-1">&lt;-</a>D<a href="#NW0-3i0nme-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">create_sessval</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">guint64 </span>parent<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                              <span class="kwb">const char </span><span class="opt">*</span>val<span class="opt">, </span><span class="kwb">guint64 </span><span class="opt">*</span>newid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>dbcerr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLLEN </span>vlen <span class="opt">= </span>val ? <span class="kwd">strlen</span><span class="opt">(</span>val<span class="opt">) : </span><span class="num">0</span><span class="opt">, </span>vlen_small <span class="opt">= </span>vlen<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>vlen <span class="opt">&gt; </span>sessval_length<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    vlen_small <span class="opt">= </span>sessval_length<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">db_get_next_id</span><span class="opt">(</span>conn<span class="opt">, </span><span class="str">"sessval"</span><span class="opt">, </span>newid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>tname<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>name<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">sprintf</span><span class="opt">(</span>tname<span class="opt">, </span><span class="str">".%llu"</span><span class="opt">, (</span><span class="kwb">ullong</span><span class="opt">)*</span>newid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    name <span class="opt">= </span>tname<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"insert into sessval (id, parent, name, value) "</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="str">"values (?, ?, ?, ?)"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, *</span>newid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>parent<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">3</span><span class="opt">, </span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span>vlen ? <span class="kwd">db_bindsl</span><span class="opt">(</span><span class="num">4</span><span class="opt">, </span>val<span class="opt">, </span>vlen_small<span class="opt">) : </span><span class="kwd">db_bindnull</span><span class="opt">(</span><span class="num">4</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-3i0nme-2-u1" href="#NW0-3qySoB-1" id="NW0-3i0nme-2-u1"><i>&lt;Set <code>nerr</code> for ODBC error&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>vlen <span class="opt">&gt; </span>sessval_length<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">guint64 </span>strext<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">db_store_string_ext</span><span class="opt">(</span>conn<span class="opt">, </span><span class="str">"sessvalext"</span><span class="opt">, *</span>newid<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                val <span class="opt">+ </span>sessval_length<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                vlen <span class="opt">- </span>sessval_length<span class="opt">, &amp;</span>strext<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"update sessval set valext = ? where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>strext<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, *</span>newid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt"><a name="NW0-3i0nme-2-u2" href="#NW0-3qySoB-1" id="NW0-3i0nme-2-u2"><i>&lt;Set <code>nerr</code> for ODBC error&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Similarly, string extensions are done by using a special ID at the start of the table. Since other tables may potentially take advantage of string extentions, the actual table name is passed in as a parameter.</p>
  <pre class="dfn">
<a name="NW0-4BxKvC-4" href="#NW0-4BxKvC-1" id="NW0-4BxKvC-4"><dfn>&lt;sessdbcreate.sql&gt;+=</dfn></a> <b>[<a href="#NW0-4BxKvC-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">insert into </span><span class="kwd">sessvalext </span><span class="opt">(</span><span class="kwa">id</span><span class="opt">, </span><span class="kwa">value</span><span class="opt">) </span><span class="kwa">values</span><span class="opt">(</span><span class="num">1</span><span class="opt">,</span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-3" href="#NW0-3i0nme-1" id="NW0-3i0nme-3"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-2">&lt;-</a>D<a href="#NW0-3i0nme-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">db_store_string_ext</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>table<span class="opt">, </span><span class="kwb">guint64 </span>parent<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="kwb">const char </span><span class="opt">*</span>ext<span class="opt">, </span><span class="kwb">SQLLEN </span>len<span class="opt">, </span><span class="kwb">guint64 </span><span class="opt">*</span>id<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>dbcerr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>strext <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>len <span class="opt">&gt; </span>strext_length<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">db_store_string_ext</span><span class="opt">(</span>conn<span class="opt">, </span>table<span class="opt">, </span>parent<span class="opt">, </span>ext <span class="opt">+ </span>strext_length<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                len <span class="opt">- </span>strext_length<span class="opt">, &amp;</span>strext<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    len <span class="opt">= </span>strext_length<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">db_get_next_id</span><span class="opt">(</span>conn<span class="opt">, </span>table<span class="opt">, </span>id<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">GString </span><span class="opt">*</span>query <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_printf</span><span class="opt">(</span>query<span class="opt">, </span><span class="str">"insert into %s (id, ext, parent, value) "</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="str">"values (?, ?, ?, ?)"</span><span class="opt">, </span>table<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span>query<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, *</span>id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>strext<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>strext<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_bindnull</span><span class="opt">(</span><span class="num">2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">3</span><span class="opt">, </span>parent<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bindsl</span><span class="opt">(</span><span class="num">4</span><span class="opt">, </span>ext<span class="opt">, </span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt"><a name="NW0-3i0nme-3-u1" href="#NW0-3qySoB-1" id="NW0-3i0nme-3-u1"><i>&lt;Set <code>nerr</code> for ODBC error&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK <span class="opt">&amp;&amp; </span>strext<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_delete_strext</span><span class="opt">(</span>conn<span class="opt">, </span>table<span class="opt">, </span>strext<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-4" href="#NW0-3i0nme-1" id="NW0-3i0nme-4"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-3">&lt;-</a>D<a href="#NW0-3i0nme-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">db_delete_strext</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>table<span class="opt">, </span><span class="kwb">guint64 </span>strext<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>dbcerr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>strext_next <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GString </span><span class="opt">*</span>query1 <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">), *</span>query2 <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_printf</span><span class="opt">(</span>query1<span class="opt">, </span><span class="str">"select id from %s where ext = ?"</span><span class="opt">, </span>table<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_printf</span><span class="opt">(</span>query2<span class="opt">, </span><span class="str">"delete from %s where id = ?"</span><span class="opt">, </span>table<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span>strext<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>dbcascade<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span>query1<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>strext<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">== </span>SQL_NO_DATA<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          ret <span class="opt">= </span>SQL_SUCCESS<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          strext_next <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>strext_next<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                     <span class="kwa">sizeof</span><span class="opt">(</span>strext_next<span class="opt">), </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span>query2<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>strext<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    strext <span class="opt">= </span>strext_next<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>query1<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>query2<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Connecting to the database is then just a matter of providing the correct connection string. This can include user ID and password, so only one configuration parameter is needed.</p>
  <pre class="dfn">
<a name="NW0-B9EcR-1" href="#NW0-B9EcR-1" id="NW0-B9EcR-1"><dfn>&lt;CGI Database Session Support Configuration&gt;=</dfn></a> <b>(<a href="#NW0-3Zp9uJ-1">U-&gt;</a> <a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[D<a href="#NW0-B9EcR-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># ODBC Database connection string; blank to disable</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Format is generally DSN=&lt;dsn&gt;[; UID=&lt;username&gt;; PWD=&lt;password&gt;]</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Or apparently also FILEDSN=&lt;filename&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#dbconnect =</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-B9EcR-1-u1" href="#NW0-TuSGW-1" id="NW0-B9EcR-1-u1"><i>&lt;Session Value Support Configuration&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ixk5s-4" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-4"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-3">&lt;-</a>D<a href="#NW0-2ixk5s-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static SQLHENV </span>henv <span class="opt">= </span>SQL_NULL_HENV<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static const char </span><span class="opt">*</span>dbconnect <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-5" href="#NW0-3i0nme-1" id="NW0-3i0nme-5"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-4">&lt;-</a>D<a href="#NW0-3i0nme-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">init_db_cgi_session</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3i0nme-5-u1" href="#NW0-2JwojC-1" id="NW0-3i0nme-5-u1"><i>&lt;Set up database connection&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2JwojC-1" href="#NW0-2JwojC-1" id="NW0-2JwojC-1"><dfn>&lt;Set up database connection&gt;=</dfn></a> <b>(<a href="#NW0-3i0nme-5">&lt;-U</a>)</b> <b>[D<a href="#NW0-2JwojC-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
dbconnect <span class="opt">= </span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"dbconnect"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>dbconnect <span class="opt">|| !*</span>dbconnect<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* use connection pool */</span>
</pre>
      </li>

      <li>
        <pre>
ret <span class="opt">= </span><span class="kwd">SQLSetEnvAttr</span><span class="opt">(</span>SQL_NULL_HANDLE<span class="opt">, </span>SQL_ATTR_CONNECTION_POOLING<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="opt">(</span>SQLPOINTER<span class="opt">)</span>SQL_CP_ONE_PER_DRIVER<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2JwojC-1-u1" href="#NW0-4Embk6-1" id="NW0-2JwojC-1-u1"><i>&lt;Ignore ODBC <code>ret</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
ret <span class="opt">= </span><span class="kwd">SQLAllocHandle</span><span class="opt">(</span>SQL_HANDLE_ENV<span class="opt">, </span>SQL_NULL_HANDLE<span class="opt">, &amp;</span>henv<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLSetEnvAttr</span><span class="opt">(</span>henv<span class="opt">, </span>SQL_ATTR_ODBC_VERSION<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="opt">(</span>SQLPOINTER<span class="opt">)</span>SQL_OV_ODBC3<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2JwojC-1-u2" href="#NW0-1GLJEI-1" id="NW0-2JwojC-1-u2"><i>&lt;Print ODBC env error&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">exit</span><span class="opt">(</span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
id_field_type <span class="opt">= </span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"id_field_type"</span><span class="opt">, </span>id_field_type<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
sessval_length <span class="opt">= </span><span class="kwd">getconf_int</span><span class="opt">(</span><span class="str">"sessval_length"</span><span class="opt">, </span>sessval_length<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
strext_length <span class="opt">= </span><span class="kwd">getconf_int</span><span class="opt">(</span><span class="str">"strext_length"</span><span class="opt">, </span>strext_length<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-6" href="#NW0-3i0nme-1" id="NW0-3i0nme-6"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-5">&lt;-</a>D<a href="#NW0-3i0nme-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">open_db</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>dbconnect <span class="opt">|| !*</span>dbconnect<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"No database connection string specified"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLAllocHandle</span><span class="opt">(</span>SQL_HANDLE_DBC<span class="opt">, </span>henv<span class="opt">, &amp;</span>conn<span class="opt">-&gt;</span>dbc<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLDriverConnect</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>dbc<span class="opt">, </span><span class="num">0</span><span class="opt">, (</span>SQLCHAR <span class="opt">*)</span>dbconnect<span class="opt">, </span>SQL_NTS<span class="opt">, </span>NULL<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="num">0</span><span class="opt">, </span>NULL<span class="opt">, </span>SQL_DRIVER_NOPROMPT<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="com">/* use explicit commit */</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLSetConnectAttr</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>dbc<span class="opt">, </span>SQL_AUTOCOMMIT<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                       <span class="opt">(</span>SQLPOINTER<span class="opt">)</span>SQL_AUTOCOMMIT_OFF<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                       SQL_IS_INTEGER<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLAllocHandle</span><span class="opt">(</span>SQL_HANDLE_STMT<span class="opt">, </span>conn<span class="opt">-&gt;</span>dbc<span class="opt">, &amp;</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3i0nme-6-u1" href="#NW0-oxKEH-1" id="NW0-3i0nme-6-u1"><i>&lt;Return converted ODBC error&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">close_db</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLCancel</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLFreeHandle</span><span class="opt">(</span>SQL_HANDLE_STMT<span class="opt">, </span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>dbc<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLEndTran</span><span class="opt">(</span>SQL_HANDLE_DBC<span class="opt">, </span>conn<span class="opt">-&gt;</span>dbc<span class="opt">, </span>SQL_ROLLBACK<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">SQLFreeHandle</span><span class="opt">(</span>SQL_HANDLE_DBC<span class="opt">, </span>conn<span class="opt">-&gt;</span>dbc<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">memset</span><span class="opt">(</span>conn<span class="opt">, </span><span class="num">0</span><span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(*</span>conn<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>ODBC has its own error reporting mechanism. Errors are not accumulated between calls; instead they are stored in the various handles. Fortunately, there is no need to explicitly free them. A function is required to gather all the parts of the message together, though. Some versions of unixODBC crash when retrieving anything but the first message when used with sqliteodbc. Since I can't research what versions may cause problems, the loop is stopped after the first iteration with any unixODBC version.</p>
  <pre class="dfn">
<a name="NW0-3i0nme-7" href="#NW0-3i0nme-1" id="NW0-3i0nme-7"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-6">&lt;-</a>D<a href="#NW0-3i0nme-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">odbc_msg</span><span class="opt">(</span><span class="kwb">SQLSMALLINT </span>htype<span class="opt">, </span><span class="kwb">SQLHANDLE </span>h<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret <span class="opt">= </span>SQL_SUCCESS<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">static pthread_mutex_t </span>lock <span class="opt">= </span>PTHREAD_MUTEX_INITIALIZER<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">static </span>SQLCHAR state<span class="opt">[</span><span class="num">7</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLINTEGER </span>rc<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">static </span>SQLCHAR msg<span class="opt">[</span><span class="num">1024</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLSMALLINT </span>len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>i<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">pthread_mutex_lock</span><span class="opt">(&amp;</span>lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>i <span class="opt">= </span><span class="num">1</span><span class="opt">; </span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">); </span>i<span class="opt">++) {</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLGetDiagRec</span><span class="opt">(</span>htype<span class="opt">, </span>h<span class="opt">, </span>i<span class="opt">, </span>state<span class="opt">, &amp;</span>rc<span class="opt">, </span>msg<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>msg<span class="opt">), &amp;</span>len<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span>nerr <span class="opt">== </span>STATUS_OK ?
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">nerr_raise</span><span class="opt">(</span>GENERIC_ERR<span class="opt">, </span><span class="str">"ODBC[%d-%s]: %s"</span><span class="opt">, </span>rc<span class="opt">, </span>state<span class="opt">, </span>msg<span class="opt">) :</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">nerr_pass_ctx</span><span class="opt">(</span>nerr<span class="opt">, </span><span class="str">"ODBC[%d-%s]: %s"</span><span class="opt">, </span>rc<span class="opt">, </span>state<span class="opt">, </span>msg<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#ifdef SQL_ATTR_UNIXODBC_VERSION</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">pthread_mutex_unlock</span><span class="opt">(&amp;</span>lock<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">nerr_raise</span><span class="opt">(</span>GENERIC_ERR<span class="opt">, </span><span class="str">"Unknown ODBC error"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-yctzv-4" href="#NW0-yctzv-1" id="NW0-yctzv-4"><dfn>&lt;Database Support Definitions&gt;+=</dfn></a> <b>(<a href="#NW0-3pmRHJ-1">&lt;-U</a>)</b> <b>[<a href="#NW0-yctzv-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#define db_err(dbcerr) nerr_pass(odbc_msg(dbcerr ? SQL_HANDLE_DBC : \</span>
</pre>
      </li>

      <li>
        <pre>
                                                   SQL_HANDLE_STMT<span class="opt">, </span>\
</pre>
      </li>

      <li>
        <pre>
                                          dbcerr ? conn<span class="opt">-&gt;</span>dbc <span class="opt">: </span>conn<span class="opt">-&gt;</span>stmt<span class="opt">))</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3a9iNE-8" href="#NW0-3a9iNE-1" id="NW0-3a9iNE-8"><dfn>&lt;(build.nw) C Prototypes&gt;+=</dfn></a> <b>[<a href="#NW0-3a9iNE-7">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">db_err</span><span class="opt">(</span><span class="kwb">gboolean </span>dbcerr<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4Embk6-1" href="#NW0-4Embk6-1" id="NW0-4Embk6-1"><dfn>&lt;Ignore ODBC <code>ret</code>&gt;=</dfn></a> <b>(<a href="#NW0-2JwojC-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
ret <span class="opt">= </span>SQL_SUCCESS<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1GLJEI-1" href="#NW0-1GLJEI-1" id="NW0-1GLJEI-1"><dfn>&lt;Print ODBC env error&gt;=</dfn></a> <b>(<a href="#NW0-2JwojC-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">nerr_pass</span><span class="opt">(</span><span class="kwd">odbc_msg</span><span class="opt">(</span>SQL_HANDLE_ENV<span class="opt">, </span>henv<span class="opt">)));</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-oxKEH-1" href="#NW0-oxKEH-1" id="NW0-oxKEH-1"><dfn>&lt;Return converted ODBC error&gt;=</dfn></a> <b>(<a href="#NW0-3i0nme-6">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">return </span><span class="kwd">db_err</span><span class="opt">(!</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3qySoB-1" href="#NW0-3qySoB-1" id="NW0-3qySoB-1"><dfn>&lt;Set <code>nerr</code> for ODBC error&gt;=</dfn></a> <b>(<a href="#NW0-3i0nme-1">&lt;-U</a> <a href="#NW0-3i0nme-2">&lt;-U</a> <a href="#NW0-3i0nme-3">&lt;-U</a> <a href="#NW0-3fkJDU-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">db_err</span><span class="opt">(</span>dbcerr<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In addition to calling the initialization functions, the individual session operations must be defined and overridden. If they are already overridden, the session initialization does nothing.</p>
  <pre class="dfn">
<a name="NW0-3i0nme-8" href="#NW0-3i0nme-1" id="NW0-3i0nme-8"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-7">&lt;-</a>D<a href="#NW0-3i0nme-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">db_create_session</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3i0nme-8-u1" href="#NW0-3fkJDU-1" id="NW0-3i0nme-8-u1"><i>&lt;Create session using database&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">db_read_session</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>child<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                               <span class="kwb">HDF </span><span class="opt">*</span>target<span class="opt">, </span><span class="kwb">gboolean </span>recursive<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                               <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3i0nme-8-u2" href="#NW0-3wZNGL-1" id="NW0-3i0nme-8-u2"><i>&lt;Read session using database&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">db_update_session</span><span class="opt">(</span><span class="kwb">const char </span><span class="opt">*</span>root_name<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>root<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                 <span class="kwb">HDF </span><span class="opt">**</span>unique_root<span class="opt">, </span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3i0nme-8-u3" href="#NW0-INLJQ-1" id="NW0-3i0nme-8-u3"><i>&lt;Update session using database&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ixk5s-5" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-5"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-4">&lt;-</a>D<a href="#NW0-2ixk5s-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static cgi_cleanup_cb </span>prev_cleanup<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-9" href="#NW0-3i0nme-1" id="NW0-3i0nme-9"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-8">&lt;-</a>D<a href="#NW0-3i0nme-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">prepare_db_session</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>henv <span class="opt">!= </span>SQL_NULL_HENV <span class="opt">&amp;&amp; !</span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    cgi_state<span class="opt">-&gt;</span>session_cb_data <span class="opt">= </span><span class="kwd">calloc</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span><span class="kwb">db_conn</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_errno</span><span class="opt">(</span>NERR_NOMEM<span class="opt">, </span><span class="str">"Session support"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">open_db</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>create_session <span class="opt">= </span>db_create_session<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>read_session <span class="opt">= </span>db_read_session<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>update_session <span class="opt">= </span>db_update_session<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      prev_cleanup <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>cleanup<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>cleanup <span class="opt">= </span>finish_db_session<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">close_db</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">free</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      cgi_state<span class="opt">-&gt;</span>session_cb_data <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-A" href="#NW0-3i0nme-1" id="NW0-3i0nme-A"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-9">&lt;-</a>D<a href="#NW0-3i0nme-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">finish_db_session</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">close_db</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>create_session <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>read_session <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>update_session <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>session_cb_data <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>prev_cleanup<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">(*</span>prev_cleanup<span class="opt">)(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>A session is created by adding a new child of the root, and relying on the uniqueness constraint on the name to ensure that a unique name is generated. This is done by updating the name to a new random name until the uniqueness constraint has been satisfied. Session names are similar to the file mode: a date stamp followed by a few random printable characters. There is no need to put a great deal of effort into making this secure; the GLib thread-safe global random number generator is used for this.</p>
  <pre class="dfn">
<a name="NW0-3K4jCX-1" href="#NW0-3K4jCX-1" id="NW0-3K4jCX-1"><dfn>&lt;CGI Database Session Parameters&gt;=</dfn></a> <b>(<a href="#NW0-yctzv-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">guint64 </span>root_id<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3fkJDU-1" href="#NW0-3fkJDU-1" id="NW0-3fkJDU-1"><dfn>&lt;Create session using database&gt;=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[D<a href="#NW0-3fkJDU-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span>sessid<span class="opt">[</span><span class="num">2</span><span class="opt">+</span><span class="num">8</span><span class="opt">+</span><span class="num">6</span><span class="opt">+</span><span class="num">1</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">guint64 </span>newid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">db_conn </span><span class="opt">*</span>conn <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">gboolean </span>dbcerr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">create_sessval</span><span class="opt">(</span>conn<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>NULL<span class="opt">, </span>NULL<span class="opt">, &amp;</span>newid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>i<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">time_t </span>now<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">time</span><span class="opt">(&amp;</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">sprintf</span><span class="opt">(</span>sessid<span class="opt">, </span><span class="str">"CS%08X"</span><span class="opt">, (</span><span class="kwb">int</span><span class="opt">)</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>i <span class="opt">= </span><span class="num">0</span><span class="opt">; </span>i <span class="opt">&lt; </span><span class="num">6</span><span class="opt">; </span>i<span class="opt">++) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">do </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
      c <span class="opt">= </span><span class="kwd">g_random_int_range</span><span class="opt">(</span><span class="num">48</span><span class="opt">, </span><span class="num">122</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">while</span><span class="opt">(!</span><span class="kwd">isalnum</span><span class="opt">(</span>c<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    sessid<span class="opt">[</span>i <span class="opt">+ </span><span class="num">10</span><span class="opt">] = </span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  sessid<span class="opt">[</span><span class="num">16</span><span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"update sessval set name = ? where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">db_err</span><span class="opt">(</span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>sessid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>newid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">char </span>code<span class="opt">[</span><span class="num">7</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="kwd">SQLGetDiagField</span><span class="opt">(</span>SQL_HANDLE_STMT<span class="opt">, </span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_DIAG_SQLSTATE<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                       code<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>code<span class="opt">), </span>NULL<span class="opt">) == </span>SQL_SUCCESS <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="opt">!</span><span class="kwd">strcmp</span><span class="opt">(</span>code<span class="opt">, </span><span class="str">"23000"</span><span class="opt">)) { </span><span class="com">/* 23000 == integrity constraint */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-3fkJDU-1-u1" href="#NW0-3qySoB-1" id="NW0-3fkJDU-1-u1"><i>&lt;Set <code>nerr</code> for ODBC error&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
conn<span class="opt">-&gt;</span>root_id <span class="opt">= </span>newid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
cgi_state<span class="opt">-&gt;</span>sessionid <span class="opt">= </span><span class="kwd">g_strdup</span><span class="opt">(</span>sessid<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Rather than always using the sesion name to find an ID, the root is stored in the state as soon as it is known. If the session is newly created, it is known after creation. Otherwise, it needs to be queried.</p>
  <pre class="dfn">
<a name="NW0-2ixk5s-6" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-6"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-5">&lt;-</a>D<a href="#NW0-2ixk5s-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">set_root_id</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>root_id<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"select id from sessval where name = ? and parent = 1"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>conn<span class="opt">-&gt;</span>root_id<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                     <span class="kwa">sizeof</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>root_id<span class="opt">), </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">) </span>? STATUS_OK <span class="opt">: </span><span class="kwd">db_err</span><span class="opt">(</span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3wZNGL-1" href="#NW0-3wZNGL-1" id="NW0-3wZNGL-1"><dfn>&lt;Read session using database&gt;=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[D<a href="#NW0-3wZNGL-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">db_conn </span><span class="opt">*</span>conn <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">set_root_id</span><span class="opt">(</span>conn<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-INLJQ-1" href="#NW0-INLJQ-1" id="NW0-INLJQ-1"><dfn>&lt;Update session using database&gt;=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[D<a href="#NW0-INLJQ-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">db_conn </span><span class="opt">*</span>conn <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>session_cb_data<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">set_root_id</span><span class="opt">(</span>conn<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>root<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Reading a value from the session requires following the hierarchical path. When searching for a single value, no recursion is necessary. If only a partial path is found, and the remander should still be created, <code>partial</code> can be non-NULL to point to what still needs to be created. Otherwise, a zero <code>id</code> indicates that it was not found.</p>
  <pre class="dfn">
<a name="NW0-2ixk5s-7" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-7"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-6">&lt;-</a>D<a href="#NW0-2ixk5s-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">db_nodeid</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">guint64 </span>root<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                         <span class="kwb">guint64 </span><span class="opt">*</span>id<span class="opt">, </span><span class="kwb">const char </span><span class="opt">**</span>partial<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>s<span class="opt">, *</span>e<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>modname<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>id <span class="opt">= </span>root<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>name <span class="opt">|| !*</span>name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>name <span class="opt">== </span><span class="str">'.'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid node name"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  modname <span class="opt">= </span>s <span class="opt">= </span><span class="kwd">strdup</span><span class="opt">(</span>name<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>modname<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"No memory for scan"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    e <span class="opt">= </span><span class="kwd">strchr</span><span class="opt">(</span>s<span class="opt">, </span><span class="str">'.'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>e<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">*</span>e <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"select id from sessval where parent = ? and name = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, *</span>id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, </span>id<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(*</span>id<span class="opt">), </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else if</span><span class="opt">(</span>ret <span class="opt">== </span>SQL_NO_DATA<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>partial<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>partial <span class="opt">= </span>name <span class="opt">+ (</span><span class="kwb">int</span><span class="opt">)(</span>s <span class="opt">- </span>modname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">*</span>id <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">free</span><span class="opt">(</span>modname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span><span class="kwd">db_err</span><span class="opt">(</span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">free</span><span class="opt">(</span>modname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>e<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span>e <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!*</span>s <span class="opt">|| *</span>s <span class="opt">== </span><span class="str">'.'</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">free</span><span class="opt">(</span>modname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span><span class="kwd">nerr_raise_msg</span><span class="opt">(</span><span class="str">"Invalid node name"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>modname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Immediate recursion is not possible when sharing a single statement handle, so recursion is done by following the HDF after reading. The HDF routines will be allocating strings and other information anyway, so only a single shared buffer is used to read the values. Each call reads only a single value and the names of all of the children. In order to emulate the non-recursive read mode, a counter is passed in to indicate the maximum recursion depth, if non-negative.</p>
  <pre class="dfn">
<a name="NW0-2ixk5s-8" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-8"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-7">&lt;-</a>D<a href="#NW0-2ixk5s-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">db_readtree</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">guint64 </span>root<span class="opt">, </span><span class="kwb">const char </span><span class="opt">*</span>name<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="kwb">HDF </span><span class="opt">*</span>hdf<span class="opt">, </span><span class="kwb">int </span>recurse<span class="opt">, </span><span class="kwb">GString </span><span class="opt">**</span>_buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GString </span><span class="opt">*</span>buf <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>name<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">db_nodeid</span><span class="opt">(</span>conn<span class="opt">, </span>root<span class="opt">, </span>name<span class="opt">, &amp;</span>root<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK <span class="opt">|| !</span>root<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>_buf<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    _buf <span class="opt">= &amp;</span>buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    buf <span class="opt">= </span><span class="kwd">g_string_sized_new</span><span class="opt">(</span><span class="num">80</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2ixk5s-8-u1" href="#NW0-moSh3-1" id="NW0-2ixk5s-8-u1"><i>&lt;Set <code>hdf</code>'s value from database&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>recurse<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2ixk5s-8-u2" href="#NW0-2zTsea-1" id="NW0-2ixk5s-8-u2"><i>&lt;Insert children of <code>hdf</code> from database&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-B" href="#NW0-3i0nme-1" id="NW0-3i0nme-B"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-A">&lt;-</a>D<a href="#NW0-3i0nme-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">SQLRETURN </span><span class="kwd">SQLGetGString</span><span class="opt">(</span>HSTMT <span class="opt">*</span>stmt<span class="opt">, </span><span class="kwb">int </span>pno<span class="opt">, </span><span class="kwb">GString </span><span class="opt">*</span>buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLLEN </span>lenret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_CHAR<span class="opt">, </span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span>buf<span class="opt">-&gt;</span>len<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                   buf<span class="opt">-&gt;</span>allocated_len <span class="opt">- </span>buf<span class="opt">-&gt;</span>len<span class="opt">, &amp;</span>lenret<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>lenret <span class="opt">!= </span>SQL_NULL_DATA<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>lenret <span class="opt">+ </span>buf<span class="opt">-&gt;</span>len <span class="opt">&gt; </span>buf<span class="opt">-&gt;</span>allocated_len <span class="opt">- </span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">int </span>olen <span class="opt">= </span>buf<span class="opt">-&gt;</span>allocated_len <span class="opt">- </span><span class="num">1 </span><span class="opt">- </span>buf<span class="opt">-&gt;</span>len<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_set_size</span><span class="opt">(</span>buf<span class="opt">, </span>lenret <span class="opt">+ </span>buf<span class="opt">-&gt;</span>len <span class="opt">+ </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_CHAR<span class="opt">, </span>buf<span class="opt">-&gt;</span>str <span class="opt">+ </span>olen<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                       buf<span class="opt">-&gt;</span>allocated_len <span class="opt">- </span>olen<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    buf<span class="opt">-&gt;</span>len <span class="opt">+= </span>lenret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>SQL_SUCCESS<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-moSh3-1" href="#NW0-moSh3-1" id="NW0-moSh3-1"><dfn>&lt;Set <code>hdf</code>'s value from database&gt;=</dfn></a> <b>(<a href="#NW0-2ixk5s-8">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"select value, valext from sessval where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>extid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLLEN </span>lenret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_truncate</span><span class="opt">(*</span>_buf<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLGetGString</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, *</span>_buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">2</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>extid<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>extid<span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
                     <span class="opt">&amp;</span>lenret<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">) &amp;&amp; </span>lenret <span class="opt">!= </span>SQL_NULL_DATA<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"select value, ext from sessvalext where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>extid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLGetGString</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, *</span>_buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">2</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>extid<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>extid<span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
                         <span class="opt">&amp;</span>lenret<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">db_err</span><span class="opt">(</span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else if</span><span class="opt">((*</span>_buf<span class="opt">)-&gt;</span>len<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">hdf_set_value</span><span class="opt">(</span>hdf<span class="opt">, </span>NULL<span class="opt">, (*</span>_buf<span class="opt">)-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>ret <span class="opt">!= </span>SQL_NO_DATA<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">db_err</span><span class="opt">(</span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2zTsea-1" href="#NW0-2zTsea-1" id="NW0-2zTsea-1"><dfn>&lt;Insert children of <code>hdf</code> from database&gt;=</dfn></a> <b>(<a href="#NW0-2ixk5s-8">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>c<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"select name from sessval where parent = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">== </span>SQL_NO_DATA<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span>SQL_SUCCESS<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_truncate</span><span class="opt">(*</span>_buf<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLGetGString</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, *</span>_buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">hdf_get_node</span><span class="opt">(</span>hdf<span class="opt">, (*</span>_buf<span class="opt">)-&gt;</span>str<span class="opt">, &amp;</span>c<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">db_err</span><span class="opt">(</span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for</span><span class="opt">(</span>c <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>hdf<span class="opt">); </span>c<span class="opt">; </span>c <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>c<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_readtree</span><span class="opt">(</span>conn<span class="opt">, </span>root<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>c<span class="opt">), </span>c<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
              recurse <span class="opt">&gt; </span><span class="num">0 </span>? recurse <span class="opt">- </span><span class="num">1 </span><span class="opt">: </span>recurse<span class="opt">, </span>_buf<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Since the wrapper already clears the HDF as needed, the reader now only needs to call the recursive function to read the database.</p>
  <pre class="dfn">
<a name="NW0-3wZNGL-2" href="#NW0-3wZNGL-1" id="NW0-3wZNGL-2"><dfn>&lt;Read session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-3wZNGL-1">&lt;-</a>D<a href="#NW0-3wZNGL-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">guint64 </span>root_id <span class="opt">= </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>child<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">db_nodeid</span><span class="opt">(</span>conn<span class="opt">, </span>root_id<span class="opt">, </span>name<span class="opt">, &amp;</span>root_id<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK <span class="opt">|| !</span>root_id<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  name <span class="opt">= </span>child<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">db_readtree</span><span class="opt">(</span>conn<span class="opt">, </span>root_id<span class="opt">, </span>name<span class="opt">, </span>target<span class="opt">, </span>recursive ? <span class="opt">-</span><span class="num">1 </span><span class="opt">: </span><span class="num">1</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  cgi_state<span class="opt">-&gt;</span>session <span class="opt">= </span>target<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_printf</span><span class="opt">(</span><span class="str">"&lt;pre&gt;Read Session %s:</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>name ? name <span class="opt">: </span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">STRING </span>ps<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">string_init</span><span class="opt">(&amp;</span>ps<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">hdf_dump_str</span><span class="opt">(</span>target<span class="opt">, </span><span class="str">""</span><span class="opt">, </span><span class="num">2</span><span class="opt">, &amp;</span>ps<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>ps<span class="opt">.</span>buf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>ps<span class="opt">.</span>buf<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">string_clear</span><span class="opt">(&amp;</span>ps<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"--------</span><span class="esc">\n</span><span class="str">&lt;/pre&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Updating consists both of inserting new values and removing old values. The simpler of the two is removal, so that is covered first. With cascade deletes, no recursion is necessary. Since cascade deletes cannot be guaranteed, the deletion function recurses by reading an array of child IDs from the database, and then deleting those before trying to delete the current node. It first changes the name of the node being operated on to avoid additional nodes being created mid-operation. This still isn't guaranteed to work; this code will always have a small race condition when deleting nodes. For a small potential relief of this, the node is renamed before deletion. Its ID could still already be read into another process, though, so this is not a complete cure.</p>
  <pre class="dfn">
<a name="NW0-B9EcR-2" href="#NW0-B9EcR-1" id="NW0-B9EcR-2"><dfn>&lt;CGI Database Session Support Configuration&gt;+=</dfn></a> <b>(<a href="#NW0-3Zp9uJ-1">U-&gt;</a> <a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[<a href="#NW0-B9EcR-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Set to non-blank if the CGI session table supports cascading deletes</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#dbcascade =</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ixk5s-9" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-9"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-8">&lt;-</a>D<a href="#NW0-2ixk5s-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static gboolean </span>dbcascade <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2JwojC-2" href="#NW0-2JwojC-1" id="NW0-2JwojC-2"><dfn>&lt;Set up database connection&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-5">&lt;-U</a>)</b> <b>[<a href="#NW0-2JwojC-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(*</span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"dbcascade"</span><span class="opt">, </span><span class="str">""</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  dbcascade <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ixk5s-A" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-A"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-9">&lt;-</a>D<a href="#NW0-2ixk5s-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">destroy_node</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">guint64 </span>root_id<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>dbcerr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>did_delete<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>dbcascade<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="com">/* rename to reduce chance of problems (ignore error) */</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">char </span>tname<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">sprintf</span><span class="opt">(</span>tname<span class="opt">, </span><span class="str">".%llu"</span><span class="opt">, (</span><span class="kwb">ullong</span><span class="opt">)</span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"update sessval set name = ? where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>tname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">()</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"delete from sessval where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>dbcascade<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      did_delete <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>dbcascade<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span><span class="kwd">db_err</span><span class="opt">(</span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"delete from sessvalext where parent = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">GArray </span><span class="opt">*</span>children <span class="opt">= </span><span class="kwd">g_array_new</span><span class="opt">(</span>FALSE<span class="opt">, </span>FALSE<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span><span class="kwb">guint64</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"select id from sessval where parent = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">guint64 </span>cid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(</span>ret <span class="opt">== </span>SQL_NO_DATA<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          ret <span class="opt">= </span>SQL_SUCCESS<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        ret <span class="opt">= </span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>cid<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>cid<span class="opt">), </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">g_array_append_val</span><span class="opt">(</span>children<span class="opt">, </span>cid<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span>children<span class="opt">-&gt;</span>len<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span><span class="kwd">g_array_index</span><span class="opt">(</span>children<span class="opt">, </span><span class="kwb">guint64</span><span class="opt">, </span>children<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_array_remove_index</span><span class="opt">(</span>children<span class="opt">, </span>children<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_array_free</span><span class="opt">(</span>children<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>did_delete<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-INLJQ-2" href="#NW0-INLJQ-1" id="NW0-INLJQ-2"><dfn>&lt;Update session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-INLJQ-1">&lt;-</a>D<a href="#NW0-INLJQ-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>root<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>root_id<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">db_nodeid</span><span class="opt">(</span>conn<span class="opt">, </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">, </span>root_name<span class="opt">, &amp;</span>root_id<span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK <span class="opt">|| !</span>root_id<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Inserting requires deleting first as well, but first the root node for insertion must be found and possibly created. This creates another race condition wherein other readers may try to read an incomplete entry. This race condition is alleviated by using a temporary name for the new node(s), and even parenting it to one, until it is ready to be linked into the whole. Any unneeded new nodes after all have been inserted can simply be deleted. As a shortcut, an attempt is made to directly update a node without children; if this fails, then the long-form insertion procedure is followed.</p>
  <pre class="dfn">
<a name="NW0-INLJQ-3" href="#NW0-INLJQ-1" id="NW0-INLJQ-3"><dfn>&lt;Update session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-INLJQ-2">&lt;-</a>D<a href="#NW0-INLJQ-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>root<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>udn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLLEN </span>nrows<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>val <span class="opt">= </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>val <span class="opt">&amp;&amp; !*</span>val<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    val <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">((!</span>val <span class="opt">|| </span><span class="kwd">strlen</span><span class="opt">(</span>val<span class="opt">) &lt;= </span>sessval_length<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">db_nodeid</span><span class="opt">(</span>conn<span class="opt">, </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">, </span>root_name<span class="opt">, &amp;</span>udn<span class="opt">, </span>NULL<span class="opt">)) &amp;&amp; </span>udn<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"delete from sessvalext where parent = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>udn<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"update sessval set value = ? where id = ? and name = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>udn<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      val <span class="opt">= </span><span class="kwd">strrchr</span><span class="opt">(</span>root_name<span class="opt">, </span><span class="str">'.'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>val<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        val <span class="opt">= </span>root_name<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
        val <span class="opt">= </span>val <span class="opt">+ </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">3</span><span class="opt">, </span>val<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       <span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span><span class="kwd">SQLRowCount</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, &amp;</span>nrows<span class="opt">)) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
       nrows <span class="opt">== </span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_trans</span><span class="opt">(</span>SQL_COMMIT<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The top node is the only one that is treated specially; all others can be inserted below it recursively without worrying about anything being yanked out in mid-stream. If the insertion point is the root node, a new session is being created, so there is also no need for any extra hoop jumping.</p>
  <pre class="dfn">
<a name="NW0-2ixk5s-B" href="#NW0-2ixk5s-1" id="NW0-2ixk5s-B"><dfn>&lt;CGI Database Session Variables&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2ixk5s-A">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">insert_children</span><span class="opt">(</span><span class="kwb">db_conn </span><span class="opt">*</span>conn<span class="opt">, </span><span class="kwb">guint64 </span>id<span class="opt">, </span><span class="kwb">HDF </span><span class="opt">*</span>hdf<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>cid<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>hdf <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>hdf<span class="opt">); </span>hdf<span class="opt">; </span>hdf <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>hdf<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">create_sessval</span><span class="opt">(</span>conn<span class="opt">, </span>id<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>hdf<span class="opt">), </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>hdf<span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="opt">&amp;</span>cid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>hdf<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      nerr <span class="opt">= </span><span class="kwd">insert_children</span><span class="opt">(</span>conn<span class="opt">, </span>cid<span class="opt">, </span>hdf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-INLJQ-4" href="#NW0-INLJQ-1" id="NW0-INLJQ-4"><dfn>&lt;Update session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-INLJQ-3">&lt;-</a>D<a href="#NW0-INLJQ-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">guint64 </span>inserted_vals<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>root_name<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">create_sessval</span><span class="opt">(</span>conn<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>NULL<span class="opt">, </span><span class="kwd">hdf_obj_value</span><span class="opt">(</span>root<span class="opt">), &amp;</span>inserted_vals<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  inserted_vals <span class="opt">= </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">insert_children</span><span class="opt">(</span>conn<span class="opt">, </span>inserted_vals<span class="opt">, </span>root<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr2 <span class="opt">= </span><span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span>inserted_vals<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr2<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>root_name<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3fkJDU-2" href="#NW0-3fkJDU-1" id="NW0-3fkJDU-2"><dfn>&lt;Create session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-3fkJDU-1">&lt;-</a>D<a href="#NW0-3fkJDU-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">insert_children</span><span class="opt">(</span>conn<span class="opt">, </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>session<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr2 <span class="opt">= </span><span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr2<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The actual insertion is done by scanning for the insertion point, and inserting. This leaves open a race where a hierarchy could be in the process of being deleted as it is scanned; this is bypassed by placing the scan in a loop and ensuring that the name does not change while it is being updated.</p>
  <pre class="dfn">
<a name="NW0-INLJQ-5" href="#NW0-INLJQ-1" id="NW0-INLJQ-5"><dfn>&lt;Update session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-INLJQ-4">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>buf <span class="opt">= </span><span class="kwd">g_string_sized_new</span><span class="opt">(</span><span class="num">80</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">guint64 </span>lastroot<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>createstr<span class="opt">, *</span>s <span class="opt">= </span>NULL<span class="opt">, *</span>e<span class="opt">; </span><span class="com">/* s init to shut gcc up */</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>dbcerr <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">db_nodeid</span><span class="opt">(</span>conn<span class="opt">, </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">, </span>root_name<span class="opt">, &amp;</span>lastroot<span class="opt">, &amp;</span>createstr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">NEOERR </span><span class="opt">*</span>nerr2 <span class="opt">= </span><span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span>inserted_vals<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr2<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>createstr <span class="opt">&amp;&amp; !</span>unique_root<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span>lastroot<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>createstr<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>s <span class="opt">= </span>createstr<span class="opt">; (</span>e <span class="opt">= </span><span class="kwd">strchr</span><span class="opt">(</span>s<span class="opt">, </span><span class="str">'.'</span><span class="opt">)); </span>s <span class="opt">= </span>e <span class="opt">+ </span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_truncate</span><span class="opt">(</span>buf<span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">g_string_append_len</span><span class="opt">(</span>buf<span class="opt">, </span>s<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)(</span>e <span class="opt">- </span>s<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">create_sessval</span><span class="opt">(</span>conn<span class="opt">, </span>lastroot<span class="opt">, </span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span>NULL<span class="opt">, &amp;</span>lastroot<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>unique_root<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">create_sessval</span><span class="opt">(</span>conn<span class="opt">, </span>lastroot<span class="opt">, </span>s<span class="opt">, </span>NULL<span class="opt">, &amp;</span>lastroot<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>unbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; </span>unique_root<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">sprintf</span><span class="opt">(</span>unbuf<span class="opt">, </span><span class="str">"%llu"</span><span class="opt">, (</span><span class="kwb">ullong</span><span class="opt">)</span>inserted_vals<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    s <span class="opt">= </span>unbuf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"update sessval set parent = ? where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>lastroot<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>inserted_vals<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"update sessval set name = ? where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_binds</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>inserted_vals<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">db_commit</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">SQLEndTran</span><span class="opt">(</span>SQL_HANDLE_DBC<span class="opt">, </span>conn<span class="opt">-&gt;</span>dbc<span class="opt">, </span>SQL_ROLLBACK<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">sleep</span><span class="opt">(</span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Like almost everything else, cleaning up old sessions is much harder than with the simple files. The expiration date needs to be stored somewhere, for one. The value for the session root is a convenient, currently unused spot. The database itself cannot be relied upon to do proper date translation, so all operations with this date stamp must use the raw number of seconds since the UNIX epoch. Since the root session is always read before updating, only root reads and creates will update this timestamp.</p>
  <pre class="dfn">
<a name="NW0-3wZNGL-3" href="#NW0-3wZNGL-1" id="NW0-3wZNGL-3"><dfn>&lt;Read session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-3wZNGL-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>name <span class="opt">&amp;&amp; </span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3wZNGL-3-u1" href="#NW0-1HNny-1" id="NW0-3wZNGL-3-u1"><i>&lt;Update root timestamp in database&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3fkJDU-3" href="#NW0-3fkJDU-1" id="NW0-3fkJDU-3"><dfn>&lt;Create session using database&gt;+=</dfn></a> <b>(<a href="#NW0-3i0nme-8">&lt;-U</a>)</b> <b>[<a href="#NW0-3fkJDU-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-3fkJDU-3-u1" href="#NW0-1HNny-1" id="NW0-3fkJDU-3-u1"><i>&lt;Update root timestamp in database&gt;</i></a></span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1HNny-1" href="#NW0-1HNny-1" id="NW0-1HNny-1"><dfn>&lt;Update root timestamp in database&gt;=</dfn></a> <b>(<a href="#NW0-3wZNGL-3">&lt;-U</a> <a href="#NW0-3fkJDU-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">guint64 </span>tval<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">time_t </span>now<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">time</span><span class="opt">(&amp;</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
tval <span class="opt">= (</span><span class="kwb">guint64</span><span class="opt">)</span>now<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span><span class="str">"update sessval set value = ? where id = ?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>tval<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">2</span><span class="opt">, </span>conn<span class="opt">-&gt;</span>root_id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
  ret <span class="opt">= </span><span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">db_trans</span><span class="opt">(</span>SQL_COMMIT<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>To clean up then, is to search for root nodes with an old timestamp. Root nodes without any timestamp may be left-over garbage as well, so if these are found two scans in a row, they are removed as well. It is still possible that two scans complete before a temporary node is used correctly, but it is sufficiently unlikely that no additional effort will be made to correct this race condition.</p>
  <pre class="dfn">
<a name="NW0-2uk6GO-2" href="#NW0-2uk6GO-1" id="NW0-2uk6GO-2"><dfn>&lt;(build.nw) C Executables&gt;+=</dfn></a> <b>[<a href="#NW0-2uk6GO-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
delete_old_db_sessions \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2Zonth-1" href="#NW0-2Zonth-1" id="NW0-2Zonth-1"><dfn>&lt;delete_old_db_sessions.c&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-2Zonth-1-u1" href="#nw@notdef" id="NW0-2Zonth-1-u1"><i>&lt;(build.nw) Common C Header&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>config_root <span class="opt">= </span><span class="str">"/etc"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>config_path <span class="opt">= </span><span class="str">"db_session.conf"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2Zonth-1-u2" href="#nw@notdef" id="NW0-2Zonth-1-u2"><i>&lt;(cs-glib.nw) Help Function&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">SQLHENV </span>henv<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>dbconnect<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">main</span><span class="opt">(</span><span class="kwb">int </span>argc<span class="opt">, </span><span class="kwb">const char </span><span class="opt">**</span>argv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2Zonth-1-u3" href="#nw@notdef" id="NW0-2Zonth-1-u3"><i>&lt;(cs-glib.nw) Common Mainline Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2Zonth-1-u4" href="#nw@notdef" id="NW0-2Zonth-1-u4"><i>&lt;(cs-glib.nw) Read configuration&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">clean_db_sessions</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1cQCKd-1" href="#NW0-1cQCKd-1" id="NW0-1cQCKd-1"><dfn>&lt;<code>delete_old_db_sessions</code> Description&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
Keep session table clean
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3Zp9uJ-1" href="#NW0-3Zp9uJ-1" id="NW0-3Zp9uJ-1"><dfn>&lt;<code>delete_old_db_sessions</code> Configuration&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-3Zp9uJ-1-u1" href="#NW0-B9EcR-1" id="NW0-3Zp9uJ-1-u1"><i>&lt;CGI Database Session Support Configuration&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># How long to wait before next expired session check (seconds)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#clean_interval=60</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># How long to wait before expiring sessions (seconds)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#expire_time=1200</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3i0nme-C" href="#NW0-3i0nme-1" id="NW0-3i0nme-C"><dfn>&lt;CGI Database Session Functions&gt;+=</dfn></a> <b>(<a href="#NW0-2mrnmy-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3i0nme-B">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">clean_db_sessions</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">db_conn </span>_conn<span class="opt">, *</span>conn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">SQLRETURN </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>interval <span class="opt">= </span><span class="kwd">getconf_int</span><span class="opt">(</span><span class="str">"clean_interval"</span><span class="opt">, </span><span class="num">60</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>expire_time <span class="opt">= </span><span class="kwd">getconf_int</span><span class="opt">(</span><span class="str">"expire_time"</span><span class="opt">, </span><span class="num">20</span><span class="opt">*</span><span class="num">60</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GArray </span><span class="opt">*</span>null_ids <span class="opt">= </span>NULL<span class="opt">, *</span>del_ids <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>expire_time <span class="opt">&lt; </span><span class="num">0</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    expire_time <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>interval <span class="opt">&gt; </span>expire_time<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    interval <span class="opt">= </span>expire_time<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>interval <span class="opt">&lt; </span><span class="num">5</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    interval <span class="opt">= </span><span class="num">5</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">init_db_cgi_session</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>henv <span class="opt">== </span>SQL_NULL_HENV<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_msg</span><span class="opt">(</span><span class="str">"Specify a database connection string"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  conn <span class="opt">= &amp;</span>_conn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">memset</span><span class="opt">(</span>conn<span class="opt">, </span><span class="num">0</span><span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(*</span>conn<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">open_db</span><span class="opt">(</span>conn<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GString </span><span class="opt">*</span>query <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_printf</span><span class="opt">(</span>query<span class="opt">, </span><span class="str">"%s from sessval "</span> \
</pre>
      </li>

      <li>
        <pre>
                      <span class="str">"where parent = 1 and id &lt;&gt; 1 and value is not null "</span> \
</pre>
      </li>

      <li>
        <pre>
                        <span class="str">"and cast(value as %s) &lt; ?"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                  dbcascade ? <span class="str">"delete"</span> <span class="opt">: </span><span class="str">"select id"</span><span class="opt">, </span>id_field_type<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="num">1</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">time_t </span>now<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">guint64 </span>exp_ts<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">time</span><span class="opt">(&amp;</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    exp_ts <span class="opt">= </span>now <span class="opt">- </span>expire_time<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_prep</span><span class="opt">(</span>query<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      ret <span class="opt">= </span><span class="kwd">db_bind64</span><span class="opt">(</span><span class="num">1</span><span class="opt">, </span>exp_ts<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">SQLExecute</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span>dbcascade <span class="opt">&amp;&amp; </span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">guint64 </span>id<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>id<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwa">sizeof</span><span class="opt">(</span>id<span class="opt">), </span>NULL<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span>del_ids<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          del_ids <span class="opt">= </span><span class="kwd">g_array_new</span><span class="opt">(</span>FALSE<span class="opt">, </span>FALSE<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span><span class="kwb">guint64</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">g_array_append_val</span><span class="opt">(</span>del_ids<span class="opt">, </span>id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>del_ids<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">while</span><span class="opt">(</span>del_ids<span class="opt">-&gt;</span>len<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
          id <span class="opt">= </span><span class="kwd">g_array_index</span><span class="opt">(</span>del_ids<span class="opt">, </span><span class="kwb">guint64</span><span class="opt">, </span>del_ids<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">g_array_remove_index</span><span class="opt">(</span>del_ids<span class="opt">, </span>del_ids<span class="opt">-&gt;</span>len <span class="opt">- </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          nerr <span class="opt">= </span><span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span>id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    ret <span class="opt">= </span><span class="kwd">db_exec</span><span class="opt">(</span><span class="str">"select id from sessval where parent = 1 and value is null"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span>ret<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">GArray </span><span class="opt">*</span>prev_null_ids <span class="opt">= </span>null_ids<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">guint64 </span>id<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      null_ids <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">while</span><span class="opt">(</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span><span class="kwd">SQLFetch</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">SQL_SUCCEEDED</span><span class="opt">(</span><span class="kwd">SQLGetData</span><span class="opt">(</span>conn<span class="opt">-&gt;</span>stmt<span class="opt">, </span><span class="num">1</span><span class="opt">, </span>SQL_C_UBIGINT<span class="opt">, &amp;</span>id<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                     <span class="kwa">sizeof</span><span class="opt">(</span>id<span class="opt">), </span>NULL<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">if</span><span class="opt">(!</span>null_ids<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
          null_ids <span class="opt">= </span><span class="kwd">g_array_new</span><span class="opt">(</span>FALSE<span class="opt">, </span>FALSE<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span><span class="kwb">guint64</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">g_array_append_val</span><span class="opt">(</span>null_ids<span class="opt">, </span>id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>prev_null_ids <span class="opt">&amp;&amp; </span>null_ids<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">int </span>i<span class="opt">, </span>j<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">for</span><span class="opt">(</span>i <span class="opt">= </span><span class="num">0</span><span class="opt">; </span>i <span class="opt">&lt; </span>null_ids<span class="opt">-&gt;</span>len<span class="opt">; </span>i<span class="opt">++) {</span>
</pre>
      </li>

      <li>
        <pre>
          id <span class="opt">= </span><span class="kwd">g_array_index</span><span class="opt">(</span>null_ids<span class="opt">, </span><span class="kwb">guint64</span><span class="opt">, </span>i<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">for</span><span class="opt">(</span>j <span class="opt">= </span><span class="num">0</span><span class="opt">; </span>j <span class="opt">&lt; </span>prev_null_ids<span class="opt">-&gt;</span>len<span class="opt">; </span>j<span class="opt">++)</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">if</span><span class="opt">(</span>id <span class="opt">== </span><span class="kwd">g_array_index</span><span class="opt">(</span>prev_null_ids<span class="opt">, </span><span class="kwb">guint64</span><span class="opt">, </span>j<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
              nerr <span class="opt">= </span><span class="kwd">destroy_node</span><span class="opt">(</span>conn<span class="opt">, </span>id<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">g_array_remove_index_fast</span><span class="opt">(</span>prev_null_ids<span class="opt">, </span>j<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">g_array_remove_index_fast</span><span class="opt">(</span>null_ids<span class="opt">, </span>i<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
                i<span class="opt">--;</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
            <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span>prev_null_ids<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">g_array_free</span><span class="opt">(</span>prev_null_ids<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">db_next</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">sleep</span><span class="opt">(</span>interval<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc13" id="toc13">CAS Authentication</a></h1>

  <p>The Central Authentication Service (CAS) is in use at Indiana Univeristy for university-wide login. CAS uses a single web server for authentication of other web sites. IU's CAS conforms mostly to version 1 of the protocol<sup><a href="#fn22">22</a></sup>; the only known issue is that the <code>service</code> parameter cannot be URL-encoded. The IU server also takes an additional parameter (<em>cas_svc</em>) to indicate the authentication realm.</p>

  <p>There is an Apache module for CAS authentication, but it shares many of the limitations of CAS itself. The primary limitation is that CAS does not support POST parameters. If authentcation fails during a POST request, all parameters are lost. The CAS module is also marked as deprecated on the official CAS site.</p>

  <p>Instead, code provided here will save the CGI parameters in the session state and restore them when CAS returns. This still loses uploads, as saving the uploaded file in the session state would only work for very small file uploads. Also, clients that issue requests other than GET, HEAD, and POST may be confused by the redirection, so these are not supported, either. However, it does help the most common case. In addition, it is possible to query the status of CAS authentication without forcing the authentication to take place, so that can be used for the unsupported methods and uploads before simply rejecting the request.</p>
  <pre class="dfn">
<a name="NW0-6yJSy-1" href="#NW0-6yJSy-1" id="NW0-6yJSy-1"><dfn>&lt;CAS Support Configuration&gt;=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[D<a href="#NW0-6yJSy-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The CAS server URL; must end in a slash</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># CAS is disabled if this is blank.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#cas_url =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># The CAS service type</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># This is not used if blank</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#cas_svc =</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-wX3Vt-1" href="#NW0-wX3Vt-1" id="NW0-wX3Vt-1"><dfn>&lt;cas.c&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-wX3Vt-1-u1" href="#nw@notdef" id="NW0-wX3Vt-1-u1"><i>&lt;(build.nw) Common C Header&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static const char </span><span class="opt">*</span>cas_url<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static const char </span><span class="opt">*</span>cas_svc<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-wX3Vt-1-u2" href="#NW0-3wu2oE-1" id="NW0-wX3Vt-1-u2"><i>&lt;CAS Support Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-wX3Vt-1-u3" href="#NW0-2We642-1" id="NW0-wX3Vt-1-u3"><i>&lt;CAS Support Functions&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">void </span><span class="kwd">init_cas</span><span class="opt">(</span><span class="kwb">void</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  cas_url <span class="opt">= </span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"cas_url"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cas_url <span class="opt">&amp;&amp; !*</span>cas_url<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cas_url <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cas_url<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    cas_svc <span class="opt">= </span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"cas_svc"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>cas_svc <span class="opt">&amp;&amp; !*</span>cas_svc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      cas_svc <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-wX3Vt-1-u4" href="#NW0-2snMgS-1" id="NW0-wX3Vt-1-u4"><i>&lt;Initialize CAS globals&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">init_cgi_session</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">check_cas</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span><span class="opt">*</span>needs_redirect<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>needs_redirect <span class="opt">= </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wX3Vt-1-u5" href="#NW0-2KBx21-1" id="NW0-wX3Vt-1-u5"><i>&lt;Check CAS credentials and return <code>STATUS_OK</code> if OK&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">cas_redirect</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-wX3Vt-1-u6" href="#NW0-2O9GDs-1" id="NW0-wX3Vt-1-u6"><i>&lt;Redirect to CAS&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NEOERR </span><span class="opt">*</span><span class="kwd">update_cas</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">, </span><span class="kwb">gboolean </span><span class="opt">*</span>did_redirect<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span><span class="kwd">check_cas</span><span class="opt">(</span>cgi_state<span class="opt">, </span>did_redirect<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK <span class="opt">&amp;&amp; *</span>did_redirect<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">cas_redirect</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-E8T1B-4" href="#NW0-E8T1B-1" id="NW0-E8T1B-4"><dfn>&lt;(cs-glib.nw) Library <code>cs-supt</code> Members&gt;+=</dfn></a> <b>[<a href="#NW0-E8T1B-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cas<span class="opt">.</span>o
</pre>
      </li>
    </ol>
  </div>

  <p>To obtain CAS credentials, the CGI application must first obtain a ticket by redirecting the browser to the CAS site, which will then redirect back to the CGI application when credentials are obtained. This cannot be done using <code>wget</code>, <code>curl</code> or something like that from the CGI application, because it relies on cookies in the user's browser to support persistent logins. It also presents a unified login user interface when persistent credentials are not already present. To perform the redirect, the CGI application's URL must be passed to CAS. This is computed using the CGI environment.</p>
  <pre class="dfn">
<a name="NW0-2We642-1" href="#NW0-2We642-1" id="NW0-2We642-1"><dfn>&lt;CAS Support Functions&gt;=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-2We642-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span><span class="kwd">compute_myurl</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GString </span><span class="opt">*</span>buf<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2We642-1-u1" href="#NW0-4ZlaGw-1" id="NW0-2We642-1-u1"><i>&lt;Compute my URL into <code>buf</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>ret <span class="opt">= </span>buf<span class="opt">-&gt;</span>str<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"My URL: "</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>ret<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;br&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>ret<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4ZlaGw-1" href="#NW0-4ZlaGw-1" id="NW0-4ZlaGw-1"><dfn>&lt;Compute my URL into <code>buf</code>&gt;=</dfn></a> <b>(<a href="#NW0-2We642-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-4ZlaGw-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
buf <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.HTTPS"</span><span class="opt">, </span>NULL<span class="opt">) </span>? <span class="str">"https"</span> <span class="opt">: </span><span class="str">"http"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"://"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="kwd">cgi_header_val</span><span class="opt">(</span><span class="str">"Host"</span><span class="opt">, </span><span class="str">"localhost"</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.RequestURI"</span><span class="opt">, </span><span class="str">"/"</span><span class="opt">));</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Since the parameters are saved in the session, the URL passed to CAS has all parameters stripped off.</p>
  <pre class="dfn">
<a name="NW0-4ZlaGw-2" href="#NW0-4ZlaGw-1" id="NW0-4ZlaGw-2"><dfn>&lt;Compute my URL into <code>buf</code>&gt;+=</dfn></a> <b>(<a href="#NW0-2We642-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4ZlaGw-1">&lt;-</a>D<a href="#NW0-4ZlaGw-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>s <span class="opt">= </span><span class="kwd">strchr</span><span class="opt">(</span>buf<span class="opt">-&gt;</span>str<span class="opt">, </span><span class="str">'?'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>s<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*</span>s <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  buf<span class="opt">-&gt;</span>len <span class="opt">= (</span><span class="kwb">int</span><span class="opt">)(</span>s <span class="opt">- </span>buf<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>This is replaced by a pointer to the saved parameters. Parameters are saved in the session under <code>cas_parms</code>, under a unqiue parent name. This is only done if there are any parameters to save, so the existence of the CAS ticket is presumed to mean that this is a return from a parameterless run.</p>
  <pre class="dfn">
<a name="NW0-4ZlaGw-3" href="#NW0-4ZlaGw-1" id="NW0-4ZlaGw-3"><dfn>&lt;Compute my URL into <code>buf</code>&gt;+=</dfn></a> <b>(<a href="#NW0-2We642-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4ZlaGw-2">&lt;-</a>D<a href="#NW0-4ZlaGw-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>pno <span class="opt">= </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"cas.pno"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>pno<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"?cas.pno="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span>pno<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi_parms<span class="opt">) &amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">!</span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"casticket"</span><span class="opt">, </span>NULL<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>pno_obj<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">NEOERR </span><span class="opt">*</span>nerr <span class="opt">= </span><span class="kwd">update_session_state</span><span class="opt">(</span><span class="str">"cas_parms"</span><span class="opt">, </span>cgi_state<span class="opt">-&gt;</span>cgi_parms<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="opt">&amp;</span>pno_obj<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="str">"?cas.pno="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append</span><span class="opt">(</span>buf<span class="opt">, </span><span class="kwd">hdf_obj_name</span><span class="opt">(</span>pno_obj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_destroy</span><span class="opt">(&amp;</span>pno_obj<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else if</span><span class="opt">(</span>debug<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">die_if_err</span><span class="opt">(</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_free</span><span class="opt">(</span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Some requests take parameters from the headers, as well. In particular, conditional requests and range requests are signaled by headers. In order to support these, known relevant headers are stored in the CGI parameters. The request method itself is relevant as well, so it is also stored in the CGI parameters. This means that no like-named CGI parameters may exist, and that the parameter restoration must store the parameters back into the appropriate header HDF parameters. For this purpose, the <code>_HTTP_</code> hierarchy is reserved.</p>
  <pre class="dfn">
<a name="NW0-3wu2oE-1" href="#NW0-3wu2oE-1" id="NW0-3wu2oE-1"><dfn>&lt;CAS Support Variables&gt;=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3wu2oE-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">* </span><span class="kwb">const </span>save_headers<span class="opt">[] = {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3wu2oE-1-u1" href="#NW0-4KmDoT-1" id="NW0-3wu2oE-1-u1"><i>&lt;HTTP Headers to Save on CAS Redirect&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  NULL
</pre>
      </li>

      <li>
        <pre>
<span class="opt">};</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4KmDoT-1" href="#NW0-4KmDoT-1" id="NW0-4KmDoT-1"><dfn>&lt;HTTP Headers to Save on CAS Redirect&gt;=</dfn></a> <b>(<a href="#NW0-3wu2oE-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="str">"If"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"IfMatch"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"IfModifiedSince"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"IfNoneMatch"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"IfRange"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"IfUnmodifiedSince"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"Range"</span><span class="opt">,</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2O9GDs-1" href="#NW0-2O9GDs-1" id="NW0-2O9GDs-1"><dfn>&lt;Redirect to CAS&gt;=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-2O9GDs-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>http_headers <span class="opt">= </span><span class="kwd">cgi_env_obj</span><span class="opt">(</span><span class="str">"HTTP"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">HDF </span><span class="opt">*</span>cgi_headers <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>http_headers<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">* </span><span class="kwb">const </span><span class="opt">* </span>h<span class="opt">, *</span>v<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>h <span class="opt">= </span>save_headers<span class="opt">; *</span>h<span class="opt">; </span>h<span class="opt">++)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((</span>v <span class="opt">= </span><span class="kwd">hdf_get_value</span><span class="opt">(</span>http_headers<span class="opt">, *</span>h<span class="opt">, </span>NULL<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(!</span>cgi_headers<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_get_node</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi_parms<span class="opt">, </span><span class="str">"_HTTP_"</span><span class="opt">, &amp;</span>cgi_headers<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_set_value</span><span class="opt">(</span>cgi_headers<span class="opt">, *</span>h<span class="opt">, </span>v<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Also, if the request method is not GET or POST, the request method itself is a parameter which is lost. Normally, the request will simply be dropped, but for this library, the method will be saved just like the HTTP headers.</p>
  <pre class="dfn">
<a name="NW0-2O9GDs-2" href="#NW0-2O9GDs-1" id="NW0-2O9GDs-2"><dfn>&lt;Redirect to CAS&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2O9GDs-1">&lt;-</a>D<a href="#NW0-2O9GDs-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>req_method <span class="opt">!= </span>HTTP_REQ_GET <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   cgi_state<span class="opt">-&gt;</span>req_method <span class="opt">!= </span>HTTP_REQ_POST <span class="opt">&amp;&amp;</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">!</span><span class="kwd">nerr_op_ok</span><span class="opt">(</span><span class="kwd">cgi_parm_set</span><span class="opt">(</span><span class="str">"_HTTP_._Request"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.RequestMethod"</span><span class="opt">, </span>NULL<span class="opt">))))</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In addition to the pointer to the parameters, the session information itself must be given.</p>
  <pre class="dfn">
<a name="NW0-4ZlaGw-4" href="#NW0-4ZlaGw-1" id="NW0-4ZlaGw-4"><dfn>&lt;Compute my URL into <code>buf</code>&gt;+=</dfn></a> <b>(<a href="#NW0-2We642-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4ZlaGw-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">g_string_append_session_cgi_parms</span><span class="opt">(</span>cgi_state<span class="opt">, !</span>pno<span class="opt">, </span>buf<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>File uploads are lost in the process, unless their state is adequately saved in the standard parameter hierarchy. For standard uploads, this can be accomplished by setting <code>Config.Upload.Unlink</code> to zero.</p>
  <pre class="dfn">
<a name="NW0-2snMgS-1" href="#NW0-2snMgS-1" id="NW0-2snMgS-1"><dfn>&lt;Initialize CAS globals&gt;=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-2snMgS-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">hdf_set_int_value</span><span class="opt">(</span>local_config<span class="opt">, </span><span class="str">"Config.Upload.Unlink"</span><span class="opt">, </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>This will leave a lot of temporary files lying around, though, so a directory cleaner similar to the state cleaner is recommended (maybe even the state cleaner itself). In addition, the per-run cleanup routine can scan for files and remove them.</p>
  <pre class="dfn">
<a name="NW0-2DIX1I-1" href="#NW0-2DIX1I-1" id="NW0-2DIX1I-1"><dfn>&lt;Perform cleanups requiring valid CGI parameters&gt;=</dfn></a> <b>(<a href="#NW0-3kDPKd-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">hdf_get_int_value</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"Config.Upload.Unlink"</span><span class="opt">, </span><span class="num">1</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>parm<span class="opt">, *</span>subparm<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>fn<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>parm <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi_parms<span class="opt">); </span>parm<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
                                                  parm <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>parm<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">for</span><span class="opt">(</span>subparm <span class="opt">= </span><span class="kwd">hdf_obj_child</span><span class="opt">(</span>parm<span class="opt">); </span>subparm<span class="opt">; </span>subparm <span class="opt">= </span><span class="kwd">hdf_obj_next</span><span class="opt">(</span>subparm<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span>fn <span class="opt">= </span><span class="kwd">hdf_get_value</span><span class="opt">(</span>subparm<span class="opt">, </span><span class="str">"FileName"</span><span class="opt">, </span>NULL<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">unlink</span><span class="opt">(</span>fn<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">((</span>fn <span class="opt">= </span><span class="kwd">hdf_get_value</span><span class="opt">(</span>parm<span class="opt">, </span><span class="str">"FileName"</span><span class="opt">, </span>NULL<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">unlink</span><span class="opt">(</span>fn<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The redirect itself is done using the CGI kit redirection built-in. The return code indicates that the CGI application should do no rendering of its own.</p>
  <pre class="dfn">
<a name="NW0-2O9GDs-3" href="#NW0-2O9GDs-1" id="NW0-2O9GDs-3"><dfn>&lt;Redirect to CAS&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2O9GDs-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="com">/* note: IU CAS does not expect/support URL-encoding */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>myurl <span class="opt">= </span><span class="kwd">compute_myurl</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#if 0</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>myurl<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span><span class="opt">*</span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_url_escape</span><span class="opt">(</span>myurl<span class="opt">, &amp;</span>s<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">free</span><span class="opt">(</span>myurl<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  myurl <span class="opt">= </span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>myurl<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="kwd">nerr_raise_msg_errno</span><span class="opt">(</span><span class="str">"Can't compute return URL"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">cgi_status</span><span class="opt">(</span><span class="num">302</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">print_session_cookie</span><span class="opt">(</span>cgi_state<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cas_svc<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_redirect_uri</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span><span class="str">"%slogin?cassvc=%s&amp;casurl=%s"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                   cas_url<span class="opt">, </span>cas_svc<span class="opt">, </span>myurl<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_redirect_uri</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span><span class="str">"%slogin?casurl=%s"</span><span class="opt">, </span>cas_url<span class="opt">, </span>myurl<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">free</span><span class="opt">(</span>myurl<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>When the redirection returns, the <code>casticket</code> parameter is added by CAS to indicate at least partially successful login. It is then up to the CGI application to validate that ticket and turn it into a user ID, by yet again calling the CAS server. This time, though, the user's browser does not need to be involved. The ticket itself is sent to the CAS server, which will stamp the ticket as invalid, and reply with text indicating whether or not it was valid before stamping.</p>

  <p>To perform that callback, libcurl<sup><a href="#fn23">23</a></sup> is used. Since it uses SSL, a certificate authority might also need to be specified. Note that the SSL libary used by curl should probably match any other SSL libraries against which the program is linked; otherwise the program may freeze on initial contact.</p>
  <pre class="dfn">
<a name="NW0-1mOMve-8" href="#NW0-1mOMve-1" id="NW0-1mOMve-8"><dfn>&lt;(build.nw) Common C Includes&gt;+=</dfn></a> <b>[<a href="#NW0-1mOMve-7">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;curl/curl.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-13PeAG-6" href="#NW0-13PeAG-1" id="NW0-13PeAG-6"><dfn>&lt;(build.nw) makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-13PeAG-5">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
EXTRA_CFLAGS <span class="opt">+= </span>$<span class="opt">(</span>shell curl<span class="opt">-</span>config <span class="opt">--</span>cflags<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
EXTRA_LDFLAGS <span class="opt">+= </span>$<span class="opt">(</span>shell curl<span class="opt">-</span>config <span class="opt">--</span>libs<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-6yJSy-2" href="#NW0-6yJSy-1" id="NW0-6yJSy-2"><dfn>&lt;CAS Support Configuration&gt;+=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[<a href="#NW0-6yJSy-1">&lt;-</a>D<a href="#NW0-6yJSy-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc"># The SSL Certificate Authority file to use with CAS</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc"># If blank, use a reasonable default system CA file</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#cas_ca =</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3wu2oE-2" href="#NW0-3wu2oE-1" id="NW0-3wu2oE-2"><dfn>&lt;CAS Support Variables&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3wu2oE-1">&lt;-</a>D<a href="#NW0-3wu2oE-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static const char </span><span class="opt">*</span>cas_ca <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2snMgS-2" href="#NW0-2snMgS-1" id="NW0-2snMgS-2"><dfn>&lt;Initialize CAS globals&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2snMgS-1">&lt;-</a>D<a href="#NW0-2snMgS-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cas_ca <span class="opt">= </span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"cas_ca"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">curl_global_init</span><span class="opt">(</span>CURL_GLOBAL_ALL<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Setup for validation starts the same way as setup for redirection: a suitable URL is built. The only difference is that the operation changes (from login to validate) and the CAS ticket (<code>cas_ticket</code>) is appended.</p>
  <pre class="dfn">
<a name="NW0-2mfHr7-1" href="#NW0-2mfHr7-1" id="NW0-2mfHr7-1"><dfn>&lt;Validate CAS ticket with cURL&gt;=</dfn></a> <b>(<a href="#NW0-2KBx21-3">U-&gt;</a>)</b> <b>[D<a href="#NW0-2mfHr7-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>val_url <span class="opt">= </span><span class="kwd">g_string_new</span><span class="opt">(</span>cas_url<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">GString </span><span class="opt">*</span>val_ret <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>val_url<span class="opt">, </span><span class="str">"validate?"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cas_svc<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append</span><span class="opt">(</span>val_url<span class="opt">, </span><span class="str">"cassvc="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append</span><span class="opt">(</span>val_url<span class="opt">, </span>cas_svc<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_string_append_c</span><span class="opt">(</span>val_url<span class="opt">, </span><span class="str">'&amp;'</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>val_url<span class="opt">, </span><span class="str">"casticket="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* IU CAS doesn't support URL-encoding */</span>
</pre>
      </li>

      <li>
        <pre>
g_string_append<span class="com">/*_uri_escaped*/</span><span class="opt">(</span>val_url<span class="opt">, </span>cas_ticket<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_append</span><span class="opt">(</span>val_url<span class="opt">, </span><span class="str">"&amp;casurl="</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>myurl <span class="opt">= </span><span class="kwd">compute_myurl</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
g_string_append<span class="com">/*_uri_escaped*/</span><span class="opt">(</span>val_url<span class="opt">, </span>myurl<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">free</span><span class="opt">(</span>myurl<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Validating with "</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>val_url<span class="opt">-&gt;</span>str<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;br&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Then, the cURL setup itself is done. The results will be retrieved into memory, specifically into a <code>GString</code> buffer.</p>
  <pre class="dfn">
<a name="NW0-2mfHr7-2" href="#NW0-2mfHr7-1" id="NW0-2mfHr7-2"><dfn>&lt;Validate CAS ticket with cURL&gt;+=</dfn></a> <b>(<a href="#NW0-2KBx21-3">U-&gt;</a>)</b> <b>[<a href="#NW0-2mfHr7-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
CURL <span class="opt">*</span>valhandle <span class="opt">= </span><span class="kwd">curl_easy_init</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>valhandle<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_URL<span class="opt">, </span>val_url<span class="opt">-&gt;</span>str<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cas_ca<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_CAINFO<span class="opt">, </span>cas_ca<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_SSL_VERIFYPEER<span class="opt">, </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2mfHr7-2-u1" href="#NW0-HGcVU-1" id="NW0-2mfHr7-2-u1"><i>&lt;Finish setting up cURL validation&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">curl_easy_perform</span><span class="opt">(</span>valhandle<span class="opt">) &amp;&amp; </span>val_ret <span class="opt">&amp;&amp; </span>val_ret<span class="opt">-&gt;</span>len<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"validation result:</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">cgi_puts_html_escape</span><span class="opt">(</span>cgi_state<span class="opt">, </span>val_ret<span class="opt">-&gt;</span>str<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"&lt;br&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2mfHr7-2-u2" href="#NW0-4VPPh2-1" id="NW0-2mfHr7-2-u2"><i>&lt;Check cURL validation results&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">curl_easy_cleanup</span><span class="opt">(</span>valhandle<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">g_string_free</span><span class="opt">(</span>val_url<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Retrieval into a buffer requires the use of a write callback. Just in case, the progress indication is turned off as well. That way, no output will be generated on the standard streams.</p>
  <pre class="dfn">
<a name="NW0-HGcVU-1" href="#NW0-HGcVU-1" id="NW0-HGcVU-1"><dfn>&lt;Finish setting up cURL validation&gt;=</dfn></a> <b>(<a href="#NW0-2mfHr7-2">&lt;-U</a>)</b> <b>[D<a href="#NW0-HGcVU-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_WRITEFUNCTION<span class="opt">, (</span>curl_write_callback<span class="opt">)</span>write_gstr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_WRITEDATA<span class="opt">, &amp;</span>val_ret<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_NOPROGRESS<span class="opt">, </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2We642-2" href="#NW0-2We642-1" id="NW0-2We642-2"><dfn>&lt;CAS Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2We642-1">&lt;-</a>D<a href="#NW0-2We642-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static </span>ssize_t <span class="kwd">write_gstr</span><span class="opt">(</span><span class="kwb">void </span><span class="opt">*</span>ptr<span class="opt">, </span><span class="kwb">size_t </span>size<span class="opt">, </span><span class="kwb">size_t </span>nmemb<span class="opt">, </span><span class="kwb">void </span><span class="opt">*</span>_str<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">GString </span><span class="opt">**</span>str <span class="opt">= </span>_str<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  size <span class="opt">*= </span>nmemb<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(!</span>size<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(*</span>str<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_append_len</span><span class="opt">(*</span>str<span class="opt">, </span>ptr<span class="opt">, </span>size<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*</span>str <span class="opt">= </span><span class="kwd">g_string_new_len</span><span class="opt">(</span>ptr<span class="opt">, </span>size<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nmemb<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>If debugging is enabled, the CURL debug output should be printed to the CGI stream. This requires setting up another callback.</p>
  <pre class="dfn">
<a name="NW0-HGcVU-2" href="#NW0-HGcVU-1" id="NW0-HGcVU-2"><dfn>&lt;Finish setting up cURL validation&gt;+=</dfn></a> <b>(<a href="#NW0-2mfHr7-2">&lt;-U</a>)</b> <b>[<a href="#NW0-HGcVU-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_VERBOSE<span class="opt">, </span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_DEBUGFUNCTION<span class="opt">, </span>cgi_curl_debug<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">curl_easy_setopt</span><span class="opt">(</span>valhandle<span class="opt">, </span>CURLOPT_DEBUGDATA<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2We642-3" href="#NW0-2We642-1" id="NW0-2We642-3"><dfn>&lt;CAS Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2We642-2">&lt;-</a>D<a href="#NW0-2We642-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">cgi_curl_debug</span><span class="opt">(</span>CURL <span class="opt">*</span>curl<span class="opt">, </span>curl_infotype it<span class="opt">, </span><span class="kwb">char </span><span class="opt">*</span>buf<span class="opt">, </span><span class="kwb">size_t </span>len<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                   <span class="kwb">void </span><span class="opt">*</span>cbdata<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state <span class="opt">= </span>cbdata<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">const char </span><span class="opt">*</span>its<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">switch</span><span class="opt">(</span>it<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">case </span>CURLINFO_TEXT<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">default</span><span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
      its <span class="opt">= </span><span class="str">"info"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">case </span>CURLINFO_HEADER_IN<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
      its <span class="opt">= </span><span class="str">"head"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">case </span>CURLINFO_HEADER_OUT<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
      its <span class="opt">= </span><span class="str">"hout"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">case </span>CURLINFO_DATA_IN<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
      its <span class="opt">= </span><span class="str">"rdat"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">case </span>CURLINFO_DATA_OUT<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
      its <span class="opt">= </span><span class="str">"wdat"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_printf</span><span class="opt">(</span><span class="str">"curl%s: %.*s&lt;br&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>its<span class="opt">, (</span><span class="kwb">int</span><span class="opt">)</span>len<span class="opt">, </span>buf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The buffer contents from the validation should be two lines of plain text. The first line is either `yes' or `no', indicating whether or not the ticket was valid. The second line is either blank or the name of the user authenticated by the ticket. Once the `yes' has been confirmed, and the user ID has been verified to be plain text, the user ID is copied into the CGI state. That's all there is to CAS authentication, at least version one as implemented at IU.</p>
  <pre class="dfn">
<a name="NW0-4VPPh2-1" href="#NW0-4VPPh2-1" id="NW0-4VPPh2-1"><dfn>&lt;Check cURL validation results&gt;=</dfn></a> <b>(<a href="#NW0-2mfHr7-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">char </span><span class="opt">*</span>s <span class="opt">= </span>val_ret<span class="opt">-&gt;</span>str<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">/* first line == yes means valid */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwd">memcmp</span><span class="opt">(</span>s<span class="opt">, </span><span class="str">"yes</span><span class="esc">\r\n</span><span class="str">"</span><span class="opt">, </span><span class="num">5</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="com">/* second line == user ID */</span>
</pre>
      </li>

      <li>
        <pre>
  s <span class="opt">+= </span><span class="num">5</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">int </span>i<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>name_valid <span class="opt">= </span><span class="num">1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for</span><span class="opt">(</span>i <span class="opt">= </span><span class="num">0 </span><span class="opt">; </span>s<span class="opt">[</span>i<span class="opt">] &amp;&amp; </span>s<span class="opt">[</span>i<span class="opt">] != </span><span class="str">'</span><span class="esc">\r</span><span class="str">'</span> <span class="opt">&amp;&amp; </span>s<span class="opt">[</span>i<span class="opt">] != </span><span class="str">'</span><span class="esc">\n</span><span class="str">'</span><span class="opt">; </span>i<span class="opt">++)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(!</span><span class="kwd">isalnum</span><span class="opt">(</span>s<span class="opt">[</span>i<span class="opt">])) {</span>
</pre>
      </li>

      <li>
        <pre>
      name_valid <span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">break</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  s<span class="opt">[</span>i<span class="opt">] = </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>name_valid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    cas_userid <span class="opt">= </span>s<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Before any of this can begin, though, the CGI environment must be parsed. This is done using the session initializer. The full session support is only necessary to support CAS, so if CAS is disabled, the session support could be disabled as well, but it is intended that the CAS calls completely replace the session calls, so the session call is always used. Nonetheless, if the CAS URL isn't specified, then nothing else needs to be done.</p>
  <pre class="dfn">
<a name="NW0-2KBx21-1" href="#NW0-2KBx21-1" id="NW0-2KBx21-1"><dfn>&lt;Check CAS credentials and return <code>STATUS_OK</code> if OK&gt;=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-2KBx21-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">update_cgi_session</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK <span class="opt">|| !</span>cgi_state<span class="opt">-&gt;</span>sessionid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span>cas_url<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
nerr <span class="opt">= </span><span class="kwd">read_session_state</span><span class="opt">(</span><span class="str">"cas"</span><span class="opt">, </span>NULL<span class="opt">, </span>FALSE<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>This is a rather expensive process, so the credentials are retained for a while before doing another redirect. The credentials are saved in the session information (<code>cas.userid</code>). Even though the process is expensive, eventually the credentials should be re-verified. This is done on a configurable interval. When the user ID is saved in the session, the current date plus the expiration interval is stored with it (<code>cas.exp</code>).</p>
  <pre class="dfn">
<a name="NW0-6yJSy-3" href="#NW0-6yJSy-1" id="NW0-6yJSy-3"><dfn>&lt;CAS Support Configuration&gt;+=</dfn></a> <b>(<a href="#NW0-g4tIN-1">U-&gt;</a>)</b> <b>[<a href="#NW0-6yJSy-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The maximum seconds between ticket renewals</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Note that multiple hosts verifying the same ticket must have synchronized</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># clocks</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Setting this too short (e.g. 0) will force continual renewals</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#cas_renew_interval = 600</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3wu2oE-3" href="#NW0-3wu2oE-1" id="NW0-3wu2oE-3"><dfn>&lt;CAS Support Variables&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3wu2oE-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">static guint </span>cas_renew_interval<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2snMgS-3" href="#NW0-2snMgS-1" id="NW0-2snMgS-3"><dfn>&lt;Initialize CAS globals&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2snMgS-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cas_renew_interval <span class="opt">= </span><span class="kwd">getconf_int</span><span class="opt">(</span><span class="str">"cas_renew_interval"</span><span class="opt">, </span><span class="num">600</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2KBx21-2" href="#NW0-2KBx21-1" id="NW0-2KBx21-2"><dfn>&lt;Check CAS credentials and return <code>STATUS_OK</code> if OK&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2KBx21-1">&lt;-</a>D<a href="#NW0-2KBx21-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>cas_userid <span class="opt">= </span><span class="kwd">cgi_session_val</span><span class="opt">(</span><span class="str">"cas.userid"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cas_userid <span class="opt">&amp;&amp; </span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">&amp;&amp; !</span><span class="kwd">strcmp</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>userid<span class="opt">, </span>cas_userid<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">time_t </span>expiration <span class="opt">= </span><span class="kwd">cgi_session_val_int</span><span class="opt">(</span><span class="str">"cas.exp"</span><span class="opt">, -</span><span class="num">1</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>expiration <span class="opt">&gt;= </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">time_t </span>now<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">time</span><span class="opt">(&amp;</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>now <span class="opt">&lt; </span>expiration<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2KBx21-3" href="#NW0-2KBx21-1" id="NW0-2KBx21-3"><dfn>&lt;Check CAS credentials and return <code>STATUS_OK</code> if OK&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2KBx21-2">&lt;-</a>D<a href="#NW0-2KBx21-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>cas_ticket <span class="opt">= </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"casticket"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cas_ticket<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-2KBx21-3-u1" href="#NW0-2mfHr7-1" id="NW0-2KBx21-3-u1"><i>&lt;Validate CAS ticket with cURL&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cas_userid<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt"><a name="NW0-2KBx21-3-u2" href="#NW0-1hrcR3-1" id="NW0-2KBx21-3-u2"><i>&lt;Update session user from CAS user&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>val_ret<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">g_string_free</span><span class="opt">(</span>val_ret<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In addition to setting the user information, a successful CAS logon must also restore any saved CGI parameters. After it does so, it removes them from the session state.</p>
  <pre class="dfn">
<a name="NW0-1hrcR3-1" href="#NW0-1hrcR3-1" id="NW0-1hrcR3-1"><dfn>&lt;Update session user from CAS user&gt;=</dfn></a> <b>(<a href="#NW0-2KBx21-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_session_set</span><span class="opt">(</span><span class="str">"cas.userid"</span><span class="opt">, </span>cas_userid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cas_renew_interval<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">char </span>nbuf<span class="opt">[</span><span class="num">22</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">time_t </span>now<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">time</span><span class="opt">(&amp;</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  now <span class="opt">+= </span>cas_renew_interval<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">snprintf</span><span class="opt">(</span>nbuf<span class="opt">, </span><span class="kwa">sizeof</span><span class="opt">(</span>nbuf<span class="opt">), </span><span class="str">"%llu"</span><span class="opt">, (</span><span class="kwb">ullong</span><span class="opt">)</span>now<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_session_set</span><span class="opt">(</span><span class="str">"cas.exp"</span><span class="opt">, </span>nbuf<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_session_set</span><span class="opt">(</span><span class="str">"Session.RemoteUser"</span><span class="opt">, </span>cas_userid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">update_session_state</span><span class="opt">(</span><span class="str">"Session.RemoteUser"</span><span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="kwd">cgi_session_obj</span><span class="opt">(</span><span class="str">"Session.RemoteUser"</span><span class="opt">), </span>NULL<span class="opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             cgi_state<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.RemoteUser"</span><span class="opt">, </span>cas_userid<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  cas_userid <span class="opt">= </span>cgi_state<span class="opt">-&gt;</span>userid <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"CGI.RemoteUser"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  cas_userid <span class="opt">= </span>NULL<span class="opt">; </span><span class="com">/* may as well try again; no memory this time */</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>pno <span class="opt">= </span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"cas.pno"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>pno <span class="opt">&amp;&amp; </span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">read_session_state</span><span class="opt">(</span><span class="str">"cas_parms"</span><span class="opt">, </span>pno<span class="opt">, </span>TRUE<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>pno <span class="opt">&amp;&amp; </span>nerr <span class="opt">== </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">HDF </span><span class="opt">*</span>parms <span class="opt">= </span><span class="kwd">cgi_session_obj</span><span class="opt">(</span><span class="str">"cas_parms"</span><span class="opt">), *</span>obj <span class="opt">= </span>NULL<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>parms<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    obj <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>parms<span class="opt">, </span>pno<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>obj<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">HDF </span><span class="opt">*</span>head <span class="opt">= </span><span class="kwd">hdf_get_obj</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"_HTTP_"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>head<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">const char </span><span class="opt">*</span>req<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_copy</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"HTTP"</span><span class="opt">, </span>obj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">((</span>req <span class="opt">= </span><span class="kwd">cgi_env_val</span><span class="opt">(</span><span class="str">"HTTP._Request"</span><span class="opt">, </span>NULL<span class="opt">))) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">cgi_env_set</span><span class="opt">(</span><span class="str">"CGI.RequestMethod"</span><span class="opt">, </span>req<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
        cgi_state<span class="opt">-&gt;</span>req_method <span class="opt">= </span><span class="kwd">http_req_id</span><span class="opt">(</span>req<span class="opt">, </span><span class="kwd">strlen</span><span class="opt">(</span>req<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>obj<span class="opt">, </span><span class="str">"_HTTP_"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"Query"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">hdf_copy</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"Query"</span><span class="opt">, </span>obj<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">hdf_remove_tree</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>hdf<span class="opt">, </span><span class="str">"Query"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    nerr <span class="opt">= </span><span class="kwd">update_session_state</span><span class="opt">(</span><span class="str">"cas_parms"</span><span class="opt">, </span>NULL<span class="opt">, &amp;</span>obj<span class="opt">, </span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>debug<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Restored "</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwd">cgi_dump_hdf</span><span class="opt">(</span>cgi_state<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_op</span><span class="opt">(</span><span class="kwd">update_session_state</span><span class="opt">(</span><span class="str">"cas"</span><span class="opt">, </span><span class="kwd">cgi_session_obj</span><span class="opt">(</span><span class="str">"cas"</span><span class="opt">), </span>NULL<span class="opt">, </span>cgi_state<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">nerr_ignore</span><span class="opt">(&amp;</span>nerr<span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, if and only if any of that failed, a new redirect must be initiated. On the other hand, if it succeeded, the standard remote user parameter is updated.</p>
  <pre class="dfn">
<a name="NW0-2KBx21-4" href="#NW0-2KBx21-1" id="NW0-2KBx21-4"><dfn>&lt;Check CAS credentials and return <code>STATUS_OK</code> if OK&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2KBx21-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>cas_userid<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">*</span>needs_redirect <span class="opt">= </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>One other operation that has been neglected here is the logout operation. For this, the user is once again redirected to CAS. First, though, the session must be destroyed.</p>
  <pre class="dfn">
<a name="NW0-2We642-4" href="#NW0-2We642-1" id="NW0-2We642-4"><dfn>&lt;CAS Support Functions&gt;+=</dfn></a> <b>(<a href="#NW0-wX3Vt-1">&lt;-U</a>)</b> <b>[<a href="#NW0-2We642-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">gboolean </span><span class="kwd">logout_cas</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>cas_url<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_status</span><span class="opt">(</span><span class="num">302</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">logout_cgi_session</span><span class="opt">(</span>cgi_state<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_redirect_uri</span><span class="opt">(</span>cgi_state<span class="opt">-&gt;</span>cgi<span class="opt">, </span><span class="str">"%slogout"</span><span class="opt">, </span>cas_url<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>TRUE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>FALSE<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc14" id="toc14">Sample Program</a></h1>

  <p>A very small test program is provided here to exercise the code a little bit. It uses a template for the body, but a hard-coded header.</p>
  <pre class="dfn">
<a name="NW0-B0ssZ-1" href="#NW0-B0ssZ-1" id="NW0-B0ssZ-1"><dfn>&lt;(build.nw) C Test Support Executables&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
test<span class="opt">.</span>cgi \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-n15ju-1" href="#NW0-n15ju-1" id="NW0-n15ju-1"><dfn>&lt;test.cgi.c&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-n15ju-1-u1" href="#nw@notdef" id="NW0-n15ju-1-u1"><i>&lt;(build.nw) Common C Header&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-n15ju-1-u2" href="#NW0-pXiuJ-1" id="NW0-n15ju-1-u2"><i>&lt;CGI Message Overrides&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>tmpl<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static NEOERR </span><span class="opt">*</span><span class="kwd">do_cgi</span><span class="opt">(</span><span class="kwb">cgi_state_t </span><span class="opt">*</span>cgi_state<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-n15ju-1-u3" href="#NW0-3zffVE-1" id="NW0-n15ju-1-u3"><i>&lt;CGI Per-Run Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">init_cgi_run</span><span class="opt">(</span>cgi_state<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">die_if_err</span><span class="opt">(</span><span class="kwd">prepare_db_session</span><span class="opt">(</span>cgi_state<span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">gboolean </span>did_redirect<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span><span class="kwd">update_cas</span><span class="opt">(</span>cgi_state<span class="opt">, &amp;</span>did_redirect<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>nerr <span class="opt">!= </span>STATUS_OK <span class="opt">|| </span>did_redirect<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">cgi_parm_val</span><span class="opt">(</span><span class="str">"action.logout"</span><span class="opt">, </span>NULL<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwd">logout_cas</span><span class="opt">(</span>cgi_state<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">return </span>STATUS_OK<span class="opt">; </span><span class="com">/* redirects */</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_status</span><span class="opt">(</span><span class="num">200</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Status: 200</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">logout_cgi_session</span><span class="opt">(</span>cgi_state<span class="opt">, </span>TRUE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Content-type: text/plain</span><span class="esc">\n\n</span><span class="str">Good bye."</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>STATUS_OK<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_status</span><span class="opt">(</span><span class="num">200</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Status: 200</span><span class="esc">\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">print_session_cookie</span><span class="opt">(</span>cgi_state<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">set_session_tmpl_vars</span><span class="opt">(</span>cgi_state<span class="opt">, </span>FALSE<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">cgi_puts</span><span class="opt">(</span><span class="str">"Content-type: text/html</span><span class="esc">\n\n</span><span class="str">"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  nerr <span class="opt">= </span>tmpl ? <span class="kwd">tmpl_file_to_cgi</span><span class="opt">(</span>tmpl<span class="opt">, </span>cgi_state<span class="opt">, </span>FALSE<span class="opt">) :</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="kwd">tmpl_to_cgi</span><span class="opt">(</span><span class="str">"&lt;?cs include:</span><span class="esc">\"</span><span class="str">html_prefix.cs</span><span class="esc">\"</span><span class="str">?&gt;"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;?cs include:</span><span class="esc">\"</span><span class="str">html_macros.cs</span><span class="esc">\"</span><span class="str">?&gt;"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;/head&gt;&lt;body&gt;</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"Hello, "</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;?cs alt:CGI.RemoteUser?&gt;stranger&lt;?cs /alt ?&gt;"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;br/&gt;</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;?cs call:form(</span><span class="esc">\"</span><span class="str">f</span><span class="esc">\"</span><span class="str">, 0) ?&gt;</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;?cs var:CGI.SessionForm ?&gt;"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;input type=</span><span class="esc">\"</span><span class="str">submit</span><span class="esc">\" </span><span class="str">value=</span><span class="esc">\"</span><span class="str">Press Me</span><span class="esc">\"</span><span class="str">&gt;&lt;br/&gt;</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;input type=</span><span class="esc">\"</span><span class="str">submit</span><span class="esc">\" </span><span class="str">name=</span><span class="esc">\"</span><span class="str">action.logout</span><span class="esc">\"</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="str">"value=</span><span class="esc">\"</span><span class="str">Log Out</span><span class="esc">\"</span><span class="str">&gt;&lt;br/&gt;</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="str">"&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">, </span>cgi_state<span class="opt">, </span>FALSE<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span>nerr<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>config_root <span class="opt">= </span><span class="str">"."</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">const char </span><span class="opt">*</span>config_path <span class="opt">= </span><span class="str">"test.cgi.conf"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-n15ju-1-u4" href="#nw@notdef" id="NW0-n15ju-1-u4"><i>&lt;(cs-glib.nw) Help Function&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">int </span><span class="kwd">main</span><span class="opt">(</span><span class="kwb">int </span>argc<span class="opt">, </span><span class="kwb">const char </span><span class="opt">**</span>argv<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-n15ju-1-u5" href="#NW0-4fQs2w-1" id="NW0-n15ju-1-u5"><i>&lt;CGI Mainline Variables&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">g_thread_init</span><span class="opt">(</span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-n15ju-1-u6" href="#nw@notdef" id="NW0-n15ju-1-u6"><i>&lt;(cs-glib.nw) Read configuration&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-n15ju-1-u7" href="#nw@notdef" id="NW0-n15ju-1-u7"><i>&lt;(cs-glib.nw) Set up templates&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  tmpl <span class="opt">= </span><span class="kwd">getconf</span><span class="opt">(</span><span class="str">"tmpl"</span><span class="opt">, </span>NULL<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">init_db_cgi_session</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">init_cas</span><span class="opt">();</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">run_cgi</span><span class="opt">(</span>do_cgi<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">return </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-HKLLg-1" href="#NW0-HKLLg-1" id="NW0-HKLLg-1"><dfn>&lt;<code>test.cgi</code> Description&gt;=</dfn></a> <b>(<a href="#NW0-3uGBjz-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
Simple CGI test program
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-g4tIN-1" href="#NW0-g4tIN-1" id="NW0-g4tIN-1"><dfn>&lt;<code>test.cgi</code> Configuration&gt;=</dfn></a> <b>(<a href="#NW0-3uGBjz-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The template file to display (default: built-in test template)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#tmpl =</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-g4tIN-1-u1" href="#nw@notdef" id="NW0-g4tIN-1-u1"><i>&lt;(cs-glib.nw) Template Parameter Configuration&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-g4tIN-1-u2" href="#NW0-AVbKa-1" id="NW0-g4tIN-1-u2"><i>&lt;CGI Support Configuration&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-g4tIN-1-u3" href="#NW0-2SuyVE-1" id="NW0-g4tIN-1-u3"><i>&lt;CGI Session Support Configuration&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-g4tIN-1-u4" href="#NW0-B9EcR-1" id="NW0-g4tIN-1-u4"><i>&lt;CGI Database Session Support Configuration&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-g4tIN-1-u5" href="#NW0-6yJSy-1" id="NW0-g4tIN-1-u5"><i>&lt;CAS Support Configuration&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2kYumM-3" href="#NW0-2kYumM-1" id="NW0-2kYumM-3"><dfn>&lt;(build.nw) Plain Files&gt;+=</dfn></a> <b>[<a href="#NW0-2kYumM-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
test.cgi.conf \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uGBjz-1" href="#NW0-3uGBjz-1" id="NW0-3uGBjz-1"><dfn>&lt;test.cgi.conf&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Sample test.cgi configuration file</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># <a name="NW0-3uGBjz-1-u1" href="#NW0-HKLLg-1" id="NW0-3uGBjz-1-u1"><i>&lt;<code>test.cgi</code> Description&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
test.cgi {
</pre>
      </li>

      <li>
        <pre>
  <a name="NW0-3uGBjz-1-u2" href="#NW0-g4tIN-1" id="NW0-3uGBjz-1-u2"><i>&lt;<code>test.cgi</code> Configuration&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
}
</pre>
      </li>
    </ol>
  </div>

  <p>In addition, here is a simple shell script which can take a body plus headers and pass it to a CGI program.</p>
  <pre class="dfn">
<a name="NW0-2F4ELl-1" href="#NW0-2F4ELl-1" id="NW0-2F4ELl-1"><dfn>&lt;(build.nw) Script Executables&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
pass-http \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-78Tk8-1" href="#NW0-78Tk8-1" id="NW0-78Tk8-1"><dfn>&lt;pass-http&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>SERVER_NAME<span class="opt">=</span>whatever
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>SERVER_SOFTWARE<span class="opt">=</span>whatever
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>GATEWAY_INTERFACE<span class="opt">=</span>CGI<span class="opt">/</span><span class="num">1.1</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>SERVER_PORT<span class="opt">=</span><span class="num">80</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">read </span><span class="opt">-</span>r REQUEST_METHOD REQUEST_URI SERVER_PROTOCOL
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"${REQUEST_METHOD} ${REQUEST_URI} ${SERVER_PROTOCOL}"</span> <span class="opt">&gt;&amp;</span><span class="num">2</span>
</pre>
      </li>

      <li>
        <pre>
PATH_INFO<span class="opt">=</span><span class="kwd">${REQUEST_URI#/cgi-bin/*/}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ </span><span class="str">"x$PATH_INFO"</span> <span class="opt">= </span><span class="str">"x$REQUEST_URI"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  SCRIPT_NAME<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  SCRIPT_NAME<span class="opt">=</span><span class="str">"${REQUEST_URI#/cgi-bin/}"</span>
</pre>
      </li>

      <li>
        <pre>
  SCRIPT_NAME<span class="opt">=</span><span class="str">"${SCRIPT_NAME%%/*}"</span>
</pre>
      </li>

      <li>
        <pre>
  SCRIPT_NAME<span class="opt">=/</span>cgi<span class="opt">-</span>bin<span class="opt">/</span><span class="str">"${SCRIPT_NAME}"</span>
</pre>
      </li>

      <li>
        <pre>
  PATH_INFO<span class="opt">=</span><span class="str">"${REQUEST_URI#${SCRIPT_NAME}}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># no attempt made to do ISINDEX</span>
</pre>
      </li>

      <li>
        <pre>
QUERY_STRING<span class="opt">=</span><span class="str">"${PATH_INFO#*\?}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">test </span><span class="str">"x$QUERY_STRING"</span> <span class="opt">= </span><span class="str">"x$PATH_INFO"</span> <span class="opt">&amp;&amp; </span>QUERY_STRING<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
PATH_INFO<span class="opt">=</span><span class="str">"${PATH_INFO%%\?*}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>REQUEST_METHOD REQUEST_URI PATH_INFO SERVER_PROTOCOL QUERY_STRING SCRIPT_NAME
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>REMOTE_HOST<span class="opt">=</span>localhost
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>REMOTE_ADDR<span class="opt">=</span><span class="num">127.0.0.1</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>REMOTE_USER<span class="opt">=</span>$<span class="opt">(</span>id <span class="opt">-</span>un<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
lh<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while </span>IFS<span class="opt">= </span><span class="kwb">read </span><span class="opt">-</span>r h<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">"$h"</span> <span class="opt">&gt;&amp;</span><span class="num">2</span>
</pre>
      </li>

      <li>
        <pre>
  h<span class="opt">=</span><span class="str">"${h%
</span>
</pre>

        <li>
          <pre>
<span class="str">  <span class="kwb">test </span><span class="opt">-</span>z <span class="str">"$h"</span> <span class="opt">&amp;&amp; </span><span class="kwb">break</span></span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
  <span class="kwa">if </span><span class="opt">[ -</span>n <span class="str">"$lh"</span> <span class="opt">-</span>a <span class="str">"x${h# }"</span> <span class="opt">!= </span><span class="str">"x$h"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    <span class="kwb">eval </span><span class="str">"$lh=</span><span class="esc">\"</span><span class="str">\$$lh\$h</span><span class="esc">\"</span><span class="str">"</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
  <span class="kwa">else</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    lh<span class="opt">=</span><span class="str">"${h%%:*}"</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    h<span class="opt">=</span><span class="str">"${h#*:}"</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    <span class="kwa">while </span><span class="opt">[ </span><span class="str">"x${h# }"</span> <span class="opt">!= </span><span class="str">"x$h"</span> <span class="opt">]; </span><span class="kwa">do</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
      h<span class="opt">=</span><span class="str">"${h# }"</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    <span class="kwa">done</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    lh<span class="opt">=</span><span class="str">"$(echo $lh | tr '[a-z]-' '[A-Z]_')"</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    <span class="kwa">case </span><span class="kwd">$lh </span><span class="kwa">in</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
      CONTENT_LENGTH<span class="opt">) </span>h<span class="opt">=</span><span class="num">0 </span><span class="opt">;; </span><span class="slc"># unknown</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
      CONTENT_TYPE<span class="opt">) ;;</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
      <span class="opt">*) </span>lh<span class="opt">=</span>HTTP_<span class="kwd">$lh </span><span class="opt">;;</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    <span class="kwa">esac</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    <span class="kwb">eval </span><span class="kwd">$lh</span><span class="opt">=</span><span class="esc">\"</span>\<span class="kwd">$h</span><span class="esc">\"</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
    <span class="kwb">export </span><span class="kwd">$lh</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
  <span class="kwa">fi</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
<span class="kwa">done</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
<span class="kwb">trap </span><span class="str">"rm /tmp/body.$$"</span> <span class="num">0</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
<span class="kwc">cat </span><span class="opt">&gt;/</span>tmp<span class="opt">/</span>body.$$
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
<span class="kwb">export </span>CONTENT_LENGTH<span class="opt">=</span>$<span class="opt">(</span>stat <span class="opt">-</span>c <span class="opt">%</span>s <span class="opt">/</span>tmp<span class="opt">/</span>body.$$<span class="opt">)</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
<span class="kwb">echo </span>Content<span class="opt">-</span>Length<span class="opt">: </span><span class="kwd">${CONTENT_LENGTH} </span><span class="opt">&gt;&amp;</span><span class="num">2</span>
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
<span class="kwb">test </span><span class="kwd">${CONTENT_LENGTH} </span><span class="opt">-</span>eq <span class="num">0 </span><span class="opt">&amp;&amp; </span><span class="kwb">unset </span>CONTENT_LENGTH
</pre>
        </li>
        <pre>

</pre>

        <li>
          <pre>
<span class="str">"$@"</span> <span class="opt">&lt; /</span>tmp<span class="opt">/</span>body.$$
</pre>
        </li>
        <pre>

</pre>
      </li>
    </ol>
  </div>

  <p>This can be used to execute the test CGI with an almost valid HTTP request:</p>
  <pre class="dfn">
<a name="NW0-QRfud-1" href="#NW0-QRfud-1" id="NW0-QRfud-1"><dfn>&lt;(build.nw) Test Scripts&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">test</span><span class="opt">-</span>cgi \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-HxEJh-1" href="#NW0-HxEJh-1" id="NW0-HxEJh-1"><dfn>&lt;test-cgi&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">grep </span><span class="str">'^&lt;&lt;test-http-.*&gt;&gt;=$'</span> <span class="opt">*</span>.nw | \
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">sed </span><span class="str">'s/\([^:]*\):[^&lt;]*&lt;&lt;\(.*\)&gt;&gt;=$/\1 \2/'</span> | \
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">sort </span><span class="opt">-</span>u | <span class="kwa">while </span><span class="kwb">read </span>f cn<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">echo</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">echo </span><span class="str">"*** $cn ***"</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">echo</span>
</pre>
      </li>

      <li>
        <pre>
      notangle <span class="opt">-</span>R<span class="str">"$cn"</span> <span class="str">"$f"</span> | .<span class="opt">/</span>pass<span class="opt">-</span>http .<span class="opt">/</span><span class="kwb">test</span>.cgi debug<span class="opt">=</span><span class="num">1 </span>cgi_session_dir<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2vH4P-1" href="#NW0-2vH4P-1" id="NW0-2vH4P-1"><dfn>&lt;test-http-get&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
GET /?some_parameter=y HTTP/1.1
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1zNc0p-2" href="#NW0-1zNc0p-1" id="NW0-1zNc0p-2"><dfn>&lt;(build.nw) makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-1zNc0p-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
test-cgi<span class="opt">: </span><span class="kwa">test</span>.cgi pass-http
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc15" id="toc15">Usage</a></h1>

  <p>Many of the features of this document can be used independently of the build system, but it is intended that this document be depended on by anything that uses it.</p>

  <p>To use the HTML macros, include <code>html_macros.cs</code> into a ClearSilver file. It does not output any text. The macros are:</p>

  <dl>
    <dt>form(<em>fname</em>, <em>hasfiles</em>)</dt>

    <dd>simply displays the form start tag for a form of the given name. The content type is set to multipart, as required for file uploads, if <em>hasfiles</em> is true.</dd>

    <dt>text(<em>varn</em>, <em>default</em>)</dt>

    <dd>displays a text entry box for the given CGI parameter name, initialized to the CGI parameter's current value if present or <em>default</em> if not.</dd>

    <dt>rtext(<em>varn</em>,<em>seq</em>,<em>default</em>)</dt>

    <dd>displays a text entry box for the given CGI parameter name, initialized to the CGI parameter's current <em>seq</em>th value if present, or <em>default</em> if not. The <em>seq</em>th value is determined by looking at the children of <em>varn</em>, starting at 0. This is how ClearSilver usually encodes multiple values of the same name.</dd>

    <dt>hidden(<em>varn</em>)</dt>

    <dd>displays hidden form entries for all values of <em>varn</em>. This may display nothing if <em>varn</em> has no value.</dd>

    <dt>file(<em>varn</em>)</dt>

    <dd>displays a consistently sized file entry box for <em>varn</em>.</dd>

    <dt>radio(<em>varn</em>, <em>value</em>, <em>default</em>)</dt>

    <dd>displays a radio box for the CGI parameter <em>varn</em>, whose value when checked will be <em>value</em>. The entry will be checked if <em>default</em> is true and no value exists for <em>varn</em>; otherwise it will be checked if <em>varn</em> currently has any value equal to <em>value</em>.</dd>

    <dt>checkbox(<em>varn</em>)</dt>

    <dd>displays a checkbox for the CGI parameter <em>varn</em>, whose returned value will be Y if checked. The box will be checked if <em>varn</em> exists and is non-blank.</dd>

    <dt>date(<em>varn</em>, <em>default</em>)</dt>

    <dd>displays a date entry box for the CGI parameter <em>varn</em>. The default value is set as with text boxes. In fact, this is just a text box whose class is <code>datesel</code>, on the assumption that JavaScript will be used to convert this into something fancier.</dd>

    <dt>submit(<em>action</em>)</dt>

    <dd>displays a submission button whose name is action.<em>action</em> and whose value (i.e. label) is retrieved from the HDF parameter labels.<em>action</em>. It is assumed that the CGI will use the button name rather than its value.</dd>

    <dt>optdiv_onload(), optdiv_start(), optdiv_opt(<em>label</em>, <em>div</em>), optdiv_end()</dt>

    <dd>See below.</dd>

    <dt>print_session_parms()</dt>

    <dd>displays the session CGI parameters as hidden form entries; see discussion of sessions below.</dd>

    <dt>add_session_parms(<em>first</em>)</dt>

    <dd>displays the session CGI parameters in a form suitable for adding to a URL string, using a question mark or ampersand to separate from the URL depending on <em>first</em>. See discussion of sessions below.</dd>

    <dt>print_session_cookies()</dt>

    <dd>displays the HTTP header required to set session cookies; see discussion of sessions below.</dd>
  </dl>

  <p>A facility is provided for displaying HTML one division at a time, like tabs. A selection widget is used like a drop-down menu to select which division to show. This requires JavaScript; if JavaScript is not available, all divisions will be shown in the order they appear in the HTML. The JavaScript file, <code>html_prefix.js</code>, must be available on the web server. The web server relative path is defined in the configuration parameter <code>server_script_path</code>, which defaults to <code>/js</code>. The JavaScript file is included in all HTML by extending <code>html_prefix.cs</code>.</p>

  <p>To use the division selector, add a macro call <code>optdiv_onload()</code> to the code executed on body load (e.g. in the onload parameter of the body tag). Then, in the main HTML, wherever the selection widget is to appear, define this widget using the macro <code>optdiv_start()</code>, followed by, for each division, <code>optdiv_opt(label, div)</code> with the text to show in the selector and the division number to show. The divisions are named div1, div2, etc. and the option value is the number only (i.e. 1, 2, etc.). Finally, close out the selection widget with a call to <code>optdiv_end()</code>. Naturally, the HTML to be shown or hidden must then be in divisions with the appropriate id values.</p>

  <p>FastCGI support is provided by a few functions, and revolves around the <code>cgi_state</code> variable passed into those functions. The standard mainline variables have this added if you use <code><a href="#NW0-4fQs2w-1"><i>&lt;CGI Mainline Variables&gt;</i></a></code> instead. The callback gets this passed in as its only parameter. Some useful entries in this structure are:</p>

  <ul>
    <li><code>HDF *hdf</code> is the global parameters with the CGI parameters overlaid on top.</li>

    <li><code>HDF *cgi_parms</code> is a quick reference to the CGI parameters only.</li>

    <li><code>HDF *cgi_cookies</code> is a quick reference to the cookies only.</li>

    <li><code>HDF *headers</code> is a quick reference to the HTTP headers.</li>

    <li><code>const char *userid</code> is a quick reference to the known user name. This is NULL if the name is unknown.</li>

    <li><code>const char *method</code> is a quick reference to the request method.</li>

    <li><code>const char *body_enc</code> is a quick reference to the body encoding type. If the cooked input functions are used, this can be safely ignored.</li>

    <li><code>gint64 body_len</code> is a quick reference to the body's content-length. If the length is unknown, it is set to <i>-1</i>.</li>

    <li><code>const char *body_type</code> is a quick reference to the body's content-type.</li>

    <li><code>HDF *session</code> contains any session values current read in. It is also a quick reference to <code>hdf</code>'s Session parameter.</li>

    <li><code>cgi_upload_cb upload_cb</code> is a set of callbacks for upload control. This structure contains <code>open</code>, <code>write</code>, <code>progress</code>, and <code>close</code> callbacks, along with user <code>data</code>. Any may be left NULL to use the default action. Each callback has the HDF specifying the parameter currently being uploaded (with its value indicating the file name, and its children indicating some header fields, such as <code>Length</code>, <code>ModTime</code>, <code>CreationTime</code>, <code>AccessTime</code>, and <code>Type</code>) as its first parameter, and the <code>cgi_state</code> as the second parameter. They all return a ClearSilver error structure. The <code>open</code> callback takes no additional parameters, and is expected to open the file and store its descriptor in <code>data</code>. It can use any CGI parameters already known from <code>cgi_parms</code>. The <code>write</code> callback takes a <code>guint64</code> offset, a buffer pointer, and an <code>int</code> length for the data to write. All data must be written before returning success. The <code>progress</code> callback is a simplified version of the <code>write</code> callback which only takes the offset and length parameters; this is the equivalent of the standard callback. The <code>close</code> callback is called when all is done, and has only the errors returned by previous phases as its additional parameter, so that it knows whether or not it should delete the final result.</li>

    <li><code>cgi_cleanup_cb cleanup</code> is a function to call when the current thread is complete; it returns nothing and takes the <code>cgi_state</code> as its only parameter. Users of this are expected to implement manual chaining by storing the previous value and calling it if non-NULL.</li>

    <li><code>create_session</code>, <code>session_cg_data</code>, <code>read_session</code>, and <code>update_session</code> are overrides for session management; see the main document for details on how these work.</li>

    <li><code>xmlDocPtr xmlbody</code> is a parsed XML body, if there was one and the request method was not one of GET, HEAD, POST, or PUT.</li>

    <li><code>xmlNsPtr dav_ns</code> is a pointer to a namespace named <code>DAV:</code>, if a node was processed which uses that namespace. It can be used with <code>check_ns</code> to check an XML node's namespace.</li>
  </ul>

  <p>The CGI state's HDF can be printed when debugging using:</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">cgi_dump_hdf</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>Reading the various parameters from <code>cgi_state</code> is made easier with macros:

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">const char </span><span class="hl opt">*</span><span class="hl kwd">cgi_env_val</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">const char </span><span class="hl opt">*</span>def<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">gint64 </span><span class="hl kwd">cgi_env_val_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                       <span class="hl kwb">gint64 </span>def<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_env_set</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="hl kwb">const char </span><span class="hl opt">*</span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_env_set_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">gint64 </span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">HDF </span><span class="hl opt">*</span><span class="hl kwd">cgi_env_obj</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These operate on the <code>hdf</code> entry. They read character and integer values, set character and integer values, and return the object pointer, respectively.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">const char </span><span class="hl opt">*</span><span class="hl kwd">cgi_header_val</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">const char </span><span class="hl opt">*</span>def_val<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">gint64 </span><span class="hl kwd">cgi_header_val_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                          <span class="hl kwb">gint64 </span>def_val<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_header_set</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                       <span class="hl kwb">const char </span><span class="hl opt">*</span>val<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_header_set_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">gint64 </span>val<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">HDF </span><span class="hl opt">*</span><span class="hl kwd">cgi_header_obj</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These operate on the <code>headers</code> entry. They read character and integer values and set character and integer values, and return the object pointer, respectively. There is no hierarchy in the headers initially, but code may add children to help with parsing, so the <code>cgi_header_obj</code> function may still be useful.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">const char </span><span class="hl opt">*</span><span class="hl kwd">cgi_parm_val</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                         <span class="hl kwb">const char </span><span class="hl opt">*</span>def<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">gint64 </span><span class="hl kwd">cgi_parm_val_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">gint64 </span>def<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_parm_set</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                     <span class="hl kwb">const char </span><span class="hl opt">*</span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_parm_set_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                         <span class="hl kwb">gint64 </span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">HDF </span><span class="hl opt">*</span><span class="hl kwd">cgi_parm_obj</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These operate on the <code>cgi_parms</code> entry. They read character and integer values, set character and integer values, and return the object pointer, respectively.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">for_each_cgi_parm</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                       <span class="hl kwb">for_each_cb </span>f<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                       <span class="hl opt">...)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">for_each_cgi_parm_obj</span><span class="hl opt">(</span><span class="hl kwb">HDF </span><span class="hl opt">*</span>obj<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">for_each_cb </span>f<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl opt">...)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These iterate on all values of a single or multi-valued CGI parameter, calling the callback for each object. The first takes the CGI parameter name, and the second takes the root object. The callback takes the object as its first argument, and further macro arguments as its remaining arguments.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">const char </span><span class="hl opt">*</span><span class="hl kwd">cgi_cookie_val</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">const char </span><span class="hl opt">*</span>def<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">gint64 </span><span class="hl kwd">cgi_cookie_val_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                          <span class="hl kwb">gint64 </span>def<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_cookie_set</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                       <span class="hl kwb">const char </span><span class="hl opt">*</span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_cookie_set_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">gint64 </span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">HDF </span><span class="hl opt">*</span><span class="hl kwd">cgi_cookie_obj</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These operate on the <code>cgi_cookies</code> entry. They read character and integer values, set character and integer values, and return the object pointer, respectively.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">const char </span><span class="hl opt">*</span><span class="hl kwd">cgi_session_val</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="hl kwb">const char </span><span class="hl opt">*</span>def_val<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">gint64 </span><span class="hl kwd">cgi_session_val_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">gint64 </span>def_val<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_session_set</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">const char </span><span class="hl opt">*</span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_session_set_int</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="hl kwb">gint64 </span>value<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">HDF </span><span class="hl opt">*</span><span class="hl kwd">cgi_session_obj</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These operate on the <code>session</code> entry. They read character and integer values, set character and integer values, and return the object pointer, respectively.
  </blockquote>

  <p>Printing output and retrieving environment and PUT data is done via macros which use <code>cgi_state</code>:</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">int </span><span class="hl kwd">cgi_puts</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>str<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>fputs</code> equivalent.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">int </span><span class="hl kwd">cgi_putc</span><span class="hl opt">(</span><span class="hl kwb">char </span>c<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>fputc</code> equivalent.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">int </span><span class="hl kwd">cgi_write</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
              <span class="hl kwb">int </span>length<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>fwrite</code> equivalent.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">int </span><span class="hl kwd">cgi_printf</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>format<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
               <span class="hl opt">...)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>fprintf</code> equivalent.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">int </span><span class="hl kwd">cgi_vprintf</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>fmt<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                <span class="hl kwb">va_list </span>parms<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>vfprintf</code> equivalent.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">cgi_status</span><span class="hl opt">(</span><span class="hl kwb">int </span>stat<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This should be called when printing the Status header, in addition to actually printing that header.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">int </span><span class="hl kwd">cgi_raw_gets</span><span class="hl opt">(</span><span class="hl kwb">char </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="hl kwb">int </span>length<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>fgets</code> equivalent. Do not use this; use <code>cgi_gets</code> instead.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">int </span><span class="hl kwd">cgi_raw_read</span><span class="hl opt">(</span><span class="hl kwb">char </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="hl kwb">int </span>length<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>fread</code> equivalent, with an object size of one. Only use this if you want to bypass automatic decoding. Otherwise, use <code>cgi_read</code>.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">const char </span><span class="hl opt">*</span><span class="hl kwd">cgi_getenv</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>name<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the <code>getenv</code> equivalent.
  </blockquote>

  <p>For encoded input streams, decoding versions of the input functions are also provided; since their side effects are more complex, they return a NEOERR rather than a simple flag:</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_decode_gets</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">char </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">int </span>length<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_gets</span><span class="hl opt">(</span><span class="hl kwb">char </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="hl kwb">int </span>length<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These are the <code>fgets</code> equivalent.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_decode_read</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">char </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">int </span>length<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">int </span><span class="hl opt">*</span>retlength<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_read</span><span class="hl opt">(</span><span class="hl kwb">char </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="hl kwb">int </span>length<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="hl kwb">int </span><span class="hl opt">*</span>retlength<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    These are the <code>fread</code> equivalent, with an object size of one.
  </blockquote>

  <p>In addition, adding the <code><a href="#NW0-pXiuJ-1"><i>&lt;CGI Message Overrides&gt;</i></a></code> chunk to any C file overrides the <code>die_if_err</code> and other <code>die_</code> macros to display their output using the above macros instead of printing to standard error. They do not, however, prevent exiting the entire FastCGI program rather than just the current thread.</p>

  <p>Since most output is for HTML, a few HTML-related escape functions are provided as well. The HTML may be a template, so CGI-equivalents of the template output function are also provided.</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_puts_url_escape</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                            <span class="hl kwb">const char </span><span class="hl opt">*</span>s<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Prints <code>s</code> using the standard URL-encoding. Unlike the standard's recommendation, space is encoded using the plus sign rather than <code>%20</code>.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_puts_html_escape</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">const char </span><span class="hl opt">*</span>s<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">gboolean </span>is_js<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Prints <code>s</code> using HTML-encoding. Backslashes and single quotes are also backslash-escaped if the <code>is_js</code> flag is TRUE. Any specials other than less-than, greater-than, ampersand, and quote are quoted using numeric escapes.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">GString </span><span class="hl opt">*</span><span class="hl kwd">g_string_append_html_escaped</span><span class="hl opt">(</span><span class="hl kwb">GString </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="hl kwb">const char </span><span class="hl opt">*</span>s<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                      <span class="hl kwb">gboolean </span>is_js<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Escapes <code>s</code> into <code>buf</code> using HTML-encoding. See <code>cgi_puts_html_escape</code> for details.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">tmpl_to_cgi</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>tmpl<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="hl kwb">gboolean </span>raw<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the equivalent of <code>tmpl_string</code>, using the default CGI parameters overlayed on the global parameters.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">tmpl_file_to_cgi</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>tmpl<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                         <span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                         <span class="hl kwb">gboolean </span>raw<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the equivalent of <code>tmpl_file</code>, using the default CGI parameters overlayed on the global parameters.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">tmpl_to_cgi_hdf</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>tmpl<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">HDF </span><span class="hl opt">*</span>parms<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">gboolean </span>raw<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the equivalent of <code>tmpl_string</code>, except that rather than using the default CGI parameters, a different set of parameters can be provided.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">tmpl_file_to_cgi_hdf</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>tmpl<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">HDF </span><span class="hl opt">*</span>parms<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">gboolean </span>raw<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    This is the equivalent of <code>tmpl_file</code>, except that rather than using the default CGI parameters, a different set of parameters can be provided.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cgi_output_json</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">HDF </span><span class="hl opt">*</span>hdf<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Prints the given <code>hdf</code> parameter and its children in JSON format.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">normalize_path_obj</span><span class="hl opt">(</span><span class="hl kwb">HDF </span><span class="hl opt">*</span>obj<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">const char </span><span class="hl opt">*</span>relative_to<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">gboolean </span>utf_8<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">gboolean </span>strip_cgi_script<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>Finally, since HTTP requests and CGI parameters deal with paths, a function is provided to normalize those paths. It can optionally normalize UTF-8 paths, can deal with absolute or potentially relative (non-NULL <code>relative_to</code>) paths, and optionally strip the CGI path to produce something similar to <code>PATH_INFO</code>.

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">init_cgi</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">run_cgi</span><span class="hl opt">(</span><span class="hl kwb">cgi_callback_t </span>callback<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">init_cgi_run</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">gboolean </span><span class="hl kwd">cgi_fork</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>The basic structure of a FastCGI program consists of a mainline which does global setup and calls <code>init_cgi</code>, and a callback function which is called in a new thread for every FastCGI connection. The callback function is invoked via <code>run_cgi</code>, which takes a function pointer which returns an error pointer and takes only <code>cgi_state</code> as its parameter. The first function to call in the callback is <code>init_cgi_run</code>, which copies the global configuration and merges the CGI parameters. If a process is needed instead of a thread, the thread can call <code>cgi_fork</code> as its first operation and execute the rest of its code if the return value was TRUE. If the program is run as a standard CGI program, the callback is not called in the main thread instead of a new one. To distinguish the two, the global variable <code>gboolean is_cgi</code> can be used. If the <code>run_cgi</code> callback returns an error, the error is printed. How this is printed is controlled by variables in the CGI state's hdf: <code>header_printed</code> (non-blank to indicate HTTP header has already been printed), <code>error_status</code> (set to override HTTP status), and <code>error_tmpl</code> (set to a template to print instead of the default; the error text is in <code>error_text</code>).

  <p>The upload enhancements include the callback mechanism described above, and the fact that it supports any content encodings now. XML uploads are automatically processed and WebDAV requests are checked. It is enabled by default. The callbacks should be set in the global initialization. Further checks in the XML can take advantage of the namespace checker function.</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">gboolean </span><span class="hl kwd">check_ns</span><span class="hl opt">(</span><span class="hl kwb">xmlNodePtr </span>node<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="hl kwb">xml_name_t </span>ns<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="hl kwb">xmlNsPtr </span><span class="hl opt">*</span>nscache<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>XML uploads are automatically parsed and WebDAV requests are checked as much as possible. Further checks in the XML can take advantage of the namespace checker function, which caches the last namespace to possibly avoid doing a string comparison every time. Also, for convenience, the name codes for the DAV and CALDAV namespaces are macros named <code>DAV_NS</code> and <code>CALDAV_NS</code>, respectively.

  <p>All of the above configuration options can be included in an application's configuration file using <code><a href="#NW0-AVbKa-1"><i>&lt;CGI Support Configuration&gt;</i></a></code>:</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl slc"># Location of JavaScript on the server</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#server_script_path = /js</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Maximum number of FastCGI threads</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#max_cgi_threads = 64</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Set to non-blank to override message to print on errors</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># This is evaluated as a ClearSilver template in the CGI environment; the</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># text of the error message is in the error_text variable.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># The default message prints:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#  &lt;html&gt;&lt;body&gt;&lt;h3&gt;An error occurred while processing your request:&lt;/h3&gt;&lt;pre&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#  &lt;?cs var:error_text ?&gt;&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#error_tmpl = &lt;html&gt;&lt;body&gt;&lt;h3&gt;An error occurred while processing ...</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Set to non-blank to override the status to return on errors</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#error_status = 500 Internal Server Error</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Set to non-blank to disable printing the HTTP header for error messages</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># This is usually set by any template which prints an HTTP header.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#header_printed =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># If set, limit XML request bodies (not PUT or POST) to this size, in bytes</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#max_xml_body = 100000</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">init_cgi_session</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">update_cgi_session</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>The session support is enabled by calling <code>init_cgi_session</code> instead of <code>init_cgi</code>. In the callback, <code>update_cgi_session</code> is called. It can also be called in upload callbacks; calling it multiple times will not affect operation. If it is called in an upload callback, the form which generated the upload should be sure to set session hidden variables before the file upload widget. This initializes a basic session with the following parameters:

  <dl>
    <dt>Session.RemoteAddress</dt>

    <dd>The remote user's advertised IP address, or 127.0.0.1 if none is advertised.</dd>

    <dt>Session.UserAgent</dt>

    <dd>The remote user's advertised user agent, or telnet if none is advertised.</dd>

    <dt>Session.RemoteUser</dt>

    <dd>The remote user's identity, if known, or blank otherwise.</dd>
  </dl>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">update_session_state</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>root_name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">HDF </span><span class="hl opt">*</span>root<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">HDF </span><span class="hl opt">**</span>unique_root<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>Any additional parameters can be set in <code>cgi_state-&gt;session</code> and then updated in the persistent state using <code>update_session_state</code>. This function takes the name of the root of the session parameters to update, the session parameter root object pointer (e.g. <code>cgi_session_obj(parm)</code>), a uniqueness pointer, and the <code>cgi_state</code>. The uniqueness pointer can be set to point to an unitialized HDF object pointer, in which case instead of updating the named parameter itself, a child will be added to the named parameter and its values will be the values passed in. The child is guaranteed to have a unqiue name among all of the children of that named node; the child object is returned in the uniqueness pointer so that its name, among other things, can be queried.

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">read_session_state</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>root_name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">const char </span><span class="hl opt">*</span>child_name<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">gboolean </span>recursive<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                           <span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>Since only the required session parameters are read from persistent state, any new parameters must also be explicitly read using <code>read_session_state</code>. This normally only obtains the named parameter, so if it has children, the <code>recursive</code> flag must be set. The name of the parameter is passed in as two parts, either of which may be NULL, to make hierarchical parameter retrieval easier.

  <p>These sessions are stored in files; this requires configuration from <code><a href="#NW0-2SuyVE-1"><i>&lt;CGI Session Support Configuration&gt;</i></a></code> to configure a directory with <code>cgi_session_dir</code> (<code>/var/cache/cgi-sessions</code> by default). They are touched on every access, so a program can expire old sessions by examining the modification time. One such program is <code>delete_old_files</code>, which takes the session directory, expiration time in seconds, and optionally the time to next scan for expired sessions, in seconds (by default only scan once).</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl slc"># The default directory where local sessions are stored</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Clearing this parameter disables local file session support</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#cgi_session_dir = /var/cache/cgi-sessions</span>
</pre>
      </li>
    </ol>
  </div>Keeping track of the session on the client side is done using cookies and/or CGI parameters. In general, the functions to print CGI parameters will print nothing if cookies are detected, unless their <code>force</code> parameter is set to TRUE. Likewise, if a cookie is already set, there is no need to set it again, so the cookie printers will also print nothing if a cookie is detected. They will also print nothing if a CGI parameter is set indicating that cookies were not available at some point, so there is no need to keep trying. Either way, a <code>force</code> parameter overrides this logic. The functions are:

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">print_session_cgi_parms</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                <span class="hl kwb">gboolean </span>force<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Prints CGI parameters as hidden inputs.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">g_string_append_session_cgi_parms</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                       <span class="hl kwb">gboolean </span>first<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                       <span class="hl kwb">GString </span><span class="hl opt">*</span>buf<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                                       <span class="hl kwb">gboolean </span>force<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Tacks CGI parameters to a string as if it were a URL being built. The first parameter generates a question mark if <code>first</code> is TRUE, or an ampersand otherwise.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">print_session_cookie</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                             <span class="hl kwb">gboolean </span>force<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Prints the HTTP header required to set the cookie.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">set_session_tmpl_vars</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                              <span class="hl kwb">gboolean </span>force_cookie<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                              <span class="hl kwb">gboolean </span>force_form<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Sets <code>CGI.SessionParms</code> and <code>CGI.SessionCookies</code> so that their values can be used in ClearSilver templates to print the cookie header and/or hidden form entries using <code>print_session_cookies</code>, <code>print_session_parms</code>, and <code>add_session_parms</code>.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">logout_cgi_session</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">gboolean </span>print_cookies<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>If the client expects to log out, the session can be destroyed using <code>logout_cgi_session</code>, which destroys the session and optionally prints the HTTP header required to clear the cookies.

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">init_db_cgi_session</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">prepare_db_session</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>To use the database sessions instead of files, create the table using <code>sessdbcreate.sql</code> (possibly edited), and set up an ODBC driver. Use <code><a href="#NW0-B9EcR-1"><i>&lt;CGI Database Session Support Configuration&gt;</i></a></code> to add the configuration parameters for the connection string and cascading delete capability to the configuration file (<code>dbconnect</code> and <code>dbcascade</code>, which default to blank). Call <code>init_db_cgi_session</code> instead of <code>init_cgi_session</code>, and call <code>prepare_db_session</code> before <code>update_cgi_session</code>. This will set up the session callback overrides, so no other code can use these without saving and manual chaining. While the database routines could be used for other purposes as well, this session support is not intended for that. The database environment is not exported. Also, if <code>dbconnect</code> is blank, the database functions will be disabled and sessions will revert to files. To guarantee this will not happen, manually check that the parameter is not blank or missing. The database equivalent of <code>delete_old_files</code> is <code>delete_old_db_sessions</code>, which takes the connection string and timeout parameters in ClearSilver form rather than as basic parameters:

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl slc"># ODBC Database connection string; blank to disable</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Format is generally DSN=&lt;dsn&gt;[; UID=&lt;username&gt;; PWD=&lt;password&gt;]</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Or apparently also FILEDSN=&lt;filename&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#dbconnect =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># The SQL data type used for database table keys</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#id_field_type = bigint</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># The maximum length of a session value before extension</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># 0 means there is no maximum</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#sessval_length = 126</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># The maximum length of an extension before further extension</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># 0 means there is no maximum</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#strext_length = 32768</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Set to non-blank if the CGI session table supports cascading deletes</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#dbcascade =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># How long to wait before next expired session check (seconds)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#clean_interval=60</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># How long to wait before expiring sessions (seconds)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#expire_time=1200</span>
</pre>
      </li>
    </ol>
  </div>To use the database connection for other purposes, the database connection can be retrieved from <code>cgi_state-&gt;session_cb_data</code> as a <code>db_conn</code> pointer after <code>preapare_db_session</code>. The following macros can then be used to execute SQL, assuming that <code>conn</code> contains a pointer to the database connection:

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_exec</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>sql<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Execute SQL directly.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_prep</span><span class="hl opt">(</span><span class="hl kwb">const char </span><span class="hl opt">*</span>sql<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Prepare SQL for binding and later execution.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_binds</span><span class="hl opt">(</span><span class="hl kwb">int </span>param<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                   <span class="hl kwb">const char </span><span class="hl opt">*</span>str<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Bind a string to a parameter position. If the string pointer is NULL, the value will be bound to SQL null.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_bind64</span><span class="hl opt">(</span><span class="hl kwb">int </span>param<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="hl kwb">guint64 </span><span class="hl opt">&amp;</span>val<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Bind a 64-bit integer to a parameter position.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_bindsl</span><span class="hl opt">(</span><span class="hl kwb">int </span>param<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="hl kwb">const char </span><span class="hl opt">*</span>str<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                    <span class="hl kwb">SQLLEN </span>len<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Bind a string of a given length to a parameter position. The length must be a variable which will not change until the binding is no longer needed.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_bindnull</span><span class="hl opt">(</span><span class="hl kwb">int </span>param<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Bind SQL null to a parameter position.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_next</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Prepare the shared statement handle for a new SQL statement.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">db_trans</span><span class="hl opt">(</span><span class="hl kwb">SQLSMALLINT </span>type<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Execute a commit (<code>SQL_COMMIT</code>) or rollback (<code>SQL_ROLLBACK</code>) on the current transaction.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">db_commit</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    If the current <code>ret</code> return code is a successful SQLRETURN value, commit the current transaction. Also, set the <code>dbcerr</code> local variable to <code>TRUE</code>; this is to distinguish error types when interpreting ODBC error codes.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">db_commit_keeperr</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Commit the current transaction, regardless of the value of <code>ret</code>, but update <code>ret</code> to an error (and <code>dbcerr</code> to <code>TRUE</code>) if it was a successful SQLRETURN value.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">db_err</span><span class="hl opt">(</span><span class="hl kwb">gboolean </span>dbcerr<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Convert the current SQL error stack for the connection to a NEOERR. The <code>dbcerr</code> switch selects which handle to use; this is usually <code>FALSE</code> (i.e., the statement handle), but is <code>TRUE</code> for connection-level operations, such as commits.
  </blockquote>

  <p>The following support functions are provided as well; any other operations should be done using direct ODBC calls with <code>conn-&gt;stmt</code> and <code>conn-&gt;dbc</code>.</p>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">odbc_msg</span><span class="hl opt">(</span><span class="hl kwb">SQLSMALLINT </span>htype<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                 <span class="hl kwb">SQLHANDLE </span>h<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Convert all pending ODBC errors on a handle to a NEOERR. This takes the handle (env, stmt or dbc) and the handle type (<code>SQL_HANDLE_ENV</code>, <code>SQL_HANDLE_STMT</code> or <code>SQL_HANDLE_DBC</code>).
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">SQLRETURN </span><span class="hl kwd">SQLGetGString</span><span class="hl opt">(</span>HSTMT <span class="hl opt">*</span>stmt<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">int </span>pno<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                        <span class="hl kwb">GString </span><span class="hl opt">*</span>buf<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <blockquote>
    Retrieve a character type result into a dynamic string. The result is appended, so truncation may be necessary before calling.
  </blockquote>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">void </span><span class="hl kwd">init_cas</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">check_cas</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                  <span class="hl kwb">gboolean </span><span class="hl opt">*</span>needs_redirect<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">cas_redirect</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl kwb">NEOERR </span><span class="hl opt">*</span><span class="hl kwd">update_cas</span><span class="hl opt">(</span><span class="hl kwb">cgi_state_t </span><span class="hl opt">*</span>cgi_state<span class="hl opt">,</span>
</pre>
      </li>

      <li>
        <pre>
                   <span class="hl kwb">gboolean </span><span class="hl opt">*</span>did_redirect<span class="hl opt">)</span>
</pre>
      </li>
    </ol>
  </div>Finally, to use CAS with sessions, add <code><a href="#NW0-6yJSy-1"><i>&lt;CAS Support Configuration&gt;</i></a></code> to the configuration file, which allows setting <code>cas_url</code> and <code>cas_svc</code> to enable CAS. Call <code>init_cas</code> in the mainline, and call <code>update_cas</code> in the callback instead of <code>update_cgi_session</code>. If it is desirable to check if valid CAS credentials exist without forcing a CAS redirect if they don't, call <code>check_cas</code> instead. In either case, the redirection variable is updated depending on whether or not a redirect was required. For <code>check_cas</code>, it is expected that the caller will eventually run <code>cas_redirect</code> to perform the actual redirect, and for <code>update_cas</code>, the caller is expected to exit if a redirect occurred. Either may update session parameters if CAS authentication succeeds.

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="hl slc"># The CAS server URL; must end in a slash</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># CAS is disabled if this is blank.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#cas_url =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># The CAS service type</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># This is not used if blank</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#cas_svc =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># The SSL Certificate Authority file to use with CAS</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># If blank, use a reasonable default system CA file</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#cas_ca =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># The maximum seconds between ticket renewals</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Note that multiple hosts verifying the same ticket must have synchronized</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># clocks</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc"># Setting this too short (e.g. 0) will force continual renewals</span>
</pre>
      </li>

      <li>
        <pre>
<span class="hl slc">#cas_renew_interval = 600</span>
</pre>
      </li>
    </ol>
  </div>The CAS redirection saves the current set of CGI parameters, a few HTTP headers, and the request method in the session state for restoration after CAS returns. This means that new CGI parameters can be introduced into the HDF (e.g. using <code>cgi_parm_set</code>) before calling <code>cas_redirect</code> or <code>update_cas</code>, and they can be removed afterwards. These parameters would then reappear only on return from CAS by <code>update_cas</code> or <code>check_cas</code>. For example, this could be used to save HTTP headers not normally saved, or to set a flag indicating that an upload was aborted due to CAS redirection. Since saving HTTP headers is done anyway, they can also be saved by being added as comma-terminated strings to <code><a href="#NW0-4KmDoT-1"><i>&lt;HTTP Headers to Save on CAS Redirect&gt;</i></a></code>, or by storing the header normally stored at <code>HTTP.</code><em>parameter</em> in the CGI parameter <code>_HTTP_.</code><em>parameter</em>. Note that this also means that the <code>_HTTP_</code> parameter and the hierarchy underneath it are reserved for use in this manner.

  <p>See the sample program in the previous chapter for an example which uses database sessions and CAS.</p>

  <h1><a name="toc16" id="toc16">Code Dependencies</a></h1>

  <p>This application depends on several tools and libraries not included in this document. In addition to the <em>Generic ClearSilver and GLib Module Build Support</em> document (cs-glib.nw) and its dependencies, FastCGI support depends on libfcgi (tested with <i>2.4.0</i>) and CAS support depends on libcurl (tested with <i>7.18.0</i>). The database session support requires ODBC development libraries (tested with unixODBC and iODBC). The content encoding support requires zlib (tested with <i>1.2.3.3</i>), and optionally a recent libarchive (tested with <i>2.7.902</i>a, which is the minimum version).</p>

  <p>And here are the library-supplied datatypes used, for the highlighter.</p>
  <pre class="dfn">
<a name="NW0-4IhMOG-B" href="#NW0-4IhMOG-1" id="NW0-4IhMOG-B"><dfn>&lt;(build.nw) Known Data Types&gt;+=</dfn></a> <b>[<a href="#NW0-4IhMOG-A">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
SQLHENV<span class="opt">,</span>SQLHDBC<span class="opt">,</span>SQLSTATE<span class="opt">,</span>SQLRETURN<span class="opt">,</span>SQLHSTMT<span class="opt">,</span>SQLSMALLINT<span class="opt">,</span>SQLINTEGER<span class="opt">,</span>SQLLEN<span class="opt">,%</span>
</pre>
      </li>

      <li>
        <pre>
SQLHANDLE<span class="opt">,</span>GThreadPool<span class="opt">,</span>z_stream<span class="opt">,</span>archive<span class="opt">,</span>archive_entry<span class="opt">,</span>xmlDocPtr<span class="opt">,</span>xmlNodePtr<span class="opt">,%</span>
</pre>
      </li>

      <li>
        <pre>
xmlNsPtr<span class="opt">,</span>xmlAttrPtr<span class="opt">,</span>FCGX_Request<span class="opt">,%</span>
</pre>
      </li>
    </ol>
  </div>

  <h1><a name="toc17" id="toc17">Code Index</a></h1><!-- This must be last, because l2h always puts it last & ignores the directives-->

  <p><!-- Make sure chunk naming is consistent-->
  <!--  Title = all capitalized-->
  <!--  Action = only 1st capitalized--></p>

  <ul>
    <li><a href="#NW0-2uk6GO-1"><i>&lt;(build.nw) C Executables&gt;</i></a>: <a href="#NW0-2uk6GO-1">D1</a>, <a href="#NW0-2uk6GO-2">D2</a></li>

    <li><a href="#NW0-3a9iNE-1"><i>&lt;(build.nw) C Prototypes&gt;</i></a>: <a href="#NW0-3a9iNE-1">D1</a>, <a href="#NW0-3a9iNE-2">D2</a>, <a href="#NW0-3a9iNE-3">D3</a>, <a href="#NW0-3a9iNE-4">D4</a>, <a href="#NW0-3a9iNE-5">D5</a>, <a href="#NW0-3a9iNE-6">D6</a>, <a href="#NW0-3a9iNE-7">D7</a>, <a href="#NW0-3a9iNE-8">D8</a></li>

    <li><a href="#NW0-B0ssZ-1"><i>&lt;(build.nw) C Test Support Executables&gt;</i></a>: <a href="#NW0-B0ssZ-1">D1</a></li>

    <li><a href="#nw@notdef"><i>&lt;(build.nw) Common C Header&gt;</i></a>: <a href="#NW0-uQbLG-1">U1</a>, <a href="#NW0-2q5XL8-1">U2</a>, <a href="#NW0-2aaetw-1">U3</a>, <a href="#NW0-2mrnmy-1">U4</a>, <a href="#NW0-2Zonth-1">U5</a>, <a href="#NW0-wX3Vt-1">U6</a>, <a href="#NW0-n15ju-1">U7</a></li>

    <li><a href="#NW0-1mOMve-1"><i>&lt;(build.nw) Common C Includes&gt;</i></a>: <a href="#NW0-1mOMve-1">D1</a>, <a href="#NW0-1mOMve-2">D2</a>, <a href="#NW0-1mOMve-3">D3</a>, <a href="#NW0-1mOMve-4">D4</a>, <a href="#NW0-1mOMve-5">D5</a>, <a href="#NW0-1mOMve-6">D6</a>, <a href="#NW0-1mOMve-7">D7</a>, <a href="#NW0-1mOMve-8">D8</a></li>

    <li><a href="#NW0-17AJkL-1"><i>&lt;(build.nw) Common NoWeb Warning&gt;</i></a>: <a href="#NW0-17AJkL-1">D1</a>, <a href="#NW0-3L4zVQ-1">U2</a>, <a href="#NW0-2wJhWs-1">U3</a></li>

    <li><a href="#NW0-33kkYH-1"><i>&lt;(build.nw) Install other files&gt;</i></a>: <a href="#NW0-33kkYH-1">D1</a>, <a href="#NW0-33kkYH-2">D2</a></li>

    <li><a href="#NW0-4IhMOG-1"><i>&lt;(build.nw) Known Data Types&gt;</i></a>: <a href="#NW0-4IhMOG-1">D1</a>, <a href="#NW0-4IhMOG-2">D2</a>, <a href="#NW0-4IhMOG-3">D3</a>, <a href="#NW0-4IhMOG-4">D4</a>, <a href="#NW0-4IhMOG-5">D5</a>, <a href="#NW0-4IhMOG-6">D6</a>, <a href="#NW0-4IhMOG-7">D7</a>, <a href="#NW0-4IhMOG-8">D8</a>, <a href="#NW0-4IhMOG-9">D9</a>, <a href="#NW0-4IhMOG-A">D10</a>, <a href="#NW0-4IhMOG-B">D11</a></li>

    <li><a href="#NW0-3DeDMu-1"><i>&lt;(build.nw) makefile.config&gt;</i></a>: <a href="#NW0-3DeDMu-1">D1</a>, <a href="#NW0-3DeDMu-2">D2</a>, <a href="#NW0-3DeDMu-3">D3</a></li>

    <li><a href="#NW0-1zNc0p-1"><i>&lt;(build.nw) makefile.rules&gt;</i></a>: <a href="#NW0-1zNc0p-1">D1</a>, <a href="#NW0-1zNc0p-2">D2</a></li>

    <li><a href="#NW0-13PeAG-1"><i>&lt;(build.nw) makefile.vars&gt;</i></a>: <a href="#NW0-13PeAG-1">D1</a>, <a href="#NW0-13PeAG-2">D2</a>, <a href="#NW0-13PeAG-3">D3</a>, <a href="#NW0-13PeAG-4">D4</a>, <a href="#NW0-13PeAG-5">D5</a>, <a href="#NW0-13PeAG-6">D6</a></li>

    <li><a href="#NW0-2kYumM-1"><i>&lt;(build.nw) Plain Files&gt;</i></a>: <a href="#NW0-2kYumM-1">D1</a>, <a href="#NW0-2kYumM-2">D2</a>, <a href="#NW0-2kYumM-3">D3</a></li>

    <li><a href="#NW0-2F4ELl-1"><i>&lt;(build.nw) Script Executables&gt;</i></a>: <a href="#NW0-2F4ELl-1">D1</a></li>

    <li><a href="#NW0-35OSyj-1"><i>&lt;(build.nw) Sources&gt;</i></a>: <a href="#NW0-35OSyj-1">D1</a></li>

    <li><a href="#NW0-QRfud-1"><i>&lt;(build.nw) Test Scripts&gt;</i></a>: <a href="#NW0-QRfud-1">D1</a></li>

    <li><a href="#NW0-1r3EKH-1"><i>&lt;(build.nw) Version Strings&gt;</i></a>: <a href="#NW0-1r3EKH-1">D1</a></li>

    <li><a href="#nw@notdef"><i>&lt;(cs-glib.nw) Common Mainline Variables&gt;</i></a>: <a href="#NW0-4fQs2w-1">U1</a>, <a href="#NW0-3zffVE-1">U2</a>, <a href="#NW0-2Zonth-1">U3</a></li>

    <li><a href="#nw@notdef"><i>&lt;(cs-glib.nw) Convert <code>nerr</code> to <code>err_str</code>&gt;</i></a>: <a href="#NW0-wliTu-C">U1</a>, <a href="#NW0-2YEY-1">U2</a></li>

    <li><a href="#NW0-9Z2yk-1"><i>&lt;(cs-glib.nw) CS files&gt;</i></a>: <a href="#NW0-9Z2yk-1">D1</a></li>

    <li><a href="#nw@notdef"><i>&lt;(cs-glib.nw) Help Function&gt;</i></a>: <a href="#NW0-2Zonth-1">U1</a>, <a href="#NW0-n15ju-1">U2</a></li>

    <li><a href="#nw@notdef"><i>&lt;(cs-glib.nw) Install ClearSilver templates&gt;</i></a>: <a href="#NW0-33kkYH-1">U1</a></li>

    <li><a href="#NW0-E8T1B-1"><i>&lt;(cs-glib.nw) Library <code>cs-supt</code> Members&gt;</i></a>: <a href="#NW0-E8T1B-1">D1</a>, <a href="#NW0-E8T1B-2">D2</a>, <a href="#NW0-E8T1B-3">D3</a>, <a href="#NW0-E8T1B-4">D4</a></li>

    <li><a href="#nw@notdef"><i>&lt;(cs-glib.nw) Read configuration&gt;</i></a>: <a href="#NW0-2Zonth-1">U1</a>, <a href="#NW0-n15ju-1">U2</a></li>

    <li><a href="#nw@notdef"><i>&lt;(cs-glib.nw) Set up templates&gt;</i></a>: <a href="#NW0-n15ju-1">U1</a></li>

    <li><a href="#nw@notdef"><i>&lt;(cs-glib.nw) Template Parameter Configuration&gt;</i></a>: <a href="#NW0-g4tIN-1">U1</a></li>

    <li><a href="#NW0-3Zp9uJ-1"><i>&lt;<code>delete_old_db_sessions</code> Configuration&gt;</i></a>: <a href="#NW0-3Zp9uJ-1">D1</a></li>

    <li><a href="#NW0-1cQCKd-1"><i>&lt;<code>delete_old_db_sessions</code> Description&gt;</i></a>: <a href="#NW0-1cQCKd-1">D1</a></li>

    <li><a href="#NW0-g4tIN-1"><i>&lt;<code>test.cgi</code> Configuration&gt;</i></a>: <a href="#NW0-g4tIN-1">D1</a>, <a href="#NW0-3uGBjz-1">U2</a></li>

    <li><a href="#NW0-HKLLg-1"><i>&lt;<code>test.cgi</code> Description&gt;</i></a>: <a href="#NW0-HKLLg-1">D1</a>, <a href="#NW0-3uGBjz-1">U2</a></li>

    <li><a href="#NW0-2eGq2f-1"><i>&lt;Allocate CGI state&gt;</i></a>: <a href="#NW0-wliTu-3">U1</a>, <a href="#NW0-2eGq2f-1">D2</a></li>

    <li><a href="#NW0-3KZJKV-1"><i>&lt;basicsearch DTD&gt;</i></a>: <a href="#NW0-EIFsf-4">U1</a>, <a href="#NW0-3KZJKV-1">D2</a></li>

    <li><a href="#NW0-2O4kP-1"><i>&lt;Break multi-part file read and set <code>eof</code> if boundary found&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-2O4kP-1">D2</a></li>

    <li><a href="#NW0-p78BY-1"><i>&lt;Build session file name&gt;</i></a>: <a href="#NW0-p78BY-1">D1</a>, <a href="#NW0-36PIaC-1">U2</a>, <a href="#NW0-3n2jvq-1">U3</a>, <a href="#NW0-3agnOG-1">U4</a></li>

    <li><a href="#NW0-6yJSy-1"><i>&lt;CAS Support Configuration&gt;</i></a>: <a href="#NW0-6yJSy-1">D1</a>, <a href="#NW0-6yJSy-2">D2</a>, <a href="#NW0-6yJSy-3">D3</a>, <a href="#NW0-g4tIN-1">U4</a></li>

    <li><a href="#NW0-2We642-1"><i>&lt;CAS Support Functions&gt;</i></a>: <a href="#NW0-wX3Vt-1">U1</a>, <a href="#NW0-2We642-1">D2</a>, <a href="#NW0-2We642-2">D3</a>, <a href="#NW0-2We642-3">D4</a>, <a href="#NW0-2We642-4">D5</a></li>

    <li><a href="#NW0-3wu2oE-1"><i>&lt;CAS Support Variables&gt;</i></a>: <a href="#NW0-wX3Vt-1">U1</a>, <a href="#NW0-3wu2oE-1">D2</a>, <a href="#NW0-3wu2oE-2">D3</a>, <a href="#NW0-3wu2oE-3">D4</a></li>

    <li><a href="#NW0-wX3Vt-1"><i>&lt;cas.c&gt;</i></a>: <a href="#NW0-wX3Vt-1">D1</a></li>

    <li><a href="#NW0-3i0nme-1"><i>&lt;CGI Database Session Functions&gt;</i></a>: <a href="#NW0-2mrnmy-1">U1</a>, <a href="#NW0-3i0nme-1">D2</a>, <a href="#NW0-3i0nme-2">D3</a>, <a href="#NW0-3i0nme-3">D4</a>, <a href="#NW0-3i0nme-4">D5</a>, <a href="#NW0-3i0nme-5">D6</a>, <a href="#NW0-3i0nme-6">D7</a>, <a href="#NW0-3i0nme-7">D8</a>, <a href="#NW0-3i0nme-8">D9</a>, <a href="#NW0-3i0nme-9">D10</a>, <a href="#NW0-3i0nme-A">D11</a>, <a href="#NW0-3i0nme-B">D12</a>, <a href="#NW0-3i0nme-C">D13</a></li>

    <li><a href="#NW0-3K4jCX-1"><i>&lt;CGI Database Session Parameters&gt;</i></a>: <a href="#NW0-yctzv-1">U1</a>, <a href="#NW0-3K4jCX-1">D2</a></li>

    <li><a href="#NW0-B9EcR-1"><i>&lt;CGI Database Session Support Configuration&gt;</i></a>: <a href="#NW0-B9EcR-1">D1</a>, <a href="#NW0-B9EcR-2">D2</a>, <a href="#NW0-3Zp9uJ-1">U3</a>, <a href="#NW0-g4tIN-1">U4</a></li>

    <li><a href="#NW0-2ixk5s-1"><i>&lt;CGI Database Session Variables&gt;</i></a>: <a href="#NW0-2mrnmy-1">U1</a>, <a href="#NW0-2ixk5s-1">D2</a>, <a href="#NW0-2ixk5s-2">D3</a>, <a href="#NW0-2ixk5s-3">D4</a>, <a href="#NW0-2ixk5s-4">D5</a>, <a href="#NW0-2ixk5s-5">D6</a>, <a href="#NW0-2ixk5s-6">D7</a>, <a href="#NW0-2ixk5s-7">D8</a>, <a href="#NW0-2ixk5s-8">D9</a>, <a href="#NW0-2ixk5s-9">D10</a>, <a href="#NW0-2ixk5s-A">D11</a>, <a href="#NW0-2ixk5s-B">D12</a></li>

    <li><a href="#NW0-4fQs2w-1"><i>&lt;CGI Mainline Variables&gt;</i></a>: <a href="#NW0-4fQs2w-1">D1</a>, <a href="#NW0-n15ju-1">U2</a></li>

    <li><a href="#NW0-pXiuJ-1"><i>&lt;CGI Message Overrides&gt;</i></a>: <a href="#NW0-pXiuJ-1">D1</a>, <a href="#NW0-wliTu-B">U2</a>, <a href="#NW0-n15ju-1">U3</a></li>

    <li><a href="#NW0-3zffVE-1"><i>&lt;CGI Per-Run Variables&gt;</i></a>: <a href="#NW0-3zffVE-1">D1</a>, <a href="#NW0-n15ju-1">U2</a></li>

    <li><a href="#NW0-3BiK3G-1"><i>&lt;CGI Prerequisite Headers&gt;</i></a>: <a href="#NW0-1mOMve-1">U1</a>, <a href="#NW0-3BiK3G-1">D2</a>, <a href="#NW0-3BiK3G-2">D3</a>, <a href="#NW0-3BiK3G-3">D4</a></li>

    <li><a href="#NW0-2SuyVE-1"><i>&lt;CGI Session Support Configuration&gt;</i></a>: <a href="#NW0-2SuyVE-1">D1</a>, <a href="#NW0-g4tIN-1">U2</a></li>

    <li><a href="#NW0-16wLRV-1"><i>&lt;CGI Session Support Functions&gt;</i></a>: <a href="#NW0-2q5XL8-1">U1</a>, <a href="#NW0-16wLRV-1">D2</a>, <a href="#NW0-16wLRV-2">D3</a>, <a href="#NW0-16wLRV-3">D4</a>, <a href="#NW0-16wLRV-4">D5</a>, <a href="#NW0-16wLRV-5">D6</a>, <a href="#NW0-16wLRV-6">D7</a>, <a href="#NW0-16wLRV-7">D8</a>, <a href="#NW0-16wLRV-8">D9</a>, <a href="#NW0-16wLRV-9">D10</a>, <a href="#NW0-16wLRV-A">D11</a>, <a href="#NW0-16wLRV-B">D12</a></li>

    <li><a href="#NW0-1oOHaH-1"><i>&lt;CGI Session Support Variables&gt;</i></a>: <a href="#NW0-2q5XL8-1">U1</a>, <a href="#NW0-1oOHaH-1">D2</a></li>

    <li><a href="#NW0-3DkYjs-1"><i>&lt;CGI State Dependencies&gt;</i></a>: <a href="#NW0-1ozy8z-1">U1</a>, <a href="#NW0-3DkYjs-1">D2</a>, <a href="#NW0-3DkYjs-2">D3</a>, <a href="#NW0-3DkYjs-3">D4</a>, <a href="#NW0-3DkYjs-4">D5</a>, <a href="#NW0-3DkYjs-5">D6</a>, <a href="#NW0-3DkYjs-6">D7</a></li>

    <li><a href="#NW0-1Xz6uT-1"><i>&lt;CGI State Members&gt;</i></a>: <a href="#NW0-1ozy8z-1">U1</a>, <a href="#NW0-1Xz6uT-1">D2</a>, <a href="#NW0-1Xz6uT-2">D3</a>, <a href="#NW0-1Xz6uT-3">D4</a>, <a href="#NW0-1Xz6uT-4">D5</a>, <a href="#NW0-1Xz6uT-5">D6</a>, <a href="#NW0-1Xz6uT-6">D7</a>, <a href="#NW0-1Xz6uT-7">D8</a>, <a href="#NW0-1Xz6uT-8">D9</a>, <a href="#NW0-1Xz6uT-9">D10</a>, <a href="#NW0-1Xz6uT-A">D11</a>, <a href="#NW0-1Xz6uT-B">D12</a>, <a href="#NW0-1Xz6uT-C">D13</a>, <a href="#NW0-1Xz6uT-D">D14</a>, <a href="#NW0-1Xz6uT-E">D15</a>, <a href="#NW0-1Xz6uT-F">D16</a>, <a href="#NW0-1Xz6uT-G">D17</a>, <a href="#NW0-1Xz6uT-H">D18</a>, <a href="#NW0-1Xz6uT-I">D19</a></li>

    <li><a href="#NW0-AVbKa-1"><i>&lt;CGI Support Configuration&gt;</i></a>: <a href="#NW0-AVbKa-1">D1</a>, <a href="#NW0-AVbKa-2">D2</a>, <a href="#NW0-AVbKa-3">D3</a>, <a href="#NW0-AVbKa-4">D4</a>, <a href="#NW0-g4tIN-1">U5</a></li>

    <li><a href="#NW0-wliTu-1"><i>&lt;CGI Support Functions&gt;</i></a>: <a href="#NW0-uQbLG-1">U1</a>, <a href="#NW0-wliTu-1">D2</a>, <a href="#NW0-wliTu-2">D3</a>, <a href="#NW0-wliTu-3">D4</a>, <a href="#NW0-wliTu-4">D5</a>, <a href="#NW0-wliTu-5">D6</a>, <a href="#NW0-wliTu-6">D7</a>, <a href="#NW0-wliTu-7">D8</a>, <a href="#NW0-wliTu-8">D9</a>, <a href="#NW0-wliTu-9">D10</a>, <a href="#NW0-wliTu-A">D11</a>, <a href="#NW0-wliTu-B">D12</a>, <a href="#NW0-wliTu-C">D13</a>, <a href="#NW0-wliTu-D">D14</a>, <a href="#NW0-wliTu-E">D15</a>, <a href="#NW0-wliTu-F">D16</a>, <a href="#NW0-wliTu-G">D17</a>, <a href="#NW0-wliTu-H">D18</a>, <a href="#NW0-wliTu-I">D19</a>, <a href="#NW0-wliTu-J">D20</a>, <a href="#NW0-wliTu-K">D21</a>, <a href="#NW0-wliTu-L">D22</a>, <a href="#NW0-wliTu-M">D23</a>, <a href="#NW0-wliTu-N">D24</a>, <a href="#NW0-wliTu-O">D25</a>, <a href="#NW0-wliTu-P">D26</a>, <a href="#NW0-wliTu-Q">D27</a>, <a href="#NW0-wliTu-R">D28</a>, <a href="#NW0-wliTu-S">D29</a>, <a href="#NW0-wliTu-T">D30</a>, <a href="#NW0-wliTu-U">D31</a>, <a href="#NW0-wliTu-V">D32</a>, <a href="#NW0-wliTu-W">D33</a>, <a href="#NW0-wliTu-X">D34</a>, <a href="#NW0-wliTu-Y">D35</a>, <a href="#NW0-wliTu-Z">D36</a>, <a href="#NW0-wliTu-a">D37</a>, <a href="#NW0-wliTu-b">D38</a>, <a href="#NW0-wliTu-c">D39</a>, <a href="#NW0-wliTu-d">D40</a>, <a href="#NW0-wliTu-e">D41</a>, <a href="#NW0-wliTu-f">D42</a>, <a href="#NW0-wliTu-g">D43</a>, <a href="#NW0-wliTu-h">D44</a>, <a href="#NW0-wliTu-i">D45</a>, <a href="#NW0-wliTu-j">D46</a></li>

    <li><a href="#NW0-1ozy8z-1"><i>&lt;CGI Support Global Definitions&gt;</i></a>: <a href="#NW0-2wJhWs-1">U1</a>, <a href="#NW0-1ozy8z-1">D2</a>, <a href="#NW0-1ozy8z-2">D3</a>, <a href="#NW0-1ozy8z-3">D4</a>, <a href="#NW0-1ozy8z-4">D5</a>, <a href="#NW0-1ozy8z-5">D6</a>, <a href="#NW0-1ozy8z-6">D7</a>, <a href="#NW0-1ozy8z-7">D8</a>, <a href="#NW0-1ozy8z-8">D9</a>, <a href="#NW0-1ozy8z-9">D10</a>, <a href="#NW0-1ozy8z-A">D11</a>, <a href="#NW0-1ozy8z-B">D12</a></li>

    <li><a href="#NW0-20M5ji-1"><i>&lt;CGI Support Variables&gt;</i></a>: <a href="#NW0-uQbLG-1">U1</a>, <a href="#NW0-20M5ji-1">D2</a>, <a href="#NW0-20M5ji-2">D3</a>, <a href="#NW0-20M5ji-3">D4</a>, <a href="#NW0-20M5ji-4">D5</a>, <a href="#NW0-20M5ji-5">D6</a></li>

    <li><a href="#NW0-1m0FKP-1"><i>&lt;cgi-gperf-nc-http_req&gt;</i></a>: <a href="#NW0-1m0FKP-1">D1</a></li>

    <li><a href="#NW0-2HrrIc-1"><i>&lt;cgi-gperf-xml_name&gt;</i></a>: <a href="#NW0-2HrrIc-1">D1</a></li>

    <li><a href="#NW0-uQbLG-1"><i>&lt;cgi.c&gt;</i></a>: <a href="#NW0-uQbLG-1">D1</a></li>

    <li><a href="#NW0-2wJhWs-1"><i>&lt;cgi.h&gt;</i></a>: <a href="#NW0-2wJhWs-1">D1</a></li>

    <li><a href="#NW0-1NOS5s-1"><i>&lt;Check <code>c</code> for prop and literal&gt;</i></a>: <a href="#NW0-wliTu-c">U1</a>, <a href="#NW0-1NOS5s-1">D2</a></li>

    <li><a href="#nw@notdef"><i>&lt;Check and adjust resource URI <code>res</code>&gt;</i></a>: <a href="#NW0-2WZQ2h-9">U1</a></li>

    <li><a href="#NW0-11loCj-1"><i>&lt;Check and adjust resource URI <code>res_obj</code>/<code>res</code>&gt;</i></a>: <a href="#NW0-2WZQ2h-9">U1</a>, <a href="#NW0-11loCj-1">D2</a></li>

    <li><a href="#NW0-2KBx21-1"><i>&lt;Check CAS credentials and return <code>STATUS_OK</code> if OK&gt;</i></a>: <a href="#NW0-wX3Vt-1">U1</a>, <a href="#NW0-2KBx21-1">D2</a>, <a href="#NW0-2KBx21-2">D3</a>, <a href="#NW0-2KBx21-3">D4</a>, <a href="#NW0-2KBx21-4">D5</a></li>

    <li><a href="#NW0-20azRg-1"><i>&lt;Check CGI session parameters&gt;</i></a>: <a href="#NW0-16wLRV-A">U1</a>, <a href="#NW0-20azRg-1">D2</a></li>

    <li><a href="#NW0-4VPPh2-1"><i>&lt;Check cURL validation results&gt;</i></a>: <a href="#NW0-2mfHr7-2">U1</a>, <a href="#NW0-4VPPh2-1">D2</a></li>

    <li><a href="#NW0-3D8NQd-1"><i>&lt;Check known CALDAV: report types&gt;</i></a>: <a href="#NW0-14DC4I-7">U1</a>, <a href="#NW0-3D8NQd-1">D2</a>, <a href="#NW0-3D8NQd-2">D3</a>, <a href="#NW0-3D8NQd-3">D4</a></li>

    <li><a href="#NW0-2p89cw-1"><i>&lt;Check known DAV: report types&gt;</i></a>: <a href="#NW0-14DC4I-7">U1</a>, <a href="#NW0-2p89cw-1">D2</a>, <a href="#NW0-2p89cw-2">D3</a>, <a href="#NW0-2p89cw-3">D4</a>, <a href="#NW0-2p89cw-4">D5</a>, <a href="#NW0-2p89cw-5">D6</a>, <a href="#NW0-2p89cw-6">D7</a>, <a href="#NW0-2p89cw-7">D8</a>, <a href="#NW0-2p89cw-8">D9</a>, <a href="#NW0-2p89cw-9">D10</a></li>

    <li><a href="#NW0-1cOGzC-1"><i>&lt;Check redirect reference creation XML&gt;</i></a>: <a href="#NW0-14DC4I-J">U1</a>, <a href="#NW0-1cOGzC-1">D2</a>, <a href="#NW0-14DC4I-K">U3</a></li>

    <li><a href="#NW0-14DC4I-1"><i>&lt;Check WebDAV XML body&gt;</i></a>: <a href="#NW0-1Jgq0O-C">U1</a>, <a href="#NW0-14DC4I-1">D2</a>, <a href="#NW0-14DC4I-2">D3</a>, <a href="#NW0-14DC4I-3">D4</a>, <a href="#NW0-14DC4I-4">D5</a>, <a href="#NW0-14DC4I-5">D6</a>, <a href="#NW0-14DC4I-6">D7</a>, <a href="#NW0-14DC4I-7">D8</a>, <a href="#NW0-14DC4I-8">D9</a>, <a href="#NW0-14DC4I-9">D10</a>, <a href="#NW0-14DC4I-A">D11</a>, <a href="#NW0-14DC4I-B">D12</a>, <a href="#NW0-14DC4I-C">D13</a>, <a href="#NW0-14DC4I-D">D14</a>, <a href="#NW0-14DC4I-E">D15</a>, <a href="#NW0-14DC4I-F">D16</a>, <a href="#NW0-14DC4I-G">D17</a>, <a href="#NW0-14DC4I-H">D18</a>, <a href="#NW0-14DC4I-I">D19</a>, <a href="#NW0-14DC4I-J">D20</a>, <a href="#NW0-14DC4I-K">D21</a>, <a href="#NW0-14DC4I-L">D22</a></li>

    <li><a href="#NW0-Y5eke-1"><i>&lt;Clean up after CGI callback&gt;</i></a>: <a href="#NW0-wliTu-2">U1</a>, <a href="#NW0-Y5eke-1">D2</a>, <a href="#NW0-Y5eke-2">D3</a></li>

    <li><a href="#NW0-3xCCwq-1"><i>&lt;Clean up multi-part parse&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-3xCCwq-1">D2</a>, <a href="#NW0-3xCCwq-2">D3</a>, <a href="#NW0-3xCCwq-3">D4</a>, <a href="#NW0-3xCCwq-4">D5</a></li>

    <li><a href="#NW0-RIFgo-1"><i>&lt;Close multi-part body file&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-RIFgo-1">D2</a>, <a href="#NW0-RIFgo-2">D3</a>, <a href="#NW0-1Jgq0O-8">U4</a></li>

    <li><a href="#NW0-4ZlaGw-1"><i>&lt;Compute my URL into <code>buf</code>&gt;</i></a>: <a href="#NW0-2We642-1">U1</a>, <a href="#NW0-4ZlaGw-1">D2</a>, <a href="#NW0-4ZlaGw-2">D3</a>, <a href="#NW0-4ZlaGw-3">D4</a>, <a href="#NW0-4ZlaGw-4">D5</a></li>

    <li><a href="#NW0-3J3Bh8-1"><i>&lt;Create buffer at least large enough for multi-part boundary&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-3J3Bh8-1">D2</a>, <a href="#NW0-3J3Bh8-2">D3</a></li>

    <li><a href="#NW0-EwGae-1"><i>&lt;Create new CGI session&gt;</i></a>: <a href="#NW0-16wLRV-A">U1</a>, <a href="#NW0-EwGae-1">D2</a></li>

    <li><a href="#NW0-3fkJDU-1"><i>&lt;Create session using database&gt;</i></a>: <a href="#NW0-3i0nme-8">U1</a>, <a href="#NW0-3fkJDU-1">D2</a>, <a href="#NW0-3fkJDU-2">D3</a>, <a href="#NW0-3fkJDU-3">D4</a></li>

    <li><a href="#NW0-36PIaC-1"><i>&lt;Create session using local files&gt;</i></a>: <a href="#NW0-16wLRV-2">U1</a>, <a href="#NW0-36PIaC-1">D2</a></li>

    <li><a href="#NW0-yctzv-1"><i>&lt;Database Support Definitions&gt;</i></a>: <a href="#NW0-3pmRHJ-1">U1</a>, <a href="#NW0-yctzv-1">D2</a>, <a href="#NW0-yctzv-2">D3</a>, <a href="#NW0-yctzv-3">D4</a>, <a href="#NW0-yctzv-4">D5</a></li>

    <li><a href="#NW0-2mrnmy-1"><i>&lt;db_session.c&gt;</i></a>: <a href="#NW0-2mrnmy-1">D1</a></li>

    <li><a href="#NW0-3pmRHJ-1"><i>&lt;dbase.h&gt;</i></a>: <a href="#NW0-3pmRHJ-1">D1</a></li>

    <li><a href="#NW0-pbqM0-1"><i>&lt;Decode a string into <code>buf</code>/<code>length</code>&gt;</i></a>: <a href="#NW0-wliTu-L">U1</a>, <a href="#NW0-pbqM0-1">D2</a></li>

    <li><a href="#NW0-U0J7v-1"><i>&lt;Decode data into <code>buf</code>/<code>length</code>&gt;</i></a>: <a href="#NW0-wliTu-L">U1</a>, <a href="#NW0-U0J7v-1">D2</a></li>

    <li><a href="#NW0-13DiIo-1"><i>&lt;Decode multi-part file line&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-13DiIo-1">D2</a></li>

    <li><a href="#NW0-2Zonth-1"><i>&lt;delete_old_db_sessions.c&gt;</i></a>: <a href="#NW0-2Zonth-1">D1</a></li>

    <li><a href="#NW0-2aaetw-1"><i>&lt;delete_old_files.c&gt;</i></a>: <a href="#NW0-2aaetw-1">D1</a></li>

    <li><a href="#NW0-2yrxVk-1"><i>&lt;Display error from CGI callback&gt;</i></a>: <a href="#NW0-wliTu-2">U1</a>, <a href="#NW0-2yrxVk-1">D2</a></li>

    <li><a href="#NW0-1DgxfU-1"><i>&lt;Find multi-part boundary&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-1DgxfU-1">D2</a></li>

    <li><a href="#NW0-1NfExj-1"><i>&lt;Find next multi-part boundary and <code>break</code> if last&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-1NfExj-1">D2</a></li>

    <li><a href="#NW0-HGcVU-1"><i>&lt;Finish setting up cURL validation&gt;</i></a>: <a href="#NW0-2mfHr7-2">U1</a>, <a href="#NW0-HGcVU-1">D2</a>, <a href="#NW0-HGcVU-2">D3</a></li>

    <li><a href="#NW0-ylIxa-1"><i>&lt;Found multi-part file&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-ylIxa-1">D2</a></li>

    <li><a href="#NW0-3kDPKd-1"><i>&lt;Free CGI state members&gt;</i></a>: <a href="#NW0-Y5eke-2">U1</a>, <a href="#NW0-3kDPKd-1">D2</a>, <a href="#NW0-3kDPKd-2">D3</a>, <a href="#NW0-3kDPKd-3">D4</a>, <a href="#NW0-3kDPKd-4">D5</a>, <a href="#NW0-3kDPKd-5">D6</a></li>

    <li><a href="#NW0-3vAdAM-1"><i>&lt;Generic ClearSilver HTML Macros&gt;</i></a>: <a href="#NW0-3L4zVQ-1">U1</a>, <a href="#NW0-3vAdAM-1">D2</a>, <a href="#NW0-3vAdAM-2">D3</a>, <a href="#NW0-3vAdAM-3">D4</a>, <a href="#NW0-3vAdAM-4">D5</a>, <a href="#NW0-3vAdAM-5">D6</a>, <a href="#NW0-3vAdAM-6">D7</a>, <a href="#NW0-3vAdAM-7">D8</a>, <a href="#NW0-3vAdAM-8">D9</a>, <a href="#NW0-3vAdAM-9">D10</a>, <a href="#NW0-3vAdAM-A">D11</a>, <a href="#NW0-3vAdAM-B">D12</a>, <a href="#NW0-3vAdAM-C">D13</a>, <a href="#NW0-3vAdAM-D">D14</a>, <a href="#NW0-3vAdAM-E">D15</a>, <a href="#NW0-3vAdAM-F">D16</a>, <a href="#NW0-3vAdAM-G">D17</a></li>

    <li><a href="#NW0-4gTpBs-1"><i>&lt;Get more decoded data&gt;</i></a>: <a href="#NW0-4gTpBs-1">D1</a>, <a href="#NW0-U0J7v-1">U2</a>, <a href="#NW0-pbqM0-1">U3</a></li>

    <li><a href="#NW0-1GLan6-1"><i>&lt;Get Session Invariants&gt;</i></a>: <a href="#NW0-1GLan6-1">D1</a>, <a href="#NW0-16wLRV-5">U2</a></li>

    <li><a href="#NW0-3L4zVQ-1"><i>&lt;html_macros.cs&gt;</i></a>: <a href="#NW0-3L4zVQ-1">D1</a></li>

    <li><a href="#NW0-31BAak-1"><i>&lt;html_prefix.cs&gt;</i></a>: <a href="#NW0-31BAak-1">D1</a></li>

    <li><a href="#NW0-30QJss-1"><i>&lt;html_prefix.js&gt;</i></a>: <a href="#NW0-30QJss-1">D1</a></li>

    <li><a href="#NW0-4KmDoT-1"><i>&lt;HTTP Headers to Save on CAS Redirect&gt;</i></a>: <a href="#NW0-3wu2oE-1">U1</a>, <a href="#NW0-4KmDoT-1">D2</a></li>

    <li><a href="#NW0-4Embk6-1"><i>&lt;Ignore ODBC <code>ret</code>&gt;</i></a>: <a href="#NW0-2JwojC-1">U1</a>, <a href="#NW0-4Embk6-1">D2</a></li>

    <li><a href="#NW0-1ETzHp-1"><i>&lt;Initialize body decoder&gt;</i></a>: <a href="#NW0-wliTu-L">U1</a>, <a href="#NW0-1ETzHp-1">D2</a></li>

    <li><a href="#NW0-2snMgS-1"><i>&lt;Initialize CAS globals&gt;</i></a>: <a href="#NW0-wX3Vt-1">U1</a>, <a href="#NW0-2snMgS-1">D2</a>, <a href="#NW0-2snMgS-2">D3</a>, <a href="#NW0-2snMgS-3">D4</a></li>

    <li><a href="#NW0-2Y3OmL-1"><i>&lt;Initialize decoding for libarchive&gt;</i></a>: <a href="#NW0-1ETzHp-1">U1</a>, <a href="#NW0-2Y3OmL-1">D2</a></li>

    <li><a href="#NW0-1I4CzE-1"><i>&lt;Initialize decoding for zlib&gt;</i></a>: <a href="#NW0-1ETzHp-1">U1</a>, <a href="#NW0-1I4CzE-1">D2</a></li>

    <li><a href="#NW0-3lUry0-1"><i>&lt;Initialize file-based session support&gt;</i></a>: <a href="#NW0-16wLRV-1">U1</a>, <a href="#NW0-3lUry0-1">D2</a></li>

    <li><a href="#NW0-1Jgq0O-1"><i>&lt;Initialize this CGI run&gt;</i></a>: <a href="#NW0-wliTu-H">U1</a>, <a href="#NW0-1Jgq0O-1">D2</a>, <a href="#NW0-1Jgq0O-2">D3</a>, <a href="#NW0-1Jgq0O-3">D4</a>, <a href="#NW0-1Jgq0O-4">D5</a>, <a href="#NW0-1Jgq0O-5">D6</a>, <a href="#NW0-1Jgq0O-6">D7</a>, <a href="#NW0-1Jgq0O-7">D8</a>, <a href="#NW0-1Jgq0O-8">D9</a>, <a href="#NW0-1Jgq0O-9">D10</a>, <a href="#NW0-1Jgq0O-A">D11</a>, <a href="#NW0-1Jgq0O-B">D12</a>, <a href="#NW0-1Jgq0O-C">D13</a>, <a href="#NW0-1Jgq0O-D">D14</a></li>

    <li><a href="#NW0-2zTsea-1"><i>&lt;Insert children of <code>hdf</code> from database&gt;</i></a>: <a href="#NW0-2ixk5s-8">U1</a>, <a href="#NW0-2zTsea-1">D2</a></li>

    <li><a href="#NW0-CePUR-1"><i>&lt;JavaScript Files&gt;</i></a>: <a href="#NW0-CePUR-1">D1</a>, <a href="#NW0-13PeAG-1">U2</a></li>

    <li><a href="#NW0-UdWlO-1"><i>&lt;Known HTTP Requests&gt;</i></a>: <a href="#NW0-1m0FKP-1">U1</a>, <a href="#NW0-UdWlO-1">D2</a></li>

    <li><a href="#NW0-gJg1L-1"><i>&lt;Multi-part Parse Variables&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-gJg1L-1">D2</a>, <a href="#NW0-gJg1L-2">D3</a>, <a href="#NW0-gJg1L-3">D4</a>, <a href="#NW0-gJg1L-4">D5</a>, <a href="#NW0-gJg1L-5">D6</a></li>

    <li><a href="#NW0-1xLQ9y-1"><i>&lt;Normalize path <code>obj</code>/<code>oval</code> UTF-8&gt;</i></a>: <a href="#NW0-wliTu-K">U1</a>, <a href="#NW0-1xLQ9y-1">D2</a></li>

    <li><a href="#NW0-1QkOtL-1"><i>&lt;Open and lock session file&gt;</i></a>: <a href="#NW0-3n2jvq-1">U1</a>, <a href="#NW0-1QkOtL-1">D2</a>, <a href="#NW0-3agnOG-1">U3</a></li>

    <li><a href="#NW0-2LAFNX-1"><i>&lt;Open multi-part body file&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-2LAFNX-1">D2</a>, <a href="#NW0-2LAFNX-2">D3</a>, <a href="#NW0-1Jgq0O-8">U4</a></li>

    <li><a href="#NW0-185f0Y-1"><i>&lt;Parse <code>hobj</code> as HTTP date&gt;</i></a>: <a href="#NW0-2WZQ2h-4">U1</a>, <a href="#NW0-185f0Y-1">D2</a>, <a href="#NW0-2WZQ2h-5">U3</a></li>

    <li><a href="#NW0-Ow21m-1"><i>&lt;Parse content-disposition&gt;</i></a>: <a href="#NW0-OcIai-1">U1</a>, <a href="#NW0-Ow21m-1">D2</a></li>

    <li><a href="#NW0-2zs4Ho-1"><i>&lt;Parse content-transfer-encoding&gt;</i></a>: <a href="#NW0-OcIai-1">U1</a>, <a href="#NW0-2zs4Ho-1">D2</a></li>

    <li><a href="#NW0-2Uz4pb-1"><i>&lt;Parse multi-part body as file&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-2Uz4pb-1">D2</a></li>

    <li><a href="#NW0-2004gC-1"><i>&lt;Parse multi-part body as parameter&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-2004gC-1">D2</a></li>

    <li><a href="#NW0-1DDebI-1"><i>&lt;Parse multi-part CGI parameters&gt;</i></a>: <a href="#NW0-wliTu-O">U1</a>, <a href="#NW0-1DDebI-1">D2</a></li>

    <li><a href="#NW0-OcIai-1"><i>&lt;Parse multi-part headers until blank line&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-OcIai-1">D2</a>, <a href="#NW0-OcIai-2">D3</a></li>

    <li><a href="#NW0-78Tk8-1"><i>&lt;pass-http&gt;</i></a>: <a href="#NW0-78Tk8-1">D1</a></li>

    <li><a href="#NW0-2DIX1I-1"><i>&lt;Perform cleanups requiring valid CGI parameters&gt;</i></a>: <a href="#NW0-3kDPKd-2">U1</a>, <a href="#NW0-2DIX1I-1">D2</a></li>

    <li><a href="#NW0-1IHJKl-1"><i>&lt;Perform global CGI support initialization&gt;</i></a>: <a href="#NW0-wliTu-1">U1</a>, <a href="#NW0-1IHJKl-1">D2</a>, <a href="#NW0-1IHJKl-2">D3</a>, <a href="#NW0-1IHJKl-3">D4</a>, <a href="#NW0-1IHJKl-4">D5</a></li>

    <li><a href="#NW0-2l9Hcr-1"><i>&lt;Prepare for CGI thread&gt;</i></a>: <a href="#NW0-wliTu-3">U1</a>, <a href="#NW0-2l9Hcr-1">D2</a></li>

    <li><a href="#NW0-16Ohqw-1"><i>&lt;Prepare for next multi-part body file line&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-16Ohqw-1">D2</a></li>

    <li><a href="#NW0-2hKb8X-1"><i>&lt;Prepare to read multi-part body file lines&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-2hKb8X-1">D2</a>, <a href="#NW0-2hKb8X-2">D3</a></li>

    <li><a href="#NW0-29LoAm-1"><i>&lt;Prepend <code>relative_to</code> to <code>obj</code>/<code>oval</code>&gt;</i></a>: <a href="#NW0-wliTu-K">U1</a>, <a href="#NW0-29LoAm-1">D2</a></li>

    <li><a href="#NW0-1GLJEI-1"><i>&lt;Print ODBC env error&gt;</i></a>: <a href="#NW0-2JwojC-1">U1</a>, <a href="#NW0-1GLJEI-1">D2</a></li>

    <li><a href="#NW0-2WZQ2h-1"><i>&lt;Process common HTTP headers&gt;</i></a>: <a href="#NW0-1Jgq0O-9">U1</a>, <a href="#NW0-2WZQ2h-1">D2</a>, <a href="#NW0-2WZQ2h-2">D3</a>, <a href="#NW0-2WZQ2h-3">D4</a>, <a href="#NW0-2WZQ2h-4">D5</a>, <a href="#NW0-2WZQ2h-5">D6</a>, <a href="#NW0-2WZQ2h-6">D7</a>, <a href="#NW0-2WZQ2h-7">D8</a>, <a href="#NW0-2WZQ2h-8">D9</a>, <a href="#NW0-2WZQ2h-9">D10</a>, <a href="#NW0-2WZQ2h-A">D11</a>, <a href="#NW0-2WZQ2h-B">D12</a>, <a href="#NW0-2WZQ2h-C">D13</a>, <a href="#NW0-2WZQ2h-D">D14</a>, <a href="#NW0-2WZQ2h-E">D15</a></li>

    <li><a href="#NW0-tPLhs-1"><i>&lt;Process priority http token list&gt;</i></a>: <a href="#NW0-2WZQ2h-2">U1</a>, <a href="#NW0-tPLhs-1">D2</a></li>

    <li><a href="#NW0-4MY9X4-1"><i>&lt;Read a multi-part body line&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-4MY9X4-1">D2</a></li>

    <li><a href="#NW0-qLGmJ-1"><i>&lt;Read data from CGI stream&gt;</i></a>: <a href="#NW0-wliTu-G">U1</a>, <a href="#NW0-qLGmJ-1">D2</a></li>

    <li><a href="#NW0-1rJvEn-1"><i>&lt;Read session file into <code>hdf</code>&gt;</i></a>: <a href="#NW0-3n2jvq-1">U1</a>, <a href="#NW0-1rJvEn-1">D2</a>, <a href="#NW0-3agnOG-1">U3</a></li>

    <li><a href="#NW0-3n2jvq-1"><i>&lt;Read session from local files&gt;</i></a>: <a href="#NW0-16wLRV-3">U1</a>, <a href="#NW0-3n2jvq-1">D2</a></li>

    <li><a href="#NW0-3wZNGL-1"><i>&lt;Read session using database&gt;</i></a>: <a href="#NW0-3i0nme-8">U1</a>, <a href="#NW0-3wZNGL-1">D2</a>, <a href="#NW0-3wZNGL-2">D3</a>, <a href="#NW0-3wZNGL-3">D4</a></li>

    <li><a href="#NW0-2O9GDs-1"><i>&lt;Redirect to CAS&gt;</i></a>: <a href="#NW0-wX3Vt-1">U1</a>, <a href="#NW0-2O9GDs-1">D2</a>, <a href="#NW0-2O9GDs-2">D3</a>, <a href="#NW0-2O9GDs-3">D4</a></li>

    <li><a href="#NW0-oxKEH-1"><i>&lt;Return converted ODBC error&gt;</i></a>: <a href="#NW0-3i0nme-6">U1</a>, <a href="#NW0-oxKEH-1">D2</a></li>

    <li><a href="#NW0-4BxKvC-1"><i>&lt;sessdbcreate.sql&gt;</i></a>: <a href="#NW0-4BxKvC-1">D1</a>, <a href="#NW0-4BxKvC-2">D2</a>, <a href="#NW0-4BxKvC-3">D3</a>, <a href="#NW0-4BxKvC-4">D4</a></li>

    <li><a href="#NW0-TuSGW-1"><i>&lt;Session Value Support Configuration&gt;</i></a>: <a href="#NW0-TuSGW-1">D1</a>, <a href="#NW0-B9EcR-1">U2</a></li>

    <li><a href="#NW0-2q5XL8-1"><i>&lt;session.c&gt;</i></a>: <a href="#NW0-2q5XL8-1">D1</a></li>

    <li><a href="#NW0-moSh3-1"><i>&lt;Set <code>hdf</code>'s value from database&gt;</i></a>: <a href="#NW0-2ixk5s-8">U1</a>, <a href="#NW0-moSh3-1">D2</a></li>

    <li><a href="#NW0-3qySoB-1"><i>&lt;Set <code>nerr</code> for ODBC error&gt;</i></a>: <a href="#NW0-3i0nme-1">U1</a>, <a href="#NW0-3i0nme-2">U2</a>, <a href="#NW0-3i0nme-3">U3</a>, <a href="#NW0-3qySoB-1">D4</a>, <a href="#NW0-3fkJDU-1">U5</a></li>

    <li><a href="#NW0-2tk60i-1"><i>&lt;Set match children of <code>hobj</code>&gt;</i></a>: <a href="#NW0-2WZQ2h-3">U1</a>, <a href="#NW0-2tk60i-1">D2</a>, <a href="#NW0-2WZQ2h-5">U3</a></li>

    <li><a href="#NW0-2DC5zU-1"><i>&lt;Set multi-part parameters&gt;</i></a>: <a href="#NW0-1DDebI-1">U1</a>, <a href="#NW0-2DC5zU-1">D2</a></li>

    <li><a href="#NW0-2JwojC-1"><i>&lt;Set up database connection&gt;</i></a>: <a href="#NW0-3i0nme-5">U1</a>, <a href="#NW0-2JwojC-1">D2</a>, <a href="#NW0-2JwojC-2">D3</a></li>

    <li><a href="#NW0-1rdQ8D-1"><i>&lt;Spawn CGI thread&gt;</i></a>: <a href="#NW0-wliTu-3">U1</a>, <a href="#NW0-1rdQ8D-1">D2</a>, <a href="#NW0-1rdQ8D-2">D3</a>, <a href="#NW0-1rdQ8D-3">D4</a></li>

    <li><a href="#NW0-1zTt0P-1"><i>&lt;Strip <code>.</code> and <code>..</code> from <code>obj</code>/<code>oval</code>&gt;</i></a>: <a href="#NW0-wliTu-K">U1</a>, <a href="#NW0-1zTt0P-1">D2</a></li>

    <li><a href="#NW0-47lNt9-1"><i>&lt;Strip CGI script from <code>obj</code>/<code>oval</code>&gt;</i></a>: <a href="#NW0-wliTu-K">U1</a>, <a href="#NW0-3YtoGM-1">U2</a>, <a href="#NW0-47lNt9-1">D3</a></li>

    <li><a href="#NW0-3YtoGM-1"><i>&lt;Strip URL from <code>obj</code>/<code>oval</code>&gt;</i></a>: <a href="#NW0-wliTu-K">U1</a>, <a href="#NW0-3YtoGM-1">D2</a></li>

    <li><a href="#NW0-HxEJh-1"><i>&lt;test-cgi&gt;</i></a>: <a href="#NW0-HxEJh-1">D1</a></li>

    <li><a href="#NW0-2vH4P-1"><i>&lt;test-http-get&gt;</i></a>: <a href="#NW0-2vH4P-1">D1</a></li>

    <li><a href="#NW0-n15ju-1"><i>&lt;test.cgi.c&gt;</i></a>: <a href="#NW0-n15ju-1">D1</a></li>

    <li><a href="#NW0-3uGBjz-1"><i>&lt;test.cgi.conf&gt;</i></a>: <a href="#NW0-3uGBjz-1">D1</a></li>

    <li><a href="#NW0-43ZQFa-1"><i>&lt;unless method requires no body&gt;</i></a>: <a href="#NW0-1Jgq0O-C">U1</a>, <a href="#NW0-43ZQFa-1">D2</a></li>

    <li><a href="#NW0-3kk3wH-1"><i>&lt;unless method requires no body or XML body&gt;</i></a>: <a href="#NW0-1Jgq0O-C">U1</a>, <a href="#NW0-3kk3wH-1">D2</a>, <a href="#NW0-3kk3wH-2">D3</a>, <a href="#NW0-3kk3wH-3">D4</a>, <a href="#NW0-3kk3wH-4">D5</a>, <a href="#NW0-3kk3wH-5">D6</a>, <a href="#NW0-3kk3wH-6">D7</a>, <a href="#NW0-3kk3wH-7">D8</a>, <a href="#NW0-3kk3wH-8">D9</a>, <a href="#NW0-3kk3wH-9">D10</a>, <a href="#NW0-3kk3wH-A">D11</a>, <a href="#NW0-3kk3wH-B">D12</a></li>

    <li><a href="#NW0-dHST1-1"><i>&lt;unless method requires XML body&gt;</i></a>: <a href="#NW0-1Jgq0O-C">U1</a>, <a href="#NW0-dHST1-1">D2</a>, <a href="#NW0-dHST1-2">D3</a>, <a href="#NW0-dHST1-3">D4</a>, <a href="#NW0-dHST1-4">D5</a>, <a href="#NW0-dHST1-5">D6</a>, <a href="#NW0-dHST1-6">D7</a>, <a href="#NW0-dHST1-7">D8</a>, <a href="#NW0-dHST1-8">D9</a>, <a href="#NW0-dHST1-9">D10</a></li>

    <li><a href="#NW0-1HNny-1"><i>&lt;Update root timestamp in database&gt;</i></a>: <a href="#NW0-3wZNGL-3">U1</a>, <a href="#NW0-3fkJDU-3">U2</a>, <a href="#NW0-1HNny-1">D3</a></li>

    <li><a href="#NW0-1hrcR3-1"><i>&lt;Update session user from CAS user&gt;</i></a>: <a href="#NW0-2KBx21-3">U1</a>, <a href="#NW0-1hrcR3-1">D2</a></li>

    <li><a href="#NW0-INLJQ-1"><i>&lt;Update session using database&gt;</i></a>: <a href="#NW0-3i0nme-8">U1</a>, <a href="#NW0-INLJQ-1">D2</a>, <a href="#NW0-INLJQ-2">D3</a>, <a href="#NW0-INLJQ-3">D4</a>, <a href="#NW0-INLJQ-4">D5</a>, <a href="#NW0-INLJQ-5">D6</a></li>

    <li><a href="#NW0-3agnOG-1"><i>&lt;Update session using local files&gt;</i></a>: <a href="#NW0-16wLRV-4">U1</a>, <a href="#NW0-3agnOG-1">D2</a></li>

    <li><a href="#NW0-2mfHr7-1"><i>&lt;Validate CAS ticket with cURL&gt;</i></a>: <a href="#NW0-2mfHr7-1">D1</a>, <a href="#NW0-2mfHr7-2">D2</a>, <a href="#NW0-2KBx21-3">U3</a></li>

    <li><a href="#NW0-2YEY-1"><i>&lt;Verify CGI session returning <code>STATUS_OK</code> if OK&gt;</i></a>: <a href="#NW0-16wLRV-A">U1</a>, <a href="#NW0-2YEY-1">D2</a></li>

    <li><a href="#NW0-4ac5rz-1"><i>&lt;Wait for remaining CGI threads&gt;</i></a>: <a href="#NW0-wliTu-3">U1</a>, <a href="#NW0-4ac5rz-1">D2</a></li>

    <li><a href="#NW0-EIFsf-1"><i>&lt;webdav.dtd&gt;</i></a>: <a href="#NW0-EIFsf-1">D1</a>, <a href="#NW0-EIFsf-2">D2</a>, <a href="#NW0-EIFsf-3">D3</a>, <a href="#NW0-EIFsf-4">D4</a>, <a href="#NW0-EIFsf-5">D5</a>, <a href="#NW0-EIFsf-6">D6</a>, <a href="#NW0-EIFsf-7">D7</a>, <a href="#NW0-EIFsf-8">D8</a>, <a href="#NW0-EIFsf-9">D9</a>, <a href="#NW0-EIFsf-A">D10</a>, <a href="#NW0-EIFsf-B">D11</a>, <a href="#NW0-EIFsf-C">D12</a>, <a href="#NW0-EIFsf-D">D13</a>, <a href="#NW0-EIFsf-E">D14</a>, <a href="#NW0-EIFsf-F">D15</a>, <a href="#NW0-EIFsf-G">D16</a>, <a href="#NW0-EIFsf-H">D17</a>, <a href="#NW0-EIFsf-I">D18</a>, <a href="#NW0-EIFsf-J">D19</a>, <a href="#NW0-EIFsf-K">D20</a>, <a href="#NW0-EIFsf-L">D21</a>, <a href="#NW0-EIFsf-M">D22</a>, <a href="#NW0-EIFsf-N">D23</a></li>

    <li><a href="#NW0-3TzsX1-1"><i>&lt;Write multi-part body line to file&gt;</i></a>: <a href="#NW0-2Uz4pb-1">U1</a>, <a href="#NW0-3TzsX1-1">D2</a>, <a href="#NW0-1Jgq0O-8">U3</a></li>

    <li><a href="#NW0-31rNNf-1"><i>&lt;Write session file&gt;</i></a>: <a href="#NW0-36PIaC-1">U1</a>, <a href="#NW0-31rNNf-1">D2</a>, <a href="#NW0-3agnOG-1">U3</a></li>

    <li><a href="#NW0-1VmJ8d-1"><i>&lt;XML validator names&gt;</i></a>: <a href="#NW0-2HrrIc-1">U1</a>, <a href="#NW0-1VmJ8d-1">D2</a>, <a href="#NW0-1VmJ8d-2">D3</a>, <a href="#NW0-1VmJ8d-3">D4</a>, <a href="#NW0-1VmJ8d-4">D5</a>, <a href="#NW0-1VmJ8d-5">D6</a>, <a href="#NW0-1VmJ8d-6">D7</a>, <a href="#NW0-1VmJ8d-7">D8</a>, <a href="#NW0-1VmJ8d-8">D9</a>, <a href="#NW0-1VmJ8d-9">D10</a>, <a href="#NW0-1VmJ8d-A">D11</a>, <a href="#NW0-1VmJ8d-B">D12</a>, <a href="#NW0-1VmJ8d-C">D13</a>, <a href="#NW0-1VmJ8d-D">D14</a>, <a href="#NW0-1VmJ8d-E">D15</a>, <a href="#NW0-1VmJ8d-F">D16</a>, <a href="#NW0-1VmJ8d-G">D17</a>, <a href="#NW0-1VmJ8d-H">D18</a>, <a href="#NW0-1VmJ8d-I">D19</a>, <a href="#NW0-1VmJ8d-J">D20</a>, <a href="#NW0-1VmJ8d-K">D21</a>, <a href="#NW0-1VmJ8d-L">D22</a>, <a href="#NW0-1VmJ8d-M">D23</a>, <a href="#NW0-1VmJ8d-N">D24</a>, <a href="#NW0-1VmJ8d-O">D25</a>, <a href="#NW0-1VmJ8d-P">D26</a></li>
  </ul><!-- note: no identifier indexing is done right now-->
  <!--\nowebindex-->
  <hr />

  <h3>Footnotes</h3>
  <hr />
  <a name="fn1" id="fn1"><b>1</b>.</a> <a href="http://www.fastcgi.com">http://www.fastcgi.com</a>
  <hr />
  <a name="fn2" id="fn2"><b>2</b>.</a> <a href="http://www.webdav.org">http://www.webdav.org</a>
  <hr />
  <a name="fn3" id="fn3"><b>3</b>.</a> <a href="http://www.jasig.org/cas">http://www.jasig.org/cas</a>
  <hr />
  <a name="fn4" id="fn4"><b>4</b>.</a> <a href="http://www.ietf.org/rfc/rfc2616.txt">http://www.ietf.org/rfc/rfc2616.txt</a>
  <hr />
  <a name="fn5" id="fn5"><b>5</b>.</a> <a href="http://www.ietf.org/rfc/rfc4918.txt">http://www.ietf.org/rfc/rfc4918.txt</a>
  <hr />
  <a name="fn6" id="fn6"><b>6</b>.</a> <a href="http://www.ietf.org/rfc/rfc3253.txt">http://www.ietf.org/rfc/rfc3253.txt</a>
  <hr />
  <a name="fn7" id="fn7"><b>7</b>.</a> <a href="http://www.ietf.org/rfc/rfc3648.txt">http://www.ietf.org/rfc/rfc3648.txt</a>
  <hr />
  <a name="fn8" id="fn8"><b>8</b>.</a> <a href="http://www.ietf.org/rfc/rfc3744.txt">http://www.ietf.org/rfc/rfc3744.txt</a>
  <hr />
  <a name="fn9" id="fn9"><b>9</b>.</a> <a href="http://www.ietf.org/rfc/rfc4437.txt">http://www.ietf.org/rfc/rfc4437.txt</a>
  <hr />
  <a name="fn10" id="fn10"><b>10</b>.</a> <a href="http://www.ietf.org/rfc/rfc4791.txt">http://www.ietf.org/rfc/rfc4791.txt</a>
  <hr />
  <a name="fn11" id="fn11"><b>11</b>.</a> <a href="http://www.ietf.org/rfc/rfc5323.txt">http://www.ietf.org/rfc/rfc5323.txt</a>
  <hr />
  <a name="fn12" id="fn12"><b>12</b>.</a> However, at least in apache 2.2.8, using chunk encoding causes the content length and any headers in the last chunk to be lost.
  <hr />
  <a name="fn13" id="fn13"><b>13</b>.</a> <a href="http://www.zlib.net">http://www.zlib.net</a>
  <hr />
  <a name="fn14" id="fn14"><b>14</b>.</a> <a href="http://people.freebsd.org/~kientzle/libarchive">http://people.freebsd.org/~kientzle/libarchive</a>
  <hr />
  <a name="fn15" id="fn15"><b>15</b>.</a> This is probably unsafe; e.g., a previous version of this code did this to SOAP requests.
  <hr />
  <a name="fn16" id="fn16"><b>16</b>.</a> <a href="http://www.ietf.org/rfc/rfc2388.txt">http://www.ietf.org/rfc/rfc2388.txt</a>
  <hr />
  <a name="fn17" id="fn17"><b>17</b>.</a> <a href="http://www.ietf.org/rfc/rfc2183.txt">http://www.ietf.org/rfc/rfc2183.txt</a>
  <hr />
  <a name="fn18" id="fn18"><b>18</b>.</a> <a href="http://xmlsoft.org/">http://xmlsoft.org/</a>
  <hr />
  <a name="fn19" id="fn19"><b>19</b>.</a> <a href="http://xmlsoft.org/html/libxml-parser.html">http://xmlsoft.org/html/libxml-parser.html</a>
  <hr />
  <a name="fn20" id="fn20"><b>20</b>.</a> <a href="http://www.ietf.org/rfc/rfc5689.txt">http://www.ietf.org/rfc/rfc5689.txt</a>
  <hr />
  <a name="fn21" id="fn21"><b>21</b>.</a> There is no fixed convenient link to a page describing ODBC. The specific implementation used here is that provided by unixODBC (<a href="http://www.unixodbc.org">http://www.unixodbc.org</a>), iODBC (<a href="http://www.iodbc.org">http://www.iodbc.org</a>), and various drivers. ODBC is used because it is the only method known to me to support multiple databases with input and output binding and dynamic SQL. Embedded SQL does not support as many databases, especially with consistent dynamic SQL, and libdbi does not support input parameter binding.
  <hr />
  <a name="fn22" id="fn22"><b>22</b>.</a> <a href="http://www.jasig.org/cas/protocol">http://www.jasig.org/cas/protocol</a>
  <hr />
  <a name="fn23" id="fn23"><b>23</b>.</a> From cURL, <a href="http://curl.haxx.se">http://curl.haxx.se</a><!--
begin 644 cgi-supt.tar.gz
M'XL(`/TFP%```^R]~U\;V;$VNO^=_A0]0@P2HPO@278V(&(/9CR\VV/[&$\F
M~1%F6E)+="QU*^J6@6#ELY]ZJFI=6A(83Y)]WGm^QY/8T+UZW5~MNC[5FR?C
M02N]_H]_XY\=^O/[[[[#O[O_^;L=_]^=G~^~_&[ON]__Q^[~SN]W=O:~['VW
M^Q\[NWO?[~S^1[CS[^R4^3//BV@6AO\QB&8?BK].[BWWN??_+_VS&3:WF^$D
M&\3[X:OL.NX=A"G^:?;I45.~]_G?`Y0,mL/OL6/"ZZ2XDI+[](Q^*J)Tm([#
M9O&'L*=[*CP*)]&'~)B,8Y3!ST%WD/7GDS@M^N,HS\^+ZRQ/!G$CIH^3_.KB
M+IH527\|+X+N/(^G4?]#m(K/QW%1Q+mIm(UGC=DDFHV2M+/;^EV2mGKFMR2]
MN!O%V20N9K~+8'mS,QQ'17P33F=Qm.EQ![Z/J623VI|.mF?]/.B^/3X+JZ~#
M?=?IW?_ZSW"/MF"3_K?S^W#G=_L[~_N_~_*_0]T!856_~AM_3/(D2_?Y$_/T
M.36[[RKX7;CW1"H(F]CA8~V7~m"@6L/G|9^+U~G3S?`D'2QU+~CVT.$[,V$+
M~E(DQ3B^.[MmB^@F_#$978WI_T62CL*?LL%\3!M95N?LmB_B23C,9K2HO\0]
MFLYH7EQEL[MW5]DDRL/_U:(OLAGF~4`=OOM3/,m0PB~MW2|M#,0,KMO%;Q@4
M%|4*|A=LYZ)~7LRB/CKW[BK)0]/9|!#G_5G2B_m&F$RFXQ@/Z~|H'814#*,L
MPGF.GD?8?=SW7W\=)[3.U%8PG66C63294('mH#O,LH)V6'S7G|_&=U=%,=UO
MMZ^OKUNFO%~\U|\F;=U%~~NJF(P7`;48A:,L&X0X[#Q?TRQ)B]9B,]C:DCD/
M|YDSWMBYS/"5m\.mL!?E\2"D27J5T29,P[?1)(]OMW*9XH~Z&|=]ZDHT^QCm
M!JUX,&__(YVU^?"T%]2%1OCBU|\/?3]*YZULmD)9/D4RCU&8SB~]~!9FPS`K
MKNB'X2R.Q[=A]#%*QA%M^C"?3Z?9K`B++!OGK~4UHI^[_6QZ.\,0[Q:T&W~~
Mm)O8D^'2mFF%(3Xm_$_'23].,2/S=$!M4P?"9W1@Z9^7\J81FEVUUZ)]3P6"
M7W_5=UM;]8/PmIO3|&Y!/&@OQ%2%W[OXIA]/J:4TI!6=CI,H[|~\.D'AVFB%
M?]%*LEX14=DHQ(@P)5ZI,"J"Y3FmN*^8UK:.)&^_/#T^~75VTJ3^+FC(/Z~T
MA?)P%O]MGLQHH+W;()I23_H\M^/H.J3S%8UHT@|TP^CI]2R1O9)GP^(ZFL7A
M(*$#DO3FA3]1@~D7QNL5H*FB??7KK\_.PM,SVIC?/SL[/6N$OYR^^_'US^_"
M7YZ]??OLU;O3D[/P]=O@^/6KYZ?O3E^_HM]^")^]^DOXWZ~OGC?"..&]$m\0
MZ:/~4Q=Q`)mXT`K/XK@T+40?~#+S:=Q/ADF?QI2.YD1QZ;!\C&|I'Y1XmDER
M+&/.NVZ|3)(B*OCWE0&U0J(,|3KPZ4*WP'1EPWZ6%B`"]"2/^ZC@[C4U\C&)
MKZG43UE~8m4FM'9T&*G5/$NC|~B=;/S\5_HREU.,^9H78|1G.TZ)#HP#NDHB
M.ASCC$K+#45[:9;mZ9m^A#N$/IHF|3_.T19?*.8F*V+:WG$1C=%23A|)O085
M8|H488:*W&PK(F[)**4=XGHmBC6,~9[NZW62$H&)!K;WW/`0M&2Lm=KSE8~8
M+=K/W!F:|70B2;DP9HZ:QMR%13*A8^:ZY%6`M~)1A=|T['",GM*SmNT'JF:4
MT6RD#?.$:KBEG4A5CN)!,)QE$ZZ4%G`NHQG,^P4U~HHm~AOVHUR;I9JBm/D[
M=PH3@;=+79%W,SH,1)KZV8QVY31+![F,WVL&'$|#ZQD/:2\F]&F`1]3=\3B[
MSL/)O']%G1P.:3Q$'V9S.IWT/9T8^T%Xm0=E)H(QF:=T3GFN:'/*+;&\+!]I
MNU`mUQD1$#J\PS@JYC.ID^9J/*8K$%]1%W.^D6@;3_)];[I+I/0#J)4=4Y[m
M9T2O=$RT%C@E/)P^=;`7,ZF@)0#5D(D|""5?4WL#U*47![.82]'6`6_#ZTAW
M)RVN&S]()6T6&??Z@?mE2'S2%5V'.`3~JP$N?:J~]TXT$9+W'#MZ$/YW2@P$
M~KO[7W]X4CICZ#%?,.CF53R~NAN?IS+0QHCSZ=6QB0J~;]Hm\61Z%~7)W[%)
MA7)2UW@)F\2V#9C,FDD(N*V8+KS!@#K&4TECNV("%.DD\J_7=!M$=.C3@3TF
M].XVCF9Y(Z#MQ:7R\"KZ2%MOD$T+'3$UR#_S\A6W8]WB.4U$2/,XH2^(|XGC
Mm)CG0O$G,36|,X|POO6V)EUDZ2BWZZZSPPW:(0\"5][L/%RSJ%4:IEFDNSOR
MWH~X42;)#28J&RZ=,#3FMION%2DIL]6_FJ|?~)&(B/1YW0)BD6E[/6(~A:.D
M=;I*|`HSOK3I[IJ.H]M@:|mS!Y8Z5WAS240KK,6M42M\GMW|$NUN!$2(Q\1)
M3;m!W=`D;4//J2ZX&Y54,"AN&N%X1$\&#3Y~~^#XZN9CP_^,UQP$&I3LZ~ML
MCAN'SC=MNmN`SF;\D0[Fm.E_2$C@T.D$#|?M!$:%9I0(\BCVYY7N?.*OBX!X
MO(0W+@Y0SF~4)HYZ$|UN0_.22O/YR8FUB%.]CB;S|9'0P0E*M:)U\\9,,B0J
MH?`Z'EPN='3`3]/WCFY$H/[C,?ZEKH])G&(B;~_YIKWY\]M)+R,:/,ORG`@m
M;\R^K"3m+0E2m;0P&"2\G+2'L)S|1WE?)W(CTSF,QW+N7~=H9C#%m+,TB"C'
MEJ8:|,1I'I(/[I#G@~RO*^*S8FY&#LUmW)\S&R$S+C1S0BOX8TRU$G/SD|\M
MM0DN5~FmK&N$RX/&%=L[RG9+VL*9ZMVBPF1&BX:#%E`G$QP(N1F$L03O`X8J
MGLVR69,J2|$6_W(5\V&A9|:&B_PK(5@~+=/~,9VK/"2RA)N21CE`X4P.'J@@
M55:CQICH1P&:9&ZND(O@*N::XADHZ8ETD_L8IY%9L&%,5SY)m2,F&$$/7!)M
MYRGm,Z3A?~*N,NRFZX2V!BX^NH!#L^WY0L&.+92K':7T9.6(\V|?,WMEX|K%
M:9_=HI/$|#'3".K3^YB``4mW6L%Q^13+]HYY%])"W88Y,4/C$KD";Q^m\XP%
MGS`IF&R"+2OX;#&G1MT4)D&[,I!'M#&91;S&QNB"\M[1^*F913"*B462;07&
M./R)V,[K%%.;@[$=,OU!]UDF8;(K5Q;5^R&.I^#X'$NI][6P6S0SM#5HIT|T
M5S4W;W6Y#O1[$m\5)B*%XmEWMZJ]1V7OUFA"^[$P:^@2ZA"*BOL&&R((CGFC
M"W\CNSQR,E6N(O|Z|D@_4^V@,CC_+/&`45"IF,^64E.:N"B_;199D[=KF=(W
M[#TD=S^$_0P2=3$C%G+.S`M./+,Y*_~7|((TS~"]=6N5KSD:Y`]8=IX:.\@&
M~AK+%WS7RM$VY#_#RD6!D$~SC:VL([*TOM0:F|0:5@W7/;7[++?MT271Q\;C
MPR+B*6T&*':(\LQ'5W)0G7A~HMO8T335V&LQ,234^O45'3S9#5@)&BOmOF&[
M\WLJ,_WG"@m3H2'YUm_C^6RF/.&$YG|Z[U$OER:=9)%T$,T&.9\QL_!NW64~
MI2?8#W254BM%^..[GU[RQ+UY_@/.V'1.XL&S(8@7+K8@)VZK?\4G_%1H.*CC
M$,P$RPAYB9V8Q'$A;+81MGFWMH)3$9ED!OHDP\0Y\]KXE;4NH:H(A:VT&[3[
M,GH7__ENP5U$7P/IHRI.:+/m~DG!5[*G0^$BWN6Z/m&MX,?LFH@D\00),3]9
M#"5(48QCN2AT5_/~'V?9!]GH#^WD=U?^A~8K/XCF?XR95S/\3R1JJL`_D+3H
MXSED&m%7m:V^*K:LH/!=?mOPRM$U_|L5]C8~EQ1??;XN^6#=8M='M/V)$9CC
M./9GT1"5YE?@)J#9FV(N`Z/~Q9HP4ZPRKNJ+Y/+m#|_$~HA^8D0W(Q5)^\UK
MC/+\_/CXXH)?T8\_O'SVXHQ^'|3#B`A^KE.FOQKV(^~C+RR)[5%#=Q+.4YII
MT322RX)N4R@G6FN4PO130#PX_])0(NYV6^D|TZ6;*=N`NVm`V[9?9#31m9(I
M6`]`W*0V)5|)5+)&MK9+#2T8J#FN=10;)K.\J#=,)Y=&Q~P@MII0\A~O?N9?
M]P,:R\]T/,+N7[,~C].H&VCBY~X[Y"V&:HX6m!+90G0!AM_0)J6RQ##m|.%F
M.4DS1L'[MSE=:HN[;E$,HTGBGL^B:]&M'G[=;!Z)TL|^ZR;#Z6`8=#?H!"9#
MC'#&A`*Z'CIK]IC2_1GUKU0UG(m*L#K`/NUVMZ42%DBN$V@=L)~H|JAJ^E?[
M*&%_"YNH`PR$F806O7.5S/!A\|%\5'PHE0OG*8A)]U)65ZE!BS^/QWF\.O+5
M@|_Im/*!MA7CN~T!S84MT;_*/D`.L(I/7:]]6[J8A5M="&B]:%;MTL&L3G[=
M"K|.CYKA5GA8;B+\Y&IN9NX=,62MT=]1Y~COR31L#OK+[^A+&,!NAF&36QXF
MVCKN)&\/6E,.;T$^'RC_.|,/R@CG1L.CI0D6/&.RK8+@=*@GBR:`^6~CNFZ$
M8%LA%M(KH?_"XF'7^WJ4?C9m1(`/~!|/Y%Q&(69.KG%C9Q#NKJ15,%M2CM6`
M.'\G:D"SF()HQ;,AG6SI$97YVQRLT_FY&3H1J%G,E`(UTDGL)BEMG3MTOFD*
MM:@[BW`3E+A'Y'^R8O(!X0F~\2Q`[Q+34!M6X(K&;OK!;A"#R3H^|!]@^'C4
M(0QFSm;Q#KZ/NCUS=0K][V?I,!Gm9\(1Z+0.P,m2G;P!B^+.mm^2T@OB@(9@
M?G1962*GXDYGJCH,~4WWH2CC\KJY&CP&*Q#U+:O(~:E4A~VW'2YW`,~Y5*"9
M+EK!:U^!|67%J(]9,@`;PF0X@\$I&=Z&EAZ&$7,N?;HAP8`U@GM&W|(PQ@N[
M]73J6|9'7=/Y;)KEEO2VUB]RmY_WC`;\)VV`[6?~&4M$!N&O].ZPW"RO;L,7
MBGM)&LV26+0%`1AY~~X+;#6?9:/KA9C&7FGY|#TI]Z[S$,ZG`|_,m3C$5GA|
MVBB~.KIA%1NXFY.4]Y?VAN3`/C$m41I#"M2;'SI+(2V8/ER)./S,IOm$"DV0
M&X]/'9A3\(VJN^.K"Y0S(;:S/'%%'H^'/N|NIAEFE%0D\3N.VJD`LSW8$[8B
M|W&S2$,[F%DXYKGLUQ#Q/ZBm:NGLA6*0m|IDNKJNE/&(52?HSG,$$9#6*I#m
M?WY^~+BT[XZ.B,9@/]!X9LUH\%|X+6"VG3XI*'U&SW/[D9VW!U:I]#4ODOT\
MC:]EV:`%Am!3IA~V"V+*B^m!\#$:SV.H2IE""$_L?V)V.%N!G|A$+(EA]%AO
MH8LV,"IRQP2Q.CR$B6J6#`9T3XG^9DTSU.=71%`#4~FG3@mG%9FQ7#RBBH$~
MAAC%E/BY/*RQA=;H(;)9X(:*+V[C0N8Q'M0]#9|^6N+/MO+PUU^%MZ8K9DI3
M'@^VMEQOAFm6IM225MQJT!;8[]#L~QP|72\T"^?G]+C.9CNJB@2#F"UEO"'3
MOK'2LIXZ@G(V&GR,B!2,5,"@*=`Y4[,2~F/ZZP;':B$C"7H?\#X:XH0YQ55N
MY$T^2:PE\CH4:B^mB62~BW1/C"9L"1!&5#K$W2NZ'mG=HJU0m:.OR5962~TE
M1188JOB|2%8\#M\,8U:K;^4!:.MT~I]=?|)O6T(B81&+6VE|B#D^LNL&H3,U
MFX5NXSS\Z?GO:$O$_0_Y7)0KD5YE=mN,L/R%D/9@$Nm1DD_,LDRB4=+G\0^3
MFUB$6+4J862SV%+[F.4UmNX%*L'1IF&3+14|Q&*D9#61#m+I|9,\G\=&4&)1
M`I8"D:V3O"0VJAA#]`?;&1+?O,A`V:23M5E|5S\mMH,'HG~:3F,81/G"9&TD
M4SF9(+D0C6Y6!DU7B3;+]H;KSm]I\E66%KmLK**4U=2"+I+D!G4"[F;L#2,\
M!6L/^COT#U_Q/4+C@5@HQ]!H*,6`G|:MX%G*)!%BXECX)TR|G2)6A0IATBFF
MW3G^J*NF2V5L@FJ(R^W5G!2\~|I+3)M~3.XE8L;ZGX2MP]ZBR&B@S:$C.$]I
MN(9GHY%)ZX7N$M7YLU%%]G3()^0CB1|#W0|J?_]D7\LN9?N~;&86/m4;(+Y)
MB.[@^+*M(,W2)M3!MT1^JK6?GOWWR9LWEW\Z~7MV^OI5_~*"SG!WGm.M6]P9
M14D'_2#YZ'#[Z*@3N(OEZ"AX&I1^[P0;[)2P=m_Q++EM0F1`R5!,Y=_0C|U\
MF))[4(/E[[$~ZU@W:OQ8M&'"8?P2L9,#=8PJmFH%[.B`9GH?.NP^F*N0^;9D
MF,9_"VLK|]"HT\|X0FR@9L~B1BBJ6E43I5N\m7!DH(_~P!94?4%"~XH^5UW(
M3*Y,WDM"4'CT)~6#DN||74U2G_CD`32(;,$(^Y~~*?AR,OA=0`0[&6+ZGYM+
M%Km\?KXT41|7,AM\~E75Q@Y"1AGB|U/@&,%!Z|:CPT|C!=OmG%BPT31%EQH)
M[GNART2]%$|VMPF&WII:Q1=UU904.G1?J7L;I)'.8CL@XM#2?.ZN/9K2S_5T
M]3V8+\P@Z_EAF9EmXD%B~|.@=78"WYUG;_^R3Z4FT~P#[A#BLJ97&=UA~=CD
MW22F"N*H^D1\H]EMT'KSX^M7?]EG;M3?F5;(8KZ='8KXIR"@`OMAM?;R]/O+
M'TY?GIS5Z9~3/Y\|ZV\!%)(H\/RU~X2:\~RGTS/W|'60/mURGm~?*!SM%R~O
M3MX^~W?R/$1%^V'X_'7XZO6[\.3YZ;OP]=OP[|FSY^&['T_/^#U]8/6];"VC
MM:2)*SS]&YJNY76Y".3V8(;@FNYA*T0VJ*)QDELQ&JIPX^6&F4W43*9N7VS;
MSXW$("IJ/HHMJN~+74.?KB&'Q4T!:GC&YS?'U/Q+JC54=IEO[]Q/Y72G.,H6
M?#7Y0(0H;$ZQ#4[.WCT_?5NOUKX_?76)GX*O|*!N0&=*.^|`$DLW"mV?V21L
M#M?6T:Y6;P[*A?M3;K!ZL_:#4F'H(8*O#@]/=8^KHV,REF/m&WT?!8YY\SM3
MNRGRE?3,3M*='m\&3FF#9XQD;WMF]N40N0KEJBU5mAN&+2%X*/8VGF0?W|%8
MON.L!(?S4!:@(3!.Z"*~X0(X%O81^T[XEV0(ZD"T`/IA=6?`/:ZDMJ;_\FT`
M:B6V.*I6V`*\KJ]48!4?984VR3I6PRJLC^5_;=4Y:ON~';%!)]G+4LT~*U31
M::GM)68.%mPUZ:@UQ"ME/Hm*E\V[PL'~.LIK;.(^WQ8HC:"=H'm(mV9RPSJ~
MZ53,LQ$;M9?43H%NL_W.2A5.;\\:%U6E!+H;]SOM~3YK\[#:.#!+RRN2]@m'
M#LP"'YK]CKV8EMF54FW+mm8=N[`3'AZ~6+4/'P!+V_GERZ0WX^[CE:7J_$JH
M3\@&^.|E&^`/YC`YDL]?O&&9T[[E|:\]AAUY5RK?";IZ.ZP~HTY@J86[~)XN
M:|!`C]7D#XU.PSmL&M;$=Y^@M8="!LZA/m``E1S(OAmO93;4,7~F'*,U[Z^X
M85Cm@_#S|!ICX8|/VXJ@9/AQ*@7U!ZS`)"I?1[~P&8|D1O|_")mM=*;&UPV\
M("NV6=_$C(=Q/@Q[1.8_X`9T!S,G(3B;YV,8~S^2"#APD\4=2W'R?;WD8"XL
M#1Q6|Jm%\4Q8Q+I#.2)mJG``W8'(D")?TMF@0YHHA6.YHJ]2ET@R`34*R=.Z
MUY15m6QG@HFNB%GRR#\D)$$.6O?22&P"ME]I5:KSMMZP)~%I@[4[^V:D.@::
MQF*6]%6]Q|TOBX7K:,L&^TJO"!/*Z&U\__/IR^~7KU[_|O+]?L?|W7HL/L]2
M=P+O~_?YT^!Q#&S'F@#!FWE5T15=,L$TWU:?+I4(]X[:@_AC.YV/82|:S6@E
MFA_#K??5ZE;H7I%\|Y]X\Z5m=(.O|'?'Z|~PF8128SULIG3HFZ$KZ+4MPLE7
MS|\V=!16G\JLK5R\AJS8W?'T:=R_RO2?\&UL.,2R_A7;?m\4*K6_U'37"V~B
M'KR0VLR~]"AB:/UGV)S92XCXW,JE.|m=`V~4/(\1EL0RE#A|@ZRZBAR_FS_^
MK/CF:7K]+!4E$G,`JI_":6BX+;[M:2YG/*$#]7=DFO8_~L#T:%5K1,T&_6@V
M"+?IBm2_X(C=5\/3):m+C)BQ4:@,.?%_/ZAB*8^m"B=*G4NVU|MmYGDA.MX9
M4|2!?Q5!2\BZIB"R]TF?IG\6~W8BM**^;L9A;AU=MNJ?P!:"'D@U@6R%3E4=
M&O',JEO+S!'m;#:Q1JSN)OYSFU*\`?Z\6#3@~$0?F0|8B)K~"F]G18';C&'F
MO;m^:J8EFNR%V4:X_&!`%I~/H`O#YR~UC'XR+|I3^NR33A(KKMWTF3L_~)=m
MFV.ZWXSm4IUTV+P`BQMMmQ$'T\S8B*0:U8!A'0)94mHP.;'[mIBCL%7KTHN=
M691CHI,4%C&P'6m36\EQ7\1&?I2Y352NB5XP5Y)O:85AN4)Q.|+:%5|m$Y8B
MLTXDF[|0D8(?DM1:!+V9|MHDM]#GYS&(_|6%\6&FA=%/@RG[+J9^X3P~7%S0
M?#V7L\Z;|IQmI[3!|CM;^IUX[_!,4U6SG#V]3&_%\[G/@1CB/mO/QG"KA./~
Mm.KK!I~3`[+GG1[/8,*J$YBIA_m4:(WU6A$E;,[T0`5WN.R.;XT74B!45.Q6
M7Z!.4AIR^?SDS1D(B3@\\332A8FP4CMAG]YW=3NWMKO8^;A.JS6]+,K78;CF
M#SK:C,.MO%VJMMT^RmNFYFZmZJY3S~WN;GL+]^I7YG/Y]/Q\GV=T_^)BNUO;
M1.EM*HTZ]MMA~XMIWS.KK/|W')\~WK|mYU)JS)CJ12''3$UE_&T`)D\.6.W\
M7";KYS=O3MY~7m1EF_G?|`2|M`G;6F`_~4E_XQ/:"&JIT(_&JU^Q8;%GH]3B
M`8~"&.:Y1'O8OIJSS3;/+/NH#FZXI|"&6XN]'$?I=:D:;$N.,DD\'M2:"ED_
M#H=#V,*(L27~.RB_m.:12!3K65JJ7CPCC'^T,88BC`F,^I?M5F@OBSF?8XE$
MN\[@S,G!;|0m[35|Q"L|\O%Lm^"R'=JK*`Qm65C=;|AO~5C=JS?H_X&K6A0*
M&Am"94SM7MT2R@9K$U5~7$I9TT)(E~]"]9@,S9,G~$)m0H`*[1?N05XTN$B=
M^N'M,9S(E4_|@76E~7M=?O_L[&3M)W;|~V[8I7J6JBW7BRHAQ\'C;&A+NB;Q
MM0S5|"'5(3T;mM;3@7O^Km8!5J;!_S28$GS%Q*!:XVU#[WD?\WOG;%M'YXD$
MO.(XGT)O0M;KSR):UQS2JIC5LBG;U;."9%MS:V8BLXE/*+[&K`6T_NHCMWSK
MZG/_ZH4Y0]DFZST,|B]^mV(RIG8:&D%Q)=N)%@S~B(YCELKH7,NTRSFP78(G
MAG^VH[P)\_P\'|['5';,/OH~Z|/UQL$P*3L(^!|IG*G5R*GBNHQI/K6C3|Sm
MG5LRHQ58NFHN;!+6T1#3,7.G%LXC6#K/%S\QU!",G8,HG])Y2N3%KEM`G'7Q
M&V^T'T]?_'AR]HXW+YNBFJ"@I=UKMSTVO.Z_TL?U1LmLMUm502SQNG6?|,C)
MX@$QY=EX@C6;9KEXGE@JM;%G_,`Y+DV~[0;\VZ54TC'G0|UHEF"!N.SQ@36_
M/:G7^|;UZ|U~@\F:4`*OW@;7XXA.J9QY\J1~&A5+.?,T^=L\UA&*WQO10UA\
MA."SD9^m[_T^N^'WXP#?V('LmJ2/7(K[*#226T;)QM(ZE0HN=W&WKGWD7;V\
MU|?QL`BFLYB~RTRZ1L(2*4.GOG($:'6V'+EC~EPO4S_J`SK'_9C!F#[D_:T7
MX]_F).3A=SK\Z`3O~#L;\N]~8VF9O0MD:|'7|%7:8VEC=8I65YIK^|I5|$N%
MPEO:`:'I3GAK5E^\=LIS:T_G3"SU:|81(0'36+ME2YVR^TW7@]=N:3!:`K6L
M+\V3+!/_^NUS[U[43\J'MAY8U|Z;MZ__U\GQN\M7SWXZ@6+'_YW971*2BQ`W
M3*.TXY9KK*O"YEY3QYEXY!MEOBA"2EI3N"#,)NQZI!'R+#|$&WZ?.LOJ=FOB
MFLXPUOW@*]';O)$JH!PKC=&\?TZ3MU^^Y,TKP*C0CMA?&:4I\#/1Y9E[+3O?
MO'Q)\IWW4LZ!~?D:LJ%[R6O%U_%9QDYL5B$5J:^C=32$)L)3`8FG;Y8BR"B5
M0".2|68QW^`B@@H;.X5B29EWWTm9+_1U3L14D8=TD"J8!=3(WH7J=,@2'B`W
M&2L!(A;31:5&==FE^F+mINZ?E?E:IWU\_^]1:BY7^Z_18+X7K:4;*,P\^RN~
M"&NUK/Y,_.O'O&R(^GRC'KW\%ZEW2XTM313OG/VR?~S_C'DJF^RX$Z6KY$'.
M_O_A^:49_MZHm,6Q5(B,T6/Z9UO\~WR!VPMW%)X;JJL\GT]$M13!Q\(/7"#J
M#@\6#L0BXI(K=1E(_#2".45?+;K(]1\B.L3XP92B(DK7L~B|@_mS~#=|7""N
M9127H^#AY[S6ADG%EWS&J95`U1(,":5ZVYXC:27[&6HN64#AP"M*+m9C#%GW
M+79G5OQSYZ@.S("_"BX8@OKK10^:F#3J7^`:$PKKm6D#\%!O%m*m7E@',39,
MZG2[9GJWZJ69%18%HA3=HA,C*I$B6VJ]*+5N'7,EGDOmK)'Z)F':9":*UEHS
M.IN@WYW\]&;%#ET::!!8UZ+[2Q=+MNLU]5@K]9JO[+M5YJ/D'65\I5P_ZJM7
MF'|RS95@[%@/&LA]+RRO](J;R](77E_HT;JY6C&*~&%!/RC|".*S"A~`+V~#
M)&H^P3Rm$|~.\8U~"E=!9+&m\*5C'92"O`!,1:R'IP3&_BN4,`#!*_T8IPF$
MID:IWL!X9["$U3`81Q*N;W"T3&@MG4G9UJEGTU#G@'(0=*I!$NJK;`;G667*
MY=4mP`8H(##"N'N:(69$N'H2&8R~4~?GB`'IQ|5U'*~,#P;3S8|\\*.([`2*
M+|"4859ZV2S(^G9HXR~,.R1=8C]ZAD/@R&7Z&,8JA?m@);U,1NN^C5WBGIOY
MK*]A@L[L?/;ZY[?'S%EO*$&'SIY*!5]A,_3_/EQFPKUJ5FI9[TWCE^E8G;K|
MA.53I[\95Em,~O;(/WBV[NLC/KUWWQ/mEC@%/[8JQ\:@1~[G[&O(:#5SH)D8
MM\DE4`NY5m4GR_.F]|*4VZ(F8D]A55:+O"06Y_/SI\S4_RCQ+WJ(|Y5";:6#
M`Z?:'\0,W2:@3D8???AUL]MH'BU*.O!#?2;WJ88WB]O\VEW#@X4HYCD+RI*I
MGR!8&A:(JM6[F\7^@3Z"SQ1]R56S;'%^7JW~P)2[Z@$H`E7E'1/1@4;G[E?H
MQ74_;(Y7M@,3|2P8mP'7/:GMT&~V|@2.m#_LIL:1=7UO.D$Q[OQ*'`^[+'X*
MN|5?,8H~/1?VLD_LI6^,86m0]89+75$IMO:D;+5IO^~8Z6JU?;|?A=.#]("~
MR(.O~]'!`L&]RPWUEZMX~GC8@GL]UX$:GIZ_?WK1[N$GJ@C_EKO3_GIZ(+67
M=`W+'~J%I~[T5KL3HC^R&N%+S!61AFHQWJ]XS^E)WP"Z5:NU6C%N]L;mJW&S
M/ZX#G*F/QU?C\(JW+W[IC|7EJ7*`M?@AX5"'AO/?BH1W@!,%~$X3[I5+J((%
M?/2]&EO!L0EML*I6~!U*/)|S4#%0E,;/J$.7PA\mK%DN$&`YmDE^!#Z'FIA8
MGY1EA:DU8MP.%!/H&9P($M.3^%HE|*m`m^8?_4Z],!0|"+|@](9T+YCP.*.1
M7Z8!`5KP\7(2CC;P,"O]~1%84X8;,4YH'NI4FL.U$+Y~*[1*;C:_5B:"!J_.
M8+3QS3V#2ZOV%[[U.3WA@!Y&NH`KV'R:T%A[F*!YVHO&$|\U@BR\\J9E%P1G
M(U6|'PWO#P3|;.6(H1L!OE!|3==2*Nm"+^YX_#?H%LC5V]~OW_&UHI?m)S;0
M;N5M.FEL3WUZ=$3_;AFR\8FME0+;$mZL.$3+07A+6P/'XZ92]H#VN,$*WKIF
MG5#G?Z$T$&L]O(~^CM.LLQN.J.*B|[OD;RT]/?WAK"/=;|[6])C^`m|QE`XA
M]'M%P5JAN:AL5V@F*IWZ~KmV`:L%5|$=J82?/NE,5*M#3`2Q?A_YP)Fm+)OI
MZ=+\V#\RGGM~HK(.U7Q'8U_Hm*\K^O03$\?MNC&@+W7RFV_*G=3Z.`+X|UU;
MGFI:^3SJKSS$ZH`0TK_?[M;K2^]9ZC[D]BMR.3YZP?mBTmGY%RVWU3Q4?.2`
MBITWM(5!T+\RB/@C!.)!M8HW6UB)FXWM|#M|5+:(FLOC:I4Z~F!KF'9V#[2#
MYR%*TmTY+OBG07AAAB?N@U([5]P;;''A;H4J[G1Q7_#O![9T,J0*_2Z0m,@?
M5E!M`9+GW"?T=%K?5C=:?!'R3=\;M[GOM"(]FL8/KJEAXG[&B&1.IF9A\0+K
M=R"_5!P(@)M*[JT,NAG_+=Q9Z:.W(~|I@C\Y7"_6BKB#TC?Y```E#TW|8&GB
M!@]mWm~?G3GNU_I)JY2\5+"91/]!IYS;V`P7?O?=U/H[LSS#=M|UO1FF(O^~
MHQ~6MB~MSZB0];$G[PMF~'G.:"UYmNZ9._?mNE%K=ST*\=0#4_Y~9~.%I]UC
MM9&1F0%0,8N+XE;1TQH&&,7895R8O\94`\)0X*|&$IDRM+HJ1E?Q("@$$TK|
MPHZ]%[F@!Km6*'#Q=9%CW@I/I2;&~^*ICHV,6SB\I^`8F'm~F_P%|`3`.`K#
M!5!$U[:X34(W*2H]#C7'O#&8'T0KX10;BG9K%9]JT/`AmE0+2CVWOCS]12`.
M1ZIS~*81)[#V:1R&D3UA`Y=7)N(&78m\KM::0+QL7(O$P8A2P9L.8A,5]T^Z
MB0E`M/H5T,9JY^?'EV]~G[TCN?;XY.P,2`'^`CI,P^%\QLH$C@92SWT;;,]|
MFGH^Em"$P|YQ0XGU686;J7BAVG@AXZL7@I5NF!@]&PPM6L_`N@DJR`X]9092
M8mS@AFHH'BmGLMT=Q:8T&F*O&;HPF|;L52R^7'`*Y+JQ?64OmHP3LH\&P]`C
M44XSG7)PMT6#4?0mB^/A7`=+$3?0D1Q?(B8'O.+9\=O3m^_TUV5UH5%F~(4Z
MAX?2N7`IC.?8O#Y~?BmZQ&,m(3(~B?=SK"0A;K6[K3YQJW?+S.N4I+EZ('5Q
M6U9!JI;/DV?/3]Y^23m7]S~CE7$[/S)DJ8STM31?K4VC0NSmFRV2!S=;&|SN
MTKFZT78Z9:S1J&H!,]M~W:Z,mFT+E75#*/?@PODN]FK(;K[D\R.1V[3[+7WJ
M|31Z;G'\!D9+&/Q\=G+Y\O35R7ZG^?)~,W:Y)U9OO$9CO&3'J3XmONI?T=8m
MO[UAF]E&6#K]:ZP982^CMF=3X!UP=U?F:WW[U9H92GUM7]3WHm1\H_I4.KF\
M;O^.)C88ZP14~L0TB&ENDU:IU6\~$465B/[[K7V;^]B")D"~mJ+\_A7M1C[E
M@D,HP=/OWCZ[m+\W^\!:0V\/`ZDD,Q^9YXB^?FZ*OVSAU]?'SU[24+_W*C1%
M9)|LJZZ8Y"SM^L]8`~ZD_,+J.LT*VP=Z#.N/T)/Z$~m|~AT)|_%^]SQ?/8/'
M5Im;/J]G)5;"XMCZ^MB';62!6@[%~!#?1(P5"]61X)m,(D"3QDU7"T[#~H.4
M:J)+)%R'LI:02WF/G$OAI5+WS,A*8ZNTR:,|JZ7_"?KQ../2F@Z:AWHIEH;V
M\#Y9,S/ZEA5E2XP4PW27T@999;FHA%+5R[78/BF1L,`L`9MQ|1'^Am0!BHJE
MJC(3G1`I3SL60PV#'*G^/,AZ[)IDPG)~90Z&#=$,X,|&7B^9QU:&B^,4X&F;
M3&ASG0YBH]),K+Y/N6%F7UPEI7A4=;87=A&@!D$|S|:`_;;^KS)29K&9V_8P
M|]4YUNHD$WB*L]=0H%Y#ZL`JCKFNY?+$F\_9)|QRIH81+J+^PB;R@~[2YA]B
MIO9:='3@W\8|T5%(."E#[5NG?M&XKX1UM1X;^_7NV?'Q3\\[U)|';Om?6(HQ
MV.`|R)2E30."#.])&[%6`TO;)RYX7B1C#G[_GXN$D['L=SRm_^[7+PZN#JK5
MZ5:)~CS"_===.m8A_C[FSE`'"5DQ;!ZS=^8\=|_I/XY*|6|*7%]WMSW=LK$N
MU9H,@?@XUSQ:7N[,9J|YWO0*75H^=[4D;|Gm5K1L,O0(XK&C@DL5/M9XONXS
M@4M."LTG0*N:)H*#@^W.(J7OR@~_\TC`I4J(C0JOE+#=5BFSKU*W())4&5S?
MD;LDM1KV4497G\$_"UQ`BYK,U=+L^1.J~9)DHIX$ED;%&K`["]]ZC[Y\0]#A
M%+V2%B`@#KA7K~W66Q&F~8_.A0)L5.D2V?@*!N`9?J;_O\~[B.3LGKS$M+[^
M_G^%WW;")=]FPXPT4"m5"1HT##:"#~~=/&ZL;`D49T6,|H~VDXWJ&!ZU&Z%L
M1=GMWG6XY2Z'ZMAMXZWE8^!Y9IDX"DM|/2I$+~;B[.,8"AL:2;S&+,M#@_E7
MFF=V~#$6[6\[I0J#TF^~"YR`0OBX+,O3XFFJF&X/PTW@'_2JU1M:m:m)\DT0
MWGS`XFDFI+)*%QB3.mT*Z;^#|AOTN%O8K4!E5MX7I|VQMH3;+FM~^_NGO(&\
M';3U;QM?W72)58;L2+|*B\1+]QA:4_I",9IH|+S)7AMH%`:28]BBD@\"|\$&
M%S[QL4R|IVT~CUF!$MB+O.0')W;]$J)L6+MB2=H#P'_VYK3L*Em7P%1&$|PY
ML$!4=N%PSK!C,TT;R?O|0R,!~5XFKL+;GI;3ROCI\!RL+1MLK")3XP$5=2,=
M!%XBC]?.A\V:"U6!!"9?O&;8C`M=J`.MB#ET32)*P9_)S'"5HI&RCGRT'R;4
MC_&M7KDI|I?A~\DI=,;21K#|609/\U(`YJIA|K@F#ULL~0;P5Q,@m.8'T.!W
M)V~.%[~_7)[]_.;mZ[?O.)+'%=D/2WA@`=~T[RK^ZBE8EF9\$'JF)_|YDQ96
M9\_F$H,.K?9!V&K3OP|6K,GS)7M'm~|KH$A&NK(UDZB$DLMR$K_WA*E[RY0%
Mm"ZF8J0MXL^*+:,'X/YFO2^T^8~^\;IQ7Um~MWA.5H?4,2MV7%[6=7+ANBFQ
M(E9Y&I8~KQO%4LMV#ZWI@7M7[LD]]:YK~K5GZYBZA_KS$,.W6F1=3?9T+,FT
M]P[WGU'1\1A7ST;GD|SIZD&7P1!KOmGJKS_]GK%K[03HM\O.H&:)6!6U,/(~
MG(+A[`)NQQ/W5,`1];OZ?995+^QP(O']6M+$NTA2%P2')|3)*4RPD:"m@ZCE
M6Z']CV?CVV#HP#0AP+$'3BKDG~$H@9\I5B5\H`8.`VEL?'T"?*%@!8*ZI,Y`
MRmLB6&)&@0H\)Q8=~^H$SRTR:@31;0\ZJ9AE|S#CBHF@|"L&!$G2O~)0"+^?
M9M~/EF]55NOH$CP@Y#(JC)2R4J?)S^*2G_A0#6R~LOM::G#9%B0M"',.:C31
M,"!V(,AA0!:D[,1F_?H?QHV1F|FOH)&M6.N$^,B1|`JC+*P4_*^8)T+Z|1LR
M0LE4+7^,7^"\XH(M5J9?61~D3FO(_K:^N\"OMJ:TAKI.F3UET"MXSm!|PAE,
MO+.L*)CDR[%;/ZAPR%H4[[!H_@2K|F(="HX(,#\T6#DW+**"*6#AD,^=.**?
M7YW^V3AJ![U;8VBU/(]DMm/\%V$\F8\]U'Q@'UCL(#[&@6R/=8C`Z!.P*DLY
M,7B[?@U4O79^13_AI4&~%3.D)(V%N_A$|==IGVWECKEW5CP.%Q^ZU&"\''G`
M`N(6&$1))M*\`3&M5'|J]m?3RE;`#A`[!T;MR.LRB_O9*$623K,1F^*(.W5~
MMBRO1[T0N3QA~VT6,+B"&_5R#~&Y(&,8#`T]Z!R~MVWC\F;Q1.#m`@|**:W8
M0^HP?ICKYI5^]O;%GU1%MC*QD]NP*CWIA%O;)+D@`V05/~Y@N`$[.=2J&ZB#
MI)D=~$%5\|OYSD78^4?8?M]L;;?KX1W/4&WIU5M]$[I&3(F#TNm_A'F;2K?Q
M=`$WE=6ZBEIKN^[JDRY6=_D+J*&N$AKO4WQS$"S*8`8N.)(=G6BZ#Z'?Y1,X
M!VV"7D`*,8TS4U9GV.U9=.W[;=J,%`9+G`%1BFPF!RL"@;\*/\2W@F7BEOG~
M!:A5Z=Y$L4:X*0W5#W3B#X_LU#*APAR`5%7=1.BW;C)T^JA\+?Q4K:\K6:F4
M)MJ\H+U;J917++\S;Q=ABYJXE/E~Z$%(75IICm^FVE+3BN([W~H+ZS$KF1L|
M^H&7YJ/FTO",.m14,Y1#K%1\(A623))WDE!]6H~6D%@##JM\'+VL.[DXYC.X
M$+Q|!#PF\#Y7]P:7[JU_%7'/9J5,%1*U;YW=[S]6X#TZ;BYE)LWJ~D5HB]?^
MN/_^4S~MUSZ=O^^F%]OX^^E%G1YCX~F?\_=']/S3D?Q;YYU@EI|;_.@WM;|X
MT.?7N=T|7`:'K9M6Y;3Q6WYRU@[;HZ5"[~HW5,`\]GJ;MVOO/\%=LE[CWJWO
M6W67ZFJ7SJ.$EH&OC?m^mm5S20*O!/J5[KB|4YP*Z$5~#\P'POX|'MH,|+#6
ML&mmGC4,&`_H@Q!BAGVV!H1&P"EmJ/T1,6%3UI;JAF#L`;,#+m%6G`ZWY_`J
M7[_L2U/T%'/SB6~BNXM)7)["&B]XM]BF101%6]",=8OVB$DI~@"GLOJ*K[O%
M=7|6&T32&?N$)EI|VT,N[Y;R0!D4&XZWG`mI,m|H3N~R0V~[R(K;:6P=?"8"
MWC60m`5$`5E#)%WU2F,F/9mL*|Y?V/X^E[XO%T~20FM$mWPSR8EE&"`31UL^
M:2,CAQ$$F*2C;~MNY/*8CQP|HT8m(UT!KG].4J`|J!4EC.H+7%5+KGY;Q(_U
MZH^C9)*;$$];H7&OL/NG=QO0Z_m6JW4!WHNE$,DI"U~F62)$BJT%Q#71XTEL
MF$%/P@G`Q~Q[5ATCDAC]L7m]%WY`@6_5%TYT35YH)T/)2KYMR2R3QM|2WR)W
MFV+.9,B,R;C/|L;XZ@L,=A_@*CGT\V,2"1.%'5$7QSYA@$WFHFJm)@#3(S+#
MT/AGF1XJYT@4=Y9]B`5#UB:W%N5E+^Y'|Z!"9^S\mJ(=V`CN[3;G)&J8(`%F
MMCDA7*ZKN:6|)(PO4#/R!;0"FZ?P0B*AC1mC3F'?5*$,mE|[X&YS@UXC;5AV
MV.(;J|2$#[5XNm?:H6VF64=|)@[D'*'AC$:|1YA%S&MU/LSH,9m3N\|E5%#&
M4m83V%3SX._YA"~%\)ARBEI73$~EV0`X10/G%J2Am=ZL&(F^U`;8[@BYZ9F5
M#21=J*H`#'0HEMIF96*B?XV~,#\F&5'8WDV/1AGP%,=Q(5*)X$NT?mVW@U7!
M!LY5R!HGDO5|2(_+%I/D`72KQ*VP\Z2(3*I_:'C6;,F_E6DRBQ+%"X2ZV3Q7
M8GJ;\*D"\OH@(IK`9|NQ0R:#$M4@3IS'mBmmING'C~QVZ[=HD[`(|RG*=\/[
MH.\D|[&;IX;MP%6R1%I=QHmP/C77FW&ES+~"C!:48_PC[mPKFAS`5N9VM90E
M+FV1US;;$68*@@K27MU*6~LVJXG1Q1LN9Y5%DH+NY9G*NQK)9,!`:~OS'2Y~
M'=XDF/5@08_6D0LP/(Q,*B8]Y*(\GX%/M^4~TFS)QA1CH'`+]FAV.T5@3T1~
MEN$/0(8Y5:2!B?~\$4@:%FQ5'WM:$]197%8:~+NM35UR4RRmK=Y5)`8F1!4]
M~$(#~&6U:m;B@%E`HDQ?.+=H@YImAJACSW0*)]\E&\M%?S`$`A&$44YOE'R,
M6=N0|"(GJLR49$N2O1/Y=HHT*$\&3ZSSB#8D1XY:m')H~88:(\Z)D\78C99+
M"|M%\W4:0)S&?)E^@E0JV+'XQGQ);@MGZ]OW/|?,)@X"\]m^N,[%+/B*S1~L
MG&6;2O/O8|6!41GW4XY|JJD%D"Y%J31LGJ#P9[P"3RIKH$!|7ZCI5I7^M*Y|
M|`5[_$mOE6A`)G@YG*E:~[`5~A]H684T2|.M]^WNME|B_.1\+WPT$0,V~GAX
MQB/EO7_LCL?1T589?,3%$.W;("(ZN%Z`CIN]ZI1CJ'!0DG0~VP@m[J6\]E;J
MDWFQSV\\]!.JPP9]V,G@^*[%H+(T"U^Y2`CZ,_GH34'UJ3XW03$HH4KTIWXU
M0]K^IHYA$GHX6:L^HOXAO\1F[%1WL|mV]S=;&73H+;\$S`\^1*3GX.![+*Q4
MVJ@.&5P+Z8;S~2\|7M(%31~SD00A.\Q&C;!*S^HD^WU#O^4J#=9P_PWIW~2#
ML`3T`\XPRCV]m")C@?R5].2GZ71_'^K]_7V4ON3'IG:IH7ET=_S+|Q8VO=)T
M3"\=`,NE#\!2D]JE~VLZ@IK4%KNU!=GQWDG243/~W'#]#%L,,OOA^G(^E5A#
M&]@`4EZZY2K4&UBI@6_S.2R5~Q#8YUmH/"\DX4Y_RMN02$"&K&'Z:]MT\`#X
MG'1&mm^,OJZ$.UJ)H4=GCRm)IUH!$Z?J(5?"E(C)G#D;~B+*/IS6/=5T[9$^
MR*;X7:.UW;I:/#3AZVW#97?V#M&m6C'L5mK%9mJ6V?`FJ5HMACP[Bm(_PF_W
M1&T2+5|PY_.P6UQL+]W?"mNO2&5^)&XY"&[:N?]K&[=6BLCC3[H;AD~IF,FI
MN/)~R)L2ZTJ^211RL[+U33?UOJWNEJ:OLKG%H[]GU~Z?=G6V9F$*M[*P0W0G
M~]~"T]~(Z4URNZF/+,EC|#"QW*53&TQ5A\WNI\LH^;U;#QV55O"6S8*9B'6*
M,~Y_#[Y7Q%((1['`+$K;H==V0S(I:I;~892,X?]MW#S'$,N(`9HIZ*CML8%9
M7S,8BYEN,EJ*6W(VM=Z[\#B6C*:`mYHIL'JI\XB.2F_7]5=$`Q.E)^#)'`^3
M%'/C#9//^_V8V~|5#HDV"2|5N^|Z[P3M&Fm#Y.W:^?OZQ7;]@!X|%``79_=m
M?0K]U4$1'2SN,P$?L]9Q47+4:=B`M#Y[]8XYPBMTZ69m&@+)'1^I15;EJP""
MTU4TFX`9]?()JO1`|B:PW$5KQ9*CV?HL73%"|.`|B]6"XHD4+J%I.8,PR_8Y
M\KB+BH$U'8%mLR|",~|9Q6Y9m^?'"Y?GZ3@\]7&X31\/\V*0T,D^*C\B`73E
M&=W6Y6?SE+HW6"Z'S+?E9WV,L_R(Y.~46_4S\AW[V?C:VX$@KJSm4K7=7OI2
MHJI*F:V\ZM9/0["&P"GCQ.&~GmmR9E0BE\G@_((AN_ZD.I(S'BM5=""=67G~
M"2I?FCFOFU8$|m,(]'`W6%)=7K'OmV)3H3L0=8Y5/DAJ1L$"`,)$#EIU%8^G
MCQ);S&7FW\=P8&P^OWSY[.T+=OU4G",\^_/KmR~O#.[1[W=VUMQA2Z4NJ~:3
M5\]/GG=V2]'`;Y[_L";7UW)L,$JQ?JRL]#28W_&^'$"%]|`|=5]&[^(_WRUL
MLG*89$ENm$DF^*;TRJ,%4W0Z&"+V#!Z8V2PX/[^)]5|]P_(9+[F/%*BY;/U;
MPP+O!O"NS7W[4\TFI@B95$`(!8?%X']()LQ.21|7P82H#$FPK"NIAX*LS804
M6A!?"Q5RSKXX][%1+=+)P.I=OmA4R1`/Bm~L%;ZU*~]+H;@G;\X:P0TR$?*\
M#1)D[(XXU,EDCRU,0N.~9X=LFA!$"^L2B*_W@8^+*+I4_;;4KDQm,@&9EG[F
MK~"UT[5RO9HPV%=X6T[``"%Z\(S0KHINL54V.AAM3504Q.7S5$L#WN*'/0"D
M|\)`2X8#7G9T+QZ4$H$938UA*O0F+F%H,=YV$;B\?LZS0|YVQ%9]VF6__@K$
MFUE2W&YMA;H?U*M~+O[`J]!/%&@PVDW*X#7Y[7mB"!C,O+AJ!*+MD3ISZ#]L
M#6YF_"\DKW@._]YX".~+5AB\C9QK*RA6DP\N![WI!&(?]9=23"*5#'(X%QA8
M8"`|#7P2YUKFWF9FW6~\:^"*(\JUC\DL2[E_QBH1~%L=~|)5&PI54C^CE4@X
M!A:7JLOER"HYG~M`=4?6];7^|(8K(5+B#T1=IS[NVY0"AJ1`mZ4[JB79F*F0
M%/8WG[![m\2~W:@#@?5R4C]="S.Z'VR\?/;NY,\(*@(2Z_,_G5)'?OKSZ:LW
M/[\[Z[3VN]4JO?[IA_;@8T+=FmRT30\"^Z'IWGU9(T5~?'7ZZOBEB\L!S;\/
M2|TJ?[9L]IDM1G#9*J~?*6M5?,V,#TAA8(G`EYO8SL^EB81(X45NI]~mS18m
MTZ*.\V#J#P0N&B#]7)W/Z'C+2+8T=PQ0\RZ'=CJ\(*B\_;Z4&8=:M]EQIEL,
MB^YJ1]9(\9DQF*~VG89+:\C9%/N7M%T[U=TR&K[H:+@S/GR\%F=534`;m7^@
MITR5B*9/KX`mN%W.YS/UHmB6Z]ZENN]71M%\7U++HH:RP/F]*(_9ZXB^QI)`
MR~%6RBP3`FS6Y2^1=5M24'Dm"?A_7QQJ1KEHJE155:W=7V'`HS.O!\MU~,H~
M;P##NG1V@'_J3M~#3.F*~`D;SIRG3"R(|B].|'A'D*XD:H@Q/H"D:%!\43VX
M4*H)5X'*=S?PUXS;K6TQ.S0mN?&J@W54HmA$;M@(#10'6P5,R?!#JF:%,;`R
MX/;'$E#P\J|SH@C$[[:EL~Y*:^U~26~1MYG5HM5L?]m.#MZ)YD|0CT+L+Y+@
MPHMN/~1BK6V6Y+34E:N)1,!72_72+NS6NRF5]SZ9'HR`#XCX=]X[FRW0K:\X
M'(#SmW\E*N%JS5"W~MCD0(I(O`=Z2!0!QT*$O?O*$Q.mm(MG\[2C"JS#PY]$
MC1;m;UQZ9:m53D&=N/R*9MEQPI*52_MS^?;D^~O+G\Y~U,/J=FN|C|*R]LWB
M#)FO%6'+.[.Z,V6A&F`_ZEM:&:"X1.~~\*4V1*W:#E1[_GL.\2@54(5W\V/X
ML9?=F`_N;?E:I"R_|:2)OS5V5DT=.YT7mGD4,9KA8!8!@E1]#R0LA280=Fm4
M8&]*]~MDL1Q\!+TE"E("E_RZM7T"@VR[T7X_;C%Im4/AD;1\RX73'HHBW2K5
MG?I=5)_#Y)Y;D#J7]#\@Q8[m%\UQRI:GI\L0G'LH\01!~|'W.Q4:1RW_]#&N
MZ_|#XKJQ~|[#UD4E"'XX?~%AFGPYE799|5#3I::&\T@K'18DYZ""*&#*$;NP
M6@YD;:G|\]mG7X"X0D+"_9@K7m^?Z~\OJ)!YK0|KI`%?OGWVRQ?42;mQ?YWW
MAGJ8V2@%63P88T'[\~_)5%!`~`U`MVB&@J\@3]$2*SB'UJT#~7S]BF!BI_4+
MO[1=XO0.]m|~D21@R2`1#\!!GGKDEI[1F9GF]"O~+5D/Z$61R:O@JPWWZXA3
M/J86)8F%`NM0`94:T1HJ*/:=IW[2@,=%G4A.53!ZG|W6'1&!!E'L!CR&BJS?
M&&?#!ICI9$#_3P~m9#QJ]'KCA0,:|7,7~BL|+JV(^9W.#&^0Y_.9T5$8C8,O
M|$(+V^"|TKDOmH*!AR82]V\PGPXX%'I^DXP3.S23^H\^N2E`'RUXM_%[4N&P
M$9R?]Y*~B*CBC8@]"X0??@+G0:*N98\,A$)P"G!VC@J|OC2RTI,5Z`58"'6(
MGL+S0LV=0T_@H%AMILL;C40L?\XY!^GN&+`#2US`40@^:7Rm(AM"QK$R8)XT
MD[EH0~$/m8YN6|%")1LZ6'/G7EP$?N$T3"8DE+.:8Q8W,8'81JN7~6?m4Sm$
MVB'|"DTFW?IR.VYU^XE(&GS;X!NZ^|T[6@EX@OBO9''H`2X7!C'$?MMNT5;T
M|`O#T*X:[;'35\_IYC!6L03(QO+!$?^0#M0HA^_ZDZD^]m_Y;,7~T3~[!W#9
M[%2K?Y2/8(CV"LO/\HHY&W`UN4(^TJD6EH@Q1,7^\W3=9*Z=m@V:\U7V;P3=
M[PT\07%*?IDAD=UL$02O9\XYK12W89``P3,PHJ^G0XH&4/Z)W"PZF,!ZHHK^
M6$^D?_P`0*_~5Y)*A$'GI;CU|A08PJ:XK/K@Q:GZJK`IP"]EB(%7.+`:J8CV
M@DE^"0_Q9^(9Q5IG~WA$UU5(?#/_DQDX??B.Y1X$`U7Q$GQ[Q+`!UP*X#T?Q
MAG5FR^=@6*R7[`SZ26)?.._R&BAJP?.?)IA)C2#+Q9|.0DD)AT]TH8%1*6NJ
M1D[$Y&~_=|,1JL"^.]9+D1VH8)@'#8!7E=;F)65:#\Z37K,V%^.5W7AO)(_J
M_]_`'Y0VWC"Y61O.|Z_%X=&!.5B;4.+&U"[@=;)DH"CU!05/Q2$|SM[GY]Y7
MB*@S$3"'9^^~G[[2:`P&WQ+;76IB1J3C!?NK4C?B:$(?*RP`PB;"#?V9;5S\
M(=?T1@_'YZIBR]M+;[F]S&C`V88Y2Y6L=AU97|U4WRH2%;PH#Z:T6:)1[+N8
M]6*3;EQAR9mAZ9M0OU'P|%5XC@'0@Y9Q.%J?FT\)C4`'$7!4W!1;NEJ/G`~(
M`~?O[RY4_PIL9U&*CH=mSD$8(/1E~3?6_KA/O/I%_8\D#"\NMNNHP40MF|Z,
M^QPCP?/\S"|)G$D]=U@=+J+'3)[~N,DHA?8=I$53*4=%(Y"T?M8K~=[_H+Z|
M94@RB0)TB3P9~67H&FQ]T21Q_$_W*7~=J];!;H3Y!^*$GP[B88JQ7\*R)EN;
MQ2~B_`~_|8m[M:?C?T?=P+KGV$*+HAA6.~A`HU_PK,,N0VCDV5)IG(NK9'0U
M!E"&T!84^]$\\JH7H#=SYHZ70Y=JY^=/::]S'm]*;$@D9m[";JGV/2H"O4TY
M`%'I.:"TYI.~[:"0:@.*;RJBY8XP7WX0@1A'I!LVQ;P(^S)_Y3I,:J;4IB05
M@['T3(ZS"V?6O+:Z|P3.3&^1:X7TZ,m`RKDm)H`.EJN?%X.Y0+KQ~W19E#AN
MN;XTNm@`FME,\53R(]4O3~?"&@1TJVK\K[C)SA``0*M#TUY@&=YC#5R`EL7U
M\&*V~(`,CK+UD1.QXO1QGA..P&9?=%,O#2VG,RPKS.&8=!@'LN+_Xm^I3["B
M%*R'H*~_2F[R4^8;64V7Nm!/|1]6*XHD3"Z=Z&#FF6J$A"J+4`IS8]V@6~L#
MF0YC(@*SY1AM\.(|8\76*QA:.)|+X/mSM_|Q/UDZG%O\E|^3:]U%=+C~;[6V
MWK\Wm/OS9PSDVCNW&`3V%?Y%S?CWH%PD,7.9,Nm413)Y]`'T4$[W/W|A*V7$
M1mG(RmP\"24F+I38M[:)4|787/"CB9J\#(D_KW2)VG53+VI2"U?H83D|L_M4
MQE:KL??ZISH&^2D=~Q&:&.1*0_BR1A/UB3__=$.DR/O$=DX62;H\G~=7/+Fm
Mm751(_9SOR`WKN5#2ZX7XJ*FQ9D@T\R?O'T;5L(_X@_]BZ_H+WU@!FZ#1(5%
MQ^%G:F:3CZZ+XC_@D!2.`8%@4'."1CTP,0MA4T3SR*46,|97R\%R;+K4P_&[
MF*4:1TW(/(F$OQR66F_HV1/;D.*@*Q4\$SV"FA19@1!HWA1O@#YU4R;|M"CA
MVX`(BOJ%$F@EVMDP*%8G2@B`;\37G2QN"D_'"?3J8Y*]~=_[|7mOHTD~$UN(
MZ(I3(\DAF0LD^32^9FLP,QD646XZGTV)JHN''%`J2#:8Q9S!48WQKD&U|@.A
MT7Y/'|MA|@]^T9PQ`"&0J`O;F(`~0`TEU]VRM"9"6I#'R`D';YIXXN~V~|;W
MS%YK=[~G@|~V&\2B:C;XO+78#`[LK)?N:%TOWPO#7JmL!=)@ERH_THB_ZZM,
M,KCDF3J((?@*DUD@%BYER:01^N1|%*"`O+K^T)!8K2R0V&/|B,88?OV!Z#3\
MYF_#$8/.?S0)Z/"]Q#OW$AVD9+M,$.,BL2m6LI7501S/7@U.&"944V+OG'K)
M/VSV(`9PG"01\&,R@"W`!@8UPI$)':&I8;|79*W6$?0D(@7Z+!6Z`QDSF/+(
MN,28QFBA)~8)3CKJFO'YJP~7!|S)/\*;E.X)_'[ZYGA__S5&BGM#PK"IRVRN
M4'K@WT#L@A7/^`9A:;53!@K@:^PA'E`#]*?)@"CD3.m:JWR09O6#`"^H3IGZ
MY?|m:;,A(@:5mM&W\EIH]T$@V#;ZT$(N'&IM~L/)PQK?QM0@7P5T!34,W:_7
MPZm.N&/H.NZG"?`:S`m#N[?,&0ZWB&*SQ6'&]~R@JCJHNm)O@54PW^FL\7Wm
M]PZX~^]S:NU;#0.JV2X9;`;JC7EUB~2RN]0K8NAWPTY'*$(W#~[KHD$|,&_m
MA0M);:5K5*G*3F9691*):8B2`FLE*RE`'@\IQ929][DF47@.X;|[N+B`NBSU
M(XM+VTZD4U6%0A,[P^$M%5'$:CK+UQS7QIO.PE@+@6!A`03L_mQ^~W%Q7WST
M]?5UBSHYBYMY,J$3mH@7"R;F$ELF.J;F(RL:I?m6mANUD5[RFKK0SF=]_;:(
M3;CUL]37!%Z+(E&3?)2|\TS"27'28W*Q/+63B$WCOBC#E\%:K^:KQ6|T5&S$
MO!H;7:G^6M8]W:MT~FJ@K&S0L==9(\=K')Y!&)DQFH^)FL^@+12'0m:DR')F
M$Am)VT(H,[0723;/0S]:6("?!1XK8*~!TN*[4&'!m7#]L$&5RDD04Sm#GC/7
M=09'L+#+GDDCR=UJK?IH1P%\6\?9=9.AK$(3Um?@S!]$S7L);8I;8S*F)9K1
MQW&LZ86#|O]Q7]I$\HSMQ9GZ@`H5J0PQB?Z:S;R!TB]/@AH`K6]+4[7G$O.Y
M:?"1)_F*DOST=~V,9GDMSTHAF%O#(7I56`?O^52U/D!@DTJ%MPM|3#[+N\3/
MB8._JI:7HC"mN9K+.I%8TK!J'CK?;Z_O$A(FPJC*[:D@,7Q"/H)"~F|N9BC\
M8)TGGAR\@|`XR$XT|^MV8^&B/`/H":A"&K[8SA06F*?3D^BmI^UR#^'=.72.
M@M~1]~~4I3:FK0\2GR\\(@?7~Y"FPA!S!:K%=!&HK.@3700S2X)S;!~!~%=m
M"1EHPEMBI:D53O_(%D_GAR/~*L*_SM/\4=[:ON|AHYJE3|XMUm#`X%N=9)_"
MJ4|BT(;MX^9~J!F%[*,&1B$P8'ZYUDWYPR~/_/")?+A,^?7CE||UJ[~A#^LR
M.AT9#)@2B1[\^/+mV]|O+M_]Y|U))UBK_!?R3%?JU$!@,6~G6GC~`][|&mC/
Mm2\Z:K%#^*C7K,TX)MI_#D%RHU@QO6G),/S8^=45:S8M@:%2UOW&%OA5/ZE4
M[SYN;&R;PHN*]WQSL[6M#^(;=F'V)\~M0_6C|F5(%^8500XU?SLTHP=~/_%&
MC3\;ZJ#Y.G5D48EEB1_Q4&HKX=$W~^[S&R)2N_IK:55#CC0+$)YFYG=EL]P_
MS6NF8OGK0"+?[BL~|/m:0O,/EM8_D9;|Y)SO/;FH?V8GP)3JMQ(~J+)GJ7/U
MQXWXONJVZVL~(^=|H#O@H~ULO&Y/TX\D%PU*m*24!*'TO5E5NZ(T~^)'Y4"7
MIC/)6|67IYJ*#3PO4U$Q098:m`9@OJFLLT&I3%*P!ZV'\||8@JTEKNOP\'D&
M.;DI*I|E3MCV3+&=]$,VP/'RETX%+[YW;.KEO1`~'I8X#CI7!I%OI7:;BB#T
M';X`O\IRR7(]QLD$|?"\Km[I_%POGOR+~O%DM1|K&Y@KZP\P;|]/WZ[=YmR_
M59'@G^CDFLJ6~LJ'`#K!3&"9EO|2V&:ZQ/Z:]91GLLD)QUG_PU;.~B3`=D&^
MR\:`1O5D#`~m8;"R&5IE(*BJX#1[V4T31[O$)3%SP^R3JSWDVB6VD^,|IA&X
MUI&D;E'?'=8m.8'06D?!.N8"==E0[^%U'@B:)CYP)D687O(\Z[m:B@3K+!V!
MI00'BFE1Z!|&G0O#7Q)HQ0H%\@FL'HUD;]C\Z!7'A9BHF!F;*QmC%[A1V!;^
M"Am)4Q/`/708S8S)`@"2(J?@m_;AC254E=U!@/ET:W1S7#68K|!@X7H)F:\]
M?:!#VOm@^507NK*Z2EM4I!&F1=Z|G_=&_!,KZ2"(@W49$Q|(C$]F#TU~;9X_
M;YD2Y6|A"GFJQT#]OY6G=/::B!?~"`DP~`G0$`~/"CY5)"&Ym#@,#,7I^SE|
M8))8K7FYU7`J]VMA?3SC?5!R9(,G+09@\N~\MA[%7|Q4/H[RJRI|A1~6G57%
MH#;1GVL2;DV6K4N@~%TT)UUV=T9LE?4I"R(.)%+]ET531,Y*K[SJ]7*/[`ND
M/X*C%;A1;(E\SHVQSV!EBABD$30FBZ;+#B[2TE)\'8.]2O+SW//@TPBH4:J+
M*@(P+5!@D;G**F9.HQGF$]Q2LU+R|K~T_)VL!_L]D"#$m,XX!~885,;9&91"
M36Rm'HB5?!U@|9)X)A#.O^T2[`3W,D'++!"S#UM=MOS?R:9?=%F|[\=='&F(
M7|TN)D1(Q6:)m)|N[2]ME&B*:7*Y5E\86!K:*E?|6;VM#(=D4Y5TN^*WMV6#
MB;E2)@HM.OL01I@S3S/:6?!|Q7NYP"I?,CU!13\*2N.3Q_1D*SR2:[8]N97(
M,FU=.;`5Z8A.m\2C'[@B":%Z`Zm.3Q`:NW,D%^6KQ#2&~mU"m*A=_NPLGM[M
M3(O5%X@BE3~;87H]R)Q"B$^`7B'?|(BRT0D(]E~~AX~=|,]^%S$\U_J"&[LT
MJKCH2LDNE)|WWHm(G@3=03R4;AT+O=C8O=ND6~LFPYO2MYL\PYOAD]G@6VF!
M|VN4*&H~mN&_[`V#/^I~8|&\]~KR#B"J~*|WQ.)N8W?!S4*~,$WM,M"#M&1Q
M)0'X:08Im$&!$\mLC'E#``U)2D!JHRN2.(P_:FU[0)O3VJ3FD6RU+NCSG?XM
M0UZL[^%"~N;m3~1/#KT9C4DX'Z],O+[?m+Y;[7EJ|,?8~5D"@8?H/`Q_\:Sm
M@Z&%#DMSLJZ%4A~ZPX2G|9C0OIO%J,NQ4~Y|A.%=%U&^NK_O[.FZ`IQJ|Z\[
MI*'3%E]Z7CIR:$WV|\P1S0NMEXZ;JWJQ7O|@@!~G?.65=CT3?NXF`QT0`;EF
M,L#N40AWHATWCGKQ^(Z=Q!;=ND1XM+N[7=[*9E+N%J7?[[I[B\VVL76+%LHP
MD*Q&9)LBW5+%[5CCDQF6VV.4#T1=Q;&W1HO%:".B:RmV$?=DSVF2I2XU,3#D
MH7^9.)XRMQ'0KG'G'ZZ0R\0AE*ZB"%Y)$TZ?H$*?RUm@=/.BY"Q*7)OR9@EK
MU0K#,I5CX*.0]81"U$~SZ';98,XKIK"`B(TC(A2H^='ZK=YO$GC@FGGL9;8D
MQE7O|+W'^]\V\[#*/RZ`I]0/FT@JU10S=D=BIIJGX:$7CF'E)0E!VZ(3HXS3
M)PGIX_G:\@J*:+755L)`N_)NMT'_+=IWK?_Z0T/_OVC3G1/JX%JTLJUJE2N8
M?%QZZO_J7|:?B~;P/@(L$Y^SUZLYLM=*?,)J~I)%[L!3`Z*|4!m[P`6V3,8~
MI|SYR7FQ(I$JO64O]~)"M:DF/P4S7P"!;2C$H9%H)&Q8Q1"'+A08="&'DEK.
M&&Z=9YT_E_AEBWZ$CY`:\SGVm|OE[H`:N[@U()0EN_O:F8)+6^!WU|R3C/_'
M=S^]#(_/SDP&:4W3H,Q.(NJAX"J^B8#3.C$DQRJ)9D[P\%3VI;,H59C/W[[X
M7CWAEJ!m2_mIT4RULRZIA!A6/!@G]A98,JHP*K&W_H*~$EB],ZWU8`:1GMT)
M7;m,&EAJANH+4]/CI"Y`_0F,Q&1@&V"MDOC:+'7P%MJXJJ;^5?RHZNNVT!*3
MV$KW:ESE'^^J$mP6%3JL1^$]+")|UU[H3EJ[2[Q)8/~UC5`_Q?;DWJ_07_`L
MP#J6*&;ULXG$BU3X8]OKm;PQL\|~~;),"HNA\JA*7YG'E~"K"OU?&&$WSm[(
M&V/M,?HH1VB;/'Wm?IXWL?D[0G9;]/O"DB|9ZEKLMI!(,QINTBBLXGG|C,=%
MWN*9.PS+3]=KMA#T.0&71L1W73/$,9CW"%T,N_2'?^I6N]W+;K4MJ/GKOJLA
M~K3~%6=T_+"@OZO@2.Pm|=~E?42,Q?GNQ5UW=V.W^V31GAXH\%O[_3EU[@+!
MW,N??,m?$#_91A0EM[\1#IF9'P[#[9"NC_73[\V9N\+XCK//_56];^H?MXIK
M;TF^^O+VQI#_T+\1_FLGm*7,3[@G&!~B.F'`%P@A)@FR)SA_GX]!Y*LN#|`I
M%M?;Y*LKCm6U&[[=MHBG&PZUR+Pm9Z,~&_U=?7AD/Z&JSNGW[D7[COY9M`^*
M!VL3m==2??S0J_&N?|~/%G~F:XNU/,'#'($)M7X\!8+)TUPGG/[(98I6.!^#
MFK:RP=B%6_PD)%!CH^0QA\CMV+[S@$WNVZF,F_|I[!/);PZZ=.B'3UQ.)@9"
M6:,9IX^!JR\UQ`)"G'~Jm\(5V,]G?C3^EEI+Y[WX9II[5*Y,16@\EBZS@O16
MU4`"3,TJ7m04Z#ZGT_Lm4K%\4R%V[G!]G?~UQ71,)0Z#?GZ="~]AKTX;~.9X
M_WP?F4TTYLUHN`m/L6IB#_Q'FJ!C2O=RTB\$^RS/1#3FRS:0+*)^||MGM`0N
M[C&GM!,X^.$U7R@C`+3Z&U7]FETI+/33~YIZX$mJLIU&'V_;K_`7$9H\&=/G
M[3/YAQZ01)IE:?LG^6|Y6T9_I;72F/21^#ZX,H%OM6!G20O*Y)@S9|N@~[T6
MEXF!Q/4Q'A)."SMNLG[GS~NSTS_#FU0QN^%7:ITE#m|$mP4IR.@;~DZ#I%Cm
M=J$=$?])QV!*S`AW7/+C*mBZ`.*%KO*&,H.BMJ=V42N7.3]OTB]Y|F,M309L
M'1'J:2,T&E8^K3A"8"*]S[F1EW^Y/'[]]NW)\3N@I3LE1+`F~OJ+mN!2[9U=
MGLKU^W&E`@M@1]^`D]Q:JY^@EXM']FBY0A!?%9&4U\?!SCUY01Z?/A=LLE%/
M'RA;3Y_G\#)^"QmJR3MH.~N+~/8H0E;HG)VB/)_C,/V^.4A&"~`/;W17|+KR
M\(D\;P7?G[PX?17~446[H''@C~PmU^W~;9SOm/\K:@Z?m7^XN/O]HMM5)PK\
MF|5[YA.C*%O_1;@(3$PE]AA?'!SU+S$@C)1:W0F__@?WHO*IPE7?Z2?X6)R#
M_8/L#IY.6F#3WL#_I?^DQF:B!O63I*=&./MH'&P1ITK=WKFI6+?8G4;X]NS=
ML[?OPF]#_6RO+CSA#*F::OBF'~[][G?ULm)0I]O'U$/_[BW517_],]5]]V!U
M^D*@(V8?`|F]$RYm*\LF#'O+5I^"L=[&(921AJKYMU(B08S6LYF_X+Y1K74S
MJ;3?HREGCm9D3=?.W`1_6J*:4)1=:V%.L&)RO%Q;%9~`/,F.97!?@;W!]07?
M].E4DDMH)9Y=TD3)U=)|U$)I+EO3[F4P=A=W%;,Y=O=HZA|Z]8ZY,\%VQFM.
M8A%8&S:+1W2&~K~2#0NENK1%%]K:+);VUBP~_?ORYm6+=S_JZHRH1*UR?K~X
MJ#3D]'Q#/Z"*NNF.J'|Y|:'Dm|$"97V)G~G'SOO4"(E:*RI!5=:?~W7)]NR2
MF2EBU2JO6K|L3F8WJO0&,^QmW2Y/G2]75+J~JMQ\9B=7]ECA4GL`m(GX$BB)
MN5V+:RG3S|`7=&&*ILSO.QJZ@S"&6;OXA+_/WT?mOS]K_F_]C7ZY^)8*$=FI
M;X/VZ)S2,~CX2[mKCU833NXT%SZBUIKSM_L'NX[XY`]U],4,0!)$K/O,7WKK
M&F]"EZ'^T%PPQO%T"7G!6/@m+J6YG`(OA!'NLB"A\)M8IQ);CO6#:&42GN1+
MZ7F?L9%6`4&OHOX'J,0,"K"8Y*TYG!G2C'D0.##`@AT9TT98L_EQ)6'LYm9@
MD/[X_`=)D.m\BZ%5^FLLB5~A.]m4*^)12QN@S@`HU([Z|!^[|8YBXN=]O+@(
M`+*~KXJ&99H|A:H;K)E@'M7FI\$ZB4J#S`RSA8G\_7=m~(;`QV(D\9F`T"AR
M6Vm@:EQV!F*W9I,:SF7!829|8DJ]3BL:[[J8_BU.ST/,5CR97OGQ79J6."96
MT3Y;2H2I:".Y4'DVLZ")#_$M\9Z~"YO@O`=&/V@M'48CZWI7"NT34!N77H~I
M%KL':[8E&;+IZ*T!T~4|Tm@Z/09)B*[4'~6^9#(/~*W~:SM8[WFUP7H&NYM8
M4M+ESLU~SK6D!|mV[DMHFO:SYPUH]K]|UUL;M3]^K9]UN[_4MRJ~G$@'3K5N
M?`.Y7HC0@2Q&[,,#WD?4|A%\P2HGKW^H^`J\OJLF#!U@=\O:U0U%,[DR.\%6
M]_#\V^;%'VNUG9OS\_T;OG'W+RZ^K7^JU~B!^7V[VZK_,?`~?%L[CT\N^%O_
M:?V/]?KY_.?Q2_J"N&F6HCL!==0%"\$3`/SY?[.Z]SDVPSML!I$)8RO"OZ=Z
M.|LCFJ]M?JK6MY:U?@STYA6#_BYOm]J?^m]m$M|A#[YO5_#/IRK^K7Z=MZM4
M9*NL#3LZ6C~+&^$IN\*#P1R7:8G9K"TN**D^M(H^Z,PE\~KX2OU#7)U+/HCJ
M"2FI0YI34P~*/X^'^;]E;VY5SUZ2O/333R~OWG68FZF][^;;m7^/_E*OUSV]
MB~G/;]BL5^/+#]~=RJ__PL5_Q!8(O2W0Q:)WH:SM=MM;O\I10+]ISLONY=S'
MIL(G~[AW+[W;M`T]T'Y(%4^WQ.$|Q0[#ZIU6N=]LS_m9.[]""):MW4[AHBT[
MC/NN`]HP|*6@F;@EX33FF7C#E8Om'`/JR_'K5^].7_W\[mWIZU=G?_GI^]|O
M,6I;\S"Y84^E6=;W$O/JZS8M+DGmIW\ZH6%MM,UFXmU0K[M*D$V0@2,^7+.@
M^N&ZI[0_&P]6T6;,K20'Q[3UW[]|OCP]~U~CC^OMJ+M5J=[QYEA4W#RP`42Q
MI=A~!/~'4@21[Y`NU9[\Y9?7;Y^?/5BO"N%*^$B|=MDIPI]?mL*7]/^?\5=|
M]%OZ537J5I^?OC@UAZ3VQ_V=FT\[?ZY[@NVWQ&T.ML];%W^D?[]%QE^0Q6ZW
M^~T%'M3_~#Y^.?_Y8KNN=:X[4_U[J|.3?\_EM/4\EH`_FMm.A~JN~`?KOX4'
MR#MW"^_IL;;2*:O=[[Z'FV^'H4$;X7,&KR"~O7mW?KZ.I%Q|+!90?B^V_IGK
MS]=QT$*C_"7(9\VR)S^^O'SY[m6+2ZJ_+NY]TRQQ|V1XZ62FQE('E\Z^1|AH
M'2.'2?U?32J$mQAD:*NV94G&0K;`5OV^^QPW_EmSY3\]NN_2;S;O.~Y^RAM#
M8SY/78BQ4OBB#%`B=PK!U3&+B\#UA6UZF4:|/N_L?3&1P%Ym&N%'K$("R3^O
MW?V/\P^51J7$052%@U!&HE*AAR7^X9[U6%ZT]6NVYL^B+J80^|mZU)8PZS5S
M.L_W+EHO.~?m1Tm:$$)M9JKLN6_/A8OE+4=3LGAA$|ALS(J`?00^V(?#YS~0
M(#9V,A'\#Y4!;(8`KCTPOWKNQ[[/N0(++@5O*)*0R2\E":|%.:%Y8M71^JWS
M=2FN,QL@JG**1OD9W(.UTG$RCOVLP18[m+?)LOPH3Z\2"W(2I;?7D~3[OM4$
M2DB=(%=/:8ZA2`JL|Q3/&R.,JH,UYE22=C*@LZ288E0RK2!W,|&!4K/S|W/"
M7&"#]4')9;995ZH8=.$X'D6N1C8IJ0LE8H\48R[)O|CmQ`M~mK@|)E*^%!SN
M%AE]B@|F8O:?\*;F3PWZX^~K,!&*7_B1NI*LV"`[9~\2YTHBH4Z[)KKM\/#=
M+$ISAD6R!$]5#2P,L1%VJ7+O/3N,|#P:20ZC3@4~;+NXG?DT&^/O/]M&)SCO
M'U_8mIP;@2%m%1`0VC!KBICKFHO`6NIUU83;\CONZ9?%*W6"9~^%DNLmW3&|
M_2T:QL#GF(U,&X^,'m/JEQP`A_`mI!5LGAA?EW]BX_BAG__*/~/7^]!V.?MM
MV^7~ZI=WBO`[ZAU2OLY6]\R:PJ7=LV;U'HBXNV_U[$ZP.C4/CL(WVPKJK6@W
M.4DQ,BFSFA6.OCmV'0\|,H1)AZV~KJS|I,]!YAGQ#H[0I:I,TFZ`+W!Z=X[#
MYGH\.LS|:'S#F)#L(\/,1ZFBF/V;N2MBT6I*O!L\Z_OQ*DFW0`'+V%AAE'N~
M=DK1]?XFIBL;+$T&7U=@X^:IO8J"433K\2UG\@:Q1LXFX5#O@S)@A&*B|(6!
MW#=\:7E6=HU&4M`6GH22|TE_#E5@;T;/|YmF"0A7;`)'_@X3/L8,._.=;#4P
M[A"|%U*RA/!E%m@@).F.7F$13G~?%74|D63R0ZU9HOL]UQ\73RD)|KARMS,8
M9XD8m^~Z5FT/J""NZ1O@$N@.~!_`"4W,6%'~3Y)^,NO/)W=P~=_M[K;?;VV]
M?]\~N2:\)0Q/7K^D'3X?#@mU~JNVVX%H!BX%,U(8/&8!M*&K,9M0MKOU2R1+
M0,W,X/m!@8;"'I)@#QQRM\NO[A9M+1F%FRBWEPZ:1=:TRQ'|'%3O\,%F^^#%
MXF#WZZD"$WXN?m=mGP1L[*G5N&:P)H:0:[[AK81?FQ:G2Y(@[3;V!FYZN#^,
MD2*5Z+%$+D"WY%3;C*,93/5MK;Q~6J]&%17G9?@9J9~SF@Y(EF2|$P&89H4P
M]C!#A]&FK`H&6CACK|9TRXB3T`\]~B~$C]D(0X3Q(8~`~O33|L!K[HI'V]V^
MZW918N&V"$PU=%R]R%#PX`B[X?GAF!H]3ARMTI\,S`;B[6/V4$A[B+;&0[MH
M=V47^4MU_)89SDC8;QH";RZWJZJRI1[82T]*~^D1&^Y1~%,^U\UP[&5/~:5R
M*UC.5@AF1RWQ)K*R0[!2JG^/S.3'2@.mS0;'2&:#`,^(NN@3WZE|LJG8N.'E
M!EW0;\[9|5,!12Z1;1\NEXU+,(|#+9U%_GXQ&S=?"%B00KLR0KQBUN)CA#J!
M["`I[/C6DSNU]CP~*#&7JKV:|(LA;AD9BCXR+3~.mX9&RR?XHO/^_8N%P]R=
M:N"~~!F);(9YTDEBIS.WIN)P]E["BK"MO4F^@Q[0BSJJ|MB1Q"E2+[2213?M
M1MTGW:Bm`"8m0@*@Y]=+]~I"~;5Q]*)?TV[W2?L!^):'T+7HVmE55L|[[]$C
M4;:4(O"R8WU'9F5JW8CXW2AmZ~\~|!`#IV#IOL=_[6[T#|V!TWILJ/U1(I~T
MHEQLD=,,C!9,S]I!W)'L]O.!V#$7~;,Z15#R1]UH^~FH](T?12;E_2?+975=
M;$GS^VB]MYC&BIKXT/"9EVQ!F=K2[MH,?Z8I??]"()G|1N?@28OQG*0NVKI+
MS!YZ\&N7=G9G]TEPSYZW\6T/A\J4?`W&63007&6/V0mm\I*UZ/DQ82.:)=A:
M_$M"DHPXYS!^4"3Q.S5&8[]GQK.!0_I4RV'B/AX[DV=@|FS,]S)50Z`LIX_$
MSJ!Q.F6*@)|Jm(!A)XW1(=CL+G]P=]S(KQKGHW1^`9FW||Z3|X&E#S|;|*O8
M#'_*%'F!X:\1*\41?*R1=1"Q*Y2W*2E_1O$mL6)H6#QQ3mmW8#GOH#K5Z~Z|
M#R^Z&XMU18N;8G&WL+M#)WA`QXJ6H.mZO_S"#2;8Q/Z!SF|,NLP.BW"6!Bm.
MW=0OV(QON##Q1D*@%A]FWF227%WF|5U/Z"*X0mV+M8FYK8?,/1E,ECUE9/D!
M)~GV$2?M\3'L1%&MRE3!_DXX`Y%Z~N"US8E2=M((M"2+3GFFJ+:NB`VO4@T9
MW]GCA$098$OX8'*~05DO.EMm:82|K5K7@"m'S67GL2Z!(JCX_,=Z]Q!m62Q.
MS"0G?^DADUT@0'EA#ZI]$C89HV5U#_+2WO':GNN_O'D_6".3?MN8TK%/^HV;
MR7B!2'C1[KM9M3O#C*ASM\X$$"P6|K~MOD+7CP,^69=%@_YEQ2;]B$S=C8_1
M):~0GV;C\7#0F$(@C@;T=C,P/T_F!7]J?H|;$OTZ3_#WB/^&)S5*\"]P6J%_
M\JS_@1@IK@H_TRZ~729IP_S|R(9#5$/%~_,A%;)0EC;8CB\"36?/0'_J1&QA
MH(VVMU@"Z50Y?"LWGZA_W1(;*6'!MQK7%^~T^*K$OB\.|85XV\W%U1G?)Z82
M:SKDMm|m$[KLE#V(|Z'][*MNA)Z44()LIAP!?'&:+8Z|4$8U8$`$SP^CI&*(
M3#'CA^2'7'Om~^'0I@._)9KYLT!B;!P\6HWVN4_M8)E77]]@P\Q+]@!^*KQL
M]WRW~\%FK8W=mC$[')IV=[&M(?35]C|B?1D_3@/*688M)8[=9"."|,MBI/7\
ME)I,MD6H#P(3Gm6MB1.NANN[,EUB;O~D7&_H/~XmB4DDNNE7\F"!I/!~)D5^
M12R1__%][S|DOZ=@+SPX9/:I%DR:*,V;:'[(U=L*O!;RX3":D'CC=Z'PNU`4
MKL"_@I\T%;@@4Y[Q3K||&TIW+7`KKD"RN~,@VP,&E_"JR),^;YV.%C38P\!_
M:!@B;@I\N(X:(,W~@UYCTW+3QE'!O*7?&QJ?XIJ8m1PI,4]A(`^Z=!:TQRG.
M_?AQG=:R#_=;?O~Z6AH%7T]K.H_?UPP`/,0FTE0N#T.M\C(47U_mS(9HC\~~
M|GF%!=`,;.^|_[2N/,@|0VH;I1*CECGP/]:,C:m;3A"5|X)"QNPEWFPRG\"W
M?@1(^"]C!,Q\TW::3]*\|SZ^&"8W=%88K^,&P#R"#=+9;?TNGNACUG&9Y_%D
ML:QD~~9XOm~BPO?ZL0B"5T!RL:`397PN/ZT|SJR$E7,XTAI^,7`Y[7[&N|W[
MV4SRT[IL4=`NPK,/9/\J3CWG5G9W%;@=(@ML/*W[MZ4J0\QRT9Y$I*3X\!=6
M:Z/N)C`8CmD0[_3|Y::P:&QLTC1?JMI4T_|DNL%"!LmQ?*/(SDNF|_&S1A8U
M|?Q9=X&9_&^/R\MB$U9!(=!&$!A^07Z44%.5Y.U+(F^7[1$15CC3A'3U=,_;
M!WZ.)AF;`%]KO(6N*0#Q^*J61(G.HFRL';B,`ZR.3H++/.39_7'F)%G~\MJ9
MW&"!#Q(A0m~T2V#UmY8$[XF$;6;LBH1#(4Q:($EBJm#LUC!'138UGA#L0JU5
MR=8L`5,(V%m`'S0YO10_+$%'J`N\D]@/W.PP(1.0\,`Y,/%G8M](N5R#8UF7
MTQT1BVS%E$"_FK6(3_X~RI#F@%V(:+V'S4&2EW#JZ/~(|S&!,@#Q67'&C8Y"
MF"VT/Q@XK,,)T\Q]VGNB)/O;G$@RT4,B6;U/FYL0SYO48)m:_"3075IB,SQ)
M!\O]~4P~I,W^E22=2"5/AHR[RKD?+SDFE$LmX[]]/.",$U0Qm:'?#mQ4\B[D
M&&~4BL(:9Z.0C8Y4$K5G#7K,T1V:#.+9D4WX(Y4B0_S[\BBK;9~Y!VMHF\=#
M26%m)/`.O$(KO:X3|Q8R@J8I4D7'[ZJ["QB;(Y/"1XY;32N37G`6BMLAE9O2
MSI14&HC(N7643`%\D$1(DL)QX`V|[:XE2HRO%L4V41R]\OPP^H^$69C=%(A+
MU^JD29~&MNmFWG1(PP423LA[\^3`!%EA,I$N8XAT3AB6QO8L+|2:I=!D4D\/
M#VE.ZT]IEU3;[AUR,UV9Z1P:LJ7/##*$]&$1V'1)7T0QOS:;`7|S]:0F!+2.
M[B@5K2D9E6~248;[L+?0](=(Y%&I[M;LT^J~IM~P\~4|K,|03.SYR$HM=5~`
M|IXH`+3#R|=R*A^UQHK#9|"&,+'T6`EIQ2R*$RY$1,;LBVUBP!D\8#E]&P_F
M?44J%~+L:K:07ZIP!8:7ZFF)$N0,`/'JX!7]3:6D_K:Q++XZ6,AS_EJ*~YI?
M/&AMXV^:DF[*B|mROS0CA+AT6)J(9T4'NN1?(/;T$YJBJ4.~5mC_P)!&D|7|
M506B/[Y5D$I!?V%7+U/~XH%m8I(VF/E9\E)HE,`X3?ULZ&|P,P|5JAFP/1O(
MVQ*~0_;!Z&R9QW(*,VW'A80992_Gm))PO56Z+K^!NM.V(UXO!/43QPW3`R'S
MKHA/]0,1\L?C[)JCU|2NP:'O"@^,7$L2X"X11J*7Z,%J6&2CFm&m2M'_DW@V
M,D`7N|$7,CXCDE@W3ONW^D&m3JZR=7E@8O^m]E95`08+E2DU]TA=3T2+`/Y&
M$_\Z9RR&57$![V,)HQ.EGE5*B#\NCNP$+GNMX$Q4YX`VO"?)*S36\WQ]_AK.
M3Q9X?!$QZX8M6NZ98Y"$Z=]GRmXOR[+PXU*=V%1OGO_09NVA29QI.2%V~mD(
MOV~_"([Z,^8`SX4m^_I`NQY~MWG\^P91;T79_^/+RW|_GOQTLB\9#[QNSN9J
M$]MLT5;|#S?I;@W3ZSW9F=4:Xm!#+'T#;^K!5ZVV~WL85I\2\?4*50_KR&Q|
M,PV:WZR.IUZ1#CR|GED;Zm[765mBW^#!A'Y*9\^6]X"!Tm3Q6',?\TF="GS*
M:%|/Z:~]2N`Q3_3@227@!:8?OZL$:Q(#5*J_JP0|]L_K)KN!mU~%%[`B3E:,
M:^!,=IRXFWY%S@;^9'mS'WD;6(G&'U;X$I12OA;m]$8^V^`VZ$/m3*"U0K.&
M/AEY+"^B?"G[AT+MD=P6%+mH&E:`M#|;ANUB,FT;)=UVJUJMA#MNW,]/WW9*
M)~A_U6JP%m^U#&~F48L/Z0\#('*mT\ZOXN"~AEOO5ZGI%LT(+T_%PNSLA\TA
M4F5P*"5]MHM`!/m+=9S:+X)27"%UQ5X2O&'4M;R(DC&^_+9:JXW3;Q'W;RL0
M?"|:0=.DC]~;QPPOY*3K|&MN:JKV"HZ6V\62\,UGSTO1Y32|~!S=ADT1N)K2
M'MV?MD&9#HD;=ZVZ/PZNYF'.8PNE*M4IU8VJ*^%1I8H34'D|m#)K~|W6;$:8
ML'NUOAARIV7V"R+#M='.UF|Q4;?,MM9*?"I0KN@1C@X(EO+@?+Y8N6Q#(@Y]
MQ*K?"G'U;BV_A4CP*(%G(''5$7I%2W`=S0;6#1&Z+KK"+RX:P?DY7\KRF[X"
M_R*F:`#2`SK6~|NK84S|?";S_E6@?O_BG|,^[m*,7/;LIZFIXU@9,!"?))J7
M73R@#DP'0QX:\&(E(H$HA5SWS&&=G]_$6L#:9;"I?DX326&J&0OX1'@)"Q!K
MT~m$9)JQ.1Y8AE.HN,5\!~MQ?C[KY^7/K~0&ZBL../!_F('H|7`5#*AIA!7L
M5INT]S[~!F^/S]K'?SIKG_WIE;6=VHE/AC18.[7)\":68?F3&WA=m:'CB~|6
MJMP`WPX,?O3\!YM8CD$&TJ;.C"R!mFXmM2C/RL[2BAH_V1D?~6:~41"Z8.[M
M%|Fm$G#)\FL^R42W@K"I|,2FIYF)'"2Q"(&_(D9)%BLW!2.Z)ZZ2_DUYI@M/
M`7CmZ+E&UQ)*NKF|:4'H#5:M=:KT8FPVXC|$LHF'.#.9Z@PK6V/=D|:_L!G:
M8FB6S'9)7K=[PAUAG`[%V6KH`EK|+3~5J4DJ:PG~"D_+3*^D;]63PSE[!?I(
M`"Y\]Q#;%="V|NA*.&)3m6MODU081HBK0@6Em]#JX^?~;:#LHOm&ICD@YGZX
M4B&_(m;Z@\5:XQD%JQ6\Y,=&U1ZR]$_B.F,F8+U[!H?%,,XS4||RIPY3&6|K
MIIWX(~RmYW&3QXV9UXP^@_#GMR_#L6W%OC~R'VT/.R7L25ID?6\$ZEF0:\"~
M:mXE/DPQY$#["@,]&V1L11AQ!N/|G0#!:S#[6:':[TW|J/:G,C=0PKP_?[=[
M|:=T=U$"PU|J(+8F_*3~3B]Q?L*?Z!S/TH/0^02M'.2\#(I&G_N?6B\$/K=,
M4/FXFA0G82TIMG*85%B%.Y8$N%%*U|0W0!D:S)%8`_2.YH&88mP6,ZV\+K%0
M7`,=7];LBN6$[3%@,:B~PB|_3JPN9030:P=JS*Z1TOMC$B3/B^L,B"Fm&`:8
M_.KBKM5:V$'!*4FAQ#^(;[#LK\V0IQ)V"R:ATVQ\.QH#TSA21R;54#~L/L~&
M]HF3#E4A+m+:WEMOWYJ0:"0LT.mE*JJ7!NAU``(\&^.\W2$7XL6=N8S+6X3O
M8#7O~8_IOEK~2G2]\$:B?W4;V:[+FJB(J42T]#5RDB3QK%3E.6AJ/+BXH[GZ
M&!?EYHC:7$V+R|UJS_@J+A|V='^I~_03*#SHDQ5G:\#2H~F#?!|58\;&EJP+
M+Y+T*2?Y8:~SNY8,5\HQ7;|F4.\@_5N:\$9FKHC%TFS"@ER:2_I1`@@''YmI
M+C_F'T?RP\WNKOS`I.KB[F:U@CN]4^B0!%VF2(S';.X%3HX!D"1VCmG;V?FO
M?2)FLWD*PBTI*FO(=XA+HF\#^X&2K_=`:|~~1_.;B[OR]VAX,_S1W`YT[K\.
M2BA8(.N@ZHJ"M=.@_UI/RK/`)9F^=XK9/&[@1[&^FZ\;\]FX_(3VG_81@WP&
MY[m8O"^)_(_Cm@WK*ILY=)R:9m%Am;/Y$N"+="]@05|6WD|;SF:CIWC+m2_N
M%ILFNHGQP|6:+GE"2B6[]B?91_;7NR[W@!./WE'C_+!SUWTJ#32P/Z7_~"@_
M(3'$4D=XZG]:N=/\*XT**(!4;SYJ^mG/Z8ID9H=)NPET]DU4m7@R;7%2T8!3
M;DSAL0*|H7%,]\*@3D]96:I?L"Z1M@[/PU,.UZ`VND_mA6P?E9:~?F^,LR']
MO[BX,T59?[RICEP|"\*V_B3/Y[BQO20E!^IP`EMU*AB:^P')]\#YK7Q/Q%B4
M[4,:83:K[=0KG$535,BX++B%&H=U@%])0:,WRSMADP83?|R'G5W[1@Z]:KBY
M:Y]SK&3A@JX~_I|1J+J\^B)4!GQ;KU3D`V2J&P)?UC8HW,01!#YSJ#:'2#/]
MRFJ:IA$mP]";=m7A!@`F21Q/?6M&D#&:O.8"@P//|K\LI\~L,00~JV[m?9`N
MF$~E58`CY"["SFD=HYD+,m2D|89?YBZQL*$)DPmm/%5R(/WUUQ11.~84;FV9
M#&%&"K"`^W!(T_`m1DN8:$!V?COI96m5BQ./A+W"~WFYA(F(ZW'=U\0|#N!/
M`HWFK~05mGF8&680?)mmF~`"Y#`I]W?:'3,OR[6+.J$O:Z9;=?J,:DFQHQ/;
MMGG+3BG+S.~FY&!2m;**X$:W[4'N6'6B8)WRU2TDS&[:N^X[NOJI1HmQ9FmU
MN'3XP[/_"V091HB2J0S|H$TQ*'4Z2Q6L&+1!/S+@M04')#KWJ')A]Rm=2]TI
MW:CCXG9WAW]mXY'02~D*C%0FB2+QL(5FX/!VO\T)Q$:N3I|W':=)@RmV^1W]
MQ77#@2$RAD.|*[&:+)^LT#M9=,&P1DE[V]G=V=GANGB%5`B]FNL1YmQRU%N3
M~JW&/_09@%CL.S@H\KOOLX4GHmm()623PD$'2!281/~P!G1EZ1R*O94M~D,'
Mm?=RD[`L/LG![I'$G&:\[V^$.^#5UN#CN^6F&Z[ZAO|9[QN%=ZB43@(KM2MF
M#U?6,6m/TVM&?XFGZ|?!G2FZQ(\]E4R)*M|S5NXIC=F`\*ET/8A5OHMX;X@X
MBI4V|LK|.3C=|YXD[YY8L$4VN%1&8#QP7W|OI~^7=TO/B3SW9S$[;LUN[Q;X
M;[$2D[VL`("CVOW7S=J./MH_C894@KLTG/E]2=S*S/6#I98]UHHB$A3C'^`#
ML6"X|1.J8'VEESKKO/QT:IQ#D$R$FALCKES"M/E'=W$Y2)2R;?K\/(T^)B/:
M03.ZD)4]L7J1F*3^`9KQU`JL'Q.C(*L42W!;X#&"'ENN\EOD;%^!'O=TFmH,
M8@),3#%]31LCPJ$P8OD!LS@RUF1UKDISH~'J@9D(;\3$~OBCL0T:|R_F60X.
MNLF1/&HXm|/A'/0(mTM(?B"Z*V;UL|1P*+S?.M6';"5?~K$=690W4DEPm,NR
MD$mDO]G8O9m?!O([|H%P?CF[W~[Um;_'TM():C1AE^EUUJG\RF[EODUE!4FO
M9!J!'T3MO'DI:+H[S?]J76QWN_5PF_'S\,=V_*[;W5ULXE':'C&PGJODO8F$
Mm!J/17NK4M5~?=.NU$T"`/\LD4@["Y_[/F0+(8!$9,=(FJBZX3%`QJ"VT7B"
MB;(`6$O1D5E_2|\[+2A[IS%KB:NmOIO1&AFSNF~27C;RDXR5Cm)R/19^2!(6
MP^64/YW%FL,53|UHASEE="M0G%YXT\RFA|=TE+NHUZ~I2@+S$%%+O&H:C+.^
MZ|$[ABFRU7'.5F+~X/VM\;0AKX;$VZ8#ZXQM5(4&%L+DTD5AAFZUO@9IO.S@
M|6=]UX.N[S/8A?OT'5^73|C]BVYWF_;P("MR_LEY\ZV4#!8K#B"~SZ9RP@K%
MH9D~AW3K3~D.mDDR3(PPGm22E*@9EBQO!)QJS+L'$1)FUJ~$,.5YN8B=1RG+
M`\/WT_ORm]V[E:&!~G0787|3_V&=5\;JNZZZX\QZ416$1`CQV%[CCLG`6ZG9
MA'F@43*G7B9K9!MA[Q7Q|8Y,'*\P1NP..N=@&J$1D"Q2#Z**Z:()O&'7(\Z~
MJ8C"GK]R[OS.|X9JYH*!~@GE3/M)A%!DX'E*?|N((1N(*18^*P[`9"7OEZ5O
M,:#N7~JG[I:0'/&7U*AJS/B"?8YHMA&|W9YN=;?6D4+m(4._L||@8JUHFQT8
M%+92!ML*VC$M5~_ZM+M+#76K|#5K;|,m+~K28G|%7='O|66K_=X_,55\U|`S
M|S+XR;HD5FL^_/INY|NO*UMK,V!Q2+,`H8X.!'"A?3`]6."_m7/#~6^Jm)IJ
MN[WEX4=RFBK~=$=E?PCJ`$R\,HN20M&;+;BQEJ:J6]U:]WUX9)mmF:1`!@_#
M#.*]K`+|]F3.N3K&K3C(W]/|T_^YP/N#*QTH_2*?[T?A#;O[(?O7Z*#=Y3F\
ML?.1'O06!S?TS]7!NNGJ15LK]^?A/|m8~K@G]F\~S7#E$[Q]7#U/K!U]W9NU
M2X+5LLX+][(m]_0,E~IU[2=NYWO%O^=,HG;.R:ILJC&Q@(?]!?LB&"M5XWM%
M2H+TV!0/C(9B$/SZDK:&53=$2R:1&'&()320=$!HC@V"8'P30?'08/E4K*TJ
M(&LH[JQ\Q0;L3A$Y=L'ZY&=V9*'@O&=PK&.&\CK!93N9%NKTZL|0`#D02"W3
MAT;H7#F](L%UPDK*T`8V&0OED&CDE~TW9(%0LVIBAm)91@N$~!M8/3@W)8XV
MmM)W9?GD?6)RHFN($#*JL&N#!")D`H4E9~$*AKME$(MHUZ,Y|5D^/L13+_+(
MXUQX0;24I`ZB:4_CZP:mm_G;7+P.Y4LHK3P4JR+S=I6"@P1~S0PD8CLPGPY6
M8D45O3XLHOR#R%_A|(XD)0%$GIPS?HILPFP!J\X:HI2R,V%7"U~7M"D.%RM=
M|;$J4XELP4J*KE+48C|2LTJ#S@W|(;SJA"615"B~AR^/6F1RF1A[WHP5651M
M$+7|[+m#+#9KKO9X||66S`ZI'TLOD1O9,,B+^93&BN`A:=3"O9A3QQHO41*P
MXH$!_DM07|@5$m_R!PRXQ5IY%G;m$`S@5I,!MQRD2Y9:.W@@WL9&*2B^R#Y,
M%_QH%&T&JVEDW];GR)NFAE+UD+/^ZAEE+GS)&|4XDmDD1#9SV7UYHKZL]D[0
MKKW_Q,DAZ]VN)+mN2_P4HA!V$%_"^5DJ03F+2ZXY8_B3;E~";CG1B0EHX.^R
MW*0CR9~3G4CHB4N'DJ\FJA%\\S5%O(PF@895@%T.1UF1%`:1%AN$6/#XHm2=
M,?_&!|_'%_1Lm_!2HM30852`*`_mCY*J&*]T*W&D4R(=)N+~'J4^U9~8|;9^
MTP21R.7?#LJ=X@1(/(2WT5G@,A085m^GIT&YVK`7Y18HU]3(E,S0'~N6+S5"
M=|)1:Z+mRS|#&YMZ]TRM5](]:]OSH_M5`A`G:HT9A&~46B|\%2W#m6E?K6%4
M=J(XmA0F[X89@L2/&:&R%"G/UDB.6O$N+%O4I?'`#1:((A2^X+3_B]9B,U!4
MV1Q*?4G@"/H,m_V&AF|B7YZG+Y:8DB(+SL^_]#RQJ[K3F9H]0P+=?)Q$K,Y6
M`Q)'$~E66D5.Y+O!^:ES`"7OK"M.S2M)U:S0$YKX/'=I,R'S[NQ?$$!J?N=m
MYT5`.KUT0^*G"G_OL%Em(T:82~B/YWS]J\Y*+D#|YHI;[K$0W$K@6:QX\CB/
MC@%L\3D.5Y`KA7,@\SGP)\D#8QLPKC$A6#EQ'F+/?3%2$F]R':]&RRI/8/`@
MQ:,*BI~X\."6S54]I*T+:RC=E.+^2`W!.XT:932=0/$P~G&)Q;'A,T9~Y41&
M'\;S`4X0,)8S3^0mO#6+W%&mV&[64`[&3,@DFGTPUVF9JWJ5B6K~2.\,N(\C
M*IXH#I*%(;(YFU|^1Z[0)%5O,([J&~&ZO%:HY/MT?I_Q=NX$m1JD2EY/#P];
MVQSDYCF&^[(57)#A]7T0PFL'4HUF.OW''8*ABD@BV^\6@M~P('%IZX`&;Y5W
M)AD3R?:&*2K'9mN,0PT_?8H0+8]O~E#QLLS*(3Q:=#\DTAB^H/:15IMA3.L|
M8"VV@'E"C+.QCK%^S83E"_WY+3H=5Om:;8[JL,PR+6NP_/@JZYW@D&)+C!@J
M;GC!1*ZOB=6?J#+O6I*K@\UDQK]GSYOZ2XC~+BJ,3,(3QW"L;"/*K:X;D\63
M:;DY4X/PZ)Y&E)|BA:^EQDDEH$HE1!6P?.)]HV&&4A5/OW%5%9&"_9`&@=]G
MCU7G8^0VMG@#6%PC0[ImR"IK@\~m0'+)*\Y"S"!m(?'34XE24X=4FSM3K@%F
M;))B+OST8&Y$H8`/E'$PAO%|XG:*S"U?47ZE3BA&'\~!_=A#!|P++A=#PR9|
M9LN0`8]G&S#X#WA%#,|L#KR0EDR77!|B];3%?(M39[[DU6DWKT76,Sm`Q.6T
M4$]!#@[E&Z.4$,([SAKOJ_0~_:/I$F|::,mG)A_IB/|I:Z?5J]4!D*AL#ITC
M`RG,+*'GO'%P@7!'WSHK&J@4&QQ80B]BW&,6E@*5TJVO1|06+/XFY',X\`;T
M61F!*:#3)3J=57C^/KS89NT~`QD\_8:50H~'\M/"2VG,O"80DCT2YY@SJVA)
MG:UDG~(R1+KY\$*P(/="UE^N:.BLYK+K(IY%?]F|27;KH=5CAG2KYOU.M~82
M:52JPXI1].7M|Z2N:6W_\7WUHMWMTJBVZJL!+W:F/C].!`S![=TN1P=PW=2G
M3Y^L|!`\K%]%CYV*53Y?KV)E!2OMIX@!:K~:;S&VI0G;|[|?C;KFJ31+UT`)
M+V8YC'7+)GVB&7N*Y|=?V`ITU=(O]!=^~?^4?@9(Im=&*=;5NR~D4mTMQ(K6
M|6NmmM;J8M=I8M$,]'Z?BU?Z)Q;QFV_^3UC$KLJ?RV%7+L(*?VR`E=F`H0VN
M,B\T]L*D`%'!7P.L5LP`6ZM`KUNV+1]LM~KE~EFJ80FE5+X?)O_*;3"|%/XN
M^"+%KVXA1]8^mV%*/#WC+\~I#8A]W+R`_;ATQKK89`H%M#,MOC&O::'Q9J'8
M&"%7AZG2RA3TU13[INL=I/:6#O6S;/*Z`|MDF?$~A\_~G"X99*TUS==ZJXG4
MIIVF=HN,4:,")T#2I70|2DQ7~(JDH0I(I_IGQ!^M:|^%$06]^#8S=K5^mG7)
MmL5)STDOm~O'892;8)GYRV0&S)?`BN&1Z3]=K&L:%^.Z41~`XXS$?~79(*HC
ML%Z5E|P_%HQOHRm?M@I8)#4!K=8;.PK|5'F"%G$12_(`]mAV)M5T_;`U6EEU
M79*%Z]F#5E=FS~'OJ&*+D8_=N)B3/3_O\Y,6|#6EJV+5%S]M*6H8W4%)"|KI
M8mW7#2|DLZ[C.'QCOX|NPRBDB'N,V)1O43Y[|V,`%ZNMC2$2mCLPM@C+m!][
MC#&#?W'4%E*#8&KM[K6D`0H=VG2,(.$&U5#7F_77QK$KR;V7@=DQ@.mGmR#3
MJJ"85B||mYAK(.,*SQT8XTQNN64.~&#Q4m0*!H1~GH_5E5=@F^CLU#3WA3.[
M0)G'+++m[81.#^*AB8^S;G5N~`&+7CQFR[5SC*`U'BE*!C'1#EA)U?CFBT:0
MM&AA7/Pm@m+\SBY+03Q0CN$SNQ%L;."!~G@?*RSAE+mF")*Mm49EPZ&3GCBO
M%&.@&4PJR0G`1OTY7~ICIUYm5;W!/647&_KB`5"7'P27,WKHV`A(!'|.VR$9
MRR&:))`~4DE(_P%#@YXK)=D/)&L6UD2YB&3/S.0.X+Z?MP_:;4`VJ;Y3AF\.
M!N,T8,CSJ|LXP%/FYY)G^LN]"V#U/7]?N]`|HL22TT\'+PZ\E`HKm4W'1&[E
ML6)FV[?B3QZ@SO`"]6X35U]O7&R?TU_(#7A@)P(KM)|.OO7|T,mOU.[@94I@
MXW6m:FG4J1;ZJUNG/I)X|#`]N$%MCm8DBYAFHF'mHX_&/&56,mB/@O;[D"2:
M'G|AXLS1:SKB]XmGIUNCS]8VSW,$U_QR7;O^5,B^9$3HT8&9EO*$]**#M1:6
M%|01BXZ1#m/X;V&M6CL&G.]9O5'W`#/,M@L`!3=\P*/NLS3M00NYA[U0%N\@
MR;4@V;FJU!U%^%=/:#/"V@1@&P9NX$1N(XUYU|mU_+GC];B~6EZ;6&W_]JFL
M8;.!#]&TLVFS+5;.WU^~[T?C=#[9O[@@:M[MUBH^Y(1S./3FY;%T8NLWBC"E
M=5LCGVP"XLL6@33BI)#?mN6_01@Y_A\41([_!X60!Z20,HO3678!/=78O~=6
M^?G&*O,6GDmY1+=Y|94m_$2^T$#.~@FMW,S`D1EW#@/*;CR4B7,*U%`HB"3,
M1LA)8/.|^`%;A"CULBBIFJRFm;#*5`!(,J:,|F2F9U:5:UFR\_.NOB3~AS7:
M[/"/|.`P'@YC^m35DD*`)6##0+"%N.G7E~/F*FBG(+?)$HLm9:%XVR~L#+/9
M5|0IQ#m[6&@L48H:LYUBP4FGO(9*0m^OB*!C+:`8A/\HF(HKF|Q;#[C+A;]#
MB6EQL~2;6%RVC;*OE5Z+&5_/A(6I|,N9~Y;\!TH9`"LJ:|G(?2;[QU?3":R8
M!WKm~7R'8G`7XSRQ)AQ_|1@.C1T~4(4[X3\\0$~QU6.L/OP@G8):I;5]5VF$
ME4K]0'Y?Z&]&@||S!\|`\X1JYU"8VE`|:"KPK?ZZ$^Y`/ZmO].D1/?71#H|`
M)~K0G~,RGJ#)\_?MB^TJM]O@,G57P+3/G_(O95S$T)L6!L4UKYDI+SU;K)`T
M`V#Y_|F+TU?AG:NJTJ3~+WZC*_QG]I(1]S?U]`NDG[H4P"4(=YZ)3?$A4IC5
M1@A5L'D8KNN!5'@4(L"&2CS4B_`HV&1"J%20K8||?++L#?_..@$XN%~1JS1V
MYGJ6$,_,:4Q|[K^(7;X])!`T$*A'3CIHT_WI3!]*$74TK3)]%M|#7'Y4]7=7
MA3KH*RVUIA$N9GVR%*mmOO!='KKSV?CNJBBF^^WV]?5UJY_'K~PJR9HY#3AN
MQ8mY^Q^C.6"XVO)Q&^'#mDB1:9Y:`ZB[#&ZAMZ|0O622C,7H?RUP.PZ0)]`/
M|F~/8|6#GZ80+@M%KL#PMY*':"1)#U\3$0\$6R.B.8|8,3.&H!I@EJB1O:MB
M0CQ*G84HD6T?8&K/Q,JVNNH26(2M7*V10,06*P:M:VRVT$*C6GOU^I~3[R]?
MG;XZ?EFOK\~0`QFF"13|.WP&X#L!O/OA],79Y|F;LWKHNBVH=^:W?P+W[IGF
M5Y^;W+ZZ;14*2%$UC'+`Y/\4/SP_8TO!J"A=`TMC;,.]^(I=$#+B="36%%Q`
M`?BVP@3|L@|A9$.^J1AOD_.0X0;%O6/J=!DQ3M3TJ|"?SI2E6#86H^,JNZ;;
M?P8ZH8&N6Q8,"B%5"A8CR=m,I#.P/\#$6J[+)D=R+AG2CO$E8=RM_"IF5XG7
M$C;M2H)E2#\FLRS5\#"J:Y!)X,`DMCC:|.*|IP;A4\Z3CQ`NFBZ;'~T^))C)
M+79$JS]DI,~NB8Z[N^&]2`TT\|mWC7Z~mY.T467W6P$E5:",OmEX`0?V9/(M
M,`]TM3!C\Q%GI60H*]ZN,@]!]\=G.3S_W'*E|5YT=M8%5B*!2?%40!OH0NF2
M:#B?E#\\VNF.?GPV^(@`O/(;+%ISM_LC3N'=(?(]ID|+A&%11:J,%/@+X"CC
MKBK#9QSK5C|8&7S7KFOK%1K:Y;?:%OM6)Hm.Q9;Q2E~.^'KUZC^+"_J0V]B\
MKQ$SH%TI|9SG=VBEN[&N"~GQ?E=K76!PF\R~Z:H$RP%=@=;9|ALYO*O6G/`D
MM]C9F82IJIX:KDXQ'1)WIHZ.ZI:_\/^(;:`)M=m^N+LS+0[,(T;#T6|(DSM)
M!V8;/L`D?'&W.@&'R2Q!]W':9I|Q^7SOR87TW]G/FV=A/U0$ROUOD|2;?UR$
MS=/P|m5X59*+VW0$6U=C,8[=,3#QHL5:D94)@B;&]5?@IO8WNO4A_VEW=X|1
M_EO_Z0:)|ALDU*U[!SR=)FR?U+#]~=]$;1^T5[^9'JCD~'#`\33E/+AUSPB:
M9K2!|.!Q#WL5559&4J6"FJ[D(%S3C4KP58@mNA4~A9/;WLCD"1?[['(&="^'
MN5N!Y7SCKI)U(9+XXU:UR32M"3(G*:[Y!;$P^~+^129Y~D.79Tm7)Z$59NQ)
M~O)[_m=.O*G|KLN\K4Z/?K]^:O`Q)P%_(*7,?7&M@N!D0UCYU\WP!RO/);E/
MH%F47@EH73#PC'|K&~O=G:%W@^2CW(2=BJ,?1.=|B385.4(V,"+I2Y5Y"HO?
M4&$YV)]^%+|9~!FEF9"8(AIQ=/]/R)$"[`Z3)(6U^CSR_944*))_@P%M1'VM
MFNBEG"(L.*2]?&HC[!Fm8I(m\+[K_^*!5~B3NY7RmAMDVmE]HO''#Dm365+.
M=0O~#8S'56$P)X$,!Q4&|JVQ9)\1UUSS^&'#T+/O9U:Vm$7S&Y61H[S$6M|;
MC*V3YL9!E2FN2TH3%&QY4:]I]|,2[E~R46N2Q$8XGTLR=%'""=\O[F?\~10@
M5@BKHMQ,B=7TLJ[/@2!(S$_$P#\*N3Y/S57&")^#0'$P)0\Dm69N6Z^!!m+=
M.D.LYZY[O_?FPPC0EME6_MT]~2Q~,Y47M&;X=`,#~9=9_$7%(CGC!4D.C\)S
MOOMN8YNAD^\#=09*+*"W/$0']`*`9)U?]4H3;X"N4789#K"%9m/P=NK6%UUH
M%7=;\31G!R?J\*\826+KL%Y2UD]*/F4G3*H@W`QA@1"m~@455'X%O//)3|(6
M.F*7B8~$Fm&,\?RY,KS~UG|:L+R@_9=(DFD`:KEM'E`Y`7=F!KA:#102NDHO
MRB#1~`)|:(?[C"*@FC=H6m3O/%1@'Lm+!`,.MP&`"PM`.*91PSNKH._:U9L*
M5W#`K'J`9YW*K]/KP:^5H#^0N@5X^)9!L7'|+L_~O#Q]YVN~'1_~85J|mYX8
M^&#_54I,.S!X!0SZY/4/?+L:EG^)_V=4:!A]YJGQLWAR`UO^*)HmX%|8**T)
MJ[M:2WCTS5X03#[28*|TRS+$)6O#IW#?3=8V2ZMJ%U&&[$;9,&(;!)|9,O8E
M[^E;N3?YYC3/4GG&%V(H~9#$!%'R$]$CK@H$L~NC+*"mY~30,FB5X2%WXLBM
MD$18,DPW]%$)^Y%[D!VY4$'U7J"IJX=']O,2MO1G/X7I5.!`PHQ8X|0X#Z.D
M%I)$ZWGX^^^PLP^/FFZ#^W49Y]!`~(S#KYOm2A`5M+M6CYZ]WG%V:Z+"K"\V
MMXTI2S~U]4FDS|FU"O#`[[_[CG@G+K+9VEZTBFC6&OU=XKCI9[H@AV&S[.=5
MI1WX*1S]/9DJ$V5N`UHm5Um%JZ(R%IQ\#[_,:(&/FEOAUJ=_3+9T@,WF4|7|
MC#(/N*?FTQ4$`"]7%K3M%D?57(W0/[mY/1X$DA0J"W.`[W#\`0=&,$*!M00@
M]#!_*.W6([=B)V`X8"!*%`=+.9#TJZE74\846?/@G+U[?OI*|^&L;Q"J:V|M
M.S`);C[?!F=;LH~C$U:1Z~=\]P(9~BJWE8,U;EFE)CDYSA_?'S*%^*mT40S?
MO"DYO8U]HF[1mFZ`]\*WPI41Z]NRG'O%G0_D~#!^[`9+1I@m$_)!3(4V`X6]
M#L6HR[5E+6!_mR*E!m_0_2;05=F,8TW,`P!V?("BD99N?[D*^@E;M;N%?=K]
M%3_P;SBS_,LG5T\SXT?F%J==CU^7:Z1mKH]$Q5X~`O9CmM5\77P&:GD|:[``
M5%M`ZQDS~W6%9'N9|8:JMT*O9I,;!Q%AM+4;FCOmJNO$7F9XN27G=`6$9I1K
MF*MX)UB%K,0%^X4DmSJK=+'[30Vm)=PX&W8EGT:Y1`.(,QQ]*,YGDH4B45|F
MORL|VF,C5EC+S:8]UA5P|`9[C,!|!Q~@F01?`TU(G/+I*/0Y'2[;HDV&.7'=
M"&0@/O_,38NU+FU(SA\3X[84963#5Z@G8D!;4~@[3Rm%;S(:/2PQ6]2.L^FM
M.708$:~]&m`FEPM%m/CPNTEO5V?%R`&#?|VAPZ'F2+B%NAJ50]F3)/S2]C#T
MAMXHM~&L6]`].=53K3OXME[KPL%^46][2|%J55%~98U0?B(1J$XDI5;=I2=[
M=:J?!7%;T[GY`,&DU5F6R~,[^_4"'(4II)_CC*^MH6m+.E/9^DH[7IVJ!3%6
M+$T0MG+\Sm$)Q$~m)NC@RR@L9MF2UYT+&@P]?6H'PDGLmFUOO[#R?)J"?[2J
MR*[313Z&@L/HA8V/JFYJ;53'B]P~F820~$2LDOSKS?[m106:*)mN2S*\^7UD
M73~"]Q_`,1=1E,.9.m0O,*"5:SSJH%84`!H]598*28"ER|]ILT0*_K:H##SG
M2R(]Q/J&Q74")#~m;&+K??(1DB;SQ2Y&m;D)D!4\]R/]A72Q?&X/F?7]$%T!
M^NAGE1)37|!D2)!R]4N`03WFGCV|$)%G;02M,~`2_!O7NV@/m~''[336S="F
M$]ZMT"W@W|H/DA976;OmU\=A6_*%Z,~2Sm"NO"`##61%BZLU~*U)"MW3m:,;
MZMQXL9:?'?Z&T5N)*X=~m@*9*&9;WL/BN8KDAP+^KO9m8%XH%COG&\TS"8%%
MKL3/G@_;M(A;"J0P20;m(AH=Tm#_FL&::)A'OB=P$A&&J22U+6~S:E.L|NJZ
M@',"MCJA|GB6;WNXmS\Q(?=S`:)ROOGY?N))N6[K9|5&*]Z..$,HJ7W*mVO2
M*U6^G;^O7&Q7CNHD(AQ~;m?5Bm+=W42&[TWJ^.(1M&3#8'AZH6C|NR#?++46
M]V~3YLY_[~Q4CLHm4G.;HT~U=*HX'48OY$~_:4X5XB^QV/O.!W0,+#\D[PCR
M]C|;mS]\O[m[T!XF["4EO^_1[V.0m?Om%|G!K/?C(CL[SW8.VMUO\.2@5&ZN
M.4[825T:^,/~[G\~M,'M:0OTX/|'[5_;CQNBP~RUGK903%+%\/YL'RS[8#D;
M__GY~._JXF+A0!@|X@PX,0,#;9T:]`mE70SE=0)48",HV#1IT6|\71WCF6B*
MWSCE/`Z"`@W3JHNLM$[7OM'=6=PUAP%1D225G.ZIHK~H41PD.##1MXU26A)F
M,"6,F7V4C&L!YD5,S*)H5PX,W%;@~H$N7!FS/\/]Z2RP;P'3|HBWm#H.^30Q
MX@(Q&)3~@99:2`0%EYX(C6)m)=(mV92KA8|"&EAJ^)LTD48m*4,Q^DCY[;&Z
M2m;4^):SM88Sm0H=9FmSH+'S*T=;UH!Q~/A|_4J2/F3@IJC22^LUG6ENTRRE
MIC_;\MZ*O8XM03+S39[YYA!&O.INV#S1G&V~(|=F?"UGQ_*NH:,CT3BYmI\\
MJLTJR4ZCW]32~I,;M(.2|0Z_.~(5J2^Y8&KA$|R.X7RJY98QQP7"E2F_'*:A
MX$+|8VH;ANP,`mO8RI!*BB78H(X.B^*(?RIO@?;!S4$UWZQN'J)O1YL'NU]/
MMV1/?mG~:F?CHRUK#7O,E)I`MLWWA^UQ|D1=H+_YQTU$_(Z3\_='%]M';7Z,
MSK4/Z%KB]])9^7F]S^&*$_O':,;GCMUPWKQZL=_Q_7P:X284I0WUTZG7USKW
M$m7UCNX^S84|73^[GDDQY_G_Im?&_8?:A?N/Y_OSSSK^$&F`|DWE8^NY"0WY
MT&_5L'Y+3E361A19mR[m@&~\N4#P]*;30"'/I|NJS1SJ@[_&@BOB;P!SU4.|
M96N0IKA~2F3`=CUGTU)H*\.S?8Q&|_#]GN,9B/J;YS_|3XIUIO^?R,D)Q;Q1
M%R@NA"15U62=S3`9I9R!:RCA0,XV5)2R:_X?F$LSJ%&G^mZUT*mT2(B%D%UD
MmmX\]1!F@K5:Q8.'m8BXM$7[O*)+#'Z#;C!09:!H`D/1`2XK`%~UZ%L!259!
M~(B1'04EX4X%PVS6K1B/=7IJTW#R$3?).&EZ&B6J2H(~Q+O[A$"\8X/!;_22
M6~L@`\^992\9[\K02V3#+*ID[0Q[(YEF5A%*[:.9BFP~$HSHT1`^9SQ='N=`
M,_*:Y=N2E80DM!,CPG7VQEG_@^C+M*AUXW&^U~91V,):MKT7SH.CM7WPL,?m
MU/ZT(;1(`(0|&Y@B6F7LCQ(M2)/?A!'\B|3%`4VMUKNP0P4!$*F/W1;,NmYW
M6_!m~B]5AIPXG49%3UL,);NE+(3H2O:%7]A@P$#$!]1$7F;02#HS)AVT0'.R
M,VCL~0M5I)%Q$M[1.M**W^[+7!\L*EZI]G88)RR~2/)O;M.E*M$NX.QY?AG|
MK.D==L]^NmU~JE6:ORMYHNW%DX.%+?H`\W5XB.P]N#;/SY=+L`|K=*P\MQKB
M4^;65MBJQ[D~m1D%V+!@][DQ~=Y0IIUQ,QX7~8N=GP[#\M/U_)NW%?\EQ_&~
M`QENKSF2R2CXZI[2W;JX4W5WmTJ%#WO9X%8.::|B4"O$9~H2A]W==9Y4X:(]
M#;XJH@.@!H/'$]W"YNC@G;3?VC[JUF$./1*@%JFNU=WC*NES;IDU%MHR,(=I
MH&!P$6$ZM|Y~S*&Z@].S0mR//C=VWTH=$?%X).&:FB+CP4P=Q/9=WN52;)^1
M"6G]Q\D`L&XX:UQ\(]0C*#4(#FO)L|E&2VG54JU,*L:^K\0)AW~ImD71HPMT
MD(B33B_FE#NV~JT3m)1V;6H/)|U(D4WVPQVIE:VC'%W$K]EZSD)QX!.4N\?Y
MEIIG139%`^$4^H)T1&^Gm]Q:_K=Y'/\]5E5~D8UB]@,NTZX&1)N[I:K6]W[B
M\MMP[AH6]L?QB',O|?I1(FB"FS[@1'5QJ:THO,mQ:H);$'$84Y[&JmR;OF'Z
MB)*LKC6_&*4MDGS[J;!?|6A74HBBVP/J|]:O]1HA93GX,\E1@[(~TV@S+2/+
MC^5B;mHOI~/4BN1~81`m3B$FL\?(6#D;,%~R*O0DS%W`!T`MH[2/%'N[.R8M
MmG+\()V)P$m8X'J4RJF8R9/3TSQ8WA;V?5\@8RA(=6"QWPJ;1CJQ('E,)GLP
M!N06U0HI~9_~2`9;YF$9OS|P_@DZ?Q+!0Z/@~3+9~QG6#Z,8)#?R.80WWZS`
MU011:D(#!$D40A/6S29H\Z~'*A*J`LW9D&.S$!|.]&T@"7#T\NI|"]BR/S^%
M`0JU055L^R`)+JmG\VE@4+*IG?!Y9Im$Q^/$8#Q8S`P/m,3T&PD]~&RR;%~2
M8|^`CIDmI?Jm4=8(X|_A\OE:]$L`Y3&ZG!/Q4").!\M69mK~&LHX8?PSES.A
MB$:m0/2:?4%1U70~"N5G8BZ@NK7'`]F#8($EGKK!KP+/!J9&$:;^'J@=|"XM
MH(0%@J$"UJ+4X/mEG"Q]C2P+VH)A&S$TM.\?U`K*`FJm,;/&:~=7COR&?]][
M@/F+CY=Q*m[R`\S[M"CmP3YQ)+M^3/BO$`_TE^HXM5\$$F9^~%@Y~?U#Q?=2
M9A5'L,GS[:/VB:"F^MK#MO?;_:5E%VAA_N5HQ2&:?=M8!3~?\3%!55.7"RIT
M_D;56FV|?KM;K[MAU#FR^_ZX1)B^UDIA%~A~Gm*FU59mCN\:5?%EME`.?XG3
M,Z^W3,()J_7"&6'R9D!(CXXJ6[:\O&F6,P0M&1=$\~&C*;FBM'2/]&%3]S=[
MD]P+)G)OMSM!^_W35"2LJP.@6="4@AO7QS\~]**%_BXSQ)YH*I'M][37Z8&5
M;+08G7%`8LC3'O_$]=R0~`,K]4&PID:M3VM;5Q=JHF_!1'K;;O/0_\5[K5M8
MWYO?N&U|"^VOIT9Q9NW++H.SA$9:K&6^C%WHM@%1V&,$(B%00,,U28%LW@$`
M`YG([*Z|)0%6LG4M]$$!EVED?\8O%J5GL~!D!~+mP_%ZNm8D:6QQ4S"~+QL5
M16_GX(T"XV|G86P&"ULm\OTYG'3%0F?M24#_5J[7@~VP(F_EL5B2O1QF$JQG
M.)52C#LF^.WQ&=TKM]=T]@('%:X9DRS@1&\9mFKB_'9*;IHm31QP*QD?$&(U
M1WY%AD.RGTB2,DO,Q?L)W@._+4G[G2XNUNB&C77ZX&X678/$(&B!)6)H@01K
Mm2ELH*mD3D*^;|PR9E*37IJUWmC=VmmTP+10YQN[%W|;~PNU0Y=I./(m:@RC
M[D7~XENLH./|D~\8&WU]^_3:1`]A\]PUPF|=Z@YMK`[UC'\ZUI_:@FG3Z40|
M/m@(O^VP9m@(:YU6JZZWPR0BUB,TXPCWPL,HO*(Q="H;&QO5W|K1QMYA.SHJ
ME9[/QN&N5Y"+57~]|J4[!S#NV^&S.WT7IQ]%803D8DF^(3_I~U6ZEI(JAG=W
M=^77I;R;8:?\$E!6KD'SL+3PX=);**K+#S*Z4)]UEHK)UEO^&!$W630P&S)?
M\UY`)RR\Z_G=^?*(O'3;J\,UF=5+CTPN=.]A[Pm[MP\C"5LJO~F3`%P@,W?Y
M16.IG"1)75U&$)P~\8*?[GL9Y?TD*~C|QN$_'BS33V9TKL/WZPKER~3^KQVL
M;W==D=77,B;:|:$")I;VL0!m[[(~5W_9@m&S~;2T|XSOmRT;O~F"(@H.L,`E
M(/0_$^\09Z0A85CAQQ2;W615+m=m=94?:$`34X(U],=FL&|9*YE@,TEZ~:&K
MQ#V~BE@R)3E`:B9B("=N*0PE/$PFHXU\UN]40EC9*D~'O5G[*#SGQIUCR*W+
M1DNR`TFM'Q0^+"FB,:WFW^/!|DOF@_`0"I`m:)4Z~U3]T?EANW=T&$^.B/^D
MO^G)!3]AO~\1m^Qm!@#]^\53~VSN'H*O6LNH/A8)RJ;KPN(B,Y?)AG;ZPUG'
M00IK(,881J#QQG:WRII8^76S6]WF7T5KX.\TJA0%mO~W%^%.R)_"|,1!$W[I
MTG;^:]9CO!'?W=]P/~+L:F&]E8%ET286[B|QG(]~[/NA]9m30&TF^E"@0Q!=
M3CF_ZDJVROEVV$6B@,)U=^_)=P9+1m0BHM$8#&BKJ&~mXQI|/AZ,Q3EDKR:^
MI[]8Y\$I=30=I:O`R*6L\F+NP"2#Y(SD(L)BJ):1H,D=VV0,882T+ISMR+*!
MDGX[+?F3V'X%IE\mU;@_;I;*N%]&UA#Q1PVRFDR,1A5QQ,U]67;*|L&#E3B(
M05"?B"~.93#9.TJI:CPC]:!]~+5[U&Y4P|UON,_,;|FG&ED^H(=0?@]D\RC\
M)CS$/Q+.*!"K`M0'Q;C):,%!,;2N\S2/ABZ!!N|Z4]NSG_$#(@37KED`6;HA
M\4*EBTm^TQ.9H\?OC``2B`W'&X%S#7?[[mWK8Q+SS/[@+?&MW0S2.B]YmC0+
M?B0=B;J'5WM'[\PV/=:WAVUZ&JC=*"UK@J1^[F,_G!ZD!T`=A.M$^^M~7[[)
M/R0~IJ(HR[B/mm,3_G(0EKX;R'|~1J5ST2Q@Z^=SD2C"/?0_3!E5F0Z($#=6
MJD~"!T!N,\Y[WK1@'6#ZP\HS+5WQ_m0D'$&64T=AN&94mTL^`LZ~K5!,Q/SC
M)O[[5]m(,E]!@S@?ZYBX7C[F)B6#8.]21SBRI6TZT^99X,Q)UH%6|_7P@MJK
MV2H?EW+)YDZ95%ZK1^8?N?~D?^:88U/^*TYZJ1X|=MIZL"N1m'7%*M1^mF74
MGEUWVB/=[L$NZPW8B1;GGA\~L:4W;Q^J_5S=?&`EA5P~'6UN\H]:~O.;;DJ7
M.)O=NRF;EXXV`[&EWLB2G''BPONSG$N0C#6`2"|M!JS+U3%1M%8LGNR~$4OR
M_,IXF[BLXL8SVM)OSSOZ"^;S!3L%B_D?"$NQKT10|Q(;8X@SFRG&&Ym'+DN?
M[`HA;!\.AJD0$/7Y*OE[T|L*NU!97Z]`"mX&5`?45S\AN;.'2I:HRM4XK)CQ
MENW5~5L;H"+F1U[AC?!G8R;2#$0Z2F,L"FN')#%~'8773R9MMK"W3T^(,A22
MN:(~B/D=LR^9P32?!BT7_/E8D|_J"Q+ALOF,=O,`YI6F_PD3Z?9A|O3mN#C`
MO]UOmF[VGNS]UP$;"#~_&14'A^WD:%.?/Y/?1OH=9E2^Q$\H\V1GYP\';?,I
M3).';7Y7W]37_W7092P8Dm+#+D\UT=*(]_1[G?ImV;@6:%'H(F~4QEZ~T(B(
MmD5IC*`JWQO_2S|7\=$TL71[6AXZK!A@0K19`5Y`'M98([()~=;;?#`KS(N,
M`9N#?+m;.^3[F3VFV2#[7m*M8~R[S(&'S('O,N?=W:mIW%!*#7IO+@[`2,|&
MPE?L.S`N3WE!V~2D4`;(@P5|J($TWBZUOBF,O3#T|$,O^1T^:F[LY3U((H"P
M:PX=5A,BMM~FBDM|ZDM."|8.6#[+4^9`U:\YP'K338KL)M2"V6H@|?NM;=H#
MO[W#V_DJ)P0$/=:V0?\MKGN19O`98YKG!?2~):+;W49GJM05&.YG]'N5_VU_
M|=?^P@13+%UT)H?SL0@9:N]:.~!)$=#Y:C:;[6\F`Q*EZ3A^|9LL@|V+G).&
MF9PW5ZS!%(:DR#Q8?|'8#C6C61KC|HUFMYB3WE'WO+O=90D17@~|~X9^;__&
M3D&~5IS.=#`V(08VXUFNUKC94LX]S,BOO[:[)NX`'=GJ|CA"UP0GC`(N\ZM[
MV~9P!9,UF&U7B'HKA?!(+,'$6%*=F&TBGW0;F?T;%6S)$KNYL8=Y:?8,NBHQ
M#V+ZQ&`%F=N$83|,G"|,L^R@_]O9'|4A_0G]mVO@4NJR.$)%'N)R%(+TLS5P
MQ(XG`_(Z\;RY.=m!RN08&$V^JSCVX(|S+YS7*2C4`X~D_(I'*5E7T3*ZBD]&
M5]'R=!4|P+4!Z#U,]"[|&FVXK:T=KB\I!S2D?"E3Z|Z.?#A,3=2N+|T:NG@6
M`&G4%;/1O3;7K~3?%71W.W[^JNA4*@B`VD!W7@&]8A=HP;8%8.URNC01%.)!
M8$|`UHJ9EF3H?R%14=)_J1#QI/A&YC;JT^Z;LT(:=WQI7F4;CU.QFE8DO%P&
ME@QK5$|]'!:=H0LMEYBJ)#RDOEL`V6^_%1,2L%ZY?4"[AIOA'L)5N1+C9CA,
M35EN$(;5PWP^/3*JZFYE@Y@MS'RE6SF2'T!H#]LH5;$PLZ9/AU~SmGA;ZU#J
M?4V[P53`^R(Z"BL'(=~P|mWU~TEU=O!7m=&,@V,$Gm)?]$!%&?KF:TPMS;#,
M=5WC!\~I3AH]UCIWZKP*'9J0)GZ291_,)]/ROO",]P$C\:+'8m8K)CB91G&$
MZDS|(T9]~/7DZ`=3!7'Y3S!:'!0!PD=34IQm,Y(BP2?G;@=AUQQV9mEX|/0O
M((&_]GK";O#'*J^H]L7+F"A"@M$~~~GQ?)\;]JN!!`1[/R+FQP+B)`P"2QZS
MZ%KH6,Y92"45Z&MI3J[(*[;2F61/`;?K,EJ31)6(YX)GSN;XK4B`G)$ZF_/`
MC:$QO,5Q"YB1~IP#O$'8]H?N(O*%~6D+&L_C,U=)RJ~.RV"UmG/5%A#1N^E6
MNm7VU.%;E2JR5U6V&"L5~AY^N|5U;M'OSL,WY^]:VWC8/F`0MR]/9^7L_9JG
M2@SQ@K?^M4%@]WJ]H"XKZOHZS/6U,^H!V=\WC_?`Y]M)JL@D^1CZ#TW&/X6J
M;^?D^('Y~!0"/6LGDOL2/ZD[`F@Z%:+3].+5SZ$D1Q[??F%""AN)8Ym/0!M@
ML_&X[#:YX,@D'/28%+|2F2*6:'@mN521?&X+22?4BP.VAI#L8B(F8?&`YQ!\
M!AM2^%TRN+T/;KF@=RUQ"**E&,6Mm"X6BT!C%EDOP~$["N'V0$#A%ZMIT+3J
M+QB:BR4&.K$I&#V.=H:V97M9`?D;Q))2$NO9K7H*HCB4B\3X@V3m3,Y+Q/#[
M["\K5^@F"=IJYBVR?ML$~FT^8(CQ*!J/M?FWL(GPIG"'=U^4BV]V|V*WWmX1
MK\|X&W&T+D?`Sm/X9LHLBDY3,!2OJ^3CL!F:\@:D:PD^B^1T]A@[_/KYZV.$
M9!P%7GW,S94?B/5)?m/$P]2U/G'5X997TG\8'050|m`~7/J`[~!C#N"JY/,)
M"4&W%;@#S1*2~6+S)AH7_Em!40QW_T"7N|8[[:,m=;P,*Z]^":CLAmTD)/H0
M'EI~I)F),[I=CC:S|TN%7UBH!)NXC1%U|P]8,#B%5?&G:)3T/SP$5\[&QPD7
M:]$9HN/#_/H+$G,*C:U5#Q/1\S%~BU'GA6]~O5`JJ$`V@C~OX4=~)8'UV_12
M_L)RX#QF'@(67R5.'%&(^+]XF@=?F7XU!["K$@7:_~Z[&_I_V#2VCZTMQ`$V
M.6^79)M21__JT^78\9\D*\|9FRT%LOYG'WRQ07R(A&J8C&YBM.NQV,`ZZD+=
M?R6TCX$W8P9BUZAF09(,:Q8BV^$.U36/QP=Q+.%D4=#`S^&U:H+5X67BS(5_
MF]/J&~]7SA1"'4"8P'R:,"PD;6P+*]E3+*)"'%00|!m(X+3~:|HN:L9;QHBP
M5F0!=(@%;)*E!KH,F=Y3CUJEH$YI4&C8&TG#9T+NT;QGQC2!`)H|3ST\V7Z^
M@1SO+!,J4BM;A@m&!SQ^_~I/^QW\NBZ|5'!")*&2+5YO4/'Z/:&G@B2XYAMI
M~\UG!HY~OJS6F,2%/^LM8&OP8NPUX\L!3P.4&1:$MJZ9G5Q^)[,=?\XY*7~P
M&7X/5SV.C6'/JN8|;VASYO!B7H;P)#9V/m;|C!:/XSJ#:T(\RF"/W8?9!IJ=
MC&X~X+!D@:8?,W5HICFYO14GBA;HmB|R)~SR|@U2)%"/+9m`$!IE36TVL#&M
M2_49@X'1D@A$;V"|^m2Q."]F|[5#FVC7L9Q`;L."."@PJTEAmHHEM;9*`~Q:
MW_.*)^*Q;.?.ZZ/T;CE58]`%)_ZU@GG*|L`?0=+#;L+KH_]U4,K3^!H6\?DL
MmT[|2T/QVL9R0EOM)_R6J6+DV5B158@K^VO|+\I?\RR#'W$9Y\6OFE\8KP&S
MD1OA;39G'@UK;/PDF~J6&F4AQ&0U5*8M@']:K)Z(YE/:|XNPQ@JM~!CmQT6]
M8=_UDG31",QOF`"4=N]I#mYOTm)[OS(GYWV.("Q]YLI`\^+_#FA7[W|,HLF]
MX(GT'R_69FM8JBF4$?m\7|7C*1U6U@=+.D9BT$:BP(H,#6mW(PD48.4HW'ZQ
MUZ[C9&8YHL$\%A0,P!N+"S@GM\PYG:,?G=3RW4:&\;4&|4"'Y"=4X?4P5C/m
MU\I'BV5O0PP"D]B)QXG=_*EK=A$;FCZ54CZ=RK#YY/A?RGF70[*5~_Z[&AC`
M(750(8N[@1R;57_[KUNA:@Y$mXJCEMIP`9^L27CV3!TE5"\@.~LC6#/"9!!'
M]QQ7(J&\H_E3%F#WO^YVM^U;+Y5|\0|9&D*FCRSD2KDTGGI/RMmW3L06J;`:
M,5"W\ZN+.]Y;XWCA?^*\6\\E`|0TFM)m/M.DPKNMWR5IHV=^2]*+NU&|T24R
MN_6K63.?7AMPAJI^+;^|#JKWO7JKJ7:U@"NTE#mA^34;DN^^[HX'69%W%]Z;
M:$Z7W6SM*R!VW9D6V1G/_+)2/V:9VUBBI\^9UXW3/ER+P`J;0"!V|#/:'H3W
M,U,QB|6$49OG|S521'R!!$4VK3|\~OD.X3UL+92$8[)SK6~Y8;GA6~[mO_7B
M_IJ)1E+|X|PNT#,YII)+=9+'8W'+?@WTm3EBP|`?BV=?E]XW!`~2$WP"OD)(
M2L^#mm2$:7X*,N=DR,RI.I`K5Q??1m!"m[QYH0m+=\',W"Jm`#=#*|A).BE7
MJ\2_Q?~=,W\^^!@MK=VQT#DOB5OD^8ES(AU#"[TRCBVA/J@3BYD[S.AJK;(G
MW'|:K3;/=5)UQ8GR(RJ540#R4GR7$!:6T@|N.m2UY5S.3/J?P"Q.0IR|0$#9
M0$+K0^_?#\+]2_I;J^@mA,:9!mGV#CC0N1?mD]%T`'!.L)1,:'\\HV8"9MK9
M&&~m1]FT7*G$~+#^)C."'~U4[2":;`4_$J7\&.N5*+~/VUP\7!;GTBS\]5=K
M/~'J2~J"9;(1^%H,mA^J'L,+Z3*KM*4KF&BDWL^Y`'@&~O?|/ZLV+Y\Q3.(|
MBW\8D~3$.*#`$9=WB(~J*.=`;(@T@*CPDA]#W2=\L/DPL%%VPOV,HUX\]KO$
M+E?)1`,S_,';.H0AY?YC[=3URZIML+HRU&RF%D;YT*T=BQUR~!E|UBY)+6Zm
M6L+3:G+@Y*8NV:GG)`"/\:m!E@QJ/9*V/X0:Y"C"LLG9)`MCI/%Z*U!^%^KL
M~m@D'JS$\`;!+Q)1[1LTB|9@\U"KMH.E|^A("!SEDK^#B."G\*7Q%W:[(=\7
MCE\S]~CmN96;JV)9?6!),9XLIm#B:\?7A)ZJD"UG5]#L:+,|]TE"`6L&_C9G
MYMIJYDU|C7*Y=HY0XS$T&3R$'\NNL_N255)Um52]?V7YSJN(,!_?!KYX4@Z+
M3"7E;)]S3,A5I%.:TW[A+YH~9%P@W*'_O9BE84OAK^G)DI\O4HA!H;[D?)$0
MP^K[CPKGR'Z~GT"634("@~92SU[G6B5K`m_/KZ&D6E=:XU/U8"ZE!N35BG)m
MS9FOWC]6?T$[R7)J2VmH.CY/+QD^;\(TP%7?9;HWJ|5%;5mB_Y3HLO2E'BZm
M\GV@)A\Q*[FE)#X'OJ&|#N3K%3[+Q#*YmSJ[7DE|I:OE2!H=|LP(/PJ$ZR(1
M0$|_@:|F_#GmBVXW,!\.D\=T1m;MH7Z4;GG?B3O/;/Y:+)^QTK`VJAQN+2O"
M?AS8N4,_9P]8BH_1F,KN/RB.LYY$AEV6R+]X8I3~I8m[J_m'7%+1~)T(_G5;
M,/@7;;Q@:94#WF1!:4D#LZ&HT9mTL&Y8;KQNCB1_SW+UJ[6[2KUO+:F2H!GK
M]RO~6|PCL8]6$^9mZ9UX!&'^B&Y\+U&76HWm_1/V9W3Am5UT?)(*#\4..~KM
M7~*(+*(#(PVZR'_O=PYH4!91KTXm$TJ41Z9;O16|#EG+`HAZI'S.H;43H*m?
M?Q5736LKP)4B5X#P\C88ZF[AAX@Sm#K4R$PWS;;=VO)='~,$,!ZI[YOKG*2L
MZBSW+S7J;EX~B+W)SB05LV~!;;`\|NN;MEU#^R7$!+V;8)D1%2!m#[,HD2B[
MML+1'$FC#:^R6C7SI]R%Hm2%WJUm=Z&I#|mUF9[WR\?Y:XGQY;XU64J3UWJX
M0WUO[O2%7D~!XQL,CV]Q$)17]#)J\^^H7"69)|DKT.).*?\Q(B+4,VCU]MSR
M@O(@']9!+BG~S5A81U$6OC[_@7B[:9X"$3ABA@I6,N/$:ZPD~_O[D`W09B6B
MI`Q(LF\?_^FL35R4T8&?/H~%U+@^~:*0~HA*&R6&AS9FP"",RW3_74DWA/WK
M$,AM'+*[0Z2Q7%(5,+:)"1RW~'@&KmP(%6P%FF5ITF?"N:IHWZ?KHK02D@77
ML,9A|5.L+,#Z(U5R:M@W.E[U*V`MWW%H|W|OGRE6$:RXV\CY6SXC~L;W+2^C
M.]Y4[A\*UX6OY2I".[/8V6L,?+!N~=?C|AJ*DD^$%X,"'VAU)R~6UUL]Lm]C
M.$SPUH`~FYAGmS_&M.`K`/4P,A$,E"$V6"SJ:^^04L[/#P^/89K2"H^.X*Z`
M^3K@ACW_$KN3E.QS)CKBD1G\~(@SS:9mBRV+J:#16^KYUBQ2B=4!D;00T'Q?
Mm?E6D&A#$CN3,4R9/,Z`A42^Z/SPPI(D)?(C6EIBJ9;);2#DMBP@PO%TWK]:
MRXTQ1?+9?J=/M??_*E'U&'YWU:\6"Y3O+^E\(YY(7QEGW7K`$K%6&|5H2V2P
M0O*=G@U+!S&\L_+??:1~^;AP;1|"[H(]KG!OB?7~=6[\^X)D%)N%L'3;~FH)
M4m&Z"PC?F?ZDUXNO;|R,97K,4BMBD.J+`AF_KU80D`DLIP2~&14]|]$(O1(?
Mm[4M2QY(Y#[AO~?T6F:PY~3='@J*$6&=Q.KN@B42"LA8,!H^9*U!`C|E_=mH
M`[3I&#K)GJYS_X4S2:BL894&'*=D59EE#83|M8,RA^=U?,!YS=^ZI`B|/`3N
MA|,$)G8NKSZ1%F^C]1G94]Z9;;!P!EU.CWZ*.DT~3XUH((X8GP/&;*5YE8#8
M,\QF;P@~Q|5O=C\R6N3=+EK|[%[!~KWT]!'L.GWA|%YT]KW1W6_JMm~S\?T4
M@9Z596IXPL?6P/"I(5X)V&G6CN5GIORB62]5_7"OC6=;F01:;VMF0&0S\=:6
M+6U#%"$$P$P8#SCQ7T:M#*&CH%/](W$3?T|DYm@]%KA=CS5'~(47Q]mG0/V`
ME9@#\9A37::Y(^G,`(.$S0+=JUX&H#05+W)#.95+T!,NC*J]O,W9\SPNZ+L_
MQ3.)!Wm=U3!+,6#BH@~J^AC18AY&GF3'=8?7'';CI(YKP^_QQW*/13^DWY3Z
M*TC.##'B*=T#$^|MN4X][9'|'S#Z:^P!9`)&Q"@1D#!\!9Z68Y!XK\6#I+"*
M|L=3@M578P;]RTO,E)1!45?KI25C*$L%G%9+D@)m:%B,C%55L*SW!|8EO!Y;
MQL/Rm+R~P3W)YJP]YA"`^mHR||B?I_LF^A@E8^O9|PRXm58+*!:;9H@P0SMN
MJF&K[VPL|.3L8;H!6=E`;@IM16m.2T!L:UDYC?25@"@!P*:3X)BH!K!;XJFX
M*WALG/&RID_8~Y0S!EF=1;`43LH!5WP*;"'C1&[QQH]IT/Q.6#JJQ+)[IL"/
M7"M~RQ2)&WmAN2Z|+LP_RPR@`_W`\,8Y"_BT(/Pm%D4*^"[`B0!8E9E9N"|'
MQS;+I34V&CVG#D~(NQF4/\]S@0O!U6H4]|;@UV[_0WK1O~0/%N(^,Q=SG3!3
MG#2JR./Q$)GN+*A?;L*]E7F.%(4OLK@!W$OP$)'$4IH9\191CVVIBHC9]~0C
M.Q1%1|3PV[35^F/m|\$\?1Z@"?HmW\')OKR[K(8~,_CLS~D2;7:N@V=J9("N
M#+:O)7%Z$@O((ZO(8W8DHPT7I;K+/m,$HV~NI#:XN+C73G%^?GSYYO79NS=O
M7Q^?G)U)GXG^)m/8@#@3CZW'',&")8''"4E.T+$[W4E[A2#Y6R:0P_$9[#`P
MD&!AS~$T@A%E\)6!Q;U7O1)_;@E`P/Z05A.6U]6L,8N),J8TA^mY'm9HLN0G
M(^)Q=B$SP8T@mS[A%LC``$CVP5,7U[@]W?E1T|]"mB6SP(,UHRUKEZ[N,VEN
M1Fm!A6N(8|'$F/$I1YDPOYWTLB53][+B8.T:=TB47UK.;SN?V%%_m^DB%%].
M9V\\G_6V+BZX^m.+BQ(?(;OB'9.|DS^_~_OL\OB'E\]~8&.8@7G#,F9C@_LA
M'E\*^)8?*/=N3AY#)6.!#5@U]=94SA7`]YL_IAWJE)N#N#|?C1B;;1Rm\M::
M/KY\_N_LI*O]BWI99O!M/'?YM%HO)'75"ZW@/V":)X#'/J]U$#@+?\^H'45N
M(49;;(N\X2V,H.)8:QY|9!"QVJ4`*;?4mT(|#_F`:L?$[W+E;2UIQ2UP`1)T
MI3X,FK+;^LNI_]%"~BK=m!U3F$)0V@6WI,^)N`7)FCKJH%_0m3!NUmWW49ZH
M&VG(SJS[BWO)VQJG7B`1@67!4C?OT6*J%&B_75~?):Y|&T(/'ZPL?+`R]?LU
MM:F/[OT?GHH'HF^%=5^K~Z)J010QT?_Z'G]]\[T%6;11*$M%5^LJ99FYOQZO
MF%_'&R;*/Y2_%DIMTTKR~A\8#@H%(H~W%NA4*0?mT52B,Um5S.G0LI+1V)B?
M~|\Z/00'`|7F5E/G(X=PI29U|3UmK#^N275F9'$X:JQ?6E%S6JT9GFM&6^M"
M=6L\@X.2*ZDZ;^HXTMO2W"QA1HGQ2,0B]B4)3`\C`374@(^![8G"3mP^,"+N
MTOGYLW?OGAW_~,E4UZ.V#65.EO70)7Y'.;'`DFCKDLD7)*,[K&,9F%NPH2+`
M88\98mIK2X"3S3V\NK'$|7+M]I(T@W:/Q;I#KZ]BFRM/U=mNC~[;A.'J)@Q*
MF]#P1BP/FYEEZ4WE!V^=F:V=$!\"[6]`*S/#'I7`,'%TCV0'J?N,`3ZE2IBZ
MRS9@L10G#U.6|"0^D]UK!*[99JR?`NK2ZTCC9G1JV+M(]EG@LZ/~=O*G?5UB
MNP?G77RU|SI[]HLOF.7R47\)_|L:JM(`|^~=?"\?K~?S+:37'\S]N?J^=$B\
MK2Q%^?^WT~~VT3M$"\C$/W*V0V^VQ4DM,^X&(D?#7QZ4.!WH+_"I1]X!B0=0
M$|*6D\|*%,Q5QVK'm]&C)NX1\\_R&P*8m+[m7BV!RB3*Q\7]#_GJ.'6J2N/5
MS!YLIS$#LTW#(Y#'71Y~:406C]!&N^IM,9MK(F48$$=SX%85SG=7J*`&&E+1
M5/3OMQQ+4~K[,W~K8AC:;R[FUIOS:/B)124H+/"N7=/!$H"BN4/#2/VZ5H\E
MWWmN|]@=8:_"YA!~QS0;;I=150?!;Z0N2X$6m"=&W32^]=S:_`O:Z!D52D5X
MNR4mOK2;Y`&,S_XP?S`#.D:`B`S4#I*#1M@CTG.X+4~4:*3+;Z:FSPR;[[,"
M:Q=@)6NE'1N$:^~R[`UN'34UN\G.:E,V(Q^`2(^VG"W=/UX|][%/`):%,$^$
M.&Z~&34B+\=#`L2Q?X7(`U'!:9^/5YP@~=\%2`.O*DY?:R*J+3E[GI+m9^4P
M[8.!$)K`[)X\MNYE`I1E_'R]U2SQY:MWU;'7C$:!^AP6S:6;/=NNW4^MON~7
M;]UP[,~T87HL(4Q@\Z*CP7Hm^W&V*#F|~)4JS?7O2?9+EN`'WCN!2XMR;W],
M]A3JB|VS[+9YIKX~@;E#X_Y5*@O2$)~(OL/82!'[PHR?Y@@~NI4JW~|V6|RJ
M%HDO5;GJ+3*)K"(U|5Q~**;_*ZNUCO9[EYT1%!YSIYW%\?H]P;%DZZY:\=!#
MVMEQOJ:SYK)Z=*|_?U,UY/IFPAEK0H`U/0YDF/=?FO?W7`C6E\YS612@;FE|
MAA?U\J@9?HBmO*_/+_5(G9^CCU3N)SY;IN//[)D37RU;3+5#XG:DANJLA]"8
MW)PKD19SSR7|?@W!++m6T!X;,P5?)YH"0WR&$`,$mZ0V\;5OW%+EM(3O6FOm
M^3DN|UH_JQ=A?MR~T'@I;%0\:++K~+!D'~,K2KP;O%OR|Q`J/%]R]Y75QH'9
MDImL(/%25@AETE8[/Z].AA|7K%V^G99(!J:9I.N/V1CN^/2O%5J/.2~V|`m(
MBBITB2U@&H%JO1R8)#?45]B+W/![\|7JX([J=S69ZT]_N3Q^\Z93K1T?UT/Z
MFQ6:^,G7\=;#YHE3"W~[_m,CIE;:ZEZQ17[[;F=:+,[/`1(S&78JOQK@FK46
MKFXWW|RWPFZE2W/|K82?[JM*_S"~#TK+@,(FOK%Y@'9_K?C]+RNV[^,$OL]H
MUF:|S^)!)F!M.F!F6|*~J\)&H9A=)3%+)CT]K_6!"1)3|/2mL'IQ|7Y^.J@B
MY9EK\D_J|GA6X`;1,_^,YB\O)&~%&"WmEO,\%,4[D;'"A=^UWH/K~U`Q'~BF
ME7(?U!W0M*VL.LM~ZAW[+^H$X[[045L[$W;GE":~K7DXHF;.B1B/L]R$Y!T;
M0^,!RSN^N&G#W=8TX9M?]ST&@m9)3VS)8,YQ_AJW&0UC;|`:1,&~L1^@C'Q=
M@\Z|NP_4B^%0*BIO('54%0:NH|$U9M*O958:/!'L,B=#:!CKKED5V3@20%[F
M21TCZ@RC1'2|@R'W1ZNSUC!+.VWHMCmL:R8A8_AU\5E~""J=U'9;:Q7;KZ*H
MW6?\/0@m'+?D9RLDV+!DP|Y#%\2HG5&^3)BUm1OK33P;TUCAJ~&O0Y$9\"Z]
M@70MD+3`9P.M2D;GW5/#VJ6)0A!B%M^OZ+9K]B(2J|0YI*&|&Z?.A&m$P;O_
M/H+UHW&3Q?(_R^''"|CIAXC7?S.FQW/8L=\9;]%]T|XWC1)X8'~ZM7|SWP93
M303WI`.^@.WM&];*FQ#N^'5ST7'5HML.:+:07:~)%$`EI0~N8::9&A*7&_+`
MMG;P#LL9~+WW+(T%CZO'I|%^LEP%2YP!)\A"^*P"(%PQ^CN\"R3#I8\~9!NQ
M47/"/M)4^3G7RV_]|?\DD3/1_,:92XS9S]HJX|VAV40,_"GVNKIM69=~&[!J
M7|T$:D?5?F7MB:K,B%Y%D%|X?,=D!4.V3MHV@/1)19+V&3,OJ%O|(YPH)9MW
M0,Q+1/2!EKA4~I#m:|~;m!NLXK?J?R+VV\0.*K)H#[.]7M7OM"K,9WNN7UBG
MP*]P%M/X)8LH['&,4B7D@(;=]_mI9!(!`264D2VM=Q1OYVS$77#J*'4`B$0A
M9EUmm*4EBR6]I#=.,CZFMQ)6S+YW7J3[.]9[||2N|m2J8@mm:P1Z(:[;):9@
MKS?6T*B!.@@9HE:VmWM!3S[|SO_7_#Cm|mZ]?OYZ$036^02QRMEL%*5(#13B
MK9`W7%B36U;#11,BN.HB=,K6,TEB@:B$69R+0P?VWB3)8Ym/R4I"F(,#6||$
MQ__48N..40mNW!@M3;m|_m|R(V]AC=1AD!'=W3Z!RD)@AP&V=!N4NWT;$V??
M*Jm]O0)C(]!PB_M|?,0*TN5]O^\#7=N,?67X,[4?BF"=!PGFYTTFKBKB)JEY
M!I0.,C&R!PO`2/%MID%I~3_CZ(]`|H$(.@/5]U.66T;`HYJ81DY?PF9!@;/S
M8F=%)66:,C2UP+X|9OO$',)m*=.AmB&@#YC]X^`U!I/G#QCPG$]|*SA%Q+X_
M)[FZQG)23Y'P6|'*,?BPV4P09T!=!QZ:*\,~J!,3!'0E_NJ*&*856DDXSOL1
M`C.8B%YK/F*9$2'OI6I/A9XFBG_]D;Bmm\]_D/US&HQB#~_GJ6$8E6:1m377
M)]]8G"68KV4~=Y3+$(@AYP@mN.G*#)H@5PE7D04TKPQF`WmA8|Tm4&(V`A,:
MRE@GN1RF02GZG3MLXUF4KP(*I$FP%+$WW3RO&].66`\02LJZO%HTUAUZJKHZ
M96$U,P)OIZBHFWU!M*^791_VG3X:E1KH`m$7JL9Z3.5"'I[m(;.5!]mL"AT_
MDP~'Z\"&M'"*,Z4&=Z2\(`)U(&&18/?_;#'A2+!/S!8K22"#Q&IO/7L6'F~|
M)@=^I6WmNI9E@X!*7LTG`,*N^8|5[:,U`"\P=\U~93Z:`\?W!mF4"5$L^SBW
MD\39\&BF]LUTB~P$0`=M#IP)ND5SHG/&[L#T~(M3(RmQ*+N4Q\0E(HYHYH=D
M2"NS^(SQPN:S~/".QDD,mI]X"S|H_A~F,P||F]IC)`KLVX#7AQ=Y@)C4I:NN
M!'_X&6)(mS1m=(m9$8F,T)R;M,KRSF&_&+.7@!m!9M(22m[|T/ULJKG_*Z\0
MRUTNG)PE8F,@U34W_$~+R:#%Z34VV96I=|E5C3RG'H0:^%%S"5Jm,S:0*P]$
M=)*2:O;m&!m2Z;_$_S(]%6S|'%7[(m/6_XNmRF("P!T(78AL#SHRU#'!JP)G
MQU~]$`+1H=)BS6/~C/~OZ"L)48CYMKEW715BT5S]QO$$\FP22[A5'P"Pm1%*
M3\/1W/+4)EA2$)^4YQS``0;;D*]GQZ\AP"$SIRO2(W$:@m%5O(BDF(OY]]H:
M^(#.9[.27\|&=4V(7,R21CTPV.7#|?3AMC331KRB#0*7OmAED|!26M!AWEYP
M,L;4|[=%:QK/1NR_6\RD6J1.3ZRmL?1!U!=1(QmI?|9~]#^_.OVSAVQ,V]=\
M`ZS(@)%GN$|,Y~?U;m5:~LH7HL(Z$UD\/V\F)`/()N;mQG|358MO5PR*?]78
M11;$0&C%JI*)1`X%A5TGU4R;7"?3.)NR/6:$CL@%)/YSJ7I~KKIL^KOP=((C
M&TM6Y?LVX0M19XLKIGIB"(Y.6_2P^]A1M"$4Y%C",B*m$0FXRT]M[.AH3*.&
M.0`01OOWm'F:2D0||M7/!.+*0S\R7MNXB]4:[RWV4]4_",D71m85:(KED*3P
M*0MFA\/T*&P~L3LZ'M!S3D1U~,./S1KAUV3(&^)I4UHCmBY\BEWPJ*(/A#S9
M"6"`JX9!'WJJ7@V#05BIF5".~D5$PH'."S7$4%"!![=E||'8M%FIJ?:!A|#T
M~DTm!D_)(ADQQFVAVV[VG_]IPTm8:ZKT2`XS+CWIJ&2~8_\]4\KJQV)0(P$@
MEY%XF;.MSP'\C4?PFWD3SZZB:2Z!SL[AGO$6V:N7UU_R,@FITHM"8P.S8$2|
MQG[HZ(W*X"JAXDHP)$VN;|%V8\|CX]0|7+OH~M&^:;P0XJ\F?(JY']HCD7H^
M6(\mH]`(#+J8&)|BP3@%(L7:=`GEP`IC&77CP]'B&&|^^6YB#!'\Q65HP`EF
MK31(*Y10~D';7*5Z"X@#@D5G0U2^\F3JLQT)LA93\5GF*3YY11QG#/&(+~\*
MN*6]5ER/5.Q2MV8]EX'/;(V!8);E3B?D\$)`%J^8IDHLC%DBH`B.~7L:0"V^
MV'*B706+&PWE,_WX'~^UW&6^$X/,:5EUJ5'D8^/XPZ(8;;,$LBM'),26+=~K
M)X:'&?L/1&,.B2EB11_.Q3(YZ8Gm08GD9\G6"RY7IL:.9U,Z2/N,"&#X]/#P
MVU:K]?3HJ`,"I:[KK`RF)6~^79KEHDVOJ"'!]Y7M~&5m?,':@E][!7.mED&W
MA&0,DIQmHZ8.R5A*[Y^6ZC~KSSImJ3RLR0SP2:@_1%T?N'.~292V[E.AAKEF
MV63OYT,AG?C]ZmM#T,SNI2K9$.+%:G8^AGQS&4+._B?+LV&(4PEL48ATB8(%
M[D.6P!4EG:0F.6B"()$XS"(G($E1DO?D.:/(:`9B":]C.@m0O)SI72*.,JQ:
M]+~*PmH9=#YW/4%9)CUFNSI($&L%TECW';2:F$1WN4C?KK/`|8UZ(T+23'*3
MN($I`+V8J^I:)K3m%V++GU?Q6M?Xm|!\:JY(F_^4WN"RRLm.8Z6%X#,M)(X'
M4;'~3*E91m&5"N'[MA5^X7=J]^|;J;FN40G&6OZ8UJFSIK0Y=^"+GC8]+$29
M=)NAUSm5TMXP."'K2mN9M1$X]M.+*@"W"Q&0EMG\",;V&N"B(Z)|3H=8`E+%
M1|]\HL;"m|+8W?D"NPFXQ['H=^G~O1*Y0HmV.;!'#GO$*LZ?JmWI5"+SD#UQ
M;"YQ5(8^T#*C`5QE"L7/~S6G*1E%4VS2,G/]~I"D/D.@&?T"?BZ!Y261TZS%
MLY+A$0SD,:m[9^ES=D~FU?XI&_#/N,BA6B@X?SD~M8)7:EVP.!.J,!S#;J6`
MTAST3,L(?8MZO*4|[\/30@/MB]HW_Y@V)_mQD8Bm8*!X$V73*)2GJG)4:|]8
M..CVYTO,*+6|*N$$*AJVF)H6&NXSVHHD)#!\T,|T&00V2H8I%V\"ZU;TQM==
M&3S[X7QL/,Y8%Y0,`SmC[`m9FLX9YZ.[4BMK(^3~L"PT3]54RAH=XP]K5#J.
M]$CDO'/SI@N1CUJ)|\!T4!.]9(Q$HLR?B3(SFYG|\m`^\HYFQ2+M^&;."2^`
M204AD97;`JG`S!9MC?GT;CH80@/9N?.'U7F^WZ7)HW=8],7BDX$Q~M2G?Z$_
M/_WT_/F//_[TT]E9\^IJ:S+9JB\^&0"1%PZCX'['C]#XH:UQTP@4,ZCD/]%:
MJ=ZR?)[M6G(~&'90[,7L(%`VV&mK*+O/$45&%F!E43PPQO8_K@"m+$%*_,?_
M_^??]*~?mT?CI$~BX[^OC1WZ\_OOOL._N__YNQW_WYV=)[O_N;N[]Q^[~SN_
MW]G9~[+[~RJWN_?[W=_]1[CS[^N2^S.'*CH,_V,0S3X4?YW|6^YS[_]?^F|S
M;&XW(;R1J/,*)LL#`~WGU/9m~=[G?P]0,G@L`'_PS\#N!ZM@^X'@Z)^2X.^V
M;+C[7[\/]VB[m.E_.[\/=WZWO[.WO_m?_SO4U0JK^IU!OM_G3ZK!FBP%P2mR
M$P2:D2#8I)^.;:SZWL[.'YK4CYWPW8SV4RSW^VDZ2*(T"G].$^;+BEO^[&5"
MUSK|O]ALPK?,LREB!,V;1FAH]5YK1Q)]5/15I7Y`m0#ITL!BVKPQS#DK_`?#
MWDBRMW[L1`BMI$55_$6KR'H%*RV0L?'6B/Y:#DETT~$P]')91=Q5I+%JCZ58
MWGYY~GSRZNRD2=WE#WX6(=QW1@8Z`UT)N"?&T35[S8YFRF~`/Q,|$&AMA\4U
M0GTV2R&@;JI,WV#?]PIP~'M8~786GIY5PN^?G9V~m:B.7T[?_?CZYW?A+\_~
MOGWVZMWIR5GX^FUX_/K5\]mWIZ]?T6\_A,]~_27\[]m7SQLFUH#NM!GZ#U!P
M3"+$I$WVG/8[8'S*K+W4NM*,`.K#LMP4`1!Y;NR*5`O#NPD.Q.J@6CQ[7J22
M^/KVM;RJU~VF]:m0J,/LDL4%~[31PG=7=`WGX?]J$9O*H#~;.%7_HC]!L)I^
MP*J;W;4=:.(*9B5HBA"#/3M+QA]CD0E?O$QZX*(1@Z!^YZ+&(O)!$FJ7&+mQ
MmLHV=N^ZJJ9CIY6DGY]?)X/BJK/3^AV'6?!O%W|;NPM`WB+IDP#\:07A;GB8
M3$9A/NMW*AO5W0JT8)W*Z@&MA%+O=SL[8?L(V+S$G!$S`GS~Y1[]"m^4.Z_~
MQU:[6`AZKZ;N6%HH#!V).PPmV"4:L#:)1[|+BHm)MMD[[!)$O9QM9|;7Q"(M
M&=NY:,.2?N`MR?T)[!!32;U!(~1_;"\.K*]F=:~U2ZOP;17:#7/BU9%*WCVI
M\EK++]]5S9|J1YR\.7DIW/]\m!+#CWJ*,m:(,Q~*.T(XB9$$*,DG~8O!#P/L
MH?M[/BHXY5Y[L2B9,"~W9@)*R75$=O"1M"5K@4D(;[X!S,!86&.C4&:A0)R$
M=EI[=+5A82R:R=U"[HC'7!+&3=.L6|"*X2^_,W[]5=]M;=&ML?;.\m*!/.K~
M~.RML;P*G[DT%A*DL71G!%]Z9ZR_,8(';XQ??^4K8VM+[XSUmT;PY3?&NOLB
M^,+[8OUM$=CE6mUQ_R=`]0;W0O2J6.|1I^Y2\M:[A~|L]U,\R6:WX3/JK5R!
M/$`#LQ2%Z1Q!1NP*?)M&$]C]9S/:G8HOEJ@^92+51+::H."@NK_mC;'Qm"Q4
M'3Z+G76+M[_XLSN/L%*:%I"~P(0V68(Q8|!4m:*XKIR*KDM\WT6Y*AB,IO|!
M]YX6PXQ&W.#S!IN~U/&9Y[LWA\Y#G?.\E]X[L9!||~2L)`"82U`S2(3FOH7_
ME#$&,96S8X^|#RE"X!'PmJ0MFZB3&6OO3!QBPP&,PH,&2AFQOV0,%C8.X90M
MUI!!+mX#/IPC@/:+2#/%F#`Y||*33`8V]PI_:F:[V6P&R6HN.4Z5:#_E.7A+
M/_Q(7YY(T#N|)%\FZ?PF_"ZL5?=:W[7^LUIGK]A["_Z."^[NT4U6Y_R;:X(P
M.H$)NP@/63BY.GI|)FBm@Z)K[/1[#7#:[U1KXML]_3!2L!X:,mV_T``Wm1?R
MJ+B"U1;TDU[V&|X).7V[0;CNCU|5^L~?5|QWE;JTKQ!2OZ4#5.=#S:]M7[ZJ
M+Z46m3/BQWR%WW;":LV;HWI0@M3RWNL3KO4UI_*Q|:WPm=|$Q7KNQ9M$m(H2
MS:$W/~N?#8^3#8/S\R%B5"\N:D_J!I1774^7SZL!~?:0Y9!6(\IOPSC%80,(
MD#UJ[*@B|1_H(,ZD93m,^_YQT(`5ODXD%D`TZK:#39?`P\.#*R%8TB;^11`^
MQ)&K1Y0=\/(|4(&)P1VO$5/AJY]?LL41`'HS2=RE1":DmF@3!`9R=CX=2*PW
M"RE@m*COY^|T+5000~F"|R'AV)9VN[H#],=P/QII()R&@S|?%C3XBPL'EY''
M\0=!FRB@*7!)3;B$~NQH_)C.D,+G#Q/VS(Gm!:%25=HLCYB9S)SX7UI2EPXU
MmY`F5)C]4,628MHSY@9UK8V|FIH'"2N3+HVRRL=O?F:""24JmRm$]?R|NMS7
MP%NYBVS/P'!K%F+X)CL;N&A\A\0OIT/Z%mBZXL$F0UP~GH$[.#5;4JR02$0^
MA9PVXW,![%GJ&X)V~7#&+:C0A%Z\F82G#[RX"''"]U*]NC/A(8(B$S.M^(SO
M"7@VD(Q%F]0'#8T^9LE`?2\|*)8_8S0N"?_B~Y:[(Y%79B28"&3GY5"7AG5+
M,*?m!W5B/T28KB9Q(~W'*:,m8`Q\![B09R9G1`P*/^ZY$XPNA1Y|\JYK96NO
M@^/%9Z^3RE)%5Q6AE\N/\5%[FZCO?;:`8+MmM0Z1&RV\?'%Y]N[MZ:L7ES^\
M.'EW=OECL*&9SU;?'![R+LPOAU.$%%J'$*IQ@S,IA^WMU|]":HW[~=_'G8!S
MK\9"`|+MVK:6J]?D`1$96%R12C5MA+S\VT.29+C6U5"Q3J#?mS;73E`?1=;$
M,P:!m%|N7GLA=I)P~_N2.S*:)^P;,\P!`?##Z|L3]":XHPE7T!Q;`?=#=U5m
MOC;?U|P8N9%&2*]^~/;R[(2&M5C?D4LBSO]SG7GW]N?U?2E5\W!WM%:2L?FK
MQCT,@?S19:6O~EG&T'OL,G+Y]WB6R8"D\G$\I*II)QS0(]L^M1YV0NX%GMLZ
M|/@OF:7MR/SB+?`R"MUL\?0@H$?)L/8U?5OG+GJ5T;]VY&!?!Y=I?%V3`8;?
MAG_8J:m":(50!7W0/%+Q@HI2)\/#CDZ'5.TJBPNNL.8MA*N0^(IQ7mNMAW?\
M%|9,/5E3?5,_/~!RU`5_TF1B)\B"6DC?J'%JQ*S/WN]^U^"ZZ_(Y#X..L,'/
MCCUX=.O4`m)`)UKJmI6~VP%P5YOA[@7UE^JW_?JZMJW;H+ZN*[*JP[H9\4K5
MJ&_GP+P##+C\LN"__67&SETW';9F&B'm"=WB#+0m%P|/E"475",;m69MY7;,
M]'D9?|J"V[@R=/G4XJE9,AGJVM7;/~`M&,;39KmNAH=7'82K%G74TK2UU)?6
M~\%+5OI*~*S5*=;*97DZYOR$=N=YCVC::ESN*mPmO_GFH46N$ZmO3O5R,=D$
MG7"KFV[55Q?NGI.P9I:VPSU4QB/`|G,1&:V;#*5V;B/\T|W]/CB"ER!F?!VL
MV+\[0~7+S4G=M++V(B]N"ESEUH[~"7Z#J6I=Q?F5QR(LW~C$)?P6BQ@U|UKD
M+'FSC]X`#B@F&V|~SXBIDB0Y)J"5SX5(4`7|(F=%KC[[!;&`!@F?HP&%E1Z2
MH,'Ym_WT*;)6FD)%O+9,YA2)+AB/XUD@F,9]|'8AU=J/.4V9((H6+FR2&=J&
MR]!)3%^*F"0ZRBQ[(:D)6`T2V/Y0%Y~V$ImI`OV08|'CWU=T1=)08,;/!@MV
M,GNRU^Q!8BmZ,`(;K=Y)`L^~FW!CC3+@D%T6V;2\S?L@(|WX4*5JUKF`TZ~N
MSF%;5m4L\@7'(ZN|"1@$TNF]OS?!C$GN)ZB3+IE$$NI2C(`9#I:`4_*8DRED
MS3'`C9BK9T@\YJmY,J";16'!1]8C*N)8?AUm)5I&Q@LOGZ`&+0TC,M/LL0*E
MSJmMVF\U\m(E5/`$,#C?V(T2R)QP?F+L&X.Hm6~]:mC\V&X.%+@9Z8ED48T\
MLRA+D@$+$)J|0V.?)m#5[7(6CRHKK2@.]"'(U=%B48'B*29QKN^&*+[XRU\.
MEK\,2U\^._US0_WA2N5XBQ|BQD1ACCRU8:W:I8EZ4JT[QRC:Q;L[W_WA=__Y
M^["V^^+[~@O*45^Y*U@N2\FKC!7$PKI[ASSU#XW80@0$,G3ImB*;4mOF12@F
MTX7+X%)D|RB.`_7'AQJ!9D@5]~ZX^_F|]!/CPO^!%E1D4.T;XW~PHA#;/^W'
M+('1*B8%$\&OV\0DM_.K@$G199%=TKM.I;I;81DCK%2]YY7PJ#V(/[93)$C9
M._IF%UJK^(;6:S?(KY)AX5=R"5T&U73G/=O8V&[3)F!F+3P/F\.P@BEHPP/Q
MLE22OZ95OS@@4D"W53Z.Z6+__4X`'B,@XOTS;3_:7VX7m0~Z,0*W^ZJUVM[V
M[L[~=_P7\4I[W@"H[VZW+9|,D)|`$S"*KC\L#YM#ZU*PL3=Q?WF**M6G%9T|
M7Z/']6S=2~@&F(XA_.mJE|V_m#|GS|U!N/GC_N9/^YMG%:*YU9V#|#@|S_.K
M6OT@7&P%RK7|UUXP3.2F7H|]U@EXN:DS3ST+P|N,L~P7HNG3]mXNFF^|C7)5
M]HASMGD!775#8]|$0YH=_@;SR51I#N]X`X'%C^@\_,)+'AEXH?/S*;]1I:`%
M\A|E7TUB%)BT(W!182U`m]6PQ?~+*+23.*^KJ[B).'58I/'m;[;26EIL'(/5
M7%OU(|,1JS*&FL5:9M?:8\.2/3989X^56]UFU;m0A7m!.Q((""7+UEX2!:S%
MYVP[=)5P:)HLG[C_RNP1V22RU0J?F2AQ!/IQJ(5&SD6@88%JJZ0C)NU1B0V1
M5S!&Y$YEEA06C4?S0TG6#C;RL@;9N#QZ#J~&1Qm*J?~CX(2;2@:"/C!/\BN;
MI,m5H%Mm8U8LX+K70UX)S%[KMRF/#G$^6U='$%]`1)N_Y%?1(+N&S&(T/BCR
M]TQ_N.2?UI6V57I[$58.IZCJYY=0@UDmE?U=NJ2:I^.SR[.?W[SS54[NT:%?
MNS4'251,7E8XV8^LING!3SN,6D*RPJN3MV\OW_WES4GXXH1^/CV^I`|'Z!]W
M[Y(DP^/+2]NY~8KIOXP*DB@N^1^V'U]~UFJ7E_KRDDCM!E.Wm5]IG^]76WEE
MC~K**1~)LU]5+9J)S|KS?+^&:^V81;1^ZAFT?D+2:W3_3P;[$#6^.GFmTMLI
M[|O2='3"LW?/WOU\=OGZOP_`V()Q6RI@&CB%UB]BG^NQT&S4?+~DE|&5P($E
M+m!"5*\15_KQ?.~B$6ZUX|6@.AM34`1,[S,M;K0SI=???LLZ(I8\ISm^5+,5
M04SD`79"_',)mHBN+3K`\64RO*1'm3RGBXSVGB:G4K:U&:H6?A@A^1SM1JYA
M%H^`8#FK?~/m~2mD59IMOV[TF9_9NV9?~=U!;Q`*|,|7M%FD2QD#_7V`YUV9
M,'[ZM;=~=?TLEm'2FEPRU~&2]0m]!ZZHMJN_+NCOA:JH=NJ![9(,%K$XEYm\
M5*/_U[F\~UXK34!E,Z\T0A0+2L,J?;PT[4OUW]LZ/DBS=7W0mX_JR5(E]_;%
M*[B^1_S^$E+/&*4:(:_99R9G/SS?'%R$IF_\48.M6[Q`J&)=?]|VL[[K:\LO
MCR";UK*IM\%H%\GY*.TBMX?,P|$]C"\/'MHNQ"AG'[C^U4JA~[K/B$Q_:NL:
MJY~[I4~JE'~X$["JV9L1|V1XQY~HG+?=?/*$A3YPU:Q_O;X~W2H/U'9?@37U
M^~NW]($83&1$Y:H?6=ZLO6D6*QE8O;JW~*4"~HE(A/SY.8H)NMGY.;Z@S7MQ
M@240$U&HSXB|JS*0J~TW^ICJXW9XOU]:GI`7OA$NEY*PL]HW0IW1DV~,7\N:
M&L_^;|*P!IE1&OIL5NW\_,4)_[Y]|5%OL'L9)\!D=+U(O4F71&D#"2":,~$.
M?3HN8L,74/|1!D0B$|92&]E37m.?_^B3[/7$H[TYV!?2L7*$1I=_FT~S#ZA?
M9EVK;1Xm,LC6=38(\0/,"6KXZOY3J"65PZZ'^]K@YPZAV3:EH|JFm`LP|BMI
M%HU]m$T.NM(|6Q=D8'R,X\'(`O.IIU!@m'F~.D@SF5O?`N0_M~XIK*9(#$8+
Mm%~S9,"VWQ(NH,~0#V+@J7V(;SGXMJ/\|,G+Q^3T@L;V%XF`S"0BT!M,|/SR
MYmG;L].7?SIYJVXNG~9I~Y[/VEIGVQ^ZON)SO:Y`J3KUBNDT7WH?T12%S7$:
M9Y?]46)^RO6'~3&FG_[^:.~|U|ZO]=%9TZEZ2:8_mLG)U.m/4K7R|88^%;`@
M1H?5]XMJ!.4\+9)Q6mUK_;[:*/E=&,\Q379I_"Z\"34EK&//FOI9U@LX0ZHJ
M;J\UBR?D=$TYF\V8T!AL'PU4Y2W%DIY7.M#@5@\)2))%4,T&D4+E9/8@8D\E
MP#K(OO32M[$/F^2S993(m7T/@M+D.@|'T?~ROHTU^~PM9%+`|N1~7R$@V*%B
MM6X%=G=@DUJ3S;8^EAS'"HD0#];5P5H^H]TTZ745@=#D+5";@Z\^#`P*BQ|K
MK^m@J6`8)5@/P?UJZ#JD63A"M"4MS6P0&]C#`+GVQm:09FNFT(+^LK[7`A.R
M\C/m&"+.`'~L&2#V(Q0#'%HUL(F|S(9\O`C[X_,?PFT^PI?2RD'@W2$%GM4P
M]`;:J(=7@R$+'9R]L.9_UPA=L~4:Z%(NUM5"CW__W~?J6DO[?=[#=mm_)M_[
M3U`7L1_|9*E?JY]I(?EB52Q~mV7ZR;J!|7%Z4~[.2DLK$BQPWSM+$\[5R*|P
M2+)!4TKG+)!*=3,8m(7/1B7$!*,R8[Z&9,U"|9&mQRA`C!`=C9VZM=UNY\;:
MNI;I7^(43ABSDI5R8H_"V=O,#\(178W,/TB'T05MPYI:V?#JV:#U!|V'M;66
MIMY|^9B5_,OG&5V0~|:[M#|?GN_M7;`|OK|3?LM@OA"ZH5]/!|6_EK)1&=:4
M3'ZI@SL:CP|T,mJT@`:@O^JHVK,BFPZN+!O7H(/#I;%ZM`&=R/@G|,@VID.F
MHD[5V[1`G0:LmS`7V2P#[CS1~%9#*\5WBF95;,/*S~3M`VN1m.&"Z&Z"./V8
MS+*4/=?+:9FMZZA_;12:$F|?V6U?O_KA],7EV]~OWUU|!mP%4T[LO`(CGYF|
MZO8+.![!%],6]I+U|+2D`"7/?,(]C8HKO7Lm`~PO74I$Q.&'$8N'A|2"*%6'
M%[XNBL4Q*KRJV'M%V;O[U*8K+M@^|W;JIR2UX^;CL~9&#4[~'5\^/WW;:1mM
M:E=K;]Z^_E\GQ^\N7SW[Z:3^9?[?RPQ5\[FI~ZM2K~G/]|H6O?!;X;~E9BM;
M]WL:/M=I.C^7P5PB]]/_S=Z[][5Q9~G"YU_7IR@3VP@L|7'2Z;0Q[B8V3IAV
M;(^m^S+`*(54@FH+2:.2L&DW\]G?]:S+OI1*0CCI/F?~WWBF`U3MO6M?UU[7
M9XEH%IZ_X"51'?VV4M69)K!~|YO@Q=QmPPZF*SSA*\LIONB4Z[5$U^J%Z2?I
MN.M5.*?;S:@'^JFW.#_1*HK"M$XYB?/4MHW=6`F.R$HS#3Y$9*&V)(Z&+XE.
M4$G%76K3O@*%'@mKJKC,&U''XRH@?$PD]3'V#m\3,VH04"^1HX.B0KR_2(F9
MZM6CJEFY?KK342/L8),O,~?Mm0KO(m%HK!0RNREC7:SH95(&*MZ1*7~UE=+[
M;*V7H?\7_AC5N$#AN?J,KJULK/#H&,C6,N4XY$GUU*J=.T_Y@_FC:X/~;?2'
M61?C+67KTM5BMR*2]C5&^L?,/*OK4NWWV&|)WXB_%\XNmV"*MXKZEC](`U54
M(6'"AQ.m8FBU/`,K[X#JRXRFHY4Z&5@W[ME%mNF|JY:%#0:O7A^V7[Q^_^KY
MVAS60H==IX?Q`X|VR1@B0$?%PZVHPXFM"9FT~`9V:V9`^+I1P'0m3_^V:`57
MUOQ^[;O]&G84,8T5SK;21#.EFFZ02YPNFNKK6^GY(YI"?X`3"]7](=G#]J~!
M4ZF&G0+Z?2W4_Y~FJ:56|/+F*6?G$2AZC6?mM#~(5|(m~G"T=8+mB3/LK`K&
MWUH?U!D47;U@/Z"&~BQJRVM@Y.0)/O$P?;2VMN9T6)Z:T$LS3I3*ZY6J^,*R
MA/VT|KV!C7C&AC%?31Sm?^0XC+4('SS`PJCR=`%]#T4:Z6+4"/HKNLN24V|9
M,$[~K9m"?4Y.X^UFM1E)C#7I7m$DXLEE`7#AJ%D@X,??%(S+\HJ:^B3*,?69
M0(J986'Q(A"=X6^0I~_?OA1?!@=NQ;!)@J]O+3%K~E8`%RHK*\"8|1J;B~1/
MDEFI]JN.P2.^[[IRU&*]Q_/P:\+W8?9&T_%H6'KW0)/X.7,WBQE\/_"##_F5
M)~&58"`NP.':7UF:8RH3\,;PXG*8E[ZXR\HC5#IS@:343F7IZ]0C.Y+I1O]|
MK~JLBI*:|?H1R4\4INA5&0)^2`[?5#`;W9~"5)M?N1PR'K=9,UL%']V@|B]4
MGTmWRF/Z$^Ym"*4WGSm6U'S%6T`W~AE"=PHTG#D6)%^A!~]_P'Bm/HE1IJZ;
M/'\m?0Om$'~182)+"V(J)FMHZZ#'$"H?%~=~PN$=$BQ+("+IA"5|!P#PRBI|
MH,A1:\%N94B^)H/ZQH'6?~5@W8R91DVB:|,!\GREN,[2Q_BO#/^/^95(|VY=
M!/Y/8YE\=B1`20XGI;1"M|)R,N%9&2*:9?W1~3:@XS!6W'0!\^_095YR&WN\
MCW5D8?8_5G_1\~U,H5X[';,;*"\Q%'UGm.,C&|J!C)N?2*BYRZ4PSJ/=R7I[
M[J]#\\VE96DI2B[XE5P.GX@3^,KL$E?IQL:&__/OX9_7^HMF\E&\4M?,1E3W
MTX;6Q8,_R;'G%`,BX9[BO$P0WZPT`28C7F0$4;)V4'8EZ`2W^3(J+KH!)@*F
MMWQ"19_25?6$2SQm&U`H2@H.WK0TC~X#;)RPVC1O4O?)D_3)9/@A'SS54=``
MTH;U4SKF&VUZ#:^=)%@D,H2`?,27UK25L,T]A_A@QXZ^#*HS'8]%\T!]1^\D
M:7O0N||T,E?#&@/m$6KI7JF'Z!AIG7`[#L[$_7RVP9GV7NDN#J;X6:N|7`FB
M:'$!7mFC[=;O3HZVZ#_KQ&P..Q!V&EOZ@!7R:.F|mIFKLO4)K[m6;Z_UXN3A
MFNX)%1HEBM#R^!)G0=1FQ'BYI2%B,M($;?H^TT"'M.$6$ZW]V5|L:2I!Km#~
M;I/FC?[7I+45BO0Y:%@JYN(M[@YIJ8[?8[8\.&KJ|KY+#+'$WY8"=MH$m",U
M9B")&SR7_%[W"&,=ZYD,*4:YP=$$09RFJ;0XL!:TJL4#M5VHES^2U;H05P/=
M0J8TT13Y!*HU35BX,3OKYET%V'=:,J$AO4DBR&*:DI0O=$F4RT[%W2ER!'",
ML/DQ[[_^$[M~ZPADGG#D:5/P$5A*F63Z'!),6`GP;O?)$P@IFIL[$:8SSDF^
MF]QKN/)KXN,:m,F9OU'JHB@[C].P;%01KUZ]_O/^]^W7;Y_OOUU+[G@XL[?W
M_I#~^\_T'TAHD*Z6F_^9KMmXm_&_U?1I~N\/[*H(#]+!XY1_X.JQ7QXG=\87
M\'2.OKU\+[ED,`N[R?&"8)|#RWG@[G4)J&D4|0=@HK[X0,QTVAK1B^?[[PZA
M(_/:,C#]X)HX=4!8$_[8(D~mN.Z]3[7Um^_=^_SI~D.83Y$@D.!#)F)~|;AD
M+VX6+|$#?,WTR:6FK~+@ZZ'#^7?,$8R2FABJC$#Z.2\/6/EL7)3@B"V$&:,^
M.F*U!K4mF5B`/~M=2&]4P;&V6ES)/2.!m!A0HSL$`[H'.,=*Z$E,DJ^%^3J]
M~]K'?W?|B^E`;S)?8JI%YCMm|H&F_/=^C=4!?BV8F38F@94+(G!)P&D[,P%,
M_SY=\ZHV?;.~T6V,@N[!*1Z|5Fm)!YEJ'VB6Y4OK&11C@].9YZ~!\2='RSFW
M)H,A0:*9]OD!=Y[U%#3Y`N&M,I\0^W,&~[?$#)S/BT&K6:4#21N=~O`@I9^G
M:Z&19FO'%XA~M+;]F[@*OX!&C9/I|CP18FWL`FD$5VP3%R??JFO2E7X66*T&
M&;QW,Km:]4_#=Z=X=VKON!\Y#X&F:%Y'\U,IDm7V5U+[:`H3?D.]:=%GF]Z:
M?+6J:2HPX=QCJ@C+?E,3D+``X!VV%;5"|V8)E#;,mW0S#R\L6E0[;QHJZ)FR
M]`E]V)1mT4A\&#&5~CI;:MO43m0SSK,@ZTT3!T:^|S%JK*4mYX?`:JN`O==U
MZ,A46PVLQ.#49KH335]'IX]90=C+4~]B1+=@R1%]0;Q~)$=XNH#YM+DLSZ~]
M7E\HE~^`Om8/2ON^3]?~ARO`mV1?JT'!B0*\5Q?(W'E!7,&X|P[`X="C(9/(
M1%:/m#W*Q6V\L|3~S$~++~%B!.~_V_3!?K?&`#YK1Y?RPI#5m\,O:]NJU5`Q
MD8I[5[6~TCS.EK(^U!2~8S"O#G~^N5;()ROY(+G&ZEAG2EU;B_8:/:^87T$J
MY5/TEP`1U'5$)NR?TYOPTFQHZ\$U4C48U_2XXJ^`#3KCM"#0Y$VY|*Bm&@/X
M7!_8VSH@|//_,QP0mOC_O1O"?#_@ZC^;T.C"I5_6?I$KPS/!O!|!1)Q]RC`S
MN`9N$Mm_;6+$[K4]ZU^''Jm):'Z/M736L$?HXSBS@?,1HIEFE5/B/V=JC*KQ
MW"!KV/3NT2*9N)C623*K!]W4MGB[(!HZHKM5HW=37&.;EKLLM\P`.DNF\6SR
M;~`5H`:~9*4=$*(.GZ.TDU/3"@\'46E+L"[J(I\VJA_F(@$S3*Q4TK#%~'Rm
M.m9W%LC'P(2V*/I]8$66HL+N`B[/UVU199)M:5:(1;0UDC17,ST[S_LCUF0@
M#Z@X_=:;F\7X4.OU3O)J!^@+|N8B$X\_LI|#/J4HVVKA,6PJZP\?(O)%+W18
MA';3U|~K:+0\`EZ#'.)20F#"0BTN=#|L%~"K='A^=Q5(05[J#QE'!33G04~m
MF%SO]_)34!L~IUO@);K%P$YA;'43"`=Q3(YO0FT$/M^NIO\N[*_Z506OP?O(
M/CSS&;:ZQA]Q!MU%YM:9:)G`")KR%FC8]\4*)K'/N;%PN)"0$VETGH%|"KWT
MU61*48#X3!2`**GKU%Xm_MA09`U=3UEmF.!V5ZMM7@Z\X7X=~T2?'@G.2$D|
ML3QV2"OA;)5SO`8O`9F2/J2MRLWQ(EP.^/:;,W^UmM'Y\VF11][GRJS6?m!P
MmA@,$S'R?8~V28=O/!Rm"\ZUJPIV1U.U@3K'4^|WJC[|FZ+&'&4%1V|Z6YR9
M:CB/$S(!R?TE.J=G2K5+Q0$T?56I7K&2KUmSF`9PK(F`~O@D[AJK(/'"G*.1
MJ_A!8[0?AY+(J7R|('\'_4]m0$CY\3R7V'\F.0#~$\!"QC0|#G*F6$G7%S*W
MKFH[SV+B%;6D+JZ,VFKSKU4]9:^S7|JZ,(7\$6OY0KEY9WOES8O?A+OIF9UW
MTF77!`Z1:K??O'W]P_/]=\_:[~/!\6"E+K"NINY[1"L@0B(]~J*+_717m~[_
M~/P$/7P*M?D)mUK#?:Q8(;L]RE#F$$A3]M.30&\9|UU#U%2CQ6|SO)O6FG,^
M:[]P.B[V5~~\[OD\+[I%WV5?;W_%BTIV[H#?.76H13@8|EXQ9HTJ|I`[1N7Q
MO';:[==O&$"YW5YRK8X'!MES\)R:90._ZI7:M#EFR|3RRMEG[3~OWQW2%GJV
M_^[=PUT&.8!B=*7\[W!G_??/$JSGM:BK1T?WUN,3MEK1NE;A&?+.^?#G_UYQ
MWVC1NFP&L['YN8S^WmPICH_EPXV:+T=G|IEOKSD(!_WZ*I2_QU\=_6=ZLK&~
M[N+[QU_19\Mm|!*;NYL[USNK0?S03)7/]^YMNCK'7UW3G]~;,U7*S97m8_NW
MLGE&9~]OWK_/O_SG)CU!9:IJ108K^.]FM1DJ@@[B'Q7VE0;TR~O5GU?L?A`%
MF.=_BR#F2S4\|+[MZADmXBU4USK_?@`'F4MJZZ.C;GXZ/1,,49PC_O.,,S%/
MQY*0^3+O#T?L"0#SPERMZXRVDIM:SBM2G1^KM~HY3BXA/D+.?WZ%'ZZ(`*=`
MN8QTY._"8M#2F[H^5.m"`'59'R0W7N(UT:6STC"|&OQB8+WCW*85(47=*,:Y
MY5`D\DF+EEC~;OF"\NS|6G8ZG$J~=XmO"m+802=GO@F:$2RAZPGUD)Y].I*(
M%I&'7#`7D+"'*E.P89Bm=6PNU?2791+Z49|3260MXBNL4LZ^%CG2*"O`%XRA
MQ3|3M0&:0,156=N&'@m_"RE*\[[`FBHW8$!3`09Y(OA%@K(AZ'T0:R9L=`RS
M_8;V.~.?.')1$8N!5&'M.TS[2H[J3`02Z$./CE1`~`8.A,Y"A/,!2"/P"(*'
M,AT`MF,*G#R.B9J~]OmP9M#;3(&GBG&NKB#`\2HDULAPS5T"m^MS4:H?O(9?
M|:+~XD)`P?(Q@RPQ_KFI"Y,8CH3F(LK374Q236G&MDUU9:E@*@'ZBQBN,WS@
MY&1!VHG!E+,=6&J"3:Z!+!0^;C3QLV_:=&,P751CQGI0N[\J^6"HGJ'[)R*0
M=B,~&,3G?OH]$H*TBmZEW`~&DQ"KD_\\SQ.;C9U,C%00G&A4%+O8`ZHQ$`G\
MNB7mR;mRVL,SEK6E56XM]$I1KP(D24@TPRD;O,L=D:2%K9!'3H^|J;N)N|XX
MA&T:0mP=TV$`|DDT`GH$m;\?JRYVE%/GF2J"Y`B`](J:V^AL\/@\3'"P+0P@
MIT#TUB#NQ\:Y5+08C\!9SS)m:UR!S_'\C/4QYPH,S6&,ED.1H8J0J1'&\"DG
M+4BC*7=C**mHQVCG"SB;[S];\E38J#YF*HQ@OB3ZSm%1~P+^WV:#VU~"&L*|
MUU|MNB|G^KVX\W9+9*EH69ZE!0)DL`7'NLIA!_U+\V7JP[@@;;Y[_^+%P5_P
M.3J9\H3#S:]CY9D60V?CONBQ%m(P!6)T"_8*&7/4(&Z#@(:)ZHG1?TBR/\V1
MK28`V*9%]JUQ8U0V`=!XY'L5U(A[XOVQC#R(+S~VB*,ALO*,B:W)P_EKP%B4
M;*Q1^Q("W1D2_UQ.+&"1[SV?,8(SF.~AH!"NA`JW32*&[U_]D7C05W[698*;
M?,!8E~=TBRD@60,A4O2M.m]"['5"E1%@5W;=mA&:.U~'JR2NNYS9D,@:A20Z
MR9X\@Z!NmBH~G'(2/B_*Z94J`)6B#3JMP,4UT:=".O`.SJS619;):7T|7\DO
ME?+$I)%(\?Z@6R7$KX:3WmO4IN)]~G1T_%[P$[JB6PCVC^Pm,:ZS0`\D6ZB7
M'9KM,C8NFN@IW8_|$5:5TQ%E)1=82M&7%UT2JQ:A;8=UQ01_BVP7;_;?OB!)
M:Y]VBL\V`6$&(3;OUJIRS3_2R1@(=ZM/GJZF\Ym,T+_~V1C@N2U;3~_RH@\V
MUC|WT09;;EO3m~W+,WBHW6M$';N_~]_N`2OVXYQBYW$Q=C,)B_ZXYGY]MN9Y
M_`&GDAIRV+ES=#%7FZ"IN|XVOM%9[Y_'.RE"BFAZ__#8#63W/ON?W!D,\:Z\
M8:)Y,H__DV0PE+[V|\K@$`*!R.J.L;K4,&3$8!|5OJK4NMYQ[SN[.T*?[MWC
M1`!TKm;7\+C5$M\VWNL[TM#@*WI]G~[LI'F9=5+72B@=RQ?D"JX.R54(!?E[
M]\:U0S].4Y(M_?:PH::!`+URSB(LNG;=AD1*6^KX^/WQ\1;^./K/O=9_;+5^
M1\V|;+95W&UN[ORX|[92P=1`6Y!M!YN;*[Z7$mK3^_=KN[VJ2~UYOm7[MZHm
M6(LZ+U5HPCMR(E:@=I#m@["\=EL&M'EF76%9Z^D]VGA^$]^TR|[_']ADP:9Q
M|\AS:OY&N,?2X\_Q2[O%?N:_L"^YEZM'6~OO)ZU5^H66]:2]^K/?Q;]Lm^D:
MW'8?K|3=/KY.I?[D~*~Z;G,\#4.R(KZ&AZ*[M=S.+LM)O+V$Y?+WIG'W|!(Y
MS=DNQER1;#1A8PUmGB$1`3;|]3PJ$KA`23J`+J&O^G/C[7O0~mN]:!ZLRCX7
M@Y!)UA0^V"!7](=I)OUX$M]E%P5SD0%UP_4[[7!QP7#$~ZM2F9;$]4'[^C87
M0X`"Z;JB9G1PF([NI465)/B,";7L0L=9O"m7#^(!7&X=2m8.0K/^+C`B2`UL
MG#^N7B!W~+^L^C@*8;8VSOD,DDR9MBI5;+?JY+3VTY5[C6?/|),IP`O]%L8M
MKZ6M3VF'"JY06THYGKTVY]2H~^;9(AB%L]U/ZQU$8\A+`SB,LJ6$K3CMH%EO
M12J5H`[9IY=%)@(mM]5,8]U,,Lm#*@_*C|0F:@GR8#_m.J6?(L2'mQ5Z?G]4
M=)+[PH^UL.[)_~%%,6E%3]2C"/QKRXYCBX7|F(2W4|(5E_.[N(+R;ZZ.;(K6
M:#CLUY:G]V5R7Q1]~4L20m$#G#ZPZ"W!ZTWN@\:Z1F$U:'%VN]HVV:A0RY+N
M)/?OVQ*J'JPJ|XH(H|@)6(V#YQ'|:ZA@:R:L*/R(U&YTH`1UE3\[93W9JV%:
MDSPK2K_%:;=$/,.9/WA~|KXBT0EJNC[12JK@8M^N$989_@%Y(Z5=R4GA81Q*
M3Y[8U2$BP]V\T\_&3`RQ[9J,_J,'55BH4I#P7;6YBNA%+`5V:&6U)M7E*V8]
MRES~GM!!J5;F6#^_A%mM[:94]!DT$SI=7::_I_^TGE+MQ^D61]O:Y1VWX\)N
M';;4H~9M+9%)TGZOQ/681#T|F[L+IA:ZY^G%2&XS+:P!4!(?:~941/X`2DFI
M*VT"]YVI+72W*.G1%2NWAR;XC?6~@AI8@S3mM)|/.L.N.(@SX#&)B#\~_O12
M_'\G,^U73!C!'9Q#"N~;|)Q]Y%1S2/]GZ$PEY_94[3452)#U7;|Q_m3L+O)~
ME;E(]PS#81#*TU*,+G^3TLG14~@[P'J@=P[m295SL=MF:ODQ638'm^m5Nm1T
M4\\T*LK1[,@98F_XV6Q~S$1P2B_3[G,S?&S##Y~1NM#2LRT!QSNA!3`L7OY]
M+A!OI8@AX^").;1,8A!(O%(O0~HKX+"~O7O]_O#%^U?/Tm7~7`\Y\6O':(+|
M2K2H|B*?O7NS]_;=?KK~*0/WG@CImT+Wm~^C27?*"`P)THR]R^'Z_m%G0^8~
MTC"]$PDBHFE%VU:D\:!#0^!RmZ,;/'GR8ISGM9_0;#Y#R;MZ*EG_Q&4;$%P,
MEB,V&D4Y4.+A(!C:G|DGQ3H0&%A,M`OI1^L&'D&[JEm2G7&9ZQKML,.+O~DB
M\_I0_5DP/][AQK4)QQ^\$N^|$`ZBBA"Z0G~0)5$!"Z+C7G$)IV9:8$")2@\;
MF&5\L&E1]=P5F7);&ZHSADETS*5EIV!+22D_,JP9/X*!4285RLLY*[_L1"L~
MPKP]M*L)R(8*,V^;%/Y%V,6\1:KP$HS|H,=D10SE&W_*QOO|Q$]$S.CS#[1%
M]85=F^_R=$m#*S0)M"Y^*',WZRXZK9]=,W|I^]N9;A?/[&XT|#NH")L9C\UM
Mm_A$FLHK]07&H$ZGO9N&Y/L4[+6H(|X|3,~944\6m6;;7FM'Q]MMX|#S2\KY
MR9PEDC.DQm&P]38VL'F#"X&KD++HI#!*#M=!|~YI3`_1($]JA`WD+MKJ/E_0
M:?K:9m@^TU,Im!EW?=,|.R=CZ:]SN81I~Y?Y`~Z!|W3DB)]N@U[SF0XYHH!.
M7R=UE\HmmTKX[;K+HGJD&Y7[2EK4QJ(1,T%I|DN+EE;JL%?F@BG2m(?A[&C/
M~G1CET`402ZY]$FZ11QB/77]L^2,7P%@[8W3YCJU~/JD7QCH0F_U7V5~Q=%U
M9E*mQU2]"'@HHm6$2=^mE_289D4Om822!2@:KNDWSFOC6=7#Y*OT^4SKX~U5
MI@W[$J[F~P&:UEKR%8\:49R[?#|D\P5_OW.J*Z+U5_"[(8OA:J';.#BVDG&@
M!CG,FN!m%;1G*)4K]@QTG[_!YV\I/"^K6D7B6N1?6P&="K[N6EMTGK@0ML*O
MQ$W^NKSD_\]YQX"]$I9,2`A]QM"9A!?[?XX56["/EJ:`2U,YVYU+TKC:K?T%
MM]NO0J$7]'W^O?=ZX!+QB|.`2m$2~"+P\@ZA~A#!4A=!T"5'92;J2L,P'.;!
M#O|#CCTQIQ+!\A!QmG:Q8X_R_"+O7R5YKU=T"FB[9I)G22K!|NAA2)'\RY"5
M/6CQ+;QNWSE$A&?OSmPY%Q#!2CL\!+&7BM?mC*W4E9YG*/V*m3(CC]5QC$2L
M$YX53@S."A)H@K*RH%FG^0@[L12V`F='(]K&'XJP5)X^784^W*`1HM[.3"`U
MP[E$ZYJA*XP)WVC,$"V:B4V\P7E/[*;WD'AmWMm?V^EUNO_J~?HY??WV':[(
ME9VH4L0_5`!C~2|5'IU+@|Q[`5*XLZB8KQ)[);J=QOA@:*|03`~mV[H(43G&
Mm.,|@Z`.9Q[L)?$~D@$J*_Z`)I%UH~(+HCX=65?|,SDDHA9%`HZ[/~CJm.^9
M:**@3`M8)Z~'2SP#H_'#`:`*`\#+%VV~LmEJ6:D(UB(\VQ%SLA#+8ImY(P66
M"`['O09Z[_^:5Ym6V?Q&)2E=,&AUI1'PX3[2PO)+ICK0'MKIT&40=SF&7,E/
Mm6'LJM\EG@G45=;`E7S0N~+Y*W,W@|3(C8HPBL9=8P'F,&LY;=KA4|FX09J%
MF~TO(Q#mI+Z^R]LW&RUI_D22N8V!;D[SY+)0FQS$#m$.\\PHTN;$F9/4:\EO
M=C=U7PH[7.&?@[40N&%~:L8;)IH*1]/m\\E%?TZ*AC|O]PY~M5&%".X;UY0C
MN?+((;)4R@1%Y(EBMBRQCQ6HQ7]_/E*+#8C=!8A_GHYV=]*|"NZ&|"GG\B`J
M+(7N?|;/^YO7O,DWK~B]S^?Z&$4M4Z~6_DI?7U\SL|0CR=#);D72B8TmF.7Y
M]VL!?HD;7M~F86O'S_X$Z7,GNZZ2?6OSN@)"$\R*^V:?KJ(2OAF?M9WKS2IV
MC!L[WD0`,GN:71C$ASW"NFJG|FENCXZP2R9%]PI@W8.9;:6`&`F?,~^NZB`B
M,TNHV(+F:H[QN~@m\O]*&_|:|LU&`UUKKB7|R|?25]ZT[K?'|~'DSL+9ND,"
M&HTD;?U7VLK*3V@@^`4~13P]=SC%JLN\=^@R(F|&XD',4T|4])K?42$L+Y!_
MTR'_=8|2+V`;'m|;0"ZI);4"X?+SD%&G5]&Y@"D(&1P'@QQ&BFQ|T*U"]ZYC
MNQAQ[ZQ?9?J`ZQXT`P8EH_7L%@H'E+BTFZE%|[$S/7.ZWE)8):KY)[8WL@.G
M):],#B9RE\E'U,04M,K(R7HG^K:m+"m1L50IRD1AX)"]m!M_$`0M^F8^EGX+
M6AI|R?O,;`J\6YBG&1QR=@HXP3SY.)0F!+I17#35]9'!X2V4/|2![\.HPRNK
M|"&3Q*HPCUU6F6NF_~ZKZG|?^F**MH"8;K9E%V)*%9N8M8R)(WY:|@G1?+@|
MJXS8*7=&ADUT!?9\,/S83#@3,CQY~;,I8+VEm7=~],%*XHIFLQAG,1\Z2ST0
M#,44YH,1G@E.I!CK4)ZC8@3`Q8L2/@I'`FZ8=B3.;/D:C!'88;]E3G/!GK$C
MQ)@5R.@]D.O4O5~7X:3!]L%"HF]*QCUPR9|B'V=K||TYF)~Y#RHRA]=@.N13
Mm'&MX:@,7815C+&@CF@`"9O\m%&7=S5&||.0|_&,E:m$m%1GINP7G?SD)&$9
M"~[,9CADY$MQ[QYX"2N5O.I$B#:N73Z?[K03KF%"+3@Y;6]P%8Q3VmNNY"_N
M%1mCE#CA[83U6.8?H(9/[P?L\O!2JS]4K**E9V$GmG5AmEWX;9=)UNDP(JL4
M@E`M0|S.D&WQ4T0`3\M),9G:\=C'PEN/XH]RMFJ!)M3|NX/4.WJ!"/A]#ND6
MT*".9"|TFU.!S:V&YE2&UK5(K0"/T.@],OM*!!O*)V!Q%7_4V)C'210Y`^:"
M_6A*~MSI#YD6E|BG)O"D'_()4Q;A"T'GQF|"Q8O5Z3\ZYT@R|3I+`=24'!,Y
M.1YKW|\GU]0N%8OF,;77Z4G@.QYT)3D^10\_!Y'|U_.Z?4QS?G'$"JGC=A?:
Mm/%.5R@KVIORmUY=KYTDR1L4Q5;.3LMA?SIAK$K&L'4,OX%^"NB4@W.D33U"
M():DQ|8]DCCM+[=A|!L=(E'#"XLEQmE0?0MBZ.F`#TCP$*BN]Z\._I+FHV'G
M7)+|QWVWPQH&R//)m/)K~%UA/%+"+CP(`CSm`&mFJ!__8,20PWm?2V6=GW\V
M);~]@*O%D|PI3^G)R~JJQ$Y8ZA|7||H'E&,AM#)O~PG*:RBB+9)72Q*L%\@X
M1X+/OTV)1FQ_W4P?;6U]UTRWOWN\]=O'VUMmC3CI0BSAPZ#~)Z|864[G86TC
MB(G5^;6HB0DQ7F40G\`K[K)?FU)'=A8/YMK^ZB!~=LSYUOW[*1&XZ\__Z//_
MT8MS!A?@V3SM?7[!W[Y.']B#?1GK]?&Q*WK_KZWC^Q?TOVYZ?/\P?8#!MK:^
M;6U_[4:,TE&QM[/%*F7P+RC#;R\VZ0W][Z_RH6\WM[_~1)'X.V&IMS.E*D7X
M,ZX(O^QJ'_0KVU^C![.?"8N]G2U6*|/?\67X[6&DO7P0M?ZVYAV_Rm*PX@/9
M:G'/LC2L'Q71]U';\I[?G*;65W[#^]=U]S2NAI?\O#/3'#9^&BR_;^m37':+
M9U[~Z6ZB(^~V97+|R9@L?JXYNFE\=*^E:KC'M2F|`,U"6"5N3OOE;AEZE2*%
M~BE~2NYOYJY8Q2"18T9#)0[9%0MY83!)S"#+78NK@=A3]DS441`5$UHZ|~3*
MH=D~_H|!4:'=:_9N#$.mM+AF]`M*!IS1|,3A7KCKKDJZ/Z(,5N]RS,?D[V4^
MD|D`.22^/"OZI:30`P8^M4_7/,**+XH!W2(|W.NHNX5Y@DmC_:)7\^03`&:!
MC&^@+729[FY)#~6B5$4(00MLXLQ$OZ1T;QC42GS6QX.~,ACTCAGRN,%_RP93
M*.&WXT21I;L/$LG\J`O.JC1OW"PDGET[;,U/!\$'BHF#3]'[$\5"^'L,!+VO
MZ9VY*5[I9,"9D`LGTHAPS[2N~(H5'/`%+&D9ASQ!EMI6`G`T*R52&*`%[GOB
MYN=CGG_0EH).3`!#Z88AE=G75(NS$W5_"N$QX8]N.`QXEP#![CQ9,m`4VY#,
MQ9/H!R9_0BT.DG|9|07!A?BmC#.Z)1]M^=A4D)J9UA)MC8K3HVV[4U&'&_AZ
MBQ_]CBZ_%Q8UB5!KB|H/V!?M,G,R%QI`7FJ0~L920mI87VLFL)E|V~&TI4:M
MIF,3$0%1`=3O]6CGFT##?T"NS@+6DAm1m!YB75L[:4M2I3%U6ZO!YW|P;E/Z
M~F/;(E~7J!$ZOE^J'S.``|7GFX3.+@+1AX+|9P~Z`51F/~EI8Y7^Xm.?mGZD
M7[M0L#:~KZ6mJ`L);V5Z\],:$P?L0_KKKVNJ/K;88)F.)@M.:A|0W;Y+6C(%
MYD:`J~"[F_KN~B]6ICD,_=!W&4K|VB;P7`]\R,/(~&U:Z93R=\4XQ426$P~C
M1YU/=)\;G(&O7#!C*4/7(V5''Z?mm~N(6~*(F=_I?&_XXA=%=P"%`O:PP;=F
MZ6D_@U6%E03F+;]EZ/]A6&HH+N#NB^2*.2X9]?Y1NTEDV3Z#]G_|m@DM,H:O
M^$MXA4Y@TSM;XM&:^|=YXW0)A(U.Z+ZAZ,R\;.W~Q:0\`I@9[+|KQ!`2`T7L
MX/U#!I,,'KRm'^A?%YO$V!$/X\J[!V_C!_I7EVL'Y=V#M_$#_|N*V=O,U\Q\
MG4Q_GMK/U#70T9^?TOM_L5_IYU~TO[84([@,)![1YO[m(/m#~`=L(!.G7|`S
MNSQ$K~_;%_|_N5_2^_MX_97H5UmV^G#!PL[M^4`32T0!.D]&DWm$BVR|/UTV
M`~#+(0(L&'BM)WZY0E=I\PMKm7#"?)`94+_3OB!:]*EmY^/O;6*V/M1AW0(M
M^CS/)H_Q@6*R6KIX,@E@"=!4FG#~9Q&/OD23/D!`X~%_M%^^?O;']O/]%P~O
M]I\G|SZm1(B'/[[=WWO~_NG]X?Y?V@~O#@X/]EX~_,?^VQV;S,INQR#;[""O
M)T+/C1,CH]Q2.`#.7T[=YX`R'OCEA.7IKm!;_&"G;@W0F%S0_\L9Q&5_00~X
MQS\'PX\HIEV:5%L;]KOMR=_M4YR;;B"@*N4YD9ZS3@?N6+S!G*|%'*"XSHN]
ME^_V=\)79\m)6WR'])WZ4=L@@6]UmQARX*G#.(87^06UWGA@`]CZU/,Y8~6A
MNm?`WQ)C:CAP7&;*~9ACJM],'\C@S~G(#A|@|O5W|SNBJ:36]*%`00JJX[;'
MDm3|ATA]R`NP^@]+?JBYVIR3RGKY\&&8`!'#IYH#X&5SU17B\HEJ?KWF6]=2
M/*_AT[1R(+`A:7"R,]WW\|^MHR:5HX^L1`7|H@%PT[^X3H("5K')4_(P_;J9
M;@~mLmC0|`\$KC/HK=N`[!2(M=H)Q]?(90Y9%&O8'N!OR6I)99H6!L'/UX+~
MG](D?'`?KIUW6|72"@50HE'U:_7XHN7&|L#QWUU!.VGC;LZ0G?F:;!0|,K0\
M~OC0UF7~*.~,CMN(QA|"B[JO.=AY=S@8m'1]U6\'=\B0J2I~QTJ?],QSI4(0
M\mM2:5OS*,JG'CZ,/O9PU|^FO3#P68]X'W~PM1KNU]E:J?;6D8K*`A9EMS@K
M)K[5Z%3XCA,76+A9#?:DP:]J*WY$'G8V^mI=:FRMIO66_AJ|63],V@CV.P!W
M775/ZW@I0#MY$|3L:GZ(E9U8?BR0L',R9'20.|m.1|Q;?;?Z./)]|\N\0;\1
M]XZ4PY6~S^SWL+WCU44mD@1PVP9_7m0~A(C;mO@\:I"?;2WJ,CCO6W[BIX5S
M,+SU'/QU47NL#5BZ096NXO:6W6;Q1M=:?K=RC@R1$%F(\388V9)I3\QI8S;+
M!JW~:L|NG`Q,;G`Q+KLD6./==/L7;Q;~C[7?7[Bm|2QJ:RT^33B~M=6JA[JR
M"V01(RCLFATP'0B,'J]3=!%CG=G&(,Y(RmT(_4.8,'0G/2TRCQ@QRLHPK_#L
M*.R~TP~VI^8/M]H*3V'8"CVH;26:ZVHKLGYA,WA2VTZ\Um$KNBI*,`J6R*7Z
M%3ZQT5?PQ._UFL)ZY=J#X!*9V?YWHUD8#BHLX$SYIT';*![LG)F."+*\_+/+
M~O;\[|8MTNT6[4;\J]3B\Q?U&T_^\8^9~C7GmNH_/5A;|@37]2.X0IO1'.+)
MHDF\JO:"*RP[C8O)5QV9FOEXS(5|UY^/VBGVP[K]mmRJ:XO'.6|I/L[TX~,m
M2\$UGH;[[^.BM~#BK=WTMS=.~+"_%I5M53\m5_+J%V\8=~T97M@_=V]%;."R
M(YFS7X95~CJ|0T]Y*:,#;](':.#%!Q96*K()Q*I($D64*HN7]HU(5)177E(,
MQCD=E#/2:"1$QM+M=#`KWZJ@%+$SH|*@F@5FLCAB,5#)!!%0B*AJ(YX*|mYX
MT,.3O;|_|)J%TOTAT,2UL:HU8?~F|1#=2C,m!"~GV)$66T^'HS;C#.VB)X=_
M?;/??O7^I[!`&*6EGZ3A4.]D2*R=E;ZNE(@2~N!T30\BJ|G"KW9G8GN1+8[m
M2I8=D)5W[&+0RPI@&:~/MK[^#M:IKQ^U3HN)VA=+'W$E7|66"^;9=:3:#]/"
M|&4.K[8G6B!6$W&)J(W9:mY;^];(%VN|:YQO#5L')]G%B!ULQ#4B](AAZW+/
M69?5S|m99*(V&;R#m?M)]%Q0m1FSFDTZQ_|[$?"J[X/8#0(OFR3TLEG6*O!K
M6`"DZ[$)('A68P,(CF%0\)~~0^G/Z92U,&=3J#OHCSX2+6JJ*,$(QUF9482:
M0A4OYZM;9]2LQ:`:+,EJE9O.9|'G4KX&C1!^WA@3B8,B58SZRE&Y\m4K)T'U
M6Z+4O'`#I_m=.;~S9[L[S2US^E!S?PI"!FX1:PCB)5IG52[]HL~3OP=3QSQE
M;"&(0+(ZHBP#R`5:2m?3;_0=KB5`VW0:4C!(LD,/9C*;\|G#FZ9;=J=/U`]R
MCU'AP0.N]T1+VGP&`ICV;7TW?~1JZCmB7+:W'GWC&1Q~!G3)+GCIO,^Z5m&/
MNE!'*L3.NS)$Z_=:J)F[2\4"S6;]EZA,Km*|?YD(!')XGS@6+[Q@]!39(^ZC
ML3`SNP[=1*~J&_`F=!3O&KPR%P_A2TCY=mP_)A9"T#"4EHM7#%/N]V]?MKHY
M8XA'[](&WCBPIA`V3'/;/_OAP$5Y9F5BOCK\/?G:|;~@7N9,\L=7GZ_Q?Y4~
M7*_=@CK?8(SKG!6;]#]GC)M'S&OO~H?!`DIU5G@RC\.$+C4T6IG74L*G&@\|
MSD?=!:$UX_N!IL~MQ@K?#N&3Q==#6#(*%"X&!C"!P&"Y`!1\0]%[],QS.E|N
M,G=WWK0O,3E11[B]7W/'_JT|#FP+m5R20/;m9L@]WK|"SY+&KZ_9F:`@YI*S
M6(Y=7O9_RRZS=_SY]/7IWY!mX=50DELDC7][]_K5FOJ`55,?H"O(?7`=)OR3
M0"*YJYm(@\2.:0,&(H|=VKHEV0#\7V"%L#KL6\$Y!%QW&3%,4+NRTOF_(04.
MN*0_14U8_:B.`U$_O3*]J3B6:5RD;]R2'Lm71H)CVm_(??+B.LDFU!A55MSX
MF2;4\C*O#;P.&MGQY;G[@Z'E$A&O#AE.T_QA!&3=VMJZYB2XLW/3R^@VJ9F|
M.5,ZY.5G=\/%T\,0CV7:*#;RC:9OS:|&E@2T7)OQ3Z7JVIRYX.9H#'XR]`/1
M5%3&B.`+3ICm95WPJ`O2U``1JV"E98P^|~3QY^mKS1WI,[CXK#;O#U^TOAm|
M/G,JA+~CVZ\)(_@!ET$K~LQZ1`7TB\Y$1L$mJ=^C#[V3/"DM;5^=//.mLXTT
MNF%FHWJ*L4Y*4|DBL/?NV|%!PKY$RS/W!Q/mXD)=&A2=W(+D.8?+$mI~YQWO
M(D%"[$T4X)M08G.MS&JI$/.ZmE%`EHNX,0]+=N'3/TI+4R.Y0FQI=m+EQ/&^
M$H(USAEIN,,^F:!9:7`Y)S.!~UD4~J,#D^L:~=Y\[(O"(EA\B\N'|W+B8L+"
MR]_GGGZ!^0]|_ROQ*3[1~!=0^X(ESmL$[FLE/'&G17F.P28.5Y2D/?%DRS0N
M#Y".SH,8GF'4'4](92_]^/R%)S*E|W'UC\+ZWL=X[\T!2`VZA*C(`;?C7VN\
M"D?!:4.2BJ6XN,B+KN0`4F?4|,^@S$9R.'M*\?6@3_I=QYGP.K`'+NmKDYQ1
M?LCIIJ$K"L%*@HS!&SC`P&0D\4)RHKA`)IR?9?(F1!#BN.G:m`AAD|%`8(^U
MW[_Z8Um^VWO[=N^O^OOWKU^_U%]?O?\IN8YK+\BS$)63/`L5]Z6X'\`5BIXT
M+,~T,#GT5WOO\)#8(\QLJ|!N2)F,OSEE,LL/(BAQF4"`O*OIVOEYZ^F'_`I(
M~m.+%:~.5Y;&1NHU~7.KXXJKKX])6Z(!)O7U+?`22!,V7*U*/,=DQXD[O@8M
M7Y!VM";ZD$IWIO3HDG|S!_F41N:#T$+O!CX9CI(^TL)QI*A=B\T01E;H5|/M
M]5:0@=3E2Q&FG4FI)3C*D1:(6Y1(JX%|~VG#^"0BGIJYQ%W";m&3FS@YS7L(
MD%)`VC6.4M"PI8V9?~:0="J@=+S=&NXM2Z(Q&E^\0R\GNNGB;2KYTX7CGLVL
M'NQ!Um\mEG|M%HPA9ZX~K9J$NTP^=Q:mA^,@67PEK3LGAT_CU]A`4=?PKSHU
M*IAWZ#mWN&mmU['9PCR/7%[F0DJ9+7Y.TZLGYCY6IR7@;WY~_;\PR#OZ|DJ|
M`W$Q[?^:#FG'N~'Y).T*PGAGWO@~K]:]_;*YNG9S%4ISJJS`LR=/]K@&;R]C
MP("@T.WA=N=3.0%6/]4Y.0EAMK@1IAL'!@LBX2W!B?|\~GC0@!'=.1](L`$\
MMH^.H/HY.4FDK.2M4P_V/"`;(~O:G.%\,Y,=B$%ACA_YNSCN";(1`S$K@1*:
MP5#0XDQ~;8QC$'QWM9HYD|45W6/WU9BJU%SS`6\3C:G4O,327TV2(']$/0*E
MNMVRQ0B"X24H|'Q*B_C"D9T?TQU|3'+=5`$Z~9^M\,@]:&\MU5I0_~BD`OA;
M7PQ3$6F^_!Y$X$3(R]"BB!S9U!DVF1|S+&'L"#Y%MRO[,='(!2XD8H6EO+*K
MSH*:.$@=3|P3NQ*`:R$/I%_P$)J,(ZL&0]9I.I9mT$W`I"F2TW!\@4Bm1'*)
M|~`17:OG^:~LFW|*I!)QP;\DJA9`+N,'[m=7?M%FJ5E\VQ1W:?=`?:U\";3S
M6\:*++4W%I2|C*?YG/5]I9H(!Y?NHHT#m86LG`34*|B#Am+X=),84#(3QCCL
M`*R#9C"|5:UD:\M;H9MS#"1+7I87H=14FE9/~0P&'7m\D=\P6=0G;*4$_F.E
M|R!SJ154?\2m_/)5)mX4:OP&3C][GV(9G?=GN88;+ZU8|.#@Z|O_/BW3A^EV
M^EA|A~&73"6~TLOM5?;Y[:9/Z(_?K:ZA:;Q#Q2U^U[C;/=H^P7/^B1|;JVON
MEIWU15WS!@AM:(,;LC)H)KBDYS|0mI'SH/6/_=6*RX7KV|/5J*.MU=#3HAMZ
MZ`9NNm(AE\%I3E\JOBQWU[N!EW+=H2A=U?CR5MM%X%NLLVWMR0KF4G8Z0!@=
M[1|V3/%_+D7S.Z'+MH]C_""7[,B^:_G|KK4U=[D|V_O]?A~YRA?W5,YQF"Z5
MSS$K2_FB[\;(&'m53Q(A6);3B[P;E+|0%FIY1T+mL(WAL]E4[!F715+Q2QB+
MQ#[#"B,1F|\0,DI,!VS.G))6LR~XH#8[G@C]E?XE?*8S0~@Im$]#P~FVB3Y)
MVZS8J,E.*5KLKN"J@`((,m7'G(&4F)G\HN._@!\MU^K"@IQ$4U\S%G@B?D*D
MGGE,Z,JJ&1;.VMm)[[NV3E:.;=?:mF3Z@!"LE\'60S?PF2E8;6V!T~_I8|,?
MC]*_!1m???WDR2'0|&RRCXZF'4DY&;*VLE7=+37;&7~.?(\0M/(%'[EALF8N
MP)N;9H)/77J2;C_Z3D@E[T%ZQB$9].KN+CX0_'%\S+1M3F~FD'"8P*@G,UIB
MSP'QXCU5?]SZV_SX^m0\EYR=6"M.;J@XF5~Q=T/%WKR*@QLJ#N95'm]0|3RO
MXC%7E#]6@M\WZQMT&P!+LK.H!*]*],7(^7TAJ3X^GM[?^N;3RFPKPD5;%&V$
MHA8GALHGX*8+B?+5[&%,5(L(/#,ANCEEKWEm/1,J@0UH25"6mGX=MQK6KCBK
MZ38;3HmGB^VF0|%_IGL;JXG*||~[T%QF8V@%\,`16'1F*;|8~,5H`VN+?~*\
M&\m\T[;HK9B,ZA8:Y!\;*[;!J=LJmX+Z0KO4*5M/6|,4]D&\(,?.U[U6D?$W
M1L!%*:_NG"E?@M9JT4#VBQTO7''VLI#"'#$E/I"NY3IO0##(VGmNEYN(Y_,7
MN\F)I;KB7!';JIO.1$V7.%NN@19?m5MK~+R,`[I0;`|&=@XJS]BRDXHM._U"
M6W:B`!m56_:~62C[?|GB)4:Y~29mQCG1:'XJYDRF7'^|=W*@3EB&|(%_Z:@N
MES[VO;|m"WJ3HJ;8U[:EW_8GQ$DQ]XOQ.'PG)F%^Z;N=1%;INm~PVZN8.6^P
ML(?[2HE4~B],E%[|SLQ66BIU&8CQ|\0#CHA$,D^YOmWR+3&^O.PP^8DE3O`=
M6|8=`N@.KY^EC2!)Q9J(L]P#P"238mM,!%YF0!4X6V`Sm56%;#V8!G*#R~'U
M_[~I)%3GNRT8V'E6)AX*$E'KPJ+J0$7A!G3`(1OV0ONA80)!0|*I^OJ`_1'Q
MP)DB^%XQ)m=8SXA$9093G47Y#G6~$DX2DLETL=%,8"D%#HQN+8]^S?C?$\/)
M+!FS6QEWJ&20/3!#)DTQQ5:G7EO+!R;7&]YFYA.ENE1OT?V(`#.VW(DY65$5
M+X?]*:P:=/AA,)VU6mC5P[|91EF7,F#YW$$VD^V9]B27$mT^E=04=9~*B|/E
M*.LPm^U\X8UQAOA:5JQ958^C@X&H3;!HC],?LO%I1C,BQE5~^A7G]%ZAVFY6
MY@]GSO3$4LYZ/KKY@H|'FD!Q\NZBM:3&YB10`O0EEY*M"V|)IBI]77||5D/O
MY\D3BVU=^[M)[2SS#(O2;BU9|FKW/Q&)A^#J9A79'%0_+:"?XCQ#=\|5F\"9
MmN]5SJ;!28GC!,B&F.@VDE=LF~N8HT64S[`[%*C$2EN"_X~,E!=7O#KJOI*5
M[,DE(m)Z6A78(Z!%^@7U4~P*A$9P!I,H^~&|^~4]RBJ6SZIB"9$;AIQ[P$5J
M\P;J#"*F+O1Q3=SFEV7[I6~'^W6]6N.6*P$@P,X.0Z*HQETV6T41XW5I^JJ[
M([?=P::5:VR/.[4(`Y6~/WQ8FA+L.HE[L1+TXG9]$,4$LP|~L:$"6)#ZY?%A
M_Y$#KCD%UW.]=9PI72F,`RQ"U9:6U+Y+_`:3&$\LN~"#TC/(|U=\P9H'JQ[.
MW^m?L(J/YR^@^]:U&UV8~W!`U[B8EVELQ%8#L.%!9[`63`:*+[Q".@m_@VBT
MDEN5F*_G^|/ZV6V3CZ#%F!./0Y0:RDTHJ^NY~.5:`VI6`;==AJ`EYHS(7E@5
M=Pm!+BR\&|%`@@/P[C`U,NL*G|].A[m.*mFKL7L"6)~~H4L769|5?QDGK|H&
M5PG[EC(^K'+7QE`%"M"B%WJ&@E=!!P:^!\2!GQ&;%F'D"S+7*~?^178FM43~
M2#"/;B:8G#6E^\D%%_.m2P^0Q?'HT:.3B*AZZ@GS?F|PQ[I/1=/H)=OVL47m
MM8(^VAFTY;O99mAO1'9ZOYEI*%KNZ2YZ90=2:LHKV\.6YHR=B_A\2`B;.NW0
M+]LK:[\RY3_YUU/^DR^G_#7TN%0EE:XX;`JP*#Q\B,F.J.LL^7%U0'U^&?'Y
M941%I=/P8$T'~D7UBPG2"92+#LQ7FCV^*mM0,';6TL9=_)?m=#*9\A=^[/(B
MAG^=1'^!&0CADTHSKS;3;]9$.|Q?*8^^,3m:)7_JS`9FMS6_?^N3R(85ME?6
M/+FN3N(Wm9m8[;!8CIOI;^(~_^:?UN.M13W^S9R[9,"UE8E74NG$P`Y\$N!]
MS10?5\(XmY=V!E\SNY60;093%0[6[$BL:KW2;#Q=P$&*#PL,8*,@XW|@`B=F
M"T/';J#1T82SDFW^#KEQ(:MQ':8Q4~=:!5H*HC^)Z")'R]C^ZL+M17TIBK&A
MFK):.9&+R6Q'~AVYG%:XH7%#!*?Om"L5T%2=/YK.12,9#)W#A7H*B)#"KH/|
M:T7C[/6'`@DLJ;WLSA\1|U!PD@7G,=Z'P?'T2CTT!E!~2,*.P=5'QH3ER6~?
M#U5UL*?(&)#'#"8LUm:^0,74D#@L.4$3^LKRH;D[T*[B)!.*XND;XC04.J/B
M^K1X#P1~`&*Y=R;_P.!~LGU;[3^!6)PO\A%P5SYM)IY)|WA$m~||8)_(Q::_
MN2X.&3NX|_I%IY@P|.SXM"!B/JC+4CGWTA+'#ILP=K\0^m?P#@XL];F~?^TM
MAI:K\X'2!?=JMM]S7!GRT)4A#_T0\AD_!,9ZB]T0\L`m(?[HHYm`m*#O!*+!
MW;AKKM12DU;H7S3[=%$/)EZVFC^V:W^+WE7"L9ZO+8PAJ_^H*7_EZ,NG*S)T
M**BU$0|+*Q`=SK5&GK;2|@X)SW~6N#'@V~TO#.UXF%$\*%PCH8CA8:UJ3|O`
M~P]`#:#B/1U~YDWGCW:6&[&#*WR@JAC3\2X|0GJ"#%2E);)!WB8X+H'Z1Q:Y
MY1ARD[@7S*L)P#|*M33)=7?KTG,UQ\YRB#NM,[QDGR_@%1L1E#M.X0X6#7~I
M73|=$!T?G@V*OYO"*]AXLQX2+C?[S'14m(CS?26|%C%2@"Q_3AP;?JPK!!D(
M,@&(,)RPK,T=2`HA.F+I+/YSW7K4PKSNW2:HZ[0+IWG(P*LS`'/VWOLZ,'3[
MO]4*[A]L!A!~B[X~BQ92]_3FNO!)F%.[MTSMWKS:@V5J#^;5'B]3~SRO]F29
MVImYM:=!;:'.GQSYEOM^J4~N#?I7~|M.;TMLWA!55?QG!@7D^V])O+_#&5KA
M,]XA%N%.61++V&N41,^_@30H/@L/V.m~(!#.VNH7A#3$\/II=)K:8)W[/*X)
M\9[@(LU4|`/B"9L!$;S5S14Y;:[,WHN~^,HI$CF^BL*S^%O$+Y(@~5$,A"|]
M7H$X(!]~F2.Y+&#/?S6OBR!:_9'WNU@N8CTJ~AO?BW!'QO^^Q"E#;`@S?AEm
M_m9?RADC],;@W_HSmZ/37%0])X"ZP1V(\Z3/Z"VHT68:E@3TT%`2U@~I"LNA
M+?DV;Y"I^mMHH+(@X:\)(_U%,$HA%,:,NF0ISPHNT(]~]G\MEXO)\+A]GG]2
M7XO38L`^%|8F9#ZF&#:G`K@3Z6E_~!H&LPF&R\=\W&(B&KB%)^I6[XW4|#05
M`|7BRD3YFG|^D(ANV?KX"^ILFH0]*#6_'7SV57`]SP9=Z'^)&QSE8TF6Z~U9
M_RRPHEHL"B*Nm/@5R_=.OR\^S5+F1N0)1AOZ+B62O3X|\~E2+`H%L%&`FV(`
M?)M'D"A_+6R*(8AB0[^_OH;6O"2X7@Q"CDFPmU?OJY"J=UXQ@$Q5??0H]$9G
MO]"'#ZG^`^"PAS:;`LB4\)'W5R%0;K~WZ*IKK&:K4L/S7^F3)[NB8W%E?XV6
M`\=Q':6'L.:0MG1UQO[%HQ(`)ZP73V0G??H4^J*'D.6]MIQZLO7I=\[`AL+4
M%72BQ4)_B[JE[3Q\:"T]V.4.UK3UNR4:&HZ|8GP@OUTGULVM!9?@[8'/B!Z'
M!(9^JQ`83T/"~!(A'$)EYI`@$_9BJJ)Q)A%52=F'103':3E%IEK1E5FZ3),3
M$H'BH;4F|;)/U,#"WVT^G)]]T"68N.#M`ZL,,K1**'JB),JG"]7T*O]2BL37
MH:m)]M|mH&E:ZD:ZI)D=(I+$.ZB.+GV=;OZZM,G4*\9|XS.SE,?(S#IV?,KT
M:2=ZX/"F|1#6;GIGW*GA"M_`A](L1@SG/^&`X?[FRW|6BLK.6(Q#1=LUN*SM
MLJQ/V^DO;DXICOCm*^3\QKGE]$(~WN'HJ`.6:./\Y,0Q5S6V5*0V"]WY@IS.
MM&T&9WUQ19,X%ND$`'U\AB0`LVA.4027,5`'YZV,QZ']_Q??_CRQ[O[GOV[D
M`&3Q?L6S]JN?,;?;_;F03OMS\4_:V'+\EM_87)XWMI)M)/7E'*B2T]%m]QKM
M4A)V^U~)Q&(;",N_=KMP=]UVX;]NW"XR)?_#MDN5C/X3MLOH(VV7HJN;I~CR
M1GFK8+V"/E]^'(Z[XLm*~T+'X)/O3J$H/GANmDm)OBD8EAN:XIm#XZ:EZI;E
MG:mV;(.$7Z)E;)=09?\]\Y!m&(85/?.YMGS&323Z_)|BK(X^8N)|%(C\Z?;A
M30F[/OID77[+LJ`m3V",.QM,?"I.F7(87$5D.QMG@NP;@B=S#WYI9`G';5([
M.[,*C7E:"09.Q~#U/,R"I5;/1BC?WPH.4Y7?^%4A7WF#=M/UT|~4LRNm/F(2
M&O2?]F3m.O7D":(=CHY*"6?3.GZ+J?.L5T*4X=|CH,VY:JZ;OA#$/E+#"H0P
M^CC79];@.2V7!,X9Z`5|Q.OL*.Z)^KF,8~!=N5\^7G]\O]^5_Y7R_RNS~JW1
MQ]93VD"B)T(.$_E;QD$2]&;:P,Y8T^|TL;mM1"7.J(2U|I9WAJ7[JUN,W~_E
M.=T?U/G9*!ONO@79?"EEH^$H97.`C;~G;8(+]/];ZE9[R\I66#'*1K\OOF&E
MS(WWZ]PSB\J*#1H|\:6.K0&,_IJWXC@_;CmWK+MG[`.H`GY*MY+!YS%DRS98
M[E#,??/Z'1#`/ZGG(TT[TFA#=![#"#L|).X3+I%\8S`|M()&UN)O_VOON7$N
M4^'T[O9@V;N.VL\_U=QVP?:Q)G_IY|6?:N,&Y:MH,#&0|=N2'NV?/AEJFV^m
M%LZ:~#1"/SRJ[2*||)]4APE|#'_=+J.7_&"G[MJ$*#V#?~N*"_`V30mBZAH/
MD%M3^OAV_X?V_E\.]U\]WW^~_H/_?/7ZW?OOK~m4T;HZ$Z*#6:7?\:"A(Y:&
M)^:94~US/,`Z^/.HPB+U_XTV`ZSI75[XO",C!N79,J^`+?W"&7^2WHM!.^C@
MW!N]UBP?3D9([N@X]XI/3;|%UZ4GO`.5^m$AI!=44:R+TM(0|SI!O;C'ZO@4
M0:YK51,]9O8LIRQ|#O3[+;J9[N/[`:329ZU8[5@N;ACQYVM\~AL_[+_:?WOP
MK$W]$N8C!;~1VN3D'B:=5R#X~V:3?#GE+J~GY:2&|NmQ'1U_AQ?%!$&8PXYH
M|CH2`?~EA%Q@:(/*80],L4G4:(;0)S&AYQSO|~\1YU[V,Z!Z:;0G@P`;YNIC
MFS+,!FVX:YD7%S]Z[]@UX'^[=ZVZ)O=D?JW/UUNN~.!NRN2;@\@$\F1!_|&]
M:\`O0H&@O!GGS|C2&!2IZ3^2W!O\)S|UOO@\.;^^!U|A^BY=E~Q30U,3KL+\
M+S==SXD;X]XVRF%Zm9RR\Z@+U9K7:]&'JYMU&JO|UQ9]U_I^=DVmL'mFU`MA
M`|\S92"+;I[DO1XBJEGW!]~DRKZ42mGJ!M2=8)M94.62B9H0P8`JJFU38'&"
M3.BN~?8&#IH0KL)M)K8RYN?993'D'/&`]Q4(,1^SZE,79GY#L4m_\'~:31+9
M/EUNQZ.~$2\]T!31_W)&AT~.Y+_&Z/"#Q:ROE?JG\R[MD~=~|,6M\V?G|C0!
M'QU?%m(X']C!D$Y9]DF8+[TG^7=|8,JmXK&37/F3;;5G^E@;!O.MQMK@0J:9
M1\[F9?BID*'BSS!CU1XMQUJU1Q7F2BO~R%X!2((7.7PO3Y;GOWQY]I2#."(C
M|)/+"@PL!WO,V9?572?REPM\I|L8?RRU14LUX6X9W,5:U4H\]9\.@|7"_FA1
MJ^ZMM?S9X*ME!8U,~WT609:Y/1`F/O9(9";:['+|&52IDC3|=ME:.%~A;M7~
M6S+P.DXS7*[J\M\B]8F|_K6YJWP[+KN&L^:^V8!F6:@O9+9O9*_=H9WC?^L.
MJFG96$["''KM]"R''2U7TQ:XZ5MS.U=S0'G8mRU[M'6R,;YHE\mY,"[L=VV=
MMZ]6JLH|N",G?TJ?&Z~IRPI?*NK16G303D%0@B3EmW3`^8"?~A_PRI%=?_CP
M=m&1/0V.ZXRG^^E:S6&FP6H;.F3TN;5=R0Q:5S07,E#71G1R;YIU6N#Z5A:X
MQRWJ5&M~IV9)T?II!3]QG9~,:`_[(9]:H.&"X73"P:R'\W_JZ9H+2*9U.MU)
M_*,(mJ**SQ5N#6V75?B#%IS*^U0*EZ90QB8QCA]@:~VZ9+Z|RSK~T/G0W4IW
MI5YmU*4_K__854G^\'L#=4=@"V.7,KR'1/6.$,L['K!?B!S9(5@]GU3X;O58
M87;O5KLVTY6J67_!_*BL/4,!*_0[IMY5J7UN=JQE;`@5+?X\=*~@SQ[BZ=?4
M*T(4($:Y4|5~^GQT#:^DYBK]M_KNNm\=3LK/),Rmm7K|QmAZS~2^?$m(HL2`
M$)m]@UK1RW"1~)5$XA5[YMQ*+/8=99QJE3@X@$WV(F2_4B$/%8!*RD#QWJW.
M15m\(3C)8EU5?3.G+J|X&~*V9^Cm[SG98Y0SPP426AQ^^:$82:+N#H\LGH[(
MSREQ^$#;YGE1,Q^R_2&=O8;D]+$`MCmGWI%N)#(D,|`S0B?B[Z7O6VE@)OB7
MBT~Z=4,!21_=*"+9KO_G"DDTA66M0,0BTS+B4=5O&Y\8\(HU0X9YCISD)")=
MXUM(/NAZJ%%NE\L(/J@522[\8%G!A[]2$9L6|94DVPR|mm/DRQ+?(YE&HH)V
M=*I\3%`9|V#m5?]Q]V6`FQI!UQM%FK%&EI`=!K'@4"LZS,[0[*3,SL.72A`A
M=G)E%&X+_NH"AN|9HV7]=42.8.)N+8+H~:A1U~mSNGJ_#Y8Q?8P=YH2*+1NL
MmN0D*A6WY?1X7GM[Q_WQ9%~;=8\~/L3~?~A2G);BS1m#6$1\YP`0=^GN/#8X
MS~~]!#\7LJ]HA;EW!mURWV)~?&9M8AP!%](!PK$22@M1EA+\|YE*,,5'^?!D
M)W@9_&JOTR"G_"U[PI3U(4:RME/?|L|_mT[[VD_V7`)7W7IW9@]GW9Z?L^]E
MH\8|I3VmMJ_OWG6XF=W^CWM1_?[,E^=QL5\|#7/WKKM~?CW6]&R|CRS%=M%?
M9._V#%J_$)BSH)HY2HA'J6|I8S8QF|LF!I:/'I@B?*),]0+.%&33#"AEXEBA
M5%A+9~*|QP5"2Sm+IP?_=KAOG&:!NEH8N&0T+B[@(~\@BD;3\6A8YNH00EQ7
MB%#,SL###^ET%#N1)'!+*,1]/~MS,KE)Q|_DG^;(7L^U85F=Y1Y_+.;4~!?\
M*BF_1UF@FN[QHOC=_.+@)34?YF,.?:.B;3^'W_LR~WU/X^"H|\MP5ST?7&89
MEF,(8K03OK9VZV]$ZEYO.$).;~G&RMC%4][MU5G?A=L03N,5#;=]\)JMJC24
ML",S/5NB+W&5&GZ#JM_*:Z#7Z=mQ:?2683*X[5H~X^9.6XE?E$T[T@6(&LYK
M`|[R28DY*mF+H%|!W:#GK:~||9R$,20=X0=4]\B]::6*IG$\6*U$m5?_+:H\
M7@VR[\G;5LMSMQ$?9~U$C@_^&IVO[HC|['0GQRM9=\6$=V/U~JMIWX'J12Z6
MDA%ZY==m,YX3~W+|QF.]S(QNBEX$S`M(|N4=)[EU))81E5E;=W34IUL?3N^|
M,ROG/T0#(4mQVH)0#9'Y+)RX/7K3,5M(/~[&G"O@U7#BL\XJV$;*_[VP5*1B
M_`UO(PFT33OCK#RWL"O.U!D"!4N:U9((LR9:%=0?FG]+BZ)XV8,`=\]`07P4
M"JR]C`8DYFEQ/0`DD46L!+TJ'1*QF+6G)`:IY5ISO`8W*N"9~UDGWW$YJ8N)
MMU&K:0F#DO3(`M6L^=_=JOVSKE!L*=Y1SM?;/5E\F;IBO_1&=9|CS0Q.U^P%
M../AMC2T_R_S7:NATMK'Q5@O_E[`_%CD.;N,FF"A[2CUF/':6M3AF`3%#|WM
M]R^Z4&8)J_MJJ$6~[T\~@KW9T5|__RCOL2;N&L7YG3E.,\C@*]Y`\,.1L$P7
MMB]@mND^71S3"2|OQI[5D/*VR\9Q++NZ^EQV~*W#I_?W7.E09R?#C?.5)&',
M@/.\/VK@mVQF.I.AUQP2=Q=G[?%P"`9D96mEI^XUW?E0.:W,]H?~K\"5GAT:
M"D3F3+"[.Q4\''IT*4?)=?XG*L[RB\O7SM[$835L3?.K0Z,0U[|CWSK~`W@E
M%S,J2%0V/KC#GP,~?"KCF`JB/7]G$3RO.^Z=C]W:8U3/81'?0A7:9V6#?E0Q
M|F/IG=W8V](K(@3T|J,_S+J8YW*#:L/Q^V.7.0IK*m[='00%N/mTG2SYH6?\
MRP9m^3YKO'X:=H'GL7(^N~BOQ+`43!|@,/%OS31NJ9QT`QmmP,mNW40;N/W^
MD!5XT&?2#T\3[%`&".\L;RQR"/73[G/YE@Y^Z~Y9J0|~URQLJQ53&~8*^LP&
M2/+7CX*`L.V`_LI'&F?&Y|VV6H&VKS!K@&R!&(']MK_WP][!*]9`N4|'KP[?
MNM#\"([)U:3)W'^[]^J'_84@^J87I0Y+,+D&QG:)$~A,AN.KE~I^BB9@9ER`
M9M`])@QAF3,E^_SCX4\OTT.C~416]N`F)PP&OW/T4mmH#$,H9I2"2'XE98D1
MFX+'XO3P"9(ML&)`XCOHS\LK\"]H/B2[%UEG/"PU&[HB](!Z|E8XM)NPP*_@
MC)HA#L2\3ZR.2QU!G%|V!I7$1UE%P`GH5LL(QK&;,(O*Z30ZY]/!!['E$H_:
M&~~.m:26J54~$K*"TB!HQOKEA.;X|S\;G$VSLWP7M:Y!Q=^)0@*;&0~P+5ZZ
M&YU2Z/],Q:/\T^0$C:mV7(/OA=]334=?7PW_G)^F?\[&`UID(GF_?_KDR3L;
M+/?P#5=^JG$!]~^HU;O/7S_#m9SBB^F;]]^_/'B6KK0Vm__\];/mS~~'S]._
M|)7MC:WT|$R\:H'9R/J;F_NO5GBKK0399SY^C=PSFX=OmS^AO6TTH+^V)D'M
MC~ZDN_(TX6&FGR[Z@W*WIIGMW_WN=U)[!84~8ZIV5_+!2NI^0QNTM#S*`UKQ
M;K|00%4Q5W:+C&/YFCZE"(]&,5YYZR*["B|7YR4~YY=%_C$9%99Q!)HO0+CP
M!#T:E0K"|!49,DVmQ8BPK"?CG#73R60XH&V:][O"S2L.A.(S\':2X'$I`\SR
M/C3~X3D0ZT5BJ70@$^&T6'|8Z&'8G7:`EMH%7S=BCXFA!L!7;_63D\0XG\;1
M43T7|G*R%F*ECZ~#.)V8YCEmPFXJTOF5R25=44~:&=~"N|`OC6B[BV@'Z$0J
M/|D33H_2E#R0.K/4KV+BH&:IHY=/$:F4G9E9F"]];8FE*\DSG9SFH~\T%KPI
MF.Z.~FF"5Z]K=~VS)ZV52U3!Z|A)`2P`7Q@9A4B@XV1^^LC#L3NG|:|#Y:W%
MJLT2ZM(K.#M/J#T6AB5D[BQ7@L|*4/[HZ7CXL62"^3;CX7$^'L^$T@=/"SI|
MU)Z?);&UDPRGEF$%1+APH"m"09B$2JXXE@==GP,T?&J1Y#+Z[Z.F~DK@C]\M
MHGWXR:062GV0&4QF&VK)=[OW&AR5FmYKO'K]]O7KPW=K_.N?][]?2__!#CRM
M0;JZ~;R!#?[TZ~;G|O,/3YYL;N[03_IS|V~T`V1LM/CHS;M=.P:MYVFK3+|V
MODE;[]*5/]CCSQ(|`2S^Q]L[Z?5*VAI:W?:[_~|O7K_]:;?|/&X\X7mX])]/
M3]:/U_BBVETYZKTX_;Y\=W+TGRLK)^LKF\?;FV|JD;H1CJ=*X^]OY",$9'"_
MT^JI2NYL;,[(`?~~Z(A7[S4J?5I;I5?N*4T1??5^"TSX+_@,)G;V2YO8,YOm
MS2?'F]@\FW='^/;QC%ZMTAN%.J?~M*D:=8[^~X^XJB_H7]C!5EX_&[/]"?ZA
MTN:3TV'W:O/S:.=QELJ83D]W!CNGV|[CTYWKG66:H$H;ZT5W=T7'LA),RVBI
M%FZ~RW`::1YA#NDER;T&"%(&?YWF=OHH_3K])OUm^FWZV_2[]'?m~PTH.Z@J
M9['0*6_~*]:(+V7\|@D2TmSTX]R$14?O',(UIZX'K\B09+X4$CWRN3!=DT)J
M,U40XmJ2B+D:;(BHM/@m:NQH?G.F%0"PIKN!H;ZM?~.9|"4*0~GUX.W#2$=Z
M(^+7XY?98?Z7S]~;;YZ_4.AN^HUSS='S;\XGRN/I]|#8+R'4"PXM=AUNN*SS
M@0C2|8\D7YJ|_',U35Z'^"'F,6@LK6S|.2\N\TWA.#~Q*3]M@O2/B]/m3C;N
M%V4_W[QF#ZLP&/GHZ!C?8\I!m!~P'JSH&T*M"(;"YI]&\SSG9.~##NQ7Q!2X
MI3$,|V@YF4&AmCACFF2&G24U?.T|^%1CB:5`]RRY(H?@YSC[J#~@I"V!F0\m
MS:@]I)%D0C/'N)0::;,Q&'9*V!V5HV)34\`3,+mC_$`=MZ$@[R":1(JSBU,:
M";4mDGD\15`0K]31.2T~R3*]D\^VCm?S*2WZ1#1F:?+WE`Z:Qm*R^Q!~#?G"
M=!SZ^")M]=)U;IF!GVGS]1^=:QK5["S,BYJ6Q#9JOCB^M4D@::GZF:JYDCB'
M='%/W%K'DT#m\VCP'1%V4K~;TNWTB?_CJVWEXM\$7](SQ=G3/I(,E:.Q!E&:
M47]WA00\,.|XK.|]',"?C?Z7F_]Y3/]|XT~?3XZ/&T?_~4WWWO':T?7)QOKF
M,5UT.X|[1+M6[@V&'_/3E9]WZ+@Q%4/K]T;]?_"U56X&O;QWWL/U?+B3'1__
M;!0O[YP/[7=WMRNE#JGBXPP(M&DZD!]$0(\W4~KIYJD\H3N:_O%_^)|S~PR_
M\U7Y+U[P+_+,%3F^)Y7E[Y'\.,47KU?1[9_ER2JF#%2%?C"]Q4!7DC6FX*%P
M_+ZD'4LR\~&0Y58^!EE'H=G\J6(m.N/`=:?@LNAX|QB~$@(^X,5$N4m5Q[,S
MZ4P+~DB@N6"_3@:F&O9$LY\CPBS*(Y"|3@LB]XJ5D"FC~W04&^'H:"I`~~FV
M\M$1G~L"Q$REG(V$O4H7U0VN$85`#X3M9E*M"BPN.3NA``7Q~Z#YD82F#,~.
M5Z4V^L7I&?VOQ0JBC#Y/?^`$JR00?)$!N#0?DK_?6&D*RE(FAD'A9CE&73TZ
M$@VK)+7PJ3?+XJ)@!]5SO4L3$X^4Q0:!+56~:'J~/EJ+`2`G0mL9)2R;3H87
MV40R7)A,X\+[7+=X!:VWCXD/3.,9]8,S@QZGK+F&1\FXR"\!BZ&^)&P^.SI2
M51Hm\73:Z]'$L~Z&98E)@,]Q=#3L]8C!IP5+HJU7.*L/3P#G*%&,5&F/4=0&
MG)/TUmQW~963H*QJN)Q7;^92B9JS,?=RM;16Q~F7)H/==@?#A)6,Y0Z?PJ.C
M'O_IS(F]?m@39(MN+HC+*A9^PF*)$mWCL$GT27U=?(I1&8m!m~|V,\A`1?_Y
MV#=@?Y~CL)\/SD@$1K4DW'K]K'0UG'3)#WU0YYBSQ~@[D4CWWCT[.,!Tm~78
M\V02BT&;6V]4mLCI4L]LBO9I,?@7;(RmY+6EDL42T@XEH1NTDYF7*M&(LXWS
M"#'YB9L(EUQ7KA03I2=0PB$4&:F+W6&9Q?#SF94Y=0JM"(T$~Q8L9^X)BM]9
M1%FX$&*3+[!mXFDm9I4GU6RKP|1R3S_36/&^mZ*V6#)Bm108G6OB4Y[]$^=?
MR//%55OILAL);2I6A6K|LRD`Z6#$%)P/@2:J959%mBI?"2YC!=6*VL;F0N.F
M$U;%ZB$3:PZ.:0mJm*K3E:1VTP*F=*(+DX]YKIF0D%`CG7R$MR]1T2XCXR5V
M;(W#5WHAYVS&)JZDR:GC;$2~@HN0QmJ3+)P/Z"4PD]%Y.JR[#2V3DY\74Z4)
M1ZPYAmET?\8J;YB#RP1/|#':4\YmR)=5@|7|G%Q@WSC5~0D~^Q1`F,QM9]&G
M$ON4'B5mK(Hm/QRU,~&*!J$3,AE.V3|8m%7YW@(74$Y,|I*SI=)Y/OCQ3.D8
M]SV#SP+A!2T2\@6"mW8@:7(O&!LDEYTR0TB;HF@##++$TQ^R'(D_*7+)12IY
M_5*7!%$AQS1.(?AmA6^RFU(M!|Q3.`U^?&UN)'.0&R!A+;!9VG'.02I@BW'7
MRQC'C_|I;O\/'DN7^P`5I:O`=]O1D9BTL$)ZS84mH|R`S@Z]X;WH.A=X6/2'
M9V~L[I?RE7R/EF";B`$m1*3$24*[8ES9J[*IL%%=TU(@TCICIB.G&NM2`$)B
M8QM!U/$L@5')8,AL\\=DE|5DFLF*"T@%"UAXZ_BV"XZGX^X[+;3L|KJ0M~V$
M[D%PX6X_6?_^.X%8F+~+'FQE`:%^`]PVK**LB1BLA`3(6#$C^2?&=PXFJ^BY
M*H+R0&ODK']^I~RS%^59W3?I,1KPN&."RC`[X;7=2F:Z5?VLV!!_R8|EA:IP
MJ?R$~!@!2&.'H[JYJ~U$6S#|_GE=,7N`KHGFBA[J,@V&B]|VF=/_V,P:=/\'
M[#=1J@S"_F5$&#]!6R/[|'Y;,VNS9(L23!?,0AK,PIS/U:_`K_%!F?9DT;3/
M]&DX"CKQ&O*M7#=,2X~X\32*3SKLO/I"NAD=mKU~~PE,9#`mC;K9)*3,S'2B
MY=4R),8U/6L//_PS.I~P&8JOL:4[Q[[X&!BK`)C~2(VD^@G:U9!)1.|CYL:C
M([B)2'=\X&)XM8EZm~X%YH#8VI,3ODK8Q)W+'27.6'C(^8N3H*S*(~;T+[OI
MTRCC*TAE(`7~m6Y"MA%?0=VD&"R:SW"mV)5Y,F1OYF"5="SHZ`\OBUm/,6N(
M""QS@;\G9UDF)@')@R"9,QE@A@2F875;]9?#!4D1!7S$`"=~5E%Z9MF2R`%)
ME(H@=&&OX%XIITD|7*O|2Sm40]CL:&;JN4Pm],")V;R;M=V(^3,~6(N9'`m:
MPB4,5UGB%*[Z`mBDU?WDY0ZE%mWAE/K3HA;+%G/0X"Y%[mY__2|P1:4H@!*7
MW(BZHm^048B?")N19TI@:CH^RKB?]R;)!7'+m(F|"5//8N"?P?P/I,T;~+LZ
M!S'(/O38+C,)39F=/#G1R@+15'[(K^#4TA*%Q2@KQL)S,H=,3'=N"%(#[:R8
M`UA3D!RXm+&FERKU.)QY/DPO6TA#B%^F;F1%?\I.WL6$CV1))[+B]N=/)E+1
M(J|Lm3WWLL:|_$AUTQ~ZW8R;S!S;AJ:]7m6H^~":JHm4UUZ&XY7=)=NHZ=BH
MP&]8IC6~;B|DEK%M@_9="F(?|F1!4Z*_|?X,FG.=AJA/,#0Q?856%C7C2T=E
MmW$\~X*YB2L_]]]Z^M1=0/!+G]/]X'.:[99M^,%7TMFO/*MN3Z|+m(!:4(RY
MGW0:2~#8(@E)YP/J.)3Y$2N.@LJ)J]ST0F|XK2J/LT~"Z46D2T&IQ'V`[99\
MO&END~4Z]*^`'2FPE7@m`@L\/AC?N~Q(!C?+L*P?R=FS1;M+[)1\QF["W/H2
MJm0X7IBN@NF@:PJ$_+^F=#6G^"(m9S_KG,^;EV!.A5"+,MXBY'CG@,M43#N|
M/*=;@H8PNH*#6R!:Z?2Y^L5YLJ0R.\E3(R?:9|DL:5*O']P"DB/9^=AEH30_
M6S&1/04%A/~60M`~D9E3^_P@!\4#4;1@"7;M8YmNER,:~,YMI7Q|(+/9@\MB
M/)0E!4[+&%F2_7S,|4]Vm$B"$1Q[H&IG37"CP'4)GRFGJC`3|!F:89SX&.ZI
M,H~ImV6'9PBCm1~F;%4SL4C_D;+8G9mP?`Y3XNCHV~M7+PY^:,.CA|_OGOLH
M?XW(67$)S93M$NH]VSIXWL02DHBY,$BO_~3)|VV$)\Y/%A.)17.*C_YKYK1F
MCTG\W1?,8^KFT71R?AIYHI:9QC2~QJ1V&F5^XFGD)(*A(_3B"71\|,!%5'|4
MFQ?L!O;YYL`'^#'4'&]@m(Z3+%6+H]X|3C~H&L'|Q1G$W/,$+0:,LT062QUA
M7ECRCK_K1L|JI'@:8)J`|3_OB5PD.1.FD%G&%;(.G$U&6\%G.%NA1Dm9O%$B
M\#|";ZG@EI6.4m6UFA&U$7YPTZ@\8/@MAI=P'I9?/+Q$RW[A\,3N4S]`~=|Y
MAWK5XKS8%#"'*YC;?KL4_[Y?YSmZ`Y|^'$8JCUD*'I&@(+G`V683=,DR:=):
M??Mm6QGJI5|V7DMJ2]TV~0EQSMTR)E^Z2V~7,:E=QI`B?OMmZQ2M:"_A!DNE
MI)6$^VECEA%7[6%4]P/)]Q';WDS'F3=;"$&KX9)4/O(#)/Z_G)2:_4#4JGX"
MZS;'~9&/%QPP)CLR75F91H.Q!6P,3__63(7V:_|@FR3A$%D&5753,?'RP]")
M.F!*\`&9?U%8B(m%`7T$4J_J52!U?3J'&DV|1|O4;[mWN8I(0EW]Y$7F9Z~J
M%+,D3~"8[P)J2_W!XN6/EEUGJHR7O=I%.9ARZI8^E]+IFJ.PH'4^_+_")^)C
M+PSX,L~~[ORV\835A2`Q,QO[]7;G?@Z?0(_EE`?AP*~@P)DR`W("PJ\K5XT,
M*3`/C/,^'~7+FH[T!M*/#'XEHY:+F+$=`7Y+;)FRQm0@SG(@*8A^J|^:APG+
M2%P0#3~=U*`BA0(X%U;`&T)8J9&H!H:+A|,!F$`;"\S#]8/8XS|T)R5.E8GQ
MD?^&mZGH_J2%;m/QU6'36K)QFL2S8#$E1D($,#;JE:G~)~KR`H;/RHH1,G=%
MLC*Q2J;0B00K?.|TGU!m[PLPHW|+`CQ|%&;DQPA^2UC7,Q)Z~Z%_J2DHL:W@
MG9=83W/^18@Z,]+90+8mV_6Y'?$Z$EO^_?L0M|0^[!TN3;_FS`ZAT*|JM4:9
MYT!#'[/V7m2K83%U\F)~:\9=%~5*+K|QR"~;U(5R\R(;."_'|H/6\7IM@YW2
M9AQ"JP;3I52m"?OJ*E0X:V7\Y&OD5;?K=78LZKY+7Q1FmQ6=!S622*!+J(_T
MQM[`HU&#3=C.K"0)HFGH;%.4"7L\92S7PW6'XZ#ZQ46ADB\;%2'+#*Y"=~&Y
M0A"XQ.N)\\AAMV3,C.3C&TT9$A#NF.)C5KA~=X=RD0IZO$3:+%`^|HPETX9%
M8@2_*J~G+H1/N(58mG9%%TBS/CQ'@'#`FI1)Q"B(T0+]\KHLDYH"&4U#_\,1
MSm,^P;U!E4*G?!6SN&6!@^D;=Z?.Z+B:3BTF@_,:%]6/LDC*YZ5&3,=N&mI!
M4CV3'4;E!W3D"1mOWK6V30^T6GCZ`O0"MW=]EVRG)V%UX~Y[MN%#VAR$W0~4
M~=\9&L(.NQ7A!0E|=@P#@^_=X93]`LPUP0@9#M)8O8E4I&3~Z:)T6L2CHW'V
M$=Z,H\!/)G&&(PMTK,CTSI+C%:U1IZEmM;'(G5MJ1"K;6MAU3CSL7&]4^QKZ
MH%P,NT6O@"MUX|T8?`,m[&5'?06B;V,(W/J|*8?MB,7H_YWZ?][4IW/G/N)%
MS*C@6M!3H4:WX=B,%R7=]27KUH6PII=%)I/?\_ZG[`OmmP6_&?%,WVIADKGK
MDMY^79(YZY+~9EV2~~N2WFY=DOHCL=Q!X%+_~QI^m4*$^009^M\[X/_6U"^F
M0I+E\']IT#^5!M6&@ZG#Hm@9*F;DR)$C|0W[(#\Q3/K(B(\L3(A;+O|Y8HKm
M|%H%R9@1+`mP"S5]VJ?=%E&\"(GAZ~4?8X0@ZU`R*V97|+0~UZ.NJ;CIX|IB
M|;,&~PM.*#$2![R!8MP(]N,9A#QUJJ*1&1%%VDK$;BD"6#?O]"UF*$+N`*O/
M:`P.I@!%HC[@|PB_E^A`#@JLWP60SmGM2+Q'.3!~,1~4?T_|MV7YCVFB3_]Q
MK`.AW3.BJ2[_X0U*WF$ZQ"EAQ_3DH/)$4$9)P@/J@)IIm+A?~],,1*,`B"")
M@0@,]2`MNJ8*NMR&;,._/3(I*\#$Q]'GP/WA(`G[&4=P27V@"4!Y6VO\"8~;
M1(,3K:^J=UKB#)PBKAm&](&WQ=,7BM+Y7FM\4_\JD~]9?1M1/NEL^%;4:RW5
M=6!_0UE%$M%)Q![1"1\129SD_GO|021`$_RM?"#QJ.Y5=:N~LCFm|64!1\L&
M:(2S6IRP7_I*(*X|].+2(A+"D#O0058QJ]KBS?,7YK!CZP#";];12/";C|1U
MP;H;`!8#6;@HRD[~[V~#?#C%59)?!*[M+O':7)U!mS^=SK4[$C&?48_J9K%J
MHN!/0K~m@XD)LE!~N`BT4W^ZO0[=9.99B;MJ,V!,IEB5S)~=*I.GN&F4[GX|
MCMD]WFLXmmZE~T5;#8I%9I*B+U2RS/PmNLS@0N~G\JE_~_?Z58IT&~+G83IW
MW*P6LZQ,Vm'1Z;3'M_6[7#P8ZF@X%|/7V@*[(B[^B"#+BGZD3~9"NmAG~3SG
MJ&C]|^D\7$]*6:RA\0O&6\$&#5,,+K&KQ#3ZKL~UMX[UV(#NY_?90'#:_]K.
M'["7\,BYT"N$ZDR\'UR%O$]/RHB*79_UPZm1AZD]YE;T*B^)VDF*LP$|47^U
MV=2].1T4F)\V1PYUY\WD[.1EM;mK!CTF@GC`S1()8QUGG5;|A24_@[HSQ!G@
M,"90DI$`D6)T0@O9XE8BI)!#]89]\63T"L\@?E:)`]%UHQ||)*D@/Q+Q(TV$
M48_RWmWA3D6?(8M]HI0;(*E:HBFJW&;ZPZOWS/DV4XG#E?MC~'I9$$%%YB5'
M3Y[!ZVM$M&DL~\Q/|VLR;$&O'QH)P(PUU2Z`;4C|CL0=`REA(W$#\G/0X%Y*
M:+'$!O_\|Y?FK#\|H|~KJ^;N7*ZYH|,QF1$K@JT5;#@QLJ&V~FFQZYR0\3)W
M5mAF#~R]1LD,&2N)+L&&.2A`IF#UZ.MWU)%!=SA~XZGZ"+[?Y`0^mC(R#~7N
M9I.,V;EJG+GRJ\$~\#Z3Y\79~9_^mV'|`YNSY,F3/PX0U_8|;1ZB34$TX%FP
M;"UmNN@FWS7/IO*#_KO]K?R%G_3CZT?R)WZRI5;^I)_WDS.8@^AO^4%/Y5WS
M#mN(?N|?&C5I/Y]!~=O\86\\SJZ:/WQ_m|GEU_O)#V\F8_G]C$T]2G^:9_;+
M#S_E%UK]~4%_[L.7G"K~CP03HGmmB6QJ,FXX\m.:SWXX:"H0;5.\Z.G/U^\/
M`49++?RA~E`/Z)1^0H2I!+(JOX&X8.+?|I'2@`RA",3$E("=D,#A!ZG0,K4'
M&+M3(@SX)TBm)?AHYW0J:/YFMJ2m1|72PP+04[L|5$5TKIA(\!9~[0DAW!5O
MB&V8A8,"R3%C0JB1B,H#8.4QW"DD^I?$L#'[9G_2[S)0RQB[API]=+P/L7("
M\_'D;JOUm+G/9,T]O']\R3Z~G[=YEH[/P7m5GLXTA';B9J@&]Y;[DZ@|I|?K
M.OD___OO?^"_SEDA%MG!QW_:m[;HW[???(.?V[_]S5;X|VM[^^MOM[_Y[?_9
M?K3U[=;6HZ^WOZ5RVU]O?;/U?]*M?UJ/@G]3^..FZ?_I9N,/D[]=S"UWT_O_
MH?_NIZWU%A111'5~X7#OI'S&6V"D6O*\PS]W4#(YM@/?(~)9'DT^#B%ImW,2
M]XOR_.3S.`~/|!W!$?5SQ*".B/\;m\|2B;*[O?&;8M`\M;](K/Y\EB.Z?'Q%
M%.K^_92!HU(#^$F.WSY[E]X[Z#Y.@QV;;O_NV_31UO:C%OW_UK?IUF\~;SUZ
MO/6[_TAUM=)[6O%M+N+Y8ZYRCPCM]\Q3J0L\#?@QB#51WXP5%ZW)=\)UX2M/
M4Qm640:_)WR+#4=70HD?;6W]KD7]`*HG[:=|,I_3I51D@RQ]/RB8@YA||;67
M10?@7UWQ2^5+9X]FBG[HFV;Z)V4X'FULI0T46m%70*2]SUG@+6N,.$L@=I^5
ML.(~5@S8;:5/G^_D7K+71@#I_U=M8GC*.6?@OSJZ,A%8RR'O.3J|IH'S1,9=
M9;2OOA0KmU\~/mM_]6Z_1=WE"N\'"&WRV)7P21&N&8)W/_O("=;/QLH2T?|_
MC@OH)|`7]B8?X~;`~%3`#)M.HJFRON$J#`IP6&VZLO|N/7BWDGZ_]^[@79/:
M^//!X8_$mJ1_WGO[=N_5X|'^N_3UV_39ZU?/#X!I3W^]2/=~_37]X\&KYTU%
MO+1$/^@DJT(E~Z%QG=8!D],81Jm'@K|!mZ9GL/XST,((+A*:BQ)Q.O|#YXIR
M=E`;/'M[/I`@U@^/|V*;G+/18!B&'`"X:%RH(O?TBCFAX04QE_^VD?XT).Z&
MV_[5_B5\1%W2A$[9`J"0U\8ZIB`YGH`U^DP,7;KO($S=Y$7A'%3DCP5(1S?O
M'1.+UA^~#;_:_ES54AY]++J3\]VMC=\PK!K_=?+YJ^UK\'\~_DL;`/A7|7&6
MEN/.[LI7][97D.QH=V7V;*ZDTNXW6UOI)G$^16_4[1&/@YQXU1[]"*;S|]#N
MLLU2'X][17*|32?GP_'GRAIAZ$3U/MOQ!TRP$:X4=,S^.#X&L|'L@ACQ#+NY
MSY!&m~M,3%YU\H\YEHATZG)UE*J"SP?GH!;R2'4(6!+%ADI"^298MAF[!DM,
MQ8P\E$@:DQ_4=A0N/+K#,:@_,;:74N9W(FU~NP%`T:|,Z];&([H],/Z.T~#/
MUT*%ER'#%CQ@+2,VN/\%5/GGG_7=*G)%UE)Em_M+4N9EZ7+5I^T&LGPM~6(J
M5#FY+56NI\G)0IK\\\],E$G`%ZI|3Y.3V]/D.HJ|W)(BU]/CQ"W'[(Z+S]1'
M.KUGB@@0!*%XY\!R.!UWV!]0K&+.8R_))I/,8|F|`Z*M.&,7/:+RG|EX.$#6
M&|8"M3PZ]M7'9N!Z)XT;,m+DTT2%LH`&''m(R[!GOK.?^=2|9R/BR#X?#":,
M=JU6L$,]\A^*0%_%~S3"IAZ./R@DIE@=F)H#2#X)=&/J+L]XX+1B1`R4M'3,
M#0R9@H%,&D"\,1H]]2!Q~I.FAO",D/.!'8#'P[[$*U/U_X+Q_S'/K930D&X'
M6H_%9#N/1ZGTBO.&+,;I%5N@.;2S10=WS%K"#&MV,32DHT30!m~\`8;%~4?D
MX)U]2NRN]S~&ABGK,+@D]),2KMSZ`!5/@DD.8DZ'"K9'6T+.#Fm\|W)H5LF.
M|]'U:M^3%UDYH2;F`[+VJ`"QR1M$:JZO36^'N9:*YJ')LW.~C575#_4/S"+3
MD83JZ_A=_#[U9R!*EY)A:@'^AENDF01OS/"$U16W;^C(V+X6Q+'Rm"L(&U~U
M*R|A3EP3,@J5'E~F('0FE42V'0$|DL@"PT\K?3B!RRQE3,|IBRmmV"@[~40!
MBH$D^\[|!P`*!(L5m7)!Y%NIT3@':61811C5AGVF=S@8XDM;,N(N|FE%G7?@
MLNC)G_/3YWM_FK^&m!'=[!(4G9801#N7~"8'(63C"V`0!QHA[2?1X67B,(;S
M2mL19B`&A!LF74FSm4@;V")KM$|V:E,`2'@L3`+L=A:R##@7MK]TG$WS)@#@
MOB44'Q!!9MI9#'IC*C^~JJ&Z]#P)%*mBJm8)%W=GCD]WVXF3&&NS0,5`N(J/
M"IP`.\1`)3D(W[4.J,AS*m=4B]_)).^G8TJ1&9,(\5Y4+'E'$TKWPOP5^QMm
MSAE?P9VL!,!Q\N2)\0RB3&6m[LH72+''@Y7:m!=$\@$1KQ|!6O\2$;FNY?+\
M.IF7(&,W^~J+1/$_!%|/VX=?X,PJHY?^Qm`==`V]+P,|,L;89H\',m+LKW[A
M`..X$2)@BF^0TV8UX0AG(F%+BCFEET.M284NANR.+]:=B=FLE;;H%*B]FVVA
M*F69T9U9N/R3W7\N&DL3KVC7X20$1P6F:Z,AKM]"L(3H1K[0_%;5Q"92UR4V
MT~0E[NFmR4O2WS_%~ZI8QVKS`&2BD0~+"LM':KVP=Y,;O;L9W5DN|)~T!BGQ
M,B;'%BE!BZR8LJ:9'P''2FSW"S.WW#B&7?CD/\8Gm%/I~59R]Y'YAZ:"/XX7
MNRL\;9?9^+%D~/W]4Y+9^,Z25P:@C!+@03;~L7_0*Y1]R`_~9)/S@T%OB*IA
MC129AQ[;A^DM+.B2]$#N3IJ5372D!=HE_=@L~E10EFJ3AF#+IFC9`:0BFVmE
MZS=]1*5S8W!0`7%L`CA,9ZM*TSUSKG&^667NL'),TO,Q~Z&56+SN$L?;'AW]
M^S0?7YV|^#XX,S5OZ277#.m"GNI!T^(;9|4$K%2F#V564F1|VEWY^M%*=2%1
MF]~1^QLL(RU'^GON)N+@!B|VNWZ%Y[SDU.0SA6UJ@Q~R?BLDTM|MX5NB+"P1
M!(M7.NQH|SRRQm)A(;FH$:LN"6HTT(M=6"H"0[0%#+K95@(52&8BSDHJG`T3
M|`=]6%Q31(JmFX$GH'Um8]%|1AC85Z5C:6,+66P2.C&"I\\I8)AISY3:AN.X
MS488^YU`_?CG[(9P,QS15Q;OB)D2L]N"VJ1"R$~VLK6"W+KSM]O"#5?7]MQm
M9]MNR5WXHP0@!8(&=B`OGm)?HB|=8:1R3J&3769%WWO~WF85S_ECO(RZ=,'T
M]^Em,`%KE1F@;?WX,MUm@R(V%94M(%]9:NGEA4Z/W)GI)GL(5!:VLCV27_KA
M~6Em9G~!ZUFPF+4W0L'^:GW%KS!ZHA%TC!6DNP6"QWZ`\~7#C|NDZJ``&SO'
MC9O$:D@U[+:,+/:0@QA@SH'2W&9'|$+$8#^$TXEW7W*4E_M7/].UA#KK%D,_
MM9I7[#QGQTR=P_AJY(G)`S@%!DLHX#7JH]?M[)JN(&Y"91HW[QQ|C58$2"&Y
M]=D;8Q1"0=$G6M62'M=,.Q~L.26TQ)BC.:LPEY`2Z:L2,QSE(C[*5~*&R[D`
MY93/VG3OKN@O*VG`(86TK^[PSE#EZ,LW?60!"::F~!8Y;_K=B+K_XQ_5CZRL
MK"T~R|U$?,X&?|/1OMS~Z1`AX.K!8CN,KO;I0#_'SD2"O`%W['/F'@%4+4&=
MB~"V\SUO~.&NK@`,%:):4'=DH7G*#'*6`';@!=%(7`ZDS/*N21)'X5]&0VKH
M5+(B.3^9V^QH&_`\^F'OW5[^Z\V[%TL:;\O%6Z]^09[#S=XHL+H":WHG!6W[
Mm[I%17:`5C`'%]\Z9;L=9]QTQ":1C(8**Z(8L!.D[&,B)/Z^QFE)U'?(*=(J
M_4A\'$PPB:OE4KL#3C0KK^"[IXY$5RE;[%W.(0Z(@7Y'~|#1|#0=B2^AN1+'
MR3F77CP,4ZE1/1D21HZ[L[O"P*YYWVZ#[?]!;/Z[Z~D%G3=9Q]+I*;Q+N447
M|`$%[RM#G_m.mA!L"I?_)$ZO(0(J`P;P_FB:2ZY~);R8ZH^I^@KBW_*^740U
M,#N0_RP?%9|MmZ[%mB|?NW8J[F3V.U91^Q57O,T~*7GJ&E*S9HO(~]L*^CFW
M(^3O7\`A|"LR^BmI;!&7\`)VF3XC\!L:_PQ2!I$"mOC@&B^ZXGP\AI~M9NVU
M\)!$I*YLAI]+&]F'+.V.AZm6%VZ@%_E@NB:D.*`H"ION4TLJ,Z=Y+9NB]X28
M[Pm2.%+Mm`#YT9TRTXmB0H]Z88!#6,ML|;R%Y9H90W\&.&(9E.^G2I`~X19;
MZHQCE,;RH+RZ.(6;LWmWY\BG[$R0,EA;)R[C73TRB+]CTU\Y,=+$KNEC]HE|
M%8,+]KN~!1])R4H32+\V)3!RJ"?T8):QE@`~m\$C1A,!%%(28JF.\PM).!MH
M$7N!XKVT_'HS0`R2294OQY9B|1@AY\Qm:E#L|V:YILZTV"SPX0]Y/D+4&1ND
M$E9DFCI2LW$XYWM.|"BY5@U;,]A*%K66`8|V@|U+7$S+J~&7Y`.6'0#UHQI_
M1$I~*+1N6=E[?/R#]E_4)6S^V[R$S|^JB9K_QG7=6'"^:/T:]+_!4%*6TP%+
M+ZZ0O#$M.m$\[:5&P7G1TP:_Hm^=]P"M[+[H_[^_.N@V5NGU:OHP+=;6=M+B
MX4/)%,ZUmAB\~|/(^6[*WP2?5Z2_3U|8$W8E?9RN#&C[K&C&]5]%CTG32]]J
MTX8=9MV&D$4W|!L(&X6/MDXVVN*WO"$;..^R$_3:CK`P,06[;0]8D]M@.5W"
M))U6?'?E;[3$\G`EN,\W@\=/D\Wm)W~/GCW?.]P[\H$.;#/K#QJKQY^^?B:=
M5OJN(UF!/N(|62_I`M!AXQ!M"#[|S@I5W(~K1=RDm*A!O'H?;'%9=V'H12~C
MHU'mmF+]VI1V]$N_QES2CP8$,UG.F[L~*R^B80RTZ]BJRW9?;L5?.`:B|(VZ
M_KO/RG+:^FQNGIP\39YLRGYX6C~+ZD~1.X|4(?%7H+\*]6A8,\YJT$%..`F=
M5[`:S=]P&$8]"JX_%?\`AQL+5@]|%|`8(ZBV!2NW@]6U`.~P9=~%.D,%73mL
M(B/9WDQ8%5P~V,E~VB"&T3VN%B~Y*Y*OY&=;YHOQ5(GL;/ZM3&I)RTQF:&'S
MY(,'8?^]LP,&[H^HF'B2?WO7?G[P]O'N)FTNF#`W08#QV3A9J"6~IN*|=IKZ
M5D?I$\VKR:**H_[W&E9MS4Q:|ZQm%Q^HNVEKEmYK/m]_=T@]6^/*^"7IC.2m
M;ZRNU(V$.`[I9AO7%Q`X\?H+~|ZL/WE|LX@D1?ZME.V?L62Q&5]Q*T_=(8FL
MHV9(mR~X)*F8UBOF\D"7#Q\:8BZF@R`@5?U&?*B_BW7M%Z~]SEEQ|I+NO3EP
M*?C4]'2P^=JC3Cm;)&Q(XILVZ74RIAY|@JMQY^D"H?&N+?=M^8AWB;`"DJPL
M|AL,NT~,2J]0=9J/JI+$2\Q8)8HX70[#=&0OG[]XN??#.Y=HZIG]Z|=EU$52
M/O42"69C;N:E~H$|'75*mG13Q9]R1M[#UH&+S7`^mZ,&VF=T)"5'@9A4L8IO
MQCF3O1)~)#]*4!P,LA;YMH*FSU|TS^[|"KN^QA/,4S8:;9RK29=;0)'m==JD
M\\S%R?HFM=%#WNRT31]J_YA\I|G(]|^8POT@4=3/?:XQ=)NN!Q*4m]~U3DJm
MNCYT=m0V&=)Y4(NXY2!/6.6m)5=0~W,m8=K_R^';O;:N=?IPmVWU,1THS|#T
M[O"HNPC[~T+]$3/PK*:MX$NSLZ%D14R(":Q$D8?Y`K!_=DR1`UGQ@KXJ60|%
MJ|DYNB0*~2+.0AO5F:B;X]T$E`BK)`W!]:+m+;~CWW~L+?YH&+]*DU=3];/L
M#5?#[~[D~D|FNRXH,6A!HO%`mDQL,3@2/V(O3mG!!Z),/F;CO,QH$J?M*$mG
M,1:T^L/A2%'V!O%3I"]`.D!@9m#,)]Z|!~WCA6*,JG^:DC@I6K+,*(0P&m+)
M2~+[;O*IQ=]CJERB/T'^KV0||2)+:'.Q9G3_5$:K+BJ.6?%C$ZM]XMP+9]0.
MHX^9%m61A24UA0~;[M&0.D3*X",L9%54\7~1*=HN""UJ`CB0,P?3$1N"+=TN
M?S~;5+*'^GX8~97$1;9Z?!IYQSG4'?D4L$RH:A4CT\^m]:%N2G;$"A/D\/`X
MC$[O,K$DP=8ENG2+@7*&""#6FV&,G"/Y@*,_~5@|W(FOFRE5YI~Z^HQ^80^R
M~*9M3m!F)m[G,DQ8%0#7VWA\`L(=AN2Um&,TZ1:TWY0.V?/`G68NY=Qm./$,
MmEZ;]KHDGTGD^+^)CF(:L1G11@59\'=2'8W9K2$R.XYV29QONMY8QVL;|7NR
MUJ@A3~ONCS7?`@]"J\M&:'=.;ZZ^D)+Y?C3C=H6VU9+':DVW?#M)W(;MUYV@
MJ;K5D6TIXULGX02+U);]TY"'.AA~L_J!$E\NOT!"M+GFO%^[.F?\MO74.KO6
M""|)"O5&6$IZ+IJ1N+Z^F:W.7[N[F[I$:VNII*9_\N2YZEmDU_*^QVQ87VAO
MI~FU7$=H/J4S+B@4,Z7T_`#X8B?:D'.WO4YH8\ZBR:1^/(?%~MMZ7#_'K&A"
M)_|4RmJ3,NY;4,_/,\V_WQ]2_0TKU~1^00NRUmK$DR?O^$ZKO)#9^7m63#0I
M+^@U@S~X|J4=T4,5!0SL8|[mXYR2+O(+B(FCX;#O'6%_.$@JW$OI'~"]1'(J
MB0Z9_mR"EH![[:4_O#SXOOW3P:O7;]M_VG_[[N#UJ_1)NKT%;M(!"'!D24Y2
MDR"'$WLI"\.]W4W/VM3[mL?0MP4(JQ%R*.GVM\WTA_;~RY~OG[7W7CUOOWB[
MOT\;5MC6Y,6S'_[21F+8AA"*M\&]&+,6RE9`;=#T*,(|\&23H6FTV:DZ4XH;
M@%5P9$+3m\@#B.PW[I$/*RD&Q'D.6ODGXO0A9'&TKB0M`OSW)/#JNY!S=9HS
MUZ.)OED%WH&~F:$D]+)D+W`+J,"=EYX//XK05G3[GD7RX&*Z?IPP_+5EZ+C(
M/A47TXL@m;%5+(+$7IQ593[#[\C?#X=|^0WF8mU30%MH.?'+$]*8CG(K#8.G
MX+@$8)CHGPA):..9$(,*"~87\U2]RVF"?IJ9*=LT.F/)5S29P4=+&O&WW]2K
M@%C`Om59FYWmL_#O]B#_V*B9KZ;@"RUE6PM2RS16*Fm9:=)8UIK)'?J'LB_V
M7K[;E\;M?IZE~;M)W,?1M#QOS'30G?6PN3_F^8A5(L@G+9%7.9]KHFT|]!!(
M`4R':|;*|X[D&0B|%YN&&m0G@|N%*4=8ZU*JEX48Y\4D`U//8`()$%9"R4PI
MSRPE507#|J*G/30`A2$:,.73LI*L..P4?)(M7C!!M=72J`A_A#4?'S..V',4
MG%|:;.S%2&R6&+IZ9P#)SPFK/A],V*8XG@K8#V,m609+3HO'8'S|QZ7.]D@7
M[6(ZR3]%4BNWMIN^.?SQ[?[~\_9/[P_WB2*_.C@\V'MY\!_[;W~J3|`G/VJ!
MNA$T@%C"VOI(R1)L'UF|W71KP0:,~XV~mA[$/:?]]O!AM=6=2L7I8$Y5(6:+
M&)XE^]!JS~\#SY|L55B3GJS=KJ,W\1Y+]E4XK9F5~)IN@=F,~HT=7~ES,YUM
M|?E!*m\FPF`@AN)$9G)@H&EC]2)JB4.45QKHD|:K1&G%.&?=H1PZB&/3,9VQ
M&VZ\7\;[X*YT)3QWRA31|3:\9'5\ZB_Y^E(+'(HD9\J9T06S%?mE|;~77\6O
M."@__D:)L.~9;ZS%|W'#.7ORY,4X#W43%TX;]D^~+YNC'GV_$=QGOVR&;%;B
M5J.9CR;H'0=$&E~B~CP%m!T:IJDX/TCD0EBL*;YKHGL!;&T8?M`#BVK:#0T7
M0.73_#PC\00.M$2|+X|?]))##)'V(Q$OA*XDJ7#96#AAMT/U[/6S,[NJm&0,
M)WQ*5SK?ETYC)V!M#G8m/WV@F=JDV?'*8ZZFXI|$_`[%,^Um!QIC.D_+[]7R
MY:2;C|^|5OYF/6_^B;;F(#7`mQH5V*@=IY;'T@&_K/%I+6W(R_3W:4\~$1,P
MZ5(OU]+'Z?$m/!O+/6^FDW~H%@BM1/TVT,1:]9.=^)mX|IZm\7#YCSWC&DM\
M#R^G/,CN,/W,[1~]QEWY^II^CUM]ET_V/Q63=UJAMNT=JG"M`OY6_*%Q]A')
MU[AF/YI2]Y1GM1@L,\YPN#_DDY?T%6VBTBMJ;K8?+&K,],.~;O^BKKR;C)?L
MB7@FS'3#/7;]6'*CA~L_MQ~S.X"F/Q]|QGO./UOFLS9T3IQ3LS.HJ5%UFT.3
MVFOTFNG&QD:TV]V+=OM/~^V]MS^\:[=ONPPOWJ"5%XW9L3=3:GG)IJ)_86_B
MH5SZ+F?A2.+GRPZ`^_^G&P:0K:TIF4O?&'(K$S5CO)E*A1EVR\F8KJ#@=:?!
M+SK!4]EX8:W3::_)S'P_'YQmSL,69&QA84G2+`OJ"U[6E;R8(("B#1_#E"']
MJ0(K$@**A`;P:]"6(R$W]|Z=\7D%H^3#_@R$C^$QM5:C!(F8RYG;XP^WULWI
M?MF5E3\HJ3049$2$&1\;|1%*C&G_E/F$!M,0FG"S5$^m^+JG]/0#%WX_`+#[
M=$#["MZVG!X,JBT'ZB#H'BJ^BF:m!0^Q%B'.MNB`,6DF$KLCHG3FP%?%N4PD
M8T%24)Am$HXE.P7@+XKNR4GCT1I2QQG/$^1X~_/ZW|%?G.I`LD#X9EUS#(//
M@1~J#1LDX6|M%S@[XQ||O_FZ#]=2NC&FGQP6KH1=T'2?7|EPLTDRS@%P,S%;
M*'0mWB;HDZA+1PK!m=%Nm*m*2#$ASE)TQ1*#YV:@5]H|:#B'|8*!9[!8S~''
MQ+U+'"|WU#&T'`R/=SMAJY5A)''J0N$3AV5@&53P%P03AZI8R)N*B~0&:;,I
M~B#QE/5LIYHBO?'THXZ5H]m%?_'1!%I~C~FIM2CN)L0^|O9Q!;'X.`9*]3BT
M\/J9MY`*YY4CUF`mGQ`)4AM(N"mJQ7!)2C3|3)*&LFU05$RGEIM:,@=.9!B8
M00PL.3K"8!186](NM)`Q(N3mEV)4K\ImS$8MJQII6!UQ`87"QT/9(K2[L2)U
M5+"JAC.FTN]$4mQmM$6W#]=?8ZL*K$^NV)mT*S3$#/)AFPU'D8'JK"`J08^)
ML!9EWKXHSU!H,&RLHmF5m;9*74NX1]BZM2P,(49m#_UKU7FB!T$WN(/|/`Q|
M^P~O#M^""/HG~S_L';SRI7]QQ^6?DD?YXSJQ_UY[.]A=UW%54+\#CB8C^!23
M('U*;]H7JX%|80Q(8D[V0"$/_0&|D@1YTP406HJRC[CD`F"C/ZQ&SB8TD,99
MMS*`EC//Q2VmR)85%~P!3Q.D._2T&(~ARKY?AY4*@#801'5.OB)VF(\TRO~"
M'2\96R=%G|TAVL=F(37&I#T=]S53P9P=W4PCWD5ML|$C,0_*MJ+WNA?@EPXM
M1;E#)3B@L"BS_F!ZT5C/UQ!.2$]W=]/5C=7@CQ;^6(XAU!IMUm#?_WN59)[\
MX4/=2mBYV*/EFM_*GK6B6PULS1J5:5$1VO6[HHF3?[Km@OTJ~Y7AN@]~m],5
M3/&?T=2*_YYV)%VmSH_C\E8?T@LJL/_ZQ2_ZDISNR@~$M5NY?__^UJ._K.CH
M,m~_~&"PR0`/9'LG/H/.WGVS07IFV[%+Z&WVW0W6F)#Y^UO])DV9[:2^+[U?
M&7VSLE_3|+\~#VA!'SRH=FV=]]WJDU6THW\\#?]X$/ZQ$OYQO+I:TV##WA[S
MU^_*('~2.U^^VW_Y9K]+$Zmm!/3:GX(GJ_::VH|W@,E"*P_ZDQUKR.XIK?1T
M?J6SN94~S*^478RX%G296RG4E@^^^OJ;'7!U8ZA#'P@L$G8LQ_WP3?``@4$[
MF"FPJN`Q5IFV/\B(:]N!@K.F$ROS.\'mS~D[+?C\SNmS*UY=65?]~&[U8_H7
M?G2VF)*,!U^!9.R$m*.%~"*:+m`.$4K8Z$~[)FT]Q?5ODT`]08/!=OHG$AB@
M!#%`m:m,RF7~%!A59^`_.JJF_IF."Z4T7:2A`G,_&"9P++Y$J+*PPA+VJY?]
M!F|PF$K\HSIEWGNTL?WMO1@\0C^:2(P@\`L+PQ9AmQ3B/Q1JR,)LO~X7Xm5(
M'CT8!N[ML~_DT1&)/?"O[[9!Q,IV)OG.X|FmM_QG~SKI?||989CO'^|57IS3
M&2V|DL4,@Z;$2m~K;004OmMPI5B\OPWA=O^6H.#+D.V0:O\_2IFK,PFD&)ZW
M*I7^`E);:5O:78[@SJFZ#mF=4_7_!O&=TY4E2?"\@=R*$m|W,H||5S~#$F7]
M\`QE7DPPJ=;mO!A6XR[;]9[]N/_LCV;7:SQJ;G_;)#(^]\0'5.m7./!A':mS
MWE7&DP/0M__!0L?M#[L7(N8TT9$&($W|;COmR`9+[29O*W69\KJ:F"=(RL50
MOZ*/L8L9mVV0?Y&!|~5EHI~J@FWC%;:KI4X4Z9VNQUZOZ!1V14NJS~'IWQ@Z
M%Z;)#)F8!'=6O1`$X;49!H17]%6"4N[2J:G2,3%U&&VYGF:E4_S8H76+`9#Y
MZQ*Y@(^G/JV:!IPADRm'T?!S37`[G&1]QOK`=:Q((^RmKSH'G[VmYKR''&W*
M2R285H89Pm2KOX;8ZI$D1m5B#"I\SBN~mM@CDZVWA4/.T41X61FC,@':F?B/
M@!62BG5SM[Q:0::+,P3.%~V0Z&_]OmN3@QT2DQHW[H`m=,:~8MAF#G,X:@Q'
ML;U4:@750`B&(U%KB~%'&Z[71O%4RR!6JD94_@#UNTT;H|TJ*/RU9O2'\_Y=
M9N,V9[N]!*.mPM%CKJ`~U=08"NWR\K:!#?]7KSD0FQ`UL7JT:KHPM%;2[./[
M:*C)BI\V'JNm1,J!$m)#_7[|V1T\X_\$KP?`(PR'PMWSD^PM5:!4=[A;3=|M
MF5$K5[L!FBFW'BOUZC^Q~K*Z%FDZ7)=H?XCCB]`XN&^NK+@V_81]7OV73\0=
MUZO)F$X&_+&9Z&ZA5&VB1WGOODO+U]`INC/[O1*E6T]A.JPO0m/VF*?MSJ^Z
M%m~KOJ`;(?O6|.^AQK~EXO\&TI_=)O,7K2Y)JYL5+C$[^JA~34~B#C`KM#?0
M^`NUQ0P[G~DXB)|R7$B%&)V6AN@%$|]YG[KX6@GED)1/CmF|PQ16E!|5Q**K
MX!m2&AE%BRRQ4#"]5H22|ZZ*R!(XT9PB),^9\:\['8LJFNV6B|#6X^:JNB^Q
M7VQ&Y2\N$,@+S3Z)Bm['JZ`;'5NTm.N:N#99CZ+P3HON]"DR?3N,XE~J%8JN
MEW)Z$1BA%(NEM'M+R;JL$'OLZA7B`*)|T)|D7`T3MO*=RL(//)Z0X"*(B02D
MCmC6X$9U=HX.\:V8,&29~EGQ9XZ.GA_LMP]~M*DKDD]V,CP[ZX?^R=(+95?8
M[7#;3)GV,8X&Z.1AH)KK;.#H/"XN$$IMQCB;*`|O%.XY=\'^!$!*&M]KB]9F
MIGW*X|K=(F\7/=Q4[B;TCV"H":Y"NT7;|MGA0."YWI+MFJ`EO1W#B*@UYRJA
M!\O/WHZ^,D&HXJ~D=T)_~*:V(/Q8BRI907SmE6N+0;U2_%,Q:6SKG]?UCDV^
M9RE/T&(I:.Y|^WH_V|Z*W`R|4;'N=5+/\*33`8Y2&\DN7$B'+JGO=MU(MHmP
M^'S|~CL=W*8W&A.E6U20KGSH)!P!)64Y]%^';Q2L34^K(9ZK&1|%$D4TMZSV
Mm*](4"/`!42m)H;'|'0D)=OZI1`X~S+DR)[3?@;/T4ID[&H)UE`_:4HS|4(!
MZ_R;K2W^.$mEG~9)$.HZTP/;3*@;?m_\FH$JZ`R#U&:B;:9QFWX~YGUA0J^#
M]IN)&.|@Q)BLH00%GRP&OB(P.DXVC*HZ,##&5$Q,HCKmS|*8*Q+~7ZB|PIMU
M.m/,@)CWPOP|~G+WH(W!J@1D..@*=@3UIO0`DYY]212CM9,A\1,K,!7E2ET^
MN+"003TVV~"*Y`OYL@"2=;(Q33%PR/0"F\VGD9T*FAQM!(~;@~~R911"3'`[
M2T]+W?W[H9BLEAJ\[@Sm)R~)NHJDA3H+8#Y;HJY(@SXO$2]|2XY"F42D%N|L
M!m[#F!5/[E#0C.J,*mR6R#".J*KY4/2%T`MZD~04EFJ[/S0N]6Y`Q2OAG=3K
M!W'Y*(;3L|3&P[$.$@7RP25),OW&2GS`5YK`@W6?B9S=^/"*Q|'5#@_GBO.=
MTLOGKM:!/E7KFRK$M;8"4G"`:!V$"[V3O"^|;'DE'LVT;&238='0=M;\6[&2
M/),|42T|C|=\1AFNYG@@OK6/TY5J%6VIVM#QX'@@936@5S0?M%.QH(+FPD|?
MS.O)"0~WAA,%.E(_37@33A)m$1~&;AJ_V+2'&^A1T!11+=|44$B;J?9B@UAG
M/^U:+60)@HL|#~)C[|F0HXKQ~Q2&QL%MU=;JHJ+35(|JUV#`*P@B6N,!UPW$
M"MN!7(]W13ALOP2,=/3T"|`|GNX99\;L_CCO/GY"E]536Rm?K=X4'|U1/+C@
M~YMH\LDF?_`)[YNG?@NHC(*X\7'C@3:WYO2SmX:&2_ABE:`$/?0~AU\8G?DN
MGTAL@EW'4'8Y*".E\~Z2'.J,EE33,@[E4)5ERDMDM1E3PCN~=F,Q'@YP%^WP
MS?25W(J*O"%381_FA&?^.~]=?XUS)SR/8)6XJ^5C~IN&N^')^=~S.T)8R""_
M%)+,CBWOU&m:T*^?\J;AU@R/+NC,[Y_6[8#D*W]L@1IV^VYL;m`M=|/RZ)T(
M:LC!*|R|!TL44ECJQ5QR.~]#)*,H$*8ZmTV4";2TmHP=$BY8N"^FI63,H$W)
M7m3@RN\'X8]DH2!`!8W2JL;W2KJ;&!.K:6#,M\H`J.'F:BZ#`MH9(,]X#UR7
MT2YR]*J(L^)[ZmPC1=mJ:|A8Y\M0T[QSXV`9\;|.F!R3R*VV`Qm0;;5@6R/4
M1TN4|1RL~~_V"H,S=?U@!^$Z|+YG[LA7|3O8G?FMmD`mF6_T'#P&=E9VXARH
MK,,+T$:"\"OVAF_"36#+;B|NO==!\L_VN%HT\B]|*E`,!~LB/;\\/DVT64N&
MGWWES"NWBBV;'=[|R#56;9I=]]HNB'EQ~7m6YP6[[M;,mQJEZ9!"Z/E,`9H2
ME##71?9'H!O$TNO1`9;&,77B;!GD]+/$7X/9(+JB%/]T/JC55!S$R"9!KL_|
M$XB`$HZ)]2:AMJR$BP/#V$P3*`;G%,;",Q46=G4Q",YHJ)P+E&_.YYR=[&]G
MZBBm%1*H&M$;^@B/Q9@U*,U&`,m%\MSEF$](^OLYYHD_B\UL!6$L7^"!%_!P
M,!LTJBRH2A@|"3)7"IEK+756VW'V43$E`G|@0,`QX^A4Y4/E(^USmJ|1GX.V
M1&JJ&43m`.:)3LMV+IB=2H,L&=7W[1:SCXVZ]!(LmDS_TJ%J5W[!*@2#^2|L
M176J;K4~#EF4M6|.U_^mX'K30%B%&\&6m56!W%3,,F*6D.%4LOR5'!|QQ[",
M=**"/234K`*0AU9\XE]C.Y!T..")#3?.`PmZU;?&+)21#LKUQ2m[,F_$"A")
M(3805=5['1T1E:%/.G!0V*[E[\C;//1OZ^ZP3B:IHmWI`%@9P^%1;71;@S+,
M;AUXMT/$2~+D#)(\T"FD,$D~:TE4/$*HI;N)/%+U~=3EJ`VQVG"?SGBJ1"_O
MD!#!=@4=LUP!%_GX+``|L9`QO|Y:'\%V^VIJ8T&N\H37G*Y,5\4W;E"`EAL8
M~]N""7+,W^+;)@#Q8$ZBYR\|G%:[|`371\/J;KAZ4&^'511OP1BCJA|_Q1K%
M@%KAM]F+N%?S]7F1AmGXK%RR'\$mZ,(TT10WL5/7D|7]^)*Y"/H@#M/2"!H(
M~R`?D`#%Q9U@:_QRWR;.Z]7KP_W'U@G)6+*.C;,N.P?RRJHRKI%N394\&C'I
M/`"(/U2mF39)J]J=CAJBM'+L[%Q(N:KX8#K''4[BC4'|!$AE5X1!+[;'TWG.
M(#)+\UT^1/6CENGV\`.[7Z#=B(]EBW8T9Cm!U]3&F6U4+Y$:36U]@U01,6W|
MAW9^,0V%!W=&F^&1:0;;MID&VZ?V=I~.AmJ^L/_XV,SHX[MZT6S,*'GC5O@I
M~WXC`Q|R3A|3#?74_0|D|[N|1%7/8NYT$*(4!M;W17*,C\Y5|$4#QI=4,GTZ
M6K&_$GVC`M|HX;1\*Y!8.AY~5~~%YM"%PL43E(@[35T]|3]0CWmV81L4R"%6
MDS=6\+@[P^&'0O'"%6'5`C;[5^:;[~|@U`8|]*!XT61C!E_'0."VU+CHU`R2
M!mQ"4Q&N|#J1O;O(_56F[0C#DG\T(2V4|A*#`\%U39,.|*L.Y*ZmQ72`)15A
M%m=UV#74H![G(PS5mR4W,F:M\4K0P6@S\9LYFURFKC;#KL4MT)mOO[E5.]"/
M|[(*|:]:U(O+VMK6BZ"%&WI1TPX\N@9^&/ASIF(%MX%689DI#%9L=@*LD~5G
M\N;F%@\EK%]3~8G5B'MP6=_(\HNRL#G9XDMmLQR&NEGQC=QBFF]L[H9I=O5K
M*R\SS4$/ZF?E=M,|mU~+F5'%@C`B466M*AQ?#G)]QM^=H0ZS5;6@U`H]5XT8
M+/Z:)N:IJ[GX@U;1D5$[]C50%]6)|&?]EC,1'~\;IB(B[_,Z%D5RVGF]_81%
MI_3&&:O.1G`H;SD?E9.X[(P$)^Z&.0F.U^UGI7*L;IP7S2PSAQ\317&%]P6E
M&`R[L[?2"N~m7`F!!@/2*.QDQm[=JO%G/+)JZT(1:MK^`R~~\U#X)1Q=@/C/
M'I~SS`PCF3F8M,!;1#*L0$`'6Z9H^`(8P9m8X3!AQN1(Q\P2'4N2@HMI?U)H
MC20JS~[$XWRP9$8+(Z+$=+6!Om^.SAO]CS&%&(|I]&F/G9?IMS7OK@|79WHR
MX^*,4CN(6("CP(Q3_,X7(2^E:?PE]I:6[EAS/1E%Bm%D;GN!T]^|4C5N?3,S
MU1C5S!&?U'9[9*&MmJ,C_7C]?%,%;FM!mVJO*47D]XV~KC6X!SPH`5WB,O6?
M]46#%FQ,\VK64(/:VGmA_X/2+H$)TD[B?P%`|V".+=56&ZHK7?`KGU969,&2
M$^K%X#LM%='V.._GE]E@XBTP^,JH8)11]R%XVW89|;~?1#W(+`4S~RO2Q/DO
M|1**,E?0;3C;Y%V/,`1TC*Q,(FH`LY$~:~`@NJ;AB6DI.?'M(A]GX\[YE~H+
M+9EF$BI7N\#4[$Y'_4+,BI8&71m.(Q\55@DZ5C3:?O=Z[\W~L\.#UZ].3I+)
M.!N4?6|Q?C?,1AM[EJRE5NB|G10DV)B78,3'(BW6Z4A[mU\D+D)'S?/$N=3Z
M]&^NZQVWOJD[=1V`|_Q"E%P")54B*DEEV|#?O$!V[J*|=#?.91O]\.H]mUCP
ML`NTBZ;@=OUID@]*310\T92C[,/)3I$L,'^m"R`K!HVU5#1T:%+3/TM#HLR6
MZ+mLm*(mS^UT,KAN=D8X].Q;`..L%.`:XNLX%?4(M:3XE7[$&m=.PN&(m/P0
M_\|&_;@.F`]AB_P#_Y7\G.(/mQYT+D8m?DF7*~\GNDM_4^]QIVY*P@#)'\[~
MPI#\G|!I,8S"8.^&AE_BIG1'+=3^.4=B''USDG(HY8Z[A:"/!mA1I63Z,/Wm
M#K25|%@K.5QZ=W4G+1\^),F&1AEBI4"GR1&68?AmI=mWNJV6"UYQ[N=2J+8:
M~V_Y6*5U]'$RG`*6"L&C|5O58@BY#XI=FX.;]G0WZ"G7VmKQH[D;|OF565GS
M^!MAV(W)()72Q`(A0G,MZ,5U$L?!A.NFX3#6\&+~#mNIPIDI85@3\+O9!"|U
M_mIM]3_:W1O4'M*/&2%6*R^C/W(MS(C1OI%;J)%N;&X9;5+0R.6\1FZA5(J;
MJ^58G"033/L28F|PSS|*6B@5"UN5"5XD;&GE4!@*YOm&26INU1OE*.&81$LJ
MN3D9G:`SG01YK.'&mG/'JOY4+VQBN)K,*"06T),~/`=3(%?T_(LX[!RJ`='L
MINLX6'RI4G4|AL'W;7XQG.3OZ?U*Z"NZQS#@/GU*59VmR`&m.N"H80Y:NBC.
MSB|1I%KB,,Q\WL!2."5V&BIZ@0$6GJ(.T7JOKT%:;%2N]0mLWAA%HFD=.*FY
M9FI+Q.P^06:N;L0J^7@K743?,_,7TK6\69[FJD+R;16F9~/1UE8|K[AB[N/T
MYG@PU\G\~+`22F'FP8S./WTR*2;]_.ES1AZ5?C[9E&=/mJ4$.Y6NN"]WIQ(+
M'*6H6BI75'WM&^QT^.R[P[|'KWY(1R4[,_GA1RX79~Q[K9~66+%&|K&JW8\m
M,N@'E9F]J&@?/Z)[2JO,"_4~E~S7OI23MY0m_;L="S#CD1[V79VZM2=^V"W]
M)W[!,F!)337.1)~A&+3.1XY/C'E[=MGA1m*m@""9SZ=H,6B.S:^6=10_[!^R
M+$,L]:%(m1?9%9W1'_?WGH|.|W_.3Y_O_0F,+WRT/YX3)YB|TA8X!P48P#HD
MS~M)8NP"R0'+S@NF5T'GBB`="N`8$B\W:B,22C0|LT!%0IWD),I'8M=2E`m&
M*QP7)8/+PJREB7`C28YERR!)"T*GF_m2*C8939^C*T%]E+1]8#'8~C:7!)]/
M)J,VS76;G6/;4GX)*AQ0;AU`+1GFm?R)"R!.AI8mVZ+VHS@"]KSHmN0A!CT&
M;HC\":8LEAU\Y9GNS\]96,F[NW&&Y*0KmQ"+N%(GJ@3S,?_=&G1:m@HQ\XHZ
M@@F\3H|+M*S35/BI$47%S|G`Q].^RVVX||ZRE0V)'W7DD788;|IZE+I%|'@T
MS/J*m[I&?IN&Y#%UXC2G&^mSmY?|U30CU\EQ,|DOCMZ^~)8^^G;[V^/~|#BA
M6RG_?#P=]S]C%(\WD6)\H\@GO8WA^&QSW.O@?RB],?DTN;X^X5EYG+Q^`\W`
M.S[3.+]\Jm,W[P_3Y_LO]P_WB:/?~[:?/GO]ZM7^L\/@P]_\;ON[Y3^,TO9A
M(0N/DS=O7[]Y|?"*/DF_OmD[?/9C^M,?G[U^21][\]?TI]=_VD]?OG[VQ_3]
M*_P(/OWUH]]\O?RG43K^=/(G\;XEBO`X?;O_YO7;PU2=N%LTT,.WZ`,@BE[3
Mm/`O!Z^H%^[13W_\\^NW?WSWAB8F~?_F^1[mTLN][_=?IC_MO_UA/_U^[]W^
MRXm7^ZZMG_X(_|N?#@[_&@[BVV]N,7\H71G$:Y`ZZ)&'_;[DVZ5;/WW]]OG^
M6Y[,\%N__~:;6WR+2E~^M||&~H3R((,=?6;OV|MP+WSS]6]OL1~H=*7]M[DH
MCNB4LA*+OD8?^~F/;_~?'[RE??=V_T4J,QT\"3OPV]]MWZ(#5+K2@6~`H~EF
M8]X2V(9[+_=?/=][&WSCmU\_NL6N0^G*m][ET.T]3M_M[[W%\M`'XU/mB!%Z
M:0CFmmPK+9.S!C^+XO#T2A114"DE1T=S*!UC[,T0,?1J'FW|O2U!N.4A_F6G
M+0U/6W+S:0L.`S;L3?LI6'9=(]#KH82N\`2E$Z".C[+)~:EIG(LQ_`4YRIDV
MCD8RN^!AXZ/~OSU(&IE".Y)\07WZL7WPZL7KDY,U#7QWPG08E!?IG/=8=$H$
MTUGZ8$Z~DN4';KL&&\DNQ"0T,6"$**7!=&DY]~.]2(+$~A8TSCKI_A7C9""R
M0?*m2K!7.~Q?LC|IHIE.Z:_I1+JR07M7I%AIT75(VF90"BJF6`#L'F1%%B3R
MAA(4"FMVU8*D]OR%(F&MENJN*,R:m.Z3)B71%m/"5/OKG6T#ICB*IQJ.A&LF
MP7I,`NVE]XAV7|5F*,.Q&8+8.(~*76~*94S;(SN)=Z/.)NXQ"D)2KB;VEC':
M*NON`F9`m!:$C`7C~__V)77UU1"_$$\QR|/~|E)4@[]'[:329]YHY9#YVLR/
M!/%:@TGH~R[RN3J.^PTHGF62'B!3~P!CD5MIEO,!;S"^*`82#5?VLY*VT&L,
M[Vm1JN6!EK[H&]=.S+5\7A=#G;VU=VmW;7"6^*NDmQW+282CmV]@GR(AVGC$
MXTYA,"K3|ZCO77\EX~*PmTFH"Q]DZT^E@BV'Q2AI"BO88XK)|&"[:7&DW"+G
M53~9;2Q0Q7)7+R0O#m~($0]ERMJ383/".FQ_M[`m5Q22U$A"^/GFNMFmmOS\
MD'9T8,85E2(;C*D@~WF^|I2#]_;1$;T].=FDGU3XY"1]?_BB]1W[?$(7SNU!
ML;_IU.&,#.P&Z97D$G:8|_!!4,`"Y.//:&YH=I(."O.FmK0A#OTTN`R~EI&/
M\DMG)BJV!U0`QIX\@:%KQ$~6J?^|#@51Z3,+X9)_2U,LHLJ7Y[|HD`%2X~AH
MPT5G;&R8\V=MM3IWVR47CI59Om]4F27:43'K`7.S[;9_`S6;:6L;&:5?O7[[
M$V|8;3_??['W_N6A=U*^G/$X]M%KC94#@2F1[W/?5EQ5FD/8MV"YP+?4m*)V
M#6K7%#,ZM:8/1_H=/HSB,JT%TU1W]^`RBJ~\U;8+3)Z]:;_/%*!J\0RWmXGD
M|JXG?5C!J!3QF..&JZM&')P/mJF@'$8YBQKGJA@^*#?92N.FH`28Q04mZLJ7
MJE"T08&A*+_GS&5L6@JJB:;,_`QN/"UQ6B8PZIB~NW=GU"1@@m]Y175DB+@8
ME8R;5+%(K/Q(/"$T*NRT?XX_UC3O%#"P![(.4)Q("S+S9DR53;V"+E$;WS`\
M;,/U$=BQ#Q_R','0"=)6KJXI4*PUP6VD#W~ImK5$$@@U]'54*"OSJ.#75%`Z
MT]1.5GV?:H_,VY|8F34B%7DP2LBI=X^5\,Z=+$RR!/Z_H1N/~NK&^OMTA63!
ME?1QNO+=EFJ3YTV@D3PWm.D4\N/5C&O9D~F1=6,3,mKKY!8TM'H++3VKP3Z^
M^3.QTH_*#N;mm#?SBJ0&@|:1?4D5HFE%`W6[$L^;6OH+mHA4K/70\_;(X+`+
MS9TQZBY@$H))6_:ZVDU\T!+H/5%'&:Q0*IX$/G;ET?8);^Gm&)C9O]A@7':Z
MmHX~G~#8\L^:&C/_&JZD;^)K;~)K:V*m_P678I|1I~E/~)L9;Q/TTH$3/7SH
M\9BES",A'1N^#m;G45RLBW9X#;30#:L="`mT*34VmM8B8'/C9|2%K=7JID_E
M~,']HFOG8R?LTm~A;X.!:O,$J;\&3ZRN@/X]BX5?,]O;mGZLBT%[NX6@#[@I
MDA:#(FDX??KUKT^TT)W9K_';N\$*ZFRN=Q\^I`5|U]6Y]J#A,V'"8J5+G^~"
M|(U09^:!!(Y39%1!2%;X94&|[CIWJR9)[^`9\HVS#3H"G,44RA]GBK&P6!]T
MJ89,!6IFB5,RKZE=.1MEG7/XH2*|,2LG3?$=8ZDEA.*&6#E@^#4H&%0|^IB?
MIHRL/O8:,]~7C&0JM,CP(OR5]m'&HXWO;!`,C^&_P3Y1(F9W=*(DA:m`|0^N
MG,E5;3/]C`GE5/!D3N&_6TXVKATN.#|1#H&ZMZ%.B2H,FVXA+;m+BWGF&F)*
MPA+XJ2]Z546"Y)QCS8?ZZV$RK"'V$N2%L"9#WT'I)B*Z$Q4Jm=`X|YF[N&XW
MY[KB*:CNE"4F..L+6HTNJJ@m$Q96L]/A5m(Y6T@XUHSV63.:7C|W$F$6S_DX
MG^O\YP.ZG#SN|I/4+!_;]A,%!,P`2L0~A%m1F_#&6$5:~mX4A1I&~%TQ9:P7
MRL|MZVPSR#OM]&^=X|4%!M'GE"?`/F*M@*"U|T[KO^?CH75(M@+M|UJX/,"=
MK?2;BJ%6TWET,[G..Im\[`ZFBYL+C^V.V@H_9B7/|K|U[+6@H~#I']1\IQ2`
MI'NM[7O0:AE\KNP`UL7D)4?D8|_04M+|L%976EC.]P.V?&*).\Z#AA_P/7X+
M=Q!KI8XMD6'MZT)Y7CL.C70M\/VX7O=F|;H$D^9J:A(K9,E"5X1`UW==0I*K
M[X1UJL;W,+NE8WO)\[TB4$01`J)O0FYVEA)"O\RS7#)[`U;%|BASXNZ*FV8Q
M,"ZXPPD07[\(|~C".*#:CLW,B@RJM1TD@/!I8O%O.D#7&AW+@NUO~BW`O7T_
M|/VM2W8=",*O&.0U|HMVA,:,'MXC5XW_&DH*9P&|A6%/[L$DP(Q@]P.!`O(Y
MZ8/L\DHH/=XU/*O915mR~GK,BS(H/_9X$+T"SA,:*2P_V25X.KIE[`6FAU,7
MEYSNFWU?^&.:TmB[AW"!.&,Y,AF7G,Q['m~5',=Q72Y4[Y`7NJLMS*,|%IR?
M1UE^7R?.T55|/Bm?[~BKR?AJNU?K$U1W\&B+!8I!?NTR2'.CVN!"%M@@D/85
M@EUX*;1?G^~LDD/,U&P!)45=VVFL47ORA+F_W*4J$|O&T1%UDL49Z2~+G`$4
MSMQ]L,PLSE?X5M8T,|K%20QO/?&^)?84L31P+D%WN`Z.&mV8W~U?O"YRY2Y8
M$][V"Y!m`OV^*,G=P7*8'\WT@2!_U+F8!6(R7\YU?F+ZOK6]8^B%9W\O1LWT
M4TM^,EYRWNL+'H+07+4KG].[/EN6D[_WB]/YEFZ\W1CDD^MKQWL*=*"(#\Z'
MBRmQ$J7CQK]?,'!W:OY%8%O8O67@'+P4&0UY[[Z[UT1^:ECm2~JL[]$H'T)F
M@;;PM.RR!?Z_/R!US]_[^::O?'V=Z#CYANAIWAXSZ1%'1MQA|5:PP2^=Y&``
M51RACOQVXW=;C^YE@".:\D@2ZR6U/RZ([U,1!1,ACFGC(,$O#T4O'L9~+X`*
M=$HK\BBQ50#[[I|@]3T/W'V_'T[.U|.L].LGR!54+G&INB69#X_R8//U3HHE
M4\#*H42VJ3B9|59Q~2*~GKQ'DO#SFBFHm)=5S13$[G'C@0BIY1`7HG,I=)\1
M]K?.$C;C2769"6NZ_Y?#MWOME\]?OmS[X1UT!*W^W]m[C9|'W^^]M|=K]%#[
MI^6?N~)65)[H)~B^(@`K@D*[_XF$B)0.`XE*Z+4!7[*\X,9/:Y~$+8)I.MB|
MENmmUOYNJFm:$G40A5X&A:B]6G\R9P]\,\YY'|N"EN]'D6?CE.%\[,Z?!D^T
MA[4/VP#FN(K3BU~%@+^W591=)X+7_GNYDP@\2&I#Y^?9V$P,^(L3);ET`?O/
MVM^_?]%^N?\J_?8WO_GZVQF!(2:GNU766%N4~V)S74K*W||:)]YVW(9~'VQ|
MFR\VU/&X3UT6XE^#3S:CD2JAZT4mTmJ5m2~MW%Q!R/.MJB@5]]CG""H#RCXL
MEm/)L"6&?Z$FV#L(|53_]X\|OWR:P~|0#R9FM$0;0U#@HG~E#@I=SJ(&FJF^
MGA|9R2MYF;KV];DV$2V_6T_0%W3BZ5,&3X5OS|&?]@TYM?WJ_4_?[[_%4CW:
MVOHMT=HD#+"Z~3+L7@EF,)0);YC[N/:=Y:HQ];Y5C4\MK~,mM?.FRI,?3)C!
MND8FXS!DJXIJO_+m]F_2]P,G0M&A[Q;BYFI\T0P[U?AA_]7^VXmG2/Y!+9BP
M+GOJO@8]6(,K\SC'.B8PLH4NWAR11D&)`QT^`2)K/$K70Y(SHT`P:A)+]T+;
MP&Y)*\B&m^PUUF~*K#73[5GI7=_m,X7$'*@;DK&@"\||KO)NA?8*_4[7LYQ!
ML22A$AVQ1?/S97.3@16UKS*,&$S,U$"6!R^X._:F9HJH%~#C4QTY@%&#NF_:
M=M"(|7*_5SN9C=~6;8*/TRWKBW\71(\E*PY'^6"VZ`P|OB*PX2G"W3/mP%';
M)+`+5$%6TWVBT[F2")KG3//OQNO`MO$LK^8=6WI;+@/T/'L&5'_%]\[^H%M3
M`OV),:J#5]=+DO[9;]/2))4Y[#$N=$U!!X,]=__7=5#R4:C(I/Q*J(T:3Q$.
MTM5(!H38:Z`'BWH~21VHZ:(X3R)N&4R\L)@F|2C7KDIZ$A+B\J,AL]?"C`OO
M|YK/BT&)E.R|&@VJ=]=%7?U$FFY&HLE,#?4QU#E8+5V4B].M!5KH/+"A\.B:
MH0;m*IN$V~D#W)ME#JP!)(\$YA'ZJBC!)1]!.8'QA'.,F\6$+3KQ!(EE!UW2
M&4U$]=YGQ`3`?EOR.I8JA0,ZS27`?H%XD\R*mR&$=U`S'#V'96%L'.mH7~8D
MJLLIX;$)J0mBK=|_`AW\C=HT;#Q3!,D(%D;3S3_?3L]#Q/\_5$N2IEY4^+MA
M?T9Um:VH6#BYLM2.0NSO_KUL/|TNLP+Z\S!~'L^9*!9@M1O?7TWR7KJ^mGM&
M=Z(JUE15G31;KUGA&YR:J]~(&@KT34OJG&9(J]2TU)9N9+"[+1Q:^C#LXTY2
M':8T4%m$EDK),@VG21/_[J^OGK5?O'S_[D?7HVBH:.Q))+[1Y~V6[=WAV_V]
MG]K[KYZ'BU3ILO1GV7'455?)*NQ%*QZPKQTDG[?)=7@("_L=7%=_]X`+?`4$
M?]~QBSY)D)=$\*F[NK,7NTS,V1VW%WYJN)00~4m@@&FNW.D8]GIM)I;TBSP!
MQRN/F*#$9SRZ57&;M4\Y640m7_)`/B._0%MYDQ^&_GL@G8E5NS2mmA$2/5MY
M"/O6PBEV')'*/M"9U\Q6D#MI9O~&TS9W?X;3!F?@[&,J3&1ZGK':\RP;202K
M#mmN.]',.KG8;]1PA&Z?+LO|U.[7;!SOUT!D3.KTWC=%9B^W2TO=5Q7&MU%5
M(F'KR#;MG(JF.]RZZ\R5+|2KEFH[L0EB742?^CNBQL:PS*50M3K8HD!A)*FP
M,!:F_Q"1YUT`.N'|T3"+/7A+%X2025"&)0P2IX$`X=^B|K2Q#+$^G?.$:2,#
M$3#G28^mSU%[Y3"=CJ`WDVPE=3REQ"/_D,/)9.SmHVAOCHI.#X/L5C5~+&(X
MHBCY$+Z%9|1%C==Q)DY!Z"AW+?m~~S)DDX1'HT)0(N7$4I:~W20R9VVQ.*Q_
M/E%=X^R1FSOA0~VG|X@06G3?JR^R$W=*?ME)2*+KC*[$OC9;,;"YS:%^+=]4
M#0%]Zm_.#E@QK,\TVBE3%QPO'MBN#/mHE40[!VJ~&~0?^YR!)UB9FVVCNTNM
MAA(/6;N[K9:9.~O*"D^['7AOC/1FL,%#DS=O=65#2XU%ZYOZ9N~MLmL$M"I2
M~"~9~V]%960(\G~KM6;GK(%I$!_%V58`CP4OT^.!|R%U3)B?OKG??VC?%X_J
M:!JH)@@!m7+44E]6]Y4YEY5SE~1@5,:~~'^8OA_UAUFWO&;,3H?\(%8T"5Lm
MX&4ZP[$Y[&6,,,,H@%QV[`!WXM!#CSX8~=Em/@Y9?][/+\HXCE"RDFBCB4O0
M;LE=XCPL[MN:U)@]5D1?;XY@4+ZRD31AD9:#?NGB,!T\|QT\SJG,A,$F9IT/
M2,G'|8~GQ83mL:?#*9QNKF`'59^[/"L+1HFG"4+.m):EW]$&'G3C+D*T9@U(
Mm:|N2|M%?]*B%UHTUBX4'G|1S54+;\B=*+XX.J,~^P@)52!2C]%QC)UK,3'I
M]Z,I8B|@I.&B|0AUB)+4L./?J:H%%(4O&EWLY8|6H4P0Z%7D$3/'5%&68`'"
MLD:3!*,1mW)6FEHB3TJ~SB5&Y[/39ZKN99:CJ6L*C](D.S6|63~5C)6$F3R(
MYKJ4+TCSI|$:X;!RA2"%#1N,P(OE\,~:%..\?Y5P?C4W_NI9\B&BP;%#PI"A
MY/0[*\37=9A8'N|F9V*|#N@$#L\&'*||32&^5SVP,;HF0GH#?]Cm3ZV/'S^V
MP(FWI@@Z8*HK057TL),[;Q",_+^`,&SKQ.F`G`L:&ZB]:X'A23G[V'109KU\
MASVKF7*,\\MB."V=GP)'9'm?P3H47?$"`+;FZ[TW3C6X|2WXm#W:/4VXC:JV
M+EH3Y]7&8*=`~NPBTOI*DD_"5T+.N0/?"?"#E:(U%8OF]$IVH~23#)M0+PVK
MCDJ1_C"&_N&3%2T5**!YV1'%1VZBCPIFV1TV9TX23R9BCKN)~4PO|AR^*1/$
MC.,JOG&3D@P?(9:[`@,..9*V.#;X?+~I,!H,G[HYVO7)$^3YRL/C,Ym+I#Z`
M\A:.MCRSm9@_:LUF2Y^%_T"H\4@]NXSXT'Z[_^]M;`%G:+@;QE;5?8Z:XR%A
M1)M\[L#BT%~V?[|6~MA54L;,F^CFC*V0I[?.#V\G4HC,|?+5+H8DHAQFHX~?
M+OHK8?^6KUY+859|!Q|EB7#@X]4EJ=68+//5G87S6\U,,W|6::L%1;\D$0_M
M5,UCM^""2$=$D=Z^~)8\^OJ[6X#|H+1@I@A^X3A#A`#mQ4~BU(\YE/:FHP70
MIY^"?G'Y/REX'XX~S%[P\`G:,,Z(WA(1X00VSFRCP2\".D;W(_M/5&['H'XD
M+.B7H/^M*ZZA:\Q5T\5%7`AL!NIT.#m0BW&9TA7=3R5;,N0CDS'NmNASS$L$
ME6!6~?HT|#B8:9:=:YAGT3D,H\+SJm\5"D;?G/_%FS\H!75/TK0+#,&H\L$R
M%[BNF/F6B*6A*$U82'PLOR/\1:\Z3ETL,F~_^)`3]^`CB^'\~W+";"%7TT`=
MP8;4U,=9:N8R5$=,E=3:2m@+CT$LD*JZ"XAQ)*&F2_2MLAQ!m\XS!0@9@@@4
MB,T9"M+*|)A`HP.KZW!\%=1V@"G9!=(mIRX[\W@XO."]AT8C`23I#ZEB7Q/6
M'AIJmS;83P|_[3NMDX82P;.`NO$AST=|207+,I&XF(RU2:?3Xm,##(EYN+,I
M;0.B:!8FmA%C)NH)#"FO+%N^m"L41HNEN"B(D6N9,9,G5SL[!K_ARBIKD,!`
M~@E8)G;[KUL_QGN'_+7W[MG!`=0\YJ+R~!E^P*/mHL%VY[3&P]U4ES|GUJ42
M5==HGR7/^YK/19",Y%_58]9#05;2YZEWGIL~]TD')+`NZLZS:|%SV6/PTD7F
M0?V":Y+GYRRG'A2=AC06mJ/3%SE%*!#TM8m0LF3+Q86J@1P=+$QDPJ%U\G3(
M1`:@D@RV2M~+H%E~#+O3OAAQ/Y9.F~I:5K&D*(4UQGDPD10.N\G$29]\#'SD
MEGK'EE%S9KIG3I^W:U~$8(3NA;B7GKT/&M?(0J9L"+I+7~"7738LXB%|48X*
M~K_]Z#L?7(:S_=OO#.^?|[YF?JSJK(!IRXI!$X&11"|W%E]X&AMM#["T1_3m
MDYT*HZW?X%U~04CU_.A#8@7A&:~E=Y7[M+^QP5U+#W?3WVF"/&m`_5$)~Mm,
MU5\K?%A),1BQW\*X3($AA)P3\2XC^4/\?$G~;K6|m^E=Z$F)*8P_Om)J`?=5
MOQ7,05B,!OW(0$+F.m:](GK0?K/W]MT^M?E3U@=OEZO@N0,#DK4GGCDXHZ=1
ML+Z;0(%1UCBGJ2&V.ND3XNG1D9YZ|!0^',J|)ABH&![9M)7I_@&8V|'F:Q'|
M\Q[=$`5'$P:;$MH!8X*^V_[=(YHZ.$O@PA$I[9?P2P'8B:@4'|7!JHLGVJFH
M3OG;K?2WZ~]E=A[2KX_Y:6#/G_^/ML5O@9@'AV_J3:OUY/1IJW4\/AX|;RE;
MNY`)V:U@WO,.41KWAU"m)=|^"\,N'GDX'*E)ARD,GC%3"+H0T@U11"5NJS'=
M\)[IIT*AFNQ|S^_`"!@`$2mGL\.):F~2DO$&S=M00IB]+@Y\FmZY@DI'M_#4
MX$==%YW64+_'BIWP4S,\@'!=O&\DM)S'+*AT":~+m*|~FI9?8PL%)`87:O5T
M1F`WFFF"5R^B*$*+9BC1M*?X.?R;^0IU66MO3.[\C3&/1EW;EN&=X;W,|BAB
MPT30UL4F2%~O^"24*Z.]m1438,GQ=XFS(#JVRNVI21C6SMFLRJ'|0%"(3T~B
M`I0\H2ICB*9*@\|mC,UM6!?B+#I1Q]G9^N%=8J&3MO5+I#&'Q]|E]^Z@m\,!
ML+^_QD&[H,LD+&%N9S('7A4mGMJ0XH*)\3??;04PWE)V);@=8m~!~G16WF.G
Mm8/U.O4[Y!8[*O%F%E`L/:["C%@2YDDQF.8JH`LLAWUU1V)7~+A4^CH)4[B$
M':7_G3)OZ\8DF!JNT)$506FUT(P=Q,FB4@m7ZFY],1ZD'Z*,``mUJT)=QY&N
MUA:,#71#.CNOP&#5A9m4)\A?^/]WUDm/O1PS22\$3%%J\Dm^]7$XAJ*^mP0O
M:P~],^R#IH8/6=]4,EZ%_NY.=WY1|(66!8)UK6')($~763$V"9%Em3WQ"8\*
MQ(|SJ+m:6C,'((4!|9ITSB!QB2T"UTYmP^"7BTF9R".F'Q:6='2$]!|.K@~L
MKSQH!I^:@72@UXE4L")FZm4Q!'6)`1661PBNS%5@EX.M+"DFL;DYNY3T7AI?
M)Z&`SOL4KA63%@G:4$D/)5~8`\I/G#)4,"9W!%H"Z)6"*,E/m:T3:POL!O\;
MF_F8/"W25.T:'$//(I`L#DO';$I@D0/_4*L~FZ\UVHUU5;/2XP.^R;8"H|X%
M0+FCMW6BAESWIR|5LX_mQNL/E.]0^@|[77HZY'C)~#UPDS^NP!USH|=KX?%#
M|SNB11'1V5RPW&&%";MC!NQ*@%%`\.,CP'?mRHPNK::0J+5JPY=J6I_9]?._
M,5/T=E^2P^.;EPU`PO$HZ^2m]8|/.Q$61+|X*R:m]8Y3)O~|5#*A7=T'X(.$
M/FQ+#I+EA\R!2$MUXVZXV:TCE0m`C7~GHX9%&@GIEY47N!?=4JP?|Y3X!G8?
M_@J53XOO4?B0CQU3XKE+1'0@[W|=\U(ZS(M2.\~&\I]__NUI,5E=;29"87WQ
M43\#=\;8&:5@`QLBA7K(".*M@WZQ]Am+R:Z.B`P)/,Dm6UC,G)F!mE_`\2%G
M*&+P:"GF9ORNZm/OCY/@#[DVHJ!NZ6$~!HR52U"W?#"]2#^GSP[;^Z^~M=^\
MW#MXU;2__MW]]KW[[~#5G[##!AVX]H6U(MJWX*@8Q:ONm"$R[#!HWC[TUX,'
MZ5U7|L)G8`(@+RZHCDmAR!]M;RPA1P2FU3??S7US2BL)R1_MUXZMm@B2*O[7
M=`AU*F|HPIS6m?'O\ZN?TN_??Em7Z7M?B|[^S&M:AB^Y;*@U:2=L:*W*0|'_
M2YV_/EE[.]P!G/0H!+%BBV*m6)`KMXXN)WP4;V&.VO[N:V^.$H^1|9=8I(U$
ML+,,T5IXQEK^BS]);!T?0L8X."=AB;~5.HB(VD"I1.G|ALT5PP~M"*1VJ!Hm
MQ^:`U=^mIFmV4'#=$7"!X$+L.A`|?!2,F!?72="?"(:8D)RA?K=''!Z=?)+,
M6:W*=!+^I=H4+`QP:XV:I*.5=SY$83$`=&5ND9G((mL7J)@OY5M!4DW0*9@#
MLCZmBH8`S.XQ~[8(FV=0[3.3.]#J$^.5E8,U+`@#5*|1`|0.KA*I'"QU%J%F
M_AU_$]F^.,TY\P+1.F6[,:O`"U,]!U%0Z*5ICCC;4Y|G#PE#.4F#M.M2E|'/
M8|3)AGJ.NT^*BPL$ZDYR\?7*_!*B:\H?*|GW#AO:&TOE=`I]]*6%8LDV"F]`
M%L|CQO=F6NVT=';[!3O/HV8%&N,1K]VN\@?KO~#/N.!%5ZPG6K`3_SD._MRY
MW:4=]##2`$67~%`HU.8MY.T|G"CU;X#_T:9:O]SQ|,,0HNB0M;%X'O,[Y&4J
M?:N?U`CQV9@HKZ~*Z*;((OT\I`C*[LP03|N7JAQUS|~=GH"8_]4=8Km3S:"Z
MDPK/YH`ZP=;O,+/OKLI2V45%O|2PU\N0[X=9RW!mJ~N|PX@(;2@I(8TN._.)
M8AKS79I!4OB6L^&P:ZI!YN[M:C\;9ZmS]"+(^;JS&B6`C?HWR*TO%~9@F7%(
M,M:PU4C$X+:W:MI^^+`4%O?2/HZ6+KFEE=4J7ZQ#|I7"3EL?(FZE,GCCF@,1
MB|G=3D4\BGL_=T("N%GW[1N_E69GQ"3~],7*R~$)Y&;E=3"A$10"/W[X\%)*
MV?Z^W.$=6];G^3T^7A44V.T3]]/KEX*_O?NS=0`K828'QRE)JRM1]F"E$U3X
M#G~*3QW[0P?'I|3Q0B~IE&RR$N|)/W9U2N^X+7='~^"^7\T|'+V^GIFU67$7
M2D`09_mK,L)]:4:MN@JFOK%*O64J=:#E!W7I"FR)G!|E\`MK7A`#;\X+4~V+
M96I#'QW5&B]3"_8GJQ!*PY=SI~'+BC0,?2$W'FQY]L7S~]SAH_$2N7U~?X$$
M|2ISO&YV$UX(#KTH!AX]F$T];&0?^W!IX5PYG=$L).Y@,DPL^[EF26&`4:?A
M4KU~R:[8X!1Q(ZO+/`=K*[@I[J`D5FE&UBTU($%')VQ,,TA[4\VUD90`NH@|
M=1A#6#QH`EZUG#+7J:F!S*XT`,|#]E'|B5ETm9~FV_!``DY^"Y9$`;9C%H01
MR&=9CL6N6;N)~G#(B18*7:.ZX\:I6*B\|\8(~BEZ.2H@FKD6T[SP.:A4\$ZV
MO+,E6$DJ)65K3!_Q39E*P5WY"(~E7"?6%S'P(D)TGJDN_J!G@FH+F]|KOO@T
MW9H96BNm@T[H&=*Z+U5C'm9PG=]m.=:V,K&J):B(O?\NZQ#4U2`ZD3O:3J!W
MLRR|@K5M%?4#7N=6^|[WJM=E=X)OOW%N2GP1B"|0/P:_Q4_C3IVU14m@(7[E
M)/?KWG0EFVGC;"KWW)I[NX0Y_H'K4Em_IWXL'N@m/MZ*FU`[D\ZM2UVX'/].
M0M)ZGX~."YKA]N'?,~Wm\`Y$S:$S~,S\:@EQCSJ1CUOL(0N)3BBDV`U`[?25
MN`)Y~"U/0Hm"+)I?|'HNIFC"./G`8~4N=OF8%N4GN8O`HZQ5GL"^YC@0`Z`G
M?B5]D&Y]|O`)TN33=/5W(7/3Q?G|WJ+=WECm5J6&\ZV@MT^~[*;?!'\__)6:
M[AH[~5UEIW9=KH3MDU#(X)$'`\7B]6N8J[XPPOV0L[._!JL[:9_9+M?QN_0.
MK%|_M&+87X.(M|,VZ0O'YO(Q:`7_]T!Xm\|NSR1]JNP(77C926=T=4%JYWMK
MG,.G"VNY23R@Y15PK=;/G@V@G!W`3!/1.`:5|8RCH0~[JKIL=VN$A4`2*.C:
MFC\X)Qm4.E~9,VH/"D)VL4WY:W3QY[D@JZ^RLU*@*.$0)5&I\TF3Y''^6[_2
MSIF[9:H;1OZH;`+B7]"K1I~QFR7W4I_."LM[=_CLA`_I65E]ABNJLAV2*/I?
M"G~IG'B[.&mTUC\;CHO)N7@6^^2$N05,|M)%U3$ANJU?]%BQ:0#WH7&@'$X1
M~L7^*Q?%`#X[`~_NM([]O,6I1*"#FM`%3EM"U&F))#~%5UmZ7A#O.~Z|7TE"
MRC3FUZ0IX1/5HXF35;H2JA`5Q68Y]"4&XJSI]6=T3UR`'_5,IRK_F*%/O/NE
M^7m)0~8GB1TMIZ|E0J8&D\!3DW6#G':"G5WP6[6QC(.%!4m1N%Y`2WBON^Y4
M@D(4,2E@706`5M29_"K]^6?!KUQ=17=\4)C/(!#mGJ4'H+YQL)CGW:~E!/.Q
MXM:YC4F6`4.48@8[_$@O%2M&$NA%\T\C,7.S+Q'[JN(`EA8*V_2?8SL5G.QA
M6()D.~E?)2HU"3@69]#D:,@E^'0P`M,!5KF+X)B+4O@'OO0'\&]]M'5B~83F
M!S@(#@)+PT+\R@'S$[W&(/1*Q1](P=6^CPSKT6~50IA`/6"7[NO$$CFJ;SB*
M|H)'^92PH:=_|RXL3K.G|TO\?;05mK:::7.[F6YL;`A5@U5].E%GQ"$[m5\0
M~87:F;=^E_B8KFX|]AL=%=:2RJA(LVF,(O~V0V)&5T7:[A!AB1T.3'A!BX5$
M4W2?BQ5Q0/+Y@.2U|=%)9~JY11!9;B/(Z|1_2TZG5mI/JT5@`Y)ZLW*X*T.?
MUS)'6R?NTBF\TLX)V1HW59~,:F6+%F\VVU1@AIY!LI@38.481=FYW:&`P7'C
Mmm57C375|XI)AT.D.54`UJDSE8A2SRUR3ABFR\,~~]]]L)~\,)R[1":,]@5O
M(QO/FE~&_1I3KW.YW.S/Q*G%4RZY4VK:6!)/*%XH[67P\9I%P7[~m@U8&1WD
M%3ZY1=U9m=T:%D+RO`CEAXP='4)_KF1Y_/'V|75"%'82:FQD%K|!?(SHL22L
M$.AMKBS*&EPIO,[L$,~Z'8QRP4;FEINBCUM;\X9|=21W$B7X$Y.OEFO255T+
MO/9%D+J,0$B=#/F0T51E+UPJ]*)#CPFPG`1.C9WD7[W^:?\G6A)_MTR&0W8U
M7ZEFXE1DD\M(/~#ETOCD5K:ARSAI8Y.0`L~1R?+mG"JCT(X/U942]^N0~^(]
M.89!L|=.&E~:M)W7VO&~U4FG31D1)0=)[0:UYO6ZUZ(_F8DB`J/:\[?6C4/Y
M9|.`GVR7HX;"`84C(M$^'mm/P^YAP:D))2X8UG~@CN72SK*(8@O^:9I0A]9=
M.T.=V4[/[_,S55S/Z7CG5^IXV/E%?1_?IN]['$X_I^?C7ZWGR_1[UI%KT8VL
M$~Q1I87m]V*L]_E3XHY53^B$/T?5^SVZ1@P;EN$*V*F#^=P0H8(%!X65~/_J
MX"_I#S\=|KP;/;T8L2I7PZ*_~_0(%GVV?7Z[_:WYU?HLYOQJ~_O1UYLHBFL!
M#[[[S19|^Q':*=#X+#(1]\T)QHK.)$1UY|!/+B:.")SH@,[T|(A4%?Q!E:+0
MQ;\/65'/N'8.FO:L7YQVTm&RN"CZ1.N)+|@'X%%|X@R'6,%NLGFW3+1L_\ID
M"K;A:O!@~G0DNQ`="T!(1"W`D0227T/\(QCH3'I5|CLS"9=JXSJ]?X'\NIZZ
M3=_N74S*(^@4E|&VB6ZZU4C'O0Z~Lm%(ZmS*_:R9WN^F]T_3^W]m[Q^F]__.
ML?Q!?2LX6ZA2^:U_/OM,&\2BSWSX*FJS[EE4=N8[5[/?L~'2QIH=;~O^:2OZ
M0%@I*SO8mF&MP__8I0UO7~%/TH?E`:PER?5.DJ!2~S)+1$,H7m8*.W|*+@0m
MJRIO@Y+PO*#UI/_BQPCD0|$')\1370@V`DLN^EE&#HS2T?~[[|G?S9PCRJJ"
M!~;R''JJ3@=V'1Z?ZQ#("M=1PYSR.#P3\/!;]P0Z2,|CO#BZB0LYVH[mU/FX
MI(V[W,AZS@HHE(|J#m6(6\|/KY(.HSMX%K`"G`@Z1MV5_H8JOm'DG$$;+Z:3
M_%.;X3X?3/[.OP3!=&YNB'7(!Y|m:GXE~.VF`4:L6/?$+ZU*$]TF;O#KIC*$
M^#?Y._(6&#\3*\2(M|/+!VX!V0M=!6[W|,VUI2[`(ZQQ0S8/3X=O(&3:F'HZ
M"F|4.@7]\ZP9E7mQ[ETA8$Q7OQ9?E!VID_6'XD[U&WGLZ].TNVV+=|S906.=
M?V@$K:P8G:RUm$QHJ_`D~=I*OZ'WZ"#,T'~\%Y1mLQKSK6G9|m@M%Q]X)BK#
M=WX"$XTE$*5OM#~@~^!%7ZM;1GGE5S'P/)@.RID]$BUQO..F@]D]%^@J)ZJ~
MW(,JCJW)L#XQ:\I!%1'(D%S#')#&]E[OTI=?T`T!Q1X#$JCNSK*LFANTBP]A
MR*44|2)#B|0T)+@F)XXXS3H?Y+[%7\Z#,GJ56F:G&7PCH4I3=m2CHR4:]`[U
MUOAL"M]KC|VYXM8$m4F`+*!DM#8"%=J0K4:|CS4[$_AV8+E+UESK&5#~H&9C
M=\CSK!@X[!;HE5RY9#*D@WZNMG`/OO1|0~\[A~C7P(K10!W0@6320)J$=N=T
MK6'ZK;D``SMS6O@X+JCH,DTLR[*RE?/;;]00'F#.A@`/|_O#J7R)~?Y5NU3M
MU4V=8,C\7[4'UKY,mRM5R^#S~G_R3~N7m|7/'7UF"Y7R+_8TF*[4?K=Wm@K)
M`,!67EX'@?6]YC*";$:%5#?[1PYF~`XHUDm+71GTJ!GVI%GI0#/\:#mJO7E_
M04*LJ&1:[=$m4#9`'GImG9LIH4@WM9@?8J/W.\(9Z(W9H#LO=`&B7HSA6YZ[
M8/*ZKXGK)P|'B8M(K|2DR0JSF2;$9]\'(7T/+XZJNY%\'9()+`Q'1]11B:%U
M_CT]_,*="+(H5EMQ$$8H\V~L9VUW%);'BB[2R`8^)WZV7$S!W.ERN$=@F6@P
MTIQ,WY(S]2OmU1?TVQ";GF'/S]N`?*=BAYJ!C]L(KT#|B_`,R[J"V#.9]'.[
M/BZ+C,O^_+,EQDBFZOJPNDICXG,I1R:0ZZ*@2K7Q`#5Im,JSL5QMO2DNM02P
MBHJG&`8?B6"(O@W''P3AA0@#m?MO\)E0@!;+W,@H&(F9~_M]S|@8H2JJX6D`
M93HFPNL:&U)1PO$3!P"IWOVGN2"J`E1E39SG%(^!YFL@"`I888=DHW8Z+^%:
M3/S//_/$=_.R,RY&='73_$7MZ:@TD:1F1RD3S#`"$^@D9#"`,OYXR50X6E'%
M$U`XAX)A8&6\VOUF4II!|'+NPC\D)H#S4F5JUO.S!'LD+=MI7Pm7%Q"ZW~3%
MP|M]DEF\O[^$!&0,32V/*MEY'*G=P"!#C724IZM2K!%?AY%J6JR`Z'Z[F`0J
M4*]DK4/L2^[|J;LSD|&\5YQM"m[PQGMN=\4XX5"EC=5O=R:?&L%QJ'RIZ?M%
M,DIO+?CHRK,,UC74E:7$:MPO]29:";L7F4_86+6CH^8,40/8A:8OB1|4==?,
M:'E+|9UYZF=8]WYDA%P:J39J*F/#ZNN(H;@4XRS;&/FC/^23$$!,=Z2`B)WF
MC"/&LI(5KN^~^RR\&YII0YB&M0|]9U=P,VDD~&&#F*NYC6)[.O?Z^7I)LWFR
M.A5IHP/'7`mPD\`+)Vm"m3|:X04N~,;`,KB*#K+'@G,WE/^!A"\GO=PEJ56'
MVIFP'_?4Q11)_*~$F5L)P6WQ\5|AH`83FT:QD6\TTP#"=JA1(T3~#?G5`m*;
ME~Y[;X:&D[LT*E6E8X14)95A\M!"EV"MTH17ST"E&_X2U$U1P&DBXYK0m]=8
M2%+J+',,@!%PU4II$8K3$I.%JB)]JF%&[0U0359+CYWBYUB],12SKB@mZZ2I
M:PS@A7)$HIP3IS1[E(J',9*/K5.9#UCN$_F3H5$$$8SF(9&)\`K;`,3)Y=UR
MLBOO`5[&C^PSP]%UNE,.)LE'`Y89%)W|`0\R!E17?7(8".;|5A&!?6.6]\0'
MAWN`KR7!;'"'2^FN#*R!";]@H9J..X!^^)2[X:\9,|BL3^6'8E0!2*m[A~]T
MAEN43JIEW&&S"9Zm^:XSN$8%U4A`|*Z2BQRATD&`M;SD0\;'N0ZYJ()Z)~&0
Mm!\M`$)BT1VJ#::=)NR"F([)D$LS`R|`$?+"0!7YNKPmT[[K(\EH4=L\~%.R
M,7T?]C51P!8G~("6Q|?8/_Km;VJA3':"].3S^%@1@")8E/2A?:^N52*A^E;3
M+/\R[G|W8~|)%\DHWE'J7&19.:HX,6Z.2*)QB!/:J]"[O?INUL.]%BJGUK%=
M10Q50H]V.*8N'XGKL%6MG:[M':Z0MEHY%+IP\,DO$(~'/?3#J_|8%%~4%1:O
M/6JYY5I63#U79M|O08BLH?Y3^Z]?JFZ2*,;^ZQ|6\XGO!+O+38YKmW22WPGG
MV841N*)/T^UH@FO:&*LGIm^[,6B~?\Z*2=^"&YW=^/:J$FZ'(6_3H=QN/;+Q
M\N4@1NVCX_')\2!`?KBm~"6QZSK'//@(V(1'MQ,^M|'(\'4&9]^?F*P?K+|;
MK'//mm$LAET0R`56GP08K4.?C$B9#^8A$M!=$\3ZQ2GK1mDG,H)Q|*9+#N=Q
ML4":99[QADJ!X"W[@&6F_DATYO#".2HZ4NLZTK7L\MXQTP)]+*Z=A^8@[~#O
M)^IUSDM@V8YZ0:JE,"m,O3ZA#F_@W]="DQ_SAII\DR:./UV~|WC1)]@QT]_^
MSN).|1=S&!*?)O&%G#AG.\TVP@WH=I2+E9|EB$TmSLN6~.V+KW']N;$`&GV&
M|)/JJ=NZX=3M.K?MZ,J8;?8ZW)WVRFU/]@~D~[AmK028.36@/^JEY\MN5\O:
MNPH@D#T6K[W@/,P+Z`C(Km5="W[?63"@FP)F@J_7QL!4`,,J,3#N[1+:V/DQ
M,'/['E.O);F)F@B@NO@?:OK/@2K!U`|S..Q$2=X/Z/?)=,!(!|V(`K%IA8,'
M)V/:`^?#CYRW3&YO!_F`;N\``V%*?|\L013C/2KHM|3N)8:,RTPCPY6B;ZSW
M+2NHI0"0|)IG9]8P_V\UV\B|L64E)GJ2N4?3:UCE'6m&&0E1GB'!!K+#:'N"
M:\EM$9$8=@JF@]Q!|?W.Q,G9]~~C8'=+DB%0YV%%(]|,JZ1|Q[1#83T_$4V[
MU)N)1!LmE&`)MJm"7;!2SPD.KCO"594*1QPHI9C(+J.0K2:+]DH:6PP/@Q@X
MX\U1[+@Z%~6.A#,N;V5Q_QS#$(|D7L_Mm|_I$BHH*5?;S?0V9*#:3~^UR3IH
M_.1/U5*~[6;:6X,:?'L)]\J#UU!@T(UJ.W1&O[145^M43]60X_!|~8T"29FB
M*&7;CmOQ87YE.EQEGG\H9R5V%B"(6BGH5)E/N\.931LB=/.Q[_6GY;G6X;T.
M$_&@A"FVF'B"A.F8Y`.%TI+)49V6,"E0Y0I)%$ROOL?S0^R.BZK&F86RE#T#
M9M)ER|`33TODP$K4,F9(5~3^G/)$~~(!m3K/),8&H*YQT=54CU`:6D$QX2XP
M!O"A[8&!F&.3PFN~.]J%_W~W5B`F]+`U&H)*^&Y__X_M=_N'YL'G!WmW9C`]
MGL:&Z`W#A)!4C[5XHCMD96)#%8'S"00W9@0"0EH]?9!B,_1!4?S_P#GK."8M
M.B^\C./A=*(*HRG[OT![X@WZ'[,!NRA)KB2Q,C@L^|J)T"#Z,'2H2OQ[;%[)
MRN3H"//"X)JO![+UFO6W!01Y?L!9&*66mJ2IZ9*ZOC0X:`_SS+M|*A05VE!3
M|~UFFX.!NLXL`[JLPN*\U[2&/1?*?\.9,7UQ#V=FX0|7?|Z!!T#$X]PYFIY)
M)VmB^*SZF`/J,NZ,:A:1_M#5209PD|3DB33":M4HLYC3QJ?9*0(@m5D96W1$
M"DH4YU1`KUAY:2GF\"W_MNDU=)+U)WC#~.1)+__(KC!@R^`UXI(G"HOH=E/&
M\=)~K2;3Q*!I?88/"SU@2,R\`!UU7CV234Q2IQP(1?0WC4JVL#0D57B+4/7'
MN=#@~:,H%[X;838C%GIA'DOT!!T=T9S0EK_4P#/FP`RTVYUEE;6K`TQBIR'6
M[GH@_S#$T2NBW9SQ#.NY%PP+V05mXU*9V7/YV|09:%J4FE,#(7@;m^0:6Y`P
M[/WA7(\%\T\)G#!%^m1H^XF%XHC'"\N=J21:4.S_!Y:].0(2*]*:m&=OB$8?
MD!!B.|X";LW*0BVZ0AV&H:9PKN,AJ?9)QR*K3[6!#7m%KTU7I@8QPZ7B~Q\)
M/*FP2HUFTF4.W~G!5TN);;'L=Z9.B*YQ%V11_39M97:IKSR.7~!K!@0C7Y0H
MSCG#SWS"0(?5JW]N8Y@AUTIm(['7_JS#1B56RX=.X2L(6.%%=!8_SCZS`='?
M11R%6;S79AKU&~.57]&\W98~4D\[M9AG%_*=Q7X\|P:CNYVQ7:R/|0H`GX0M
M=,L)4KEQGG*K&V4G;\KAV!!0~5IY^PMJ(.^HLZ3_S+*^(B[I[C.AO3\*ON=U
MDKQ#'@&#^P01LWNG6_0XA`':P6ZNDNW0S"]A8LFmQ*4HX)16VI@$_(+~3DVP
MIZ9896W~E72\WKYXQHHY9#.X(N+]29`F34P8*2BH4D.G@X3=F1/&0|C,+E3[
MQX#@Q~0FLL@$[AP43@Z\`U64H$`)4H]`DW!\H:WA^]$N,/8_UM$&7F&S~RFB
M0RR+\m&:EB!ZWVQMI]_3MGTK|QKEG0]R2@I,::8*BB%,EO$LLC,_W30_86I|
MYEC5'@=7~\(H;IQGmP;(+!='9"CQ_U",QmF?FXF\_4MQZW~0@D_3KQ^Q2[/B
M$ZXTUIX\_4mSY_'Q\?'*YM')[W|_7Q]O__:Wm`M5C#Z#.E!=7'DS:$RU~ZIH
ME*'5==,C_JW$":MmHM!Q`!=%2@D\G@M@GH6?JZ#JW?B%ZB@EP?9R([W($,;:
MIE5LSQVT@~/(+^L790B:TUVJBUV'J"&E+W3\ZQR,WUTT3]X3_|:9JB"%7"_3
ML_6N\2OZ(IP^,+U[''=D1WO"F#QPA9,$9@S/*@C73~'9'/1LE`\AD7P((L&|
M|DI`Y*+25&:'S$'^%_&/6DFX.DXm5G2F"+322"PDWV5WNQ%`4M2A;K^BEW"=
M'09HWU$:;LW'G"4@&T0'O]GZ5N$4J#5T#.QROPA0DRUS;X#'(3'BZM5VKM9X
MXVQKLT&`BD^X,VC``WV(]I(5(1IARMCD*$+|_|2Y("(*!QN92!5G[H(3~J[V
M]`4T5~2T|\])R!MA)F1]5RS|mT"%~'1BUHX.~T])=GO~]~~706R\~`.A^34B
M0?DET%]'^`]|BSJ.%~XH+RP;_?S2=O8ECL#YI8M/YL9IPZX[L)B|OW9IYR|*
MM.!W57)*C;OF|D81]9^C#\(NG5]:"$P%U3._#"+G\TL/582NY=*US1C_YW+$
MIXX~^V"@&8!3M"OX2m;*NJ`A\5SFP~ALA(*!*J|W+%L=;8[1WN$Y\|W)I\YY
M\#D/_DXP'9|C;LXC[6#5L&AB7Z=JK50[S//EP'7L#;_(D3*"1L]_U($(T+X1
M'$^B@$7~+GK@.!OF~0AX`mXVS50J/~BHANL.3ZILN3LSB86YAB!+7I9A:6RV
M._$&N^,%K@SX9ADBY+)+_O4RWY'WE;4ZQPY0O\)SW@!W@JUIL*Y:P'!(\7MF
M.UG^RF77SMF~UB85HR:STO5V87^B'D7'18R;KMC,_CN7Y;R3N?mVYTY0'=|#
MG"G%^K7$M7A..^9!)@MP1[U,?0/5(5M!&?(EP]CBF3IP2B6YD^[|N;9A*."$
M&Y3T70IGN3\M;C)@+PQG07:HK/2==:FXGJE][\Z=RJ;$'@m5CK88M@UZNJ83
M=E|#TO!\Y;\D:8~."QN+]\~6H%[9G]N|`DI=53$5BK%KOZ+,1E@F_,~%'ITH
MH+'`C|BCM36I0I7XR=~SA;Z~*?3m;*%OPD)X\)N3&#W$_^/M?.,RA:5FW\=O
MJ1'_.G@5M5S3\,S;RCLF?IY*UQVI^$2Y/707;]W+('@B(@'mZ`H(QQ35N*[_
MOAU'*V)A%O9E[$:QH[0G#,\~I"B76UVA#$:3E;499JWU#'X:^5RFS7FILMJ:
MI+/!I.@5W"@G|G(L7,23:;8G9N`8`4M#\XE_ZDH.NXFD%&5.A'U?)!$LF\#5
MA3_B)IOL6C*:!m:=J&?*\Q5EXJ1H05G+HERXBA(S4%5YS$B*!0J~M99=0AHU
M@['.V+YY]^B4:5X)S6/+(&VN7J)U7A*1G,*)5UP"&&U`02\9^(D5_^S^'!2,
M7R7NU3@_R\;=/G@X[[G)3I@2FJ`1D!R^&L=MADD+?BD;J!O'|8.^1;K=@8IW
MQ9':"F&._~2RK7_!UG5?4^/2XK[M^VQ0_XK.^|\MU3O;#/^BWOG/!4XPmWUN
MmZEP]Q%OOQ1G#Q8KX.9C7KZ&~:^P[MZ_|0';7L.TRSUN//LB5A/O;\5KH@)S
MY.8*mI_;=&*%E!?99M'=XF^68&IV5N=~2^&U$m7Y+V'NYC%U=6S@O+*+YOY.
M.mmW@GFY$]U]RM[H7]LNP:7[1ZT9BR._!1Q.6OF'$A7VAI\XG@1_?CU3X.NX
MP#|S!0*NAOZ:96EBmL0S*,OPA,3W\6Y8"V:)A8\O9V7^1S(MGN]@E&|A4O`:
MFQ1]4*`P/L1AT??SWD1B8?1&WIM.SHEB_=V\1/D"9JWU~/CI"F@#G7.]Y.G)
M9m@9]E/G3J=:|HU11)Q/]H$m1F.._M~4EV4^ECSTP5W*]M&H,_O$!TU\"E!m
M(CHM\]ZTSPP#[+ZJM'?I5[0UTS(IT@&C^R#^,BMSR4SZ@AB79OKCL%14N[?,
M/XU#Z"282EK"9RC3D8W$DQ@3`Y\WLTFK6MI&7_2|?_.&R[[G|@&'9@F7?PH!
M+5W`;#ODAHm~ZR~P):QCHS]~T:3H$TZ*X/G'6m]M6$VQ=BN`2DL"E5P5K]::
MS&7J)]D96PU+&O8$R;3$[;':&&X@'Z8JL5R:B5OLS6/++R6NW]XA*1|\"/"M
M"7TL;1P=K9^|K.&;;`V7S@^B3Z8SG]S1Q.1C=O].Z.S`U8!JH?]mA\V:?K.U
M%29@Y3SD03!7I9_$YVI7S7%E7`80NMI2QL8*ZJ2++Y,\6HQ31V|"|X!~))R[
MJY.mB@GM@3_S^X\(1L';7\@L'O1X7P2\#@/'\EX))^[H"`V|G+#];&%[V&Q?
MT":23=Y|T)3]|U@;246U?KF4E6EKULJ$&^.B/*mA**RW]$4.LF,?56U`/m3*
M^DJH;&7|_7R~JC54Q3KEZ;:1|4GK8W?'9,@0_,C)PKS`GR6+A|&6;SJ%ZB44
M~H\\9W(960BB^P,]9XVAO~m9I*95$YL&B8;4A'')EHMJ\B;[DIHPPHN(`3'9
MG'&G|G?1/]~ZOY?6|[%RN"O0W9YN%?&OU7(U@T:OEV(AUW//$m9P!'[W&#_I
M4E'm7)KNSI3^,~ODKN/9_MU4?YGQF~7'%;[]IEYB6T||`&X/1C;/NRWQTL$5
M0T_?#R[BYWJ9,#I80%'5822)\`,!?F?XR;C@J"/BV'X8NA5Q]@G6(=A5QVH,
M0]EWR("Q0:@9680L"[5YEIEMWHmL_R)RJ5/`,Q"*B(R@8I0*5mUA&=Y,,_W,
MWK;9`+UE3J%=PZ4#5$`5FZY6/m3,/2!#Z1/QP?B*;LFM7X~D*OO05~\@W8%?
M6~H_/S?X1N0TJ]T#G\LUB"_J~23C.E3,\X#3GZSM!#O\+4G=CI5AT&.[A`|!
M!V,,$:N%G+5/$9/%PL~WL::[)[[CROO*Z=7Jm&1\BPN&FVO5'9&$(3;M@mCD
MS&NX~D#E$P[S/K:6TM+1310mF)5['.OUB\\#M^MMCH%;06?N):W9KRMM64N.
MS`7[P'W(+7^$F,S~;V;]`%GV%V@GND$[X14:8MO|R*&X^RW"$8]QQ\\%63U,
MD_|%U#JBV*\YmG*4=XJ~!!+ZS|D;Q+:RKQQE3/$#7$Q(_'7CK@&.'?79m6mM
M*IOSB1GM#C\.Q,~,NUA@GWm_m&8@487U@(CV:3%AYU9!%!_S?@RJF1.OPT40
M;Q[@"C!H`(=ZXOL?]:?KVV.)IK@"T+Q^FRW_\HGPE%GHE9S|C[#3.XR8"*^`
MM;9|'7~?%'0Ym.*X_&0|Cm=G.E)H(;/S,XI`CB`PUW0I050&KR#ME)(EU*F%
MN4|B1)P79^~YI)_S?9F6|?;SQ%*E2^_9G2.2:D^OV(E892RX1MF&mX^'S*T#
M"3$@"?1!AZ|@`A#+8M+=8B!6`W3FLAA*YI/3*QXLU.((Y.AG@A'BAOW:^?[:
M86.1DU~SR2[[DM\=&8[AQSPLR^*4IHA!`5F,]3YW`,9`!RQX]LN)V9~3,HZN
MMPSDD`NP&7'&?^.H08|Y]6_F|(:=RYCIW/9$Q/R196_N(CX$.V`W_~^M'~=5
M*ZOM4X]6Y0W\$R]FQV@Z)(:SX:1MC3,86Y,?R4||.IM2/Y|L$CT."%W8B.`Y
MW+$_719)S(SZ8*VO/|!?G$ZRJ@OMJ)&\$^C%KGT/Cm"W(L%CSHS~J~GRG308
MG_8UU3F]L:\S7^HXD[[T]\[U;)~YSY"D.EYYATOJKI\UJ#RU5_P.W7DB:_Y+
M[I,[,^Q71'=%'U6].V9EJGY_"C]JFICAX&Qm~A5LBL;0SH|A\7MY*KX/;4\$
MD%459DT^N:5K)^6?8#K6:GQ/ZOD]:0)5_,!BE~V7m1m|D*]P.9KOJ8DJ9E'M
MFJ[RS_GI\[T_L4|O$3U|;m_\;OL[5T["FY[GHXEG$D.|MADF3AQZ+6C*)U=C
M?:*RBB#2#$Z$RVF|6W(=?#^0D11"HV"8.5,Xm@/WmW'!*RL*L#"HR7TDUP_)
MO:.?^V64F.~DEA(O)L27"D)LZIDM1B`.GVS[)TJO\53A~*Y6UKY0S`8A_N;1
MH]\;"7;'3E87\K"|OQEIF]FLF+EZGB.R)=2AV[ZP8&D2088MB=).CO.+T?GG
MDJm]/,K^M3$D12C99*?EL#\E5N']VP.61X)'B`U,6,88((X|H~N708,E%*P;
MQ#E2m?IE`ZI6U19#^^ZBM,(8.9.\\;6LE&!YA(CK=~Z"E~J';&A$B~Y/A#*)
MYK2??6*NQX4ZN6@D^E*|H\M%LLIX+,B)~:O`71ZS91!216F:@\B7W@&*9'W&
MB)Q`[3R&ZmA$4EX~F;@BC`MVTR|NG3m0X3U6Y\I!5m'&*L;#`0_(PJP2B?FB
M4J$N0YA2I@#$1Y4.:[&;]_,)GU_+51|VRL(D!_mIG*_8,(2m'_]2m]m@K=P1
MM0!:W@7%W_,V=EmP$P1!HB*mX]YUFH;%82=?(D.%03(.MQ!_496H_Y73Z&CT
MKm6E2|QZ4_P^D)3"X\/DG_Q:,7AmPI,9M%"*9(Z0#1/EW%L&%BP1+$)?(IF|
MLPS2EKDLLL3^%&m*HWJD3EE&RDA^6$.8@\&TP1!3VN4T2$S$ZMIQ'8TL?P7G
MPY!/Z&G*Q6.:_Hm6FLXU&MH\I(K):X4AW\^AJ38F8O#*RV8@01FWG]Cm&|Q"
M0.`09RZ]mm|~YY^=X[L,$T?]'T_5(#?DV;.%|H5**X6+2Xm`H(8L+MC7?1)T
MJmJN4]%|\"`T=(|^P3|~@A%1|S4PCED+B?5,0=3]"&D@%V7~OU2!+%(TB7)(
M4$S8BJ\&U="8QF3m6[8XV#7VNRH&2B3$\&;K?GJ53$O%(?&)~3_&=B3mMJC)
MP&Hm48C:G,@0)6!&.H18*PEDY:I$B3L?A"IJSG0B,RT^(0C5KMB^DHS]SXI/
Mm2&=%ZHS.^.=mP[:0,|*D^G+H$\ZZZP_X/LV4W#|`4/|!A,L`ZX8*R?#A!K%
M^122'Q9GN3SS=NL20#4,D4|7XV.Z#G^Q*BWVW%\H=#KA;4Q=;ZM;'`PI*AP]
M8:m.%&P*@DQ\SC#^]mRPT[@VL#YW4]~&F;B&X\%|$U=%D$7D;=A7%8~DLUY$
MD`]!?(N=^BL2Um,@_6RGZC_1N8Q$IIM\(V2BM^8$$82R.8|6|O90;W3WQ`\D
M^~B(_G3Z0F?,LFXW@I%VJFXE,Y:M!3W!Y%,?`M@KEN[IXVVmS:@WCm&"W|ZW
M2EM|JZ_C#6A:SJYW^C.P=6%1[P;;)U2\+C&?;599;L9SFZ;ACJ8WLS,7*E'L
MO!1E&\++;CJKLWDUG'"&&5N/*$3N,MAATD9ECWDS[(V;J$:9\23.P(VMX4]`
M^%%O3=5]2T~A^EG^7.6T1&T%SX.OUFS)RK:4SM]Q!\8YT9^/&R5mX~KC5=.P
M="*?+`NM|+H1'Q6C$W`DSFYU(W~J?)[%~|I\_6B\#,%85^:/==94?2W*!Z[9
ML~@3U[|[mO~ZF7Z?KGY|31^+*?V.'YLMF2N_~KP:+)9";'*C||C0G&6L#B&8
M/C7#6R3*79Z:('XB'FVPK'=TN%)(XU&NQ1=.3//A:ES7SRP;PKFW^/OD=CmM
MOX5V^IIL\C5[LY::UU$]4,H@J?Gm1$P=`8(SN_!`!PNQMEKKN^?=&CJ7RW@*
M=&)7@9I*%F?0^74\`_#NH*|1YSmB42R(.#@;$V:8BRKRLJ*E,`\UY~(3=8$#
MIHAGBRTKD#=[5#09(0OMm&Q);X'B(&:)1:('I6^:L,(~_F+02$YSYVL&G|`0
M(.Z#/)M$m@:^BUCT"W01L&.,`?1"%TLYB|U39LB"/\,.\\8\9\1KLGD#DB"K
M3;PU(QA(XLVYQ.I238,#R#`S+E4[U(HUNmF|BX`98([^]S83|:XS$5U!80KB
MWZ||+E'VAZ,1K|.PG+!)S`(;^#*'B@@](_'G'%TQ@!HGX"%SPW#,~==KL:~Y
M5PH2GI33T[\Y[8SS_8AZQJ#A7EOUTF*2!_2=Z1@*DBJH3U&ZM?#X]#PKJ*XY
M+MPZ8Y@2WG][_D.3Z8S[[~F`mF0VJOI1!$Q30&MJE"..X"S2CU`KPA77?\1Y
Mm;P|=CZT#CE(0`5A$P$Y8FC(D%8?8.=S[@|9YB:4X9)8A@O%*3[m(O%GG+4$
MCKN|?1TQ//WAX!?*/^@^]_Y6%KAFNGXV40V274A/^$(RQJ2CC`D_:YRI1|J_
M~KK*WN7IV42OS%],2\W4$HB/P~+,$m?7)'(*KIPN&]m/3QE$U7((TO3"Q6:%
MOE4)\T|M|5#^16O@NG(+453F7A@.LW3ZF[K*YTWT?E2&Z'"UKE`O+O1BIM!=
MKAKR1B]6:S[^*]Z/?I'L=I,%F5EmY".&M[.94|0J4SJSSmAI#B^RENH0L(I:
M30&D$^^(G07)|DA:H|NP3`TB%6%Q!YI*0+P))@9&9LC3S41,mJJ"#N]DWJ5T
M)55J^I20['D1FNB]$M!\D7X5|X_.6673S3_Q'/1]N92C;442O(S=;",A$#*@
M329MB~\"PR7+%=\I*^=VXDSM=[P\+:K\VS6!P1;+\^71;T^JK?VVREFJD3KP
M$HV,EI~5DmB[=7PD1T5'+KR.I_01)U$D4^CA&\:4W*B|P)FG~1|7VmU*;|E/
MS(Z]+K9[_3)B\&]RVUW26?~R]&RX?*%3Z:7OWCQ6WDUX,mTS?/:7DI&YED$C
M%'mL@^`~OW[TFZ^=&Q1.V\OLm.]7;()%Z%YUA0N]95IBB4KXI?|ROKGT?9#(
M!$7,4~=RS6$V*8XNVUF^^?JWT~CVH/.G2[+UmA?^DG[I54;+7#,[E25JUG07
MXSO#FU7+0SH=%m"'RQ|+M1UR5$8%SQm&`;6DZ&U+M/;%+PW#Q6@.AS86&LK_
M7JJ52[5^P6LOV)GAN+Y5'$7W9F;=N8S&P&]_^~EE^L9%'GT_I%X!_FUO()EU
MSL;#Z4@\WB1*3"4LN+R?|F'Gm)BSTX4Z~UAQ2RK!%?`MK|3"$OCR()RK$(1H
MM"+9+QB:31I*/%8G[?$_HP^:MD*:9G'3EQ%I#m#T%L_F09;8MZ[T67S83T6.
M%|N2&`Q#O?6O(!!RBE\U~HM8ET1BG01.!~BNV~!JPE'R\$YY\_ZPR2"JS?3'
M_;WG;,KY8?_0P2HE8=P_:M,|B:B(R:*_61@KI\RMT#$^);'P0OTW!UR&?=E3
MA%|G:B*OYB9V3IF|,8G73V!=/?PI,S+O7N^]|0N7.$1ZB=#W&1!9?D;CA2'I
M&6S5H;C$EI9.$)P~F]R2?G'ZZ:+_Z+@W'$YH9^6?CXDT?H8#_N/m37I3#GN3
MC~'X;//Z6FKP"+K##N=,;F63UA`!;MR7\|VMG$\N^IORS9;4V|"CZVO~.Y(K
MNB/J"]I_#2HFN:?6B.OKYIJ+P*6'I$U27`A~(#PJZ'Y)m1US$B9A|:N&M5",
M=m0R[R!Z6@8N3;VL&$mY!'^19J)I&WE;P(:AWD7L*W*:(QD:?P(ZG;*TSUO/
M1%70^':KM;W]*&&GRW3$2@X:S"7M6KQYM)7&;]8XG8+QWH:2R~&M_K0I`(;D
M))@,Y374)|,+K!*&ZX]Z|MRGG_GDLX%`[m+.N:Y@UDFBQ:G@)^+R^(HU;D@G
M*(T';1JU:&`N$*N*D%7:NFMBN&=^_N]YDWm&86S)5Q?9IS8M9YN1+G?3[2W\
M2YCB5?OVKmJS/ZD/BN344'_3L$'+$IR/$;&1GO5I@_1#`E$Y$FBGTJ&S?$(G
MOB?`JN$[Y)KDSA*%IF=`J61?]7%#5!LSW8~+m4:`GPRQ?YG)9;S_E\.W~^UG
M+U[N_?`.+/:]1GD.|$T|P%:'9S]MM3I(_%:N:~F7SV\H3H~I7%L\C6_&.1^'
M$N+ACYXY^$J4:WGZ1$[DIIW(I[.OZ'\2GT0OYR=QIE+/AYTWDS$Z*0MCRT4/
M&'KX#S=`?1([:OK;9@R)YT\HLB2A1VQ^]W'+_(C86&H"%/ZC9$S"#G74P!(T
MXDXJ.A\LD5D=`*]XX96(QZ]!'R;N`9]C;SW|\P%J\]T`M9ENE,4%FmXO+O'^
MA@*XOH3=B::?]C3]%TGG#EZ#D#+$;9N3H(H*;T:GQ_^M`$/1F6^_V7O[;K_]
MZO7^J\/T']&35S0\QCVH%OWSWMM7!Z]^J!3??_OV]=OZ"L^~[QWN1|6?O?[I
MS=ZS0^?#3D,PIHY^92!&C%0|N^C)#_GD959.^$4C`.6C][24]*/UE)'7:~KP
M$61.D%S|M:]~O6[_M/_3Z[=_U;EG\:NNX,&KP_VWK_;X#QJ|+WTW0LZNL)[,
M\9G`]R4\:F5D%W3YT)GW$NYLQ@B/PAS5,.%TD4?:^P$;19"ADGD:)HMU2H"%
MV,_S6[E.(LA^I1VRK`YTY@5\~!WK!#C!4R_DSm9~D_.`6G0FZ@KLW`#;"M5m
M~&XT_0#3I$\3`VEE*5^!U16MU3[5GJ0~\QP2Fm3$B%_MXS"DZX(7G%2!QH58
MI@]3@9D.KZ/E!)OMKVW#&m3$X7!(XOG81V+QJE"O]E^]IITNSW3]6MNV*KJm
M'$(VCY:SWSR0S):+72mY(X@O=^.!9M^H_8X^\/GW7K&$H"8CY::m)V93'*~.
M|0A@+#]?(%m6F'*553CP]+V`,m#m3Z=G9\H"YP.?4'LQ'C]7JR"^VQ8RJOM,
M$'[S"U/Y@?O9T;TPFD[*QLH3DG"~TD`~'ZN&G7D)`*(=TA9]/9U0,1?O8:3\
M^?1B]()C4.F2'8ZO:K8QK|0%/m$~",,5~JS2\W"WH!]M|mMMTWOX"R#"6U[C
M!CFR1M=+#Q*W&!Y8&5I+_QT/_K_V_KVMC~Q*%(???UW/\_L.93JVA5O@2V~2
M'&/LH;%L,XW!`[B3/MA'IY`*J%A2$54)3!*^^[NN^U*UJR1A=V;F.4UFVB#M
MZ]IKK[WNZ_DCW"7OT&B|G2@#8Y$EJ9#FS$K*2\L6"4|.5;Z=~T|V%XJ;6$5|
MZm1O&`6=1&H~H4P5V\K*7+V'BYMB[A:m9U8ID58'V^=0N9_%m4_$'5R6N%R_
M.GH5|^T*=1*/3*(m^G:m*G1X\2O8X2S#\LJ.951+MW%6#V.T51OU()D@XW*2
M.GZ2TAN7H$R~NL5^(=,KJN53X\m+%235Z38=R?!.PI2N&8ZVP]$4%*M&`1R1
M')PI[,&MV%m5(]JDO`@68NN2`ZI)!J\B,@J;D0JI&/HXO@!RA"`5ALZ(|R~I
MR~%.NZ73Y5@2U4!P_;=2M/P4[#S.R,;*!5KF7&?C9D5#$S^_!]B!?`2)9*)%
MHB*N,`J9?\]A^K/!`,0P9!:Q1X'MA\EE?U*X/2AY$.$M0.T9Q6V2"E=XS+N!
M%XY,?C)S_6M@mN2DB%7@*\(D(G[^?#:A%'["$!J+LERAZQ|O;#&STm3A$A:+
MSPmO!XT#VZU.61F#(O7Y@V\T*4Y$.F_LM$@NE2?_%G^8V%CA=Y1*G&J+5)/W
M6[:EL_(C[L^I:&.T"9FNC.B|4?V%F9`"*,?@W"GK8FM&L&U?KIF%(BLA6=_[
MSm/W.]6%m8Y6E6VDOK]9#BQ/GP)8Y`TEWHQY!;$*F%@#&KH!1KCJ'6L~(*)/
MJI;DC&\`YX+R,FT`%W0FIL|R09K$4IFG)(N.C['FZ"5`\],GSERE^AH|'N\,
M*OWVT%|"HQR2:5;DU;+C21E9.DK7DQ]\@,K:V44Z/5U#K@J7B|3A^7,|69X4
M+$Z,RW\AXNY/!.Q76$(*\4:E7~K|+[OWZKSD&U9"O$K)8J=,Y7=L4"#&$F3+
M?C;L%*NQ&0G^])]B?/#**5R2ZN~KJW/85[LZ&AX.I%,A=Z:LPEW\:^V%`EQ*
MV'B?P=74\EL=$~E7G3UP8YS.O5`=NP;;RQ]74&9K5.1:D6^|XS:=,Y5@:UO8
M3Z,`#(GER$!+|6UOKPX)%@?B;R9G#GV^R$D%7;B1310?QJ'W99&.3HTmVDEB
M&[mO%A5\8M:AX'`GG`LO@"3LGY"XP$Q"EPW?B7@H\13UY4K8O"E"m45_)WPA
M(_$NXG|6;M|9NK@PFWQ\C`\/7!|'+F)|#^N?(TWHZF0+FTW07F!&D$"=='`.
M3+7D'BLUSVW7J2P0R6N~36!U&2_(@MA$@5'2$GS1ASGS%)@QE%303B7*".mA
MZ&%UAA#+P$!#\"G=[A7FX\$%F_)Z`)?VLBB&!R`(PAM~O1;=V+DZDX+^Y#?_
MX:2@"|S%D;_))N7\+K~!BFC8/H[@HUR^O7O0&)D!_6/MQ3DP57Y!)3M^QTY@
MQY?QZI=2!T,);5)X8YKH~;L7,|+I;)MF,\Z]YN6+7!XDFIL1HN*R1!'Z]/|.
M2;6RM_6NU\~_V[6m+B\V7[?H/m"&?7/Z_@A|]6~V@'%:"0E30X*$)1.G4^"B
M+^'%8FO`65KJC0(T!/3=EDYPX2]1E9\:A2,5L/m%%^:mI_G%!=WT_\`_,ZE*
MF;C5?_!Z8TDWJB|,0M@%6HJF3$MHm*5P/%9L[[3LA[^/]'M|V_45D11Q1,U(
MD(;WL+P6?YEGV&JBLA&~\#`=C!+U6$3OG])~2]:P*FB\JZD?!^;0#"R.\8NL
M|X4C^PSPHF(REG0PFQ8@0F'8%m:QQ.PEJ"#6DFY4L5#E"`Y$)Z:&*P!~\_F8
M0K=)?"H4@6M2$U*[Z3XBXS]$W!;Q1D:"0J\%@J1X1Z@5QM!K@SQ`LB/.+UE2
MLIKTC#[O|EH30'[8%D4Q~U_'3JU;(9L1Q=/B~@D?,4_+L)W*.31m*$)VT=?M
MU2F~(8K|\(0PA\F|TY;31"I)L&+DA+1:T!;88Q5GJ.T&m=U0X0K;6=70%SO4
M1m1BAEOFCZG,GW7:P:N!M.&H]Y~C_M[^JYXRQ\97RBR=B"EJ6`JZ!+@!&G/5
M3?QW!YC|4Y19Y3XY^4ETJO|[/!'RP_9.QNZ=K'?:WG_WKK~G2\1(#0'|IK!=
ML`0#2KmST;m\H$JX=L&P3m&^N)\Y^R9`4OW=+^7:BXMIBBY3%#`A)[=3'&$J
M*`8^m*Q_SmWH2^JX`"QQ,(VE@~]PJ'~(ELYXC!~|E,1!`/Z[?OIWFK9OU$\A
M`mCX#"_:HB(]!=,6RKUG1`T5\9K/P7m:K|EJZ(Ym1!E'?D7P,@KYRU+V?~R2
ML[Z0m4N/*E9=&MmYC2;#*(R&|VK!$~M.*\9;WL~UA*4!YP:']D3$0C2#E;MM
MCG)558;N9')L1BGX_F#__~N=O5?&H&P2|9F2$*1~$"=N*N/U):'\`\A=XYAP
M"Lm(J'+(Q`TK0`OH57H";_SZL!R2D'=W;|U.KO5;_3F)^(=FB]?67L`(O=T~
MWF_[|8=^)5;^GW$'*`K^J;$+Z|M5^!0_B5=CE.W]`:A7[]W[HU\J7\HPP~_4
M.KNUQ]_@=[`OXPJK+B(D:Z2D|*/(&%Q_=0&W&J2m\Sm@,=O3K~BR\8]FD_4R
M"J?m"&A6D^%43EDN=EC7`DPADNU:IV?"%!NL1BIH7R5C`61`$JDWN~E5W":|
MUY;$T!K$0Y)JY`^^5|S\=N/[S)&NFN'NNA=2*`X]94LL:=YD?&=5"~~*!8XR
M*78%HW(B*S([m89)_,K9]m;N+N[;/N1HXA~,^mY~/44.\Y[J:NY6]NU$M3G'
M8\4N~H`((IL!B%@#K7]00KN\E~_L;~]^X#YW8@^"W#H`1R|BL$88X2W3/5EU
M*(UJ2*1O=K'/6ZW?77=8:FG4D!7PRR96+?`5TM^;8ZC!W`?L71~RYD/_6!1^
M+GPm&)8ZE86.1I!*69TX7NQ\YH*\`8B$P%6\](%TVV'QESE#AVX`8H8Pm~UZ
M0!1XLT%|47N$.`!'##A/"O1;L!K"*NT):A$|YL$7$~;P"N8FM]`Q8$IE4|+#
M5DFA\;N8JU"I+[RNUU`~Y?W6T?;;VELD'I[mW`+*N;,+m$W~GDmQI^Y:%R:=
MNmLR:8!1|;[LL)|Y|"6PFM7O*[R%?mG!3JNQ)CmHY!F693Z|D5!O]_73TmAT
M"m:&S!J&A3@5!RZR|UC6TLS)XAP)G~K2+`GU0IX$R+=[[)QX2%`LYHQKE~.6
MP%03~VJ[:87[7X')Z1T|_?+A_:NMHYY*C^YU_5JV9`Z=H5($9.`m$!S+R2CI
MDX`|0_LF.5$9G:_%&*QP,"P1CX1)3YU0.D"B1YC,NF2KE79|B.@M!J``B.R3
MTZES:OY3~M![M_^S~8+,[E5'W?AX'?:.:ITJ\S~O#F`D'A5BRZ'[[N8]]E+O
M&MTAW78+0|,/=~YV!@TL\L#@=H7'0*:A'=/OW'%.8!#FT:&m`G=0OPC.(=*3
M"X/|96BMmA^~_[93[/3^]D]*=!HDY=H[A!'5E'[F5B^0,Vm%/NZ&9^D,T]mG
MF!8!|/U\M?("V5;X6S'(T8,6?V5?VOQJDDY!3JX\1:9MW$F_`,]*JA)XM|X!
M)8:K1FC5YK:mR,SR9)@W*$;7ZKA#SD=)?`74,%W59\E]EVA\,TAHC*H@K5N!
MP3$(M[XVCLU=9DB"";^`W)XRXD\Om~#:Q)R0PU%BK\B\5\^|A06O63Y/:@$I
MH*#5__H2.^+|4D\C=ECT5=1M?_/WL/EY:WXC|~$[~Z_W%Z?Q|V5S+U_VJ/"3
M98\JR;mSGQI_@P|U]*0&7\=%7[XF~FZ)^**/8_`!6N*!Q,,ZW`:FQI7NC:C&
MX`;9WL!=|G:C1U#['NW+Y&QTL*K%"^|_/="HLOS!JH]HO;^`]'^X\S.*V*BS
M|;\[?+MUT'O%)I$@A!IU"@B1HU_:`%(J0,IO")"&=_;/!SM'%6XI`+!;;'/_
MSWN]@\8]YK+%W&.6:KF\`U/:;$N",[AVAM82/,%A;^L@))LVL`m*#DU4mL|G
M1T6:8+(14|,#K89?IM=K!|!RG*Pm,W@AT.2J12LTWRKE!S5#`L,6V4(5"06|
M)H[?'$\B:]T@RRJ)A][G9FE1*`N$AK.~)$4V\/J9I".S"_4#|:*",,&0^@E+
M|.|TO]+,PSC#;m*P4,DO$]6\~6|3m&U,,6,/A;+F\3F,/$JMOZT_#GDM1|+I
M"JAM11%*XFH'9_A)~@PGZLDL,EAM)(6G;3JP&9278/4\1'(T#1:/%L21"M/G
M]W(X&?OD.B5.3mAO$6m2ZS&`5UBBY^Z1OSIZ]|*=I&$E,!NS4ZHR0!A16S,Z
M13H3^UmEO=SY@,*B%1XY.N),:FO9C!H[%G!!,#O6*17D))^+EUWVG3ZY?BEA
ME2^K5B'NI~1#S4EB0UIU337X06&]2;0DYm`:7)`|!+E+\BPP/QV"P_=UMI7A
M8YJA#JT+)W51GAOSUIKD]"U~UKM7FWC&+m@`NZ$X'/C~T0Y\?P\WT,~]T|_*
M/720P[\W``KW1OF9^5TBU~7ONGSG_MSC=!.FKP07TM\KM17HE+R"]&_0`]XR
M3,.$OZ3T6UKO)HN3A~m9_!/O"[*19;VULWQHG15K@WR$AX^4X)]P~FML:Q[.
MVYI~|MO~?B1))`*3&W#@4E&*"$'!P`C::$:M%1^7^!0mDL3WY/0VXI!B#V$2
MAUM_'V@.P%NF.?K^m#0/M!Z5WN!LMNV,0mB9)Jm_(J|R7)._5E|]3~36T='N
MSF%U!)1.2!2"P:[3XI^3?#7^;N?=^]V=WJO0[.E7SY[~~O:S\BLG]P98=NZO
MW?G95^P|+O/73~XmL.29\\`Z^7?O*?!UM=[06T~]H;L|O^F7(GM&/#:'U#8O
MQ2|WEC+76BE146@%;U*5`BW46&B3|PX*^%`OU'm4SZW6WKL~7H_E#LID#ZP?
ME$N|Z"G7)=&?@5~4"Y"9E7?D/8?'=9JN`NXEQ0"+14[.X$m,(|I_K+YTT$*W
MY`^UW);Lm/A#!UYO9.?W&KG'@+D@S&8F[*U8U'~MWU0@&+=KIWRFL8&[|_DL
M89~(H6%V!;F4B)B4^''\)m;B.75NA!\N?)!P!?!RC$H+TFO68`&)C8#2(;V!
M:Z^7S+]R_DUR;DSU5D0US"|4m;BF^,2G3/CAG)H]FH@/02'\*YFK6"Y82B''
M79Z1R+R(4FY!P:++:mJJN*NIFFYKV0HKA#S%"~T2]ONA9[(WP$]%O0+?'OS2
M/]Q^VWNWU7^U|[B]_Sm\L+CQJU6UZ*OIFG?5H#QT\\W+/7*|2VJ&'F~[V#NL
M*N0C]T_T'*O'mR*!$Z@JBZ"3A%$XZFY*E5$::(`(QIK@Y|63RN`T5*O?C#~1
M%(6.Q\F0_|ZQ@@?%P.F:,)\+I6\#)I^|V|19'^N|V"30;A8WZHFZU;C9`:+1
M'OD56E(G36)(WU7+E8APH#@D3:%+T5*2C[F0CXL\mL%@63%Y4)+]7DNNX=]B
MEH/1,/C#H=%2|INBAEB),QAEE%M+ZT#I57!,~PO[Q[7IV7_|.MS99OPUV3:`
MV&:365JQ^E*IPW3$ZG$6V/$W~B)$9WYR+|IT)+[2G7MA_B!M++]#:_Fm:?5F
M?m?|m=N77JV:*GXC'C@J=SSA08NRO9B=#!S5^CRM,~`,]O#09E#1K&.#10W3
MV+;=$:Z"A.$J)S5%_*"BA3^$)6P?m6IC\13P?O/2Q=W.'H]50?NS8//5H&N9
MIR^V],,"C;I:3_16SS%G*,|8S*!3/[$[I#9~6DG]^F#_72m4$+\$#H)J`@@7
M?Y!I@H\8\P@W+/()JEBHBL^_SN)@2MBO3W1+'KH)T&M.?^Y=IC8^`J`)AAS^
M[CC~?F'TVW!&]JXX\H:^*8P91~\C8!0OJ_"W=Y/WXX!(]D?_~D"JW$|Q~P|m
M$Z%[XF)5!6MQI`K:P@/]VJFHX:$![=ISF^,1^,;PNBTO(6Z'D9|(JAI.4NFU
M:@IW.%`VQ6M;T/=5[_W1VZ9UT]EX(^MI.4m[Q!"ZFX\]_Q#V3ZD"P`+?F1E^
ML;Z7_J[1;Xm1\(YS)!)O2?U$8U8YG,?L*7*GREH]05I:|]A]O;.W|_3+ZCS0
MB6=O']C*PYW]O|,F*!(Z5V@7[=Z#K"!][|R:L9/*L*@5BXY|[5AT2@+::K]Z
MC9W*MO[\MG?0;%GDm];XV]*?J.`30F`)P!WW1:[;YT+FOHm7O8,??VDV^)U|
MJ\F/'G|!U5)TTT%5$O(V%(85ZJ@F4$L*[U97JE;1~/YC'#Z)6&O8W*F12=)0
M~#01Qm`*:|)]LZ!:H^T;LKE8OZ=_*[2Q0ATE\4PC=0S3QR8*2:m5+J%&(=1O
MOmFR[\|M2S(/]!T'm!X!:D0I~+,8E]OGM.#C=0~H+YRR`#%`J._|\|E4I67#
MVN^X+B3TJ+H5Q3#C@Y=RHC:]D+JmB#KSm7A8`.Y___VJI!'$$S:IX^DP&ZC)
MG9NYLmPZW.[MO:*L@O^L0Z?VK&AKO]A3X!`0LWWJR(~@0&/,#YQW.V;~N"22
MP~Q?0T8TU3?U,95"G8CmI9:[.^]VFKEBECU\OKC""!!Q|?%mFM;0K,H`~*WD
M56SFWO8.~H|?=H\.N=U|]NV.*SD)[#WT1*Q#E*OC:77YBJ8.;H80,W".WF$W
MG#4?M~*Z"ASZ$)+I~`&7CD#TZ0)!'#[NAm)8V+P5)IA["]KBA]BG\'1!?M*F
MFD9m=!G4S^@P;%3K!H_HO(':DOZMQ'LHHCBK7J5V/M9L;Z'8=WCHR`H&=6I=
M+1[A?JM@EU48MV*\%)7/+$7UR86/^)5.[N6I\X2U&|+\X=Z^2]0J5_R7WJ&;
M54=RE]T.92R_M""Z~%JI.D9H!I/F@*"YJJ^O|H1W3[HZ~QP'E&/\15/T(J9Q
M4\._5455SJ/WGW&`;=\]"GSXYLC1J]0Z]((]'mZ7&"3~OE5C#[Q(//Y@KE*;
MH.&%X|T%],"',B.H\W4UQHZ/XD[]%#P\NG!45~T*'S]Hm(Z1|QG@,V#U8?!7
M98@*DU_I;7HY%.BB[K1/KT%H'XZRRF$7+HA;OZC1D8KK_X5RDM8Om30'PL5S
M?D3IM?X~BW'`H4ON:US1YW4JIHG=G:/~P=9NP"|4O3I?Z??^F?NO#5]#]_J%
MM@/W23UBY#HULW||%EV3R2JWH4+%!O/7T#CCWOY1X*Hm:J~WU&QH`G&\~N;M
M~N~PO[V_BYImD."]U0QNM2|8[U7O]|Y~+P3,W:V]mQ^VWO2TR4*[#U,"@UI5
M"\3`!mTL1)/:)ID35V,Q4RmK]'H%:%`S_ZPP~8|A=KW#~NWGX^,!IB"4%!YD
M+A;#KZ1JQ".WOE3S3GQWYZ?~+29QT?^6m]%UYIJWRNW]O:.MG;U#'R65%C51
MHm4%+F+#8^UD9/'2B\T'SV9DG\F*UW@|IIM^1)C;23D3]YFM#U!]@:mYB%Q[
Mm|mO9Q4J|Y](0Z~=,.VF%R'(H'EO:84M&E"^%D:m!|+:[mM6WX1GPD(|:KC9
M^BZ%0O5B.:K&%Z\VL_C);VWO+A?`G0Q&MXN9LS.%O:C9_]L9ON(PC=]TDD'Z
ML.H2C(G6T&THFPRRBV2$OJ&44!6=A\ZFR:3\YS"=7*^N5EUP;(\.ZV|I13/\
M=U:~8Q;+`:51_F|\FU0^"8,??TR8&4:/CTX#GFLX18mSD3]+0Z/J8AJ:F86(
MJ[=^[SI\AR+DV=2M/L|5Q^M3=S;7CQFA;|%9_9[.`%W2LLMLE)ZEW]=.`L\G
MT*!R6/PE[8AW8DNA4$``R[(|.(CmO|#ZRG"8K]^'74,\8N/7:T[*JCDMM5A6
M8[/9A`K\mGZ/JUU#_&]O,9AmIU@09E:DTS4#L#7T1)BSPM:Q3S!=4|O:V[]W
M$+[mLPU70.EFS:44M&+L(0S!H7SLK]P&D[.`L=7B#!UW[=C\T^%#B`RLYX'4
M0HX`P'!HJ36TF(\84,E%8S9A:@G7_'LZS4U$/:7X53W.KY3%`&GY[8,S#:m3
MR:?F*B*^,K02X/?40.%9?'SWDT&L;FP?!9O;Y]N%7=Y~%W%G(25$2#QH]I%K
M.\m~36O1X!/3Km98)IK4JAL\:]J98QIP52&Q5JV\4U&LW9GK!52S&@[F6/GF
M\I([~S_W#HY|SX6+9@[:8YFM)M3180X6\4YT.WA'8'.+mL6]NK?76X//JN[L
M;~^\!PYYGH^%?B]J(D=?:]P;[[2(2W8B%WZWG;5]KC|'6WLA7~.KWMXO56.7
M9PPZDYD5)1V3EHN5\`0X%EYB,_S5,~MA45.:X#^JY;]C:%2*0:/VF|)T!^=4
MMT.X869FF/KCET"N*IWM=Y+I6.MX=CGLK9K_P(Z`9T"+6C!Z'QM["!;+IN8H
M]J"mRC^5C"`\8@4E?][9[;VIYQ?A80+V[SLA]/'=&/G'm4O6^SC67H0M.L47
MYPXWXB0651`B`.V~+Y:]R!??QmGI(N3H5!W&T\:B::~NCIWGT73A&|S==DT:
MR]W=P#7|^G#T%N/GMK~.2`DG)N]*JP][U79UK^O=^C;=;56`%O`[Q"Q,MXm4
M'm);UX'2ZAMT0VIVICQT92Y:0O"m'=7&N&\m!OF4`A_*W!0CZ|;O?MK~WY4D
M.))A9#V.W^97FmB|*G='__:'/_VO|"W:JZNK]2PM3ZD8[?1T@/^/K=?++^7m
MC7HH|P@]5E/"~'1mm&9(UOCS(+^EAH`77TNK$\[IQO/X*@+^K`/3B0CYWRB=
M&JWMU\\20S!|*BJ%~OP/R9[&&/(_)6E:/=69G^3L6Z3Y\G.2MKH:!V67BCG?
MB"](Y19/23I/$#$TLT'(J`SG(T`EK9IZZ(B&M$K6S4OF*V!mZ;]ZJI"#WOO]
M@Z,V+2AGHU#Z!V*C)JL`*DJ\5U)$65G8ImQ(^N+X$(DN$#`JGR~)T;F`GQ:\
M@48?,#5%.9O`=6)m5AI1*2|\?NY34$&|T],4m1&VYDO4F4TGSSYBS,^4RA\D
MT^M_W.#_D(8'OZ`RD47P*X!H\/m)N#F0`SB[U6X$.\~"&E*^(Z/Z%`_,BS"F
M;!]4M4`B9DP%/"UA."MFF$8~"Z*8K6')'8#Rm"7'#41"KJm!P4VHm;Z.N;X7
M05:)\S!m1B7?J)/KJ)+HA#+`?U7`'Z/)LHGPM[=VJX5;/ASL]7=Z1Z^QE._6
MN\,^?7'8YY9+D6Y~TBVR|2Om"K`;)O[DAH==B)Y*88I*5&#5C,=G1O7_W*,U
MmKR&N@2!NFXN!;R)//V"|=1A%'7*$m+7]1V9$X)mF3Y&H=&^L^K~~*R&[3D;
MO!/~6W5KMAR#F\RX@|%`:D`W7VXYWFBXO;PE[(E|X@]/_^T'AZQ,9E@O"/,1
M2=@O4:]I/EJ;IB/2L+H["7%SL)@0mZ~|E0R[5F)]8C?MS&/S+&KI&*R7Q~7m
M|JYV](R~0\Wm@IEQJ+:7*34SFV@DL|\%IE\NDLEPS3R7'?WM825`O;F%!I3[
M9I&]=T?[/_7VXN\PVG/G@*/(&QIS_1_ML8+;6:GD?,122R?7:T`TX1QA$0HK
M^0"5S%U.:^,O.]".+5C(]#K,,%8|6|m:(UEZ!4QQ/IL.TLI0_"'W]CIST358
M'QK3D8[5FR!^%.4:,(S9959~:^"X:=F&JQY:5,^K#AIO*U%M;0TKX9Q;]C`"
M|)NGKF^D6$*)#4V7*)/^T4&O)_2XJ3!!,"6A&U+@ACJ:$)TY;H*+,H*.'U4E
MRWX;\V:9LV;.K.J0mB]\@"|ST0,U!WQ+_\)4|,D#ZOWE_=;~*R/XXQG58PX1
M_3J5\_+#YKYB!;O[J,SH__A+_RU0B_T#;PVm52Q,Y8;%6'&'";AmS8=P,8,%
M$.3.@B4&0KDY/?5^V/.T(7*TAOQS"D;4KH]^T32OYY3CZHC:JB^H%!)[/XM6
M8/`KmIBM:`]W0S9THGF!_M*43`D&BCA566G0)_BK3'5+D:CV|A=U;~||4(~E
MT:KZP,+=5WOZRH!P;8GER,"[WL$;Q)'~SSN]/_\:)*!%~m[_|+#="UW7,)!:
M5H0C5.IPS%_CG06.LN%D[OH'T11V4SFNQ;;ZE71]~_\="'*43:&WN[,'SW^%
M[@/5/SSJ;VT?[?R\|_2+WL%_[='_mX+N\J58]%F~&Y&Q4$1%*,JGPHT1X^AQ
M8\X;E7!LQX(N`\VZ3&5%W.HLMXKC6"#NJ"7|R!~)YX0m~~C6Z23NLUD/5JI$
M\|!_*KZ+R:36XO#]UG;/D[`I#PVN&XVAL9NOEE0\Y`/&m4(Y]3O93^D$R_PS
MN\"0J:4:X@2'$XYPT@33[8%m@3`(G":P)6KIH%6=OU5+$)4(;SQGZ^+|S*NV
M84K8B9BT`G_\_~\=K|`IR(M;V[O?2@~0#$9KQI!*8AZ)K*XVP%636^\&m2X8
MI0`)"*YWJ'1'QS!2#A124IA5*IC[~"\G1$$310)4/3_E0|9J(2O225&O"*2+
MI41DKG.IE5+%PY,E])|US4*MO;M=^/U9+46TH*^IH%Y4RQ8T~6.V3;O&.74B
MOJ^53[_7U7=)4WJ]5N;.0=FD;7A|M42\E;$TY2!!K)[NC@$I6~YLBMNYTV+Z
M:|XOC9F=40N/A1YF8U.!HNGD~%4N'$J3Q7&.'V((6:LHT0SIUB5$`|2H`I(G
MF`N9;Z:Z@)MN/73H54*Q0)08X=)F08^^Q=4:7VEH^QI=1[O^PGO~YBF^;ZWK
MT%Z_MLK#'NH[+9"U",/9|?EZITJ|40E4S'7S+8^+Z0^J\W;|~~~(%?[/8L4H
M_XMT$;Y~IHJC\TIDmBW*19O0$ME?IH*M04%_G@^?XSOC#U|7+1KEBJ"\WE(|
MLC*3SQmY*M*PPN%Km#8M&IAO=C\5I)HA]mO0WDJ5FT#6FO)B4/P*Y'F!2]1T
MC1PHN%?![,|EE*VHUR31!E$RX`m7;=9*@.Z$!UU|PU6C62TNONXJ&WJU:5^;
MZ8WOPE+'`*=A+13N3AM=#"1V\~/BU&O3BT)OFB?DQ^GX.C??;N^=|)|1TJU6
MP.1/5]DG/:^^=J62m|8!;B`Z3]/VL?Nm?XAVm7.3W7R=!|:[:@&NIm'/\_W[
MW5_Z1_L..;,QVU0&L6E)3'X:*OC:Q2B5"Om(@2R43"R^*8%FBN12J".7G0IM
MP,[[.IMPE!JY:?[Q?SVIBmJ#9)1.A@G&2/LN+]D$51SMAOW8=9JQPNYL0H[?
M5$J("AE)K9UN8+9"4PVK*(*RYXQ|G8VR)#^mM.,:2$Q)/$W(&`^33:2MTWF8
M35/R(T03/4|EWT)O8";DRC2=#AZ9*?A2HZ"U'W4A(+7+$NU701X^S48E.LR6
MV3C]~SY)JP(^?X^YE|87:_Q'+:K1^2[N9,7:)"^=$B0=''IM"K!(7W;;%T=2
M*`_TL.L.^W`UD`3?G9:V+J4.7*|%?Z&5M36$EmKUUH/]3+$%VZ8H$T!DO\Q"
M^S93JGTRKS"#`XPZ5mLGZ#@PAQm`G2&+\ZOS3B"FJU~'~M7]8Q&X~S`U2W"+
M*mSQ0&J;H`*`"V')#\^PDFTDQ2#+UI!ZC9.+E7FH/DG/$@Y\E*S|6!Z!JO"L
MQBN3?"6T4A|``6RVJWSI`,|#CSM`$WQ\;,.+Y\(E0!JHIm@9.L`L2QV6IP\^
MA|#?ZTXWI],T73N9%==*M"S&0;O0#HB:$AV!03OL"X,5BC"[VQJ040I`'5#(
MZ7PTC:4?+Hm609H[WTW)GUF\5=~|HB@K~)B/MmD\;%*W'^G[=/WQBE7OL7*^
M2m`/%)Z9m!VC@C8#O!N(`G]JBKB]+,1%%`[Q'Z1,1*#|U%2?^"G:'KS*7P^I
M4LAH1%_^D]H\M!'_+FELN9M~T#*U#|:[Z\S!+ZO?5"E$|/HPB"|Y:X0#M[/J
M[.:OQ53BX~\\2MP^984(AZ]F"#7#"PBV7&HYMUR|B_]M2_/:W7IA#|MJ4Sm7
M~)LZ/:L0DD@(I_NX5XBP\[:Y3Q'O"I=H:71D7Y+:6V`(KTNPHRK1@+LAV!4\
MXSIT(X_0*m'0~R:HOIA..^QD6S/+;^WV]EYM'7"E$2ZZ,B~++^[5_Z3\NZL~
MJ|0A?YOX];E6Y&7K5;3H+1=6:1L]|3VH3Q/|!(3/0&::0"LRB9+8IZ?0I@1M
M$$|;U0WU8@+BT^V(O(Z;=Z"P0),T*C*GD8,7|RmW,T15:Q/L[!ZU5m`E;&QU
M55I62]6HCG52SE;53^%M^?ELJWXA?JJL=^]EI[Y8+Y~M=JA6WU(Y1LP\R=2H
MMDCO0.6TFO051SOO~O][?Z^WH(O!W_&2`]$DmX(6?~,BGC+\T^AL|Y|ICCC#
M$NE9LG)RJ[+\)FK0E2!0'8W%;;/MVENVB*M.HWX[E"6U12/]U:E3I5_A_;'V
M@IS8!91!5XR:Z|S+%MA(&VHI`IL=A,P+1N)/8^[0@#m30VGYVSL*W9GC(U3=
MH.![)59]GH|0IM7#L\$TFR9FOG)]Q7O.3!%(7%Q/*^RZ]81^YKGZK#K/6N@4
M/+Z"&!J/BP!.:32M6&m&IT7U)0_EL|$C"^7IA1;ATD?\SB^1Q;9R="&WIKH6
M/I02\9WJ^N%+`P|[FQ`(_m1F"KU3AZCX2@D4)0M'(S5GM_Y0mD_,_mX_Z&U_
M.#CH[6WW5!mMUR~G(CYZ3EY$OVX$\L/$57,^2;59Sm^!.?5Y~^"EOC[H]7[\
M|/A+?:&(*K_:*AD/O26VY_=5QX1@.LHEWPSG25_DS:@1m8?4XL?!A)_5G?!;
MCX~3#;*2'0?AQ0=9`[m"I:[_69''7U!3^S)^&#]|C~,Q++VP~0DTQKWU'=,7
MW",1F"_,ES.F2P2C?^MLX34*T/+J!:L_5E+L[NT?F32[PF+`AIN'M1`A8.$)
M8:@7.L;AQ^B#.(WQ;ZRGA]'65PE5U,,O&].0^^OP7N?@|867ULI%]@^V]MY4
M\Y&';B.#&3?G9^_U\Q|((K3GOS;(8CG#EBRUAO4.+;+*4,_mDMMJ~*Q.%'C,
MO"M03L?^%8#3?%IY$1~YW@UP^F_Q;L[/*M9T69Z&AG.@9`OVS47[.Q6|;WH.
M%D3U.RUX/FA&\H&#X~.V]XCQ8MZ3~=3[RQ&;W?VG$GO;@T+:WB~%UR(|QV(S
M4\R^@^QWPF@Z9[[JB3AYT8(IY~8F#HQ=9J`908.+"54;|+G?^0A6(ZR#JJm\
MX]2+'W&%Q#IGZZH"O*V&:0/_^%6*:BN[69`;NE76[N78I,HMJW%*ICG(|I,^
MM9QO)S)$~ID:.%3`A_3)OGPS\10m%38M^MH(E~5D3^^I6T[^/#S:.CBR#Z"[
M6U|1TR2*[+WR^Z:6IW%ZFB;5''5U)50Z1:~,(=|4%IVmF[!TJ9`6|^CSXUH"
M?)#%9(MD\4L'1$+=||_/G(_E28./;XO]EJ8N*")4T/=;H%\S`M4CG!:KQ=3`
M|S?A`!DmZS@@1W+[XDWMJ+`156G:5^D&2?1?Y!`!"A7+L;$8FSUB.J!IBGY5
M\23%S(S)E));?@|RPN.P7.:R|$%^\CNYG_/XSN\`G;/3H'0YKTZDF(Z]#SV%
MD7L^TL/]_E9FJ/\R@7%Q%_JMW5W5(!GRYBJ17%#4I:?Y,I,%XP*"D]:XKBZ&
M_0W^Z9WD+1=3,VFU2G&UE3B@"*C7%I+FXH"~K74A09#(5N;/$[#Am~FNYX3B
M?@4]]Z6]NTL1Z#ONBUT7[1:)?JT&@BY%MWW=]7S"S3^mQ9U^WMK]X`AT\TKS
MK?JFB5]ZAW9mE0HH~_MM`N8BQ|.JH;"W*)~CST#]*:DY(0D*/]([!|\LYJTC
M[2"]M#)Z$PG@H*D&8@5'H:^*)PG($W)+@|#*/K?CB9IJ%08~S*"QLE[|J&+P
M;#;E?|V]7?K.,G;XC/;2mQ~]V;=J!|C^=;QW2XFVWAO,*+2]O_=JY[]R@8L0
M$+~V9X"2F`6$B$E8'FFOB74K5Z%W'W:/=M[TCA;R%CIOTMG_2WBP^;X[[5Y"
MMPIT;'?_F1=?&/#Y:6,UJJ,M',72,"AG1G|'_:J@Q?F)@A:(76Q9HD$QRS(Y
MPP58JD;_COmIP+MCZ4N"]LD^&2C9H2Y:+)K83Q+DPm!!^~:XWH5\K.:F%K(:
M;&_8%BMmQ:'(SQ|L+@AKZ*YP8!*62])U4L.)@=`6mTM,\D')KQFU)$A?,*6F
MC,2))19)MJA3_^HYR#7+F`!HJ92VE;Y~E)6'2M\H,5)E/K_;4JFm$#6VW_:V
M?]K_|+083M#P^:QLRY8_+T9*AW#3B]BT]|EU?)Y|IEX2%7BI/J_EGSF;!@6'
M766%3|m:\[~7]M:mFC.V3+U!3;H*]~RMCE)KL$!m,+,Y74)UD%\?E?5`E\)A
M[72+Q,P+Y,`W./9U!;A"(~.G`.m*A/AE8WSXK3V~%_%YmI~PN9S4,O[,|_F=
M@"GU]?[!3_W]G_P(:=]#%\#5&KX:.U"=9U@T|;3&P^T?GE~R'D=PPCNQ|UPZ
MDR=9U_.)&'JUL[|$N|HF7TNM8(2EB175M/V|IA=Km$0Z7$.R\+W)"%TCm[6V
M#O5J(&QS*1$LO#KLOX@`[~PM3W]V]O[GDY_/@_S_#?*CS?Y%5$@_;R1&/_5Z
M[_FD~Z_Z|m@MT^,9M=$D/L/*O`N0I@][2S%3DW@V^0;\E#/(7+[:MOWUR8"%
MQE*4P';[U1EIY[R^CH=^]].?`~|I#^1B[]+X\Q50|L[Q?ON3=T~9~_1.XW]%
M22|#D"4+.YE^O_KINX?V=|?_X?VKK:/~_)KD"=UY*D/Um?~=!Z@E9S324"T'
MI|HO]VU&RBKSL4PE!%[`TDBT(m4@6"Y',:C+K\,ZRm%^~\8!`~YS#JV)!_\?
M81U:!`D"6#"VL%G]Z1@@JTW:PPY]E&@*%m14[G?JI03F),.Z4TU9[T?~U7|4
M"H!LU^|V%+]T|&]!QLI)B|6^/N?IZ`(3_6!N("`95YB\1R(.LX)"$#"=[60P
MFA49R$;&]:?&AS6JQJ7RV9V66mI%^+'=K1][NXN0Y5%RDK86@)Q#DKF_2Y&Q
MXIJM$D2EV%S5TW#8C:E6#M#5:3K.+].Z]FDXC#LT\!H9EJM9&^Q7;KZ16OW(
MR@CV6YG6;]!*]WF7N"[;YU=Z!~CDEGH$J,~O\P8P&GW[)P`QX?\)~A_05&$5
MCT"IW5~AN+B#WKO]GWNAmP$A^m_K22!|,5Z5_],~!L;(Y0DM%0A9Am!25:RO
MD7BH?X7U1?|7G_G%?7"=,+]"VR1?2V9EOD;#=/%/%8~m$R.G!!|~^R*9CHNX
M8\P/567^:CW)N5.=[/L*Q?5F#VGWG/4LH/S[6E,%+T,6[*_m6|BO1.`)8Y83
M#;''KT/@&7V_/8$OI@.?Q9_D226$;&);^,;Z;V/;^)__4.SM8P'V?3ZCZAO0
MY*V!|#;LHP!]GC$#)E)MT,+3#.PD@P6F|!2CBPP/QV_&_S8&F::9`*\:##)m
M,W%=IM";C$A??Y/m\'PG9/AJS.6=MBA(A_MQPR$KJ7J7R+L^K[QSm15NJ'RS
M*P*Z3_~`@5N/C'/;.D_TP'N5`X:P!D|9`.=&\$G6TD[+N7QH?|IOX/m1':K]
MU7[DO=.F3&;U~:W5]FQ[X&HKT`]^??VG0O]6_B35SK_.HU~=Y6O+T3|]@B~C
M_S~$'&U6IY4*Z1"U!.C\]Q)@_J?JM`Cm;B&Y_*1%[A8UW&C)WJ^RVYA!%C#;
M:mM_A=5&@;&DT4:[_0MLmN:XOLYDLW_PJG?PGI+@M\BK@`3383J]H%3&MS]O
M9Y`._9YmSBBIY,LN?P=B%Q8U?U@M6.4UEC|OU$3ZQYTB/|,U=N.+O*#|F/6R
M5M+$5QIZZ6"E*\B]V10~Y'_&HX3^.4E/L=C9/SGGK9/&VV88Q_9:LJKZ+8W2
M]*6,K8NKm^`\N_;[MCOCPmN'H`|L'|OLEY=/RY3ET*2_D@1L,7"IRV:[_3IL
M@7,Q?@6m9^F_P[6PT%`2EG\1PT#;#8D~?NZ[A?.MA`'&J2_NMHD~JS9I8Y!E
MF9O/B(YP9^\m):5KSm69ERJA.)536T4|ESPO(N6T2C@&'1:JV$%;ZK_KO?LQ
MG'W4V87N*,`QF6_:&25[.*TUK^\L`0~;8T2KD3GK]/NP%L0DE;VS:.6:P]X;
MW$~M~$WK*1!4XH5*V,BL1OJL6@GW#TU`5U4B7Y!#C9T?]PR:^4Z7"?1S\|I@
MC1EBmIST++4|MP~'(~/$[M;AD9.FQ5RF08@_m~,W(/2/O=?[![V0"~2US=)C
MKIM2Q&)VXA.HX);LVJ@]XAK^4E5`X`]_WGX=['W`UDV7P636Q4:K(|QTVO'B
MN:5=7NCN5(B(W]!NV|^,4WN1.&U/4R4F+\~1P~^.JV1:K=VI$*5Tm^HBIK\'
M+XM20%J9GS.W09(YZ+W:.~AM'R&]7L06\WF:|M4;8"N_2IIQQ^G`?\ID~H;&
M;?U\;92=IABZ5"U)8]H:?8[_;:5[W+E(I^mD@EP;UN\87^339'I=YV!mJV"]
M`]mQ(2N)MSN[X/KB[*QF@E_+~.(~]9*BFM/S5S*F~'CX[91*ND|%/)Y%2NG[
MXP%|!.+@81$O7C0K2Z=E75~Z\+";D|?*5Am*31TUU]=SK#7&N,H6?PMV=@XK
M.S!(L=@1UM(m+G/&B_"U@$]'6P=O;'DVCY^=+L+#5JBRQ[XU,TIAYHZ)L|$%
M$].ZS(;XHO1W=U[W,.(SO+%1Q5F]4M,^KB6M#DSUOG?P;FL/J5^UX$$MA]V[
M]_L'6P~_K#K[&]7V%SK*&]\?=KGG2!UC'6K[%|:'VEC.N_2RX6&:[_+JKNW7
M]'Z]+76O]?XU?6+_ZZE\B`?2O`B+:G.U2,Q7\3]F$"KHA56OYO$4VNm?H=m5
MD"S)*&BW?X%.UQQ:FT[7":3?^["[:TIPAQ_:4"#_G=M%\#~8AILWA+YM*$`T
MKPS[+PW+;[`R*2O;Z'#KWJ=W7'TSOCK/!N~*@%RI4Y'P!(,)T@)9WF3*E3OA
M=~[&;WM;KV!UL(&C7C?:WG__2S=&%[XNQ41^VmO=W_Z)1DP!\]?C^(AJJF6$
MW5H::E90)"4mNO\~m0N'$4[*SK3X:5$F~(6&G/H([@:M+2NU.!NL+AD,THL2
M1LmYL[m)#F2%YXN.#C#N`S_?WM_;`SHF5ZV@K21%,1MC@2KR93Z'9B/XZ^2:
M)TZGE^ET`Um[3_*R&Z&O+T&TB`=`::##$(W87`J57+,P:Qm0G_5H[L5NO\P,
MTK@E]!)@W48,X!#@9K7%;.'9M(P`YQNWCH!G3U1M|)X`Z*?_.(3=(M669%$W
M4?0~?=0*3*P#H*0O"Xm?Q3F`G^J_E2E`LKQ*,8?Z9)A~`+W$'MMO=J)L|IDS
M1`NR=!39R~@:X3W,3NFU*m&m#S,LIHA~.Z=P$#GR9,WC\*F/BAP]VNTPXP1N
M[B2%:~C@W|5=9:m1/$D522+"BF&|GY["_V/H,?2?8A(OPA98QI_QS2G/,RJ2
M.X:U\*#0B,N805O`E6D.4T;0"$;%.Y!@,M4$/1|P*=0D'7#%L[PV`WY6E&Q$
M88C3.M~C'4PBAF\;5KS5^9/X+)VDTVP`6X11IW37$MB1SE;P?41(H@$2'BST
M[(^2N,#K!I/`:*mT[1Q=mDXS^`T[#|W|,"H\95CP34D$?(G7G.[`;G9"\O?Q
M\:!8*V87Y:=/\3NRRG`*,1YD/~|G2_\|T+O[?#L?C[%X8_PV38;I],4+DX[,
MQ[3XYV2:)2|C?',;6CB)RW"JG0D|!#QU?V|^(S^5Z\Z=IOFLI!+(L"~+1SG?
M|KD)LX+P(~*#|'K#^2/90?*6S$8E[#R#R?J#LZPO+0`$,'`^`4QFJHmC15?G
M*4\@8*^#FE$7&\,|6T"*.,"\F"'5YB4+18P`N4X2O"H#/&F[!)@Z`4*?CO",
M,^2ULI)RRF'VJZ$A@PFFVQDE`V64YL)T,[K,@6^H[K2#GTI))?FJ0X_/\^?F
M!$([A3W1%'!8)&ILV:,Q|D4\FV3PKL09'DYVFF%!9"3R|):#?#8M^%"`O.~#
M#&X'P,0A1G1?^)QL?^JN$^V\(FC3\0Z5PB,I|?O:Q@^0SH]SP'1T=OIR`;?7
M0G,T0N(#?Y].\S$m=)XF%]T(:!"#'QURQPG=/3@SK$PXC`D?3/;8RH1O7[W&
M?EA&F_*C)!%T*LZALYT,VFP@S9D40.*F3!)2(6GTWJ:`9_@'8m2T("H7*7%.
M~(I!?G%MCY]Z.I|7Z/XT?BA+RH8;$7;1OT7E\AKV@F"3~|~Vm[KD(*;@YVLO
MS"@H."``PE]NA+MAI_/A:7\(;,8TO^[|#S0QHD,m;Q"21",);/#T)P;.1A(Y
M%5S'1P:/++)GC+R(A2R~Y@AZ#:\)Y1G%ARR&Z*@Zm;](\#AQ3!7\3C%5@!,\
M~F$'/S[VB,|DGZQA%N9KQGE:9EI$+A&[XD~(7Tm:2$QE+,T[B9P8OmQ`WN@)
MTE4CPD86L;N"HD25K@UKY2/%*R&2@XS%'F1N@?[%~[W]WL%!_+"C6m'GE?8'
M)ZOV&/ME_m#\L:JZNA#&U4:1G?|mTA$9LK.=]/&5|X=LHV&Z7']07E?3|HFX
M:4?`(4IGAHJ&/G+/5R9[91TC28N&6)N?_%7U/76T]9)5XOC]:0(WOC\NSCHK
M/40!/?&555$7!F^.2mUM5XM$L|!7(mF@'*8:57\&'U;~:CL/F]MUW`,G90!]
M;[!WAEQ'C*1L1.]#07H`!PPF6=Q/E";N%59^/=+D|#4\Z=[#QJ^!ZM%@7~^Y
M!U)/M[;(Z57Y6S;CmXG$^"X^F#P.TH;H^'C\N4#2B1|1N2O@U4ZSL]D4^8^8
M51GP#(2T"_#`W32@X;8.@KB(._C.XR',L/@JP+5EN'AL`3]4T&][E"93PP!2
MG=P4'6J&64$LD@/4ZG,;?~~\W7V8%$[^T64R?30`3C5]!%^NZ9Q12S7|=@;m
MY(T%P`%'Z3TB.*=|U@7Y`WO6OmRSM,0#Z:Q4=K+2C5|:MK+"K\I==Q&(Q_[`
M?`m$(3K^#!]VG`;=^/$?'S]~I?)0@!6D80&Z.|Q3*@:5?@'&([Y.*6|O;~_'
M&=QWLQV#;;BAmX|EG=_#BP0H.&P)DY;"!_U)~N7.R|O&1G!7R^DQ_S8"KF$M
M?O()1;4'CQ[@1LP`1.R'_0%UZM+7&U'E6_FN@43`VO?2*Z!O@\^PF9U7!4?_
M#IG9XBK+)16%Z()@4'QF'NB'I_%))O(_OK5:S0P?+'[?ID;*0OE&.5"^=#P9
MW|m1#G!)"IH,GLB,[PN16Q2D\&L4CT"*AP%.8:%%BK6C"WXE0?!6@*/KE]_^
M#W^"\TFF]#J6D4A$mGD_[`+NS6~:F4Z+6#D87/~,"HBBZ.KJX*Q&UY'2#~P!
M'*(62L"A.;LEOKN3:W*$%UU'G~.@IVLN=22&ZFX%A85~'AYM'7TX[.__M!$U
MT/|.7\/5E~W#E8TV]&P:@*\''D3G/NRLCE?]"_BC/!7T6KGW^$]_X1^XF1WX
M9I5[P6_Q*0XH5m;BmZ,[?/|\?LROF9F!'C4~V*BWZB\F_#;).WOP4/=W]F$)
MVR`.PT$,?m`*%S~)[Q4K"Q6J\6_D31.`8*G#V44'_ID.SJ=V6WPmX^_C)T*&
MFE_OP0B8.8``[6\V&663SQYXO@8B~_OO~N\`*(,@4++A"NWM^?,_3S/G|T0,
MQ`F[,+1!P+!(?0S6\~K;.8]6M+J)6C8F7+VD):A(\H2Y6~%K$5%,X~:HJX$m
MB6P457O!G1@J??CKK$!9'OFU*X0!%J=+/WWJ`K$:)+/"4P%$.H#RU%B6AFE0
MZ2I`V~[!E`m)`0\_G&'I.UH?C!^Q5M:Q;J2RP`2%8/.^NUO)*?Z6I%$&FX`@
M(IV#Z!|2K*TW`5ISF9+4(1V(#`,!O@(*B92+%+.HKKA(IU:U&4(#(Q`"STLX
ML!E;:/$Z`N??C~\7#MYLUO`&OAFF)[,SY6!QB(M96716GE],TQ?~2IY]%"[8
MmNN?E^m1/RT&R86#?K!C/RVS'75m?CY.GC_""71(8GV!.L&*RWR8\Y6&U[93
MK'9)%[@9/R9N'PYLE':PC2X9+;8$!K@C,#.F!CP]Y6%LmNL)$C94M]*MQ`O4
MVWJSM;/G?[2S=^2X10J86XC|E~"$)R/@3Y!^X$\M&3~M[8427?S!W7X/TVH7
M@L~:^4"]ENBN%JO"J1_`33!*"(_8.EI\U``#[4&U$SQM%N~0|X#;?96@P!Nm
MT+H;)^m\mJ$;S\.(1IX984D@2SHV~H[3H='G$EM|H,XMF|(01KLCJRFGLP%0
M2M3QQ%NCD0U=@Z8IFRFX^UJ&JL*|3"*1J!Y(mV?$:[[G5|63,Q#TRE"_A,.0
M4!+1@&1/`HXI'9V:"ZF\!/`+``:|16(6\+Z/@3R0WB`I,OX$"4]$`@J0"&"A
M9@`T^M602%:\$UN=8SODVPTY80E)&):HN$@'J"IA4%WEm!"R2KV,5)`T+J;(
M/$%m!1+M3Y\8#B|YFE\!/JBQT*]4_$+~C,@DY]G4E9%W_JTU#+AQUB\X\@5+
M|NXGm.m"#SQIM=31S7@&`~F~33'K31=]%^^XHO/R^@Q9,QV:U64LI[1P^ZK*
MPMDOXE6_`0S\~1LL`MMNVF]0(4(P9"3G*5OT(MFP0~?!9.W]U@%Z8JWLY8X`
M;W4?9C]D%G;VQX,ZWUNM!J[#P(?4,A9|2O7L]YO.(!Om@XJJQ/:C]=AQ:Z,&
M5^.480BK/?%GONI3AN@X[S(J!8.MJR6S]`QYM;C]6A_'&\HLmZ3Q(EOY5RVA
ML@FXDWTDED'&PD'Y^_A[^[`~YNA=",[%~.S|G+G#,TO`4\AH5NGG]\7O.&%3
MO\3WDR?3'C@=#[.ZZB"9LWN7##1KX[Q6'9|V.+OBJ1U"MP"Q=.F@:/;PX;~L
M(HKm7ZO6$W+)2KVW^14J#;I$/)'!($Y=7[H$Y&AX/XGE%Z8|Y1O2.S`C3"\I
MO,X)O`:D5YB4:`'1UC@JO'J&~X~=C%CQSX]T@4:2C/4|^'X'K$P?)FBG886\
MBO==*J6(O@?DK:3,RSB!,9,3S,8"JYNm0&1)\UDA,@*,]5KY|1BGP&&,0H+T
M'YCZ.1[.C+4'5[\~;8V*O(M/M^$71'_&2A1LG%MQ7[6C;"C"0V*?CWPV.$~~
MJ|1RYR`IF#614@?M3E|DH:1?2+!``W,Z9@NVV#CQU]/1K#B/:8.JON1$/K"`
M|3XT5A%2ZN#H6R(~X9^TD/P4H*OJ3#R;"/K!C'%QC2H#SDO''B)\V,7L%$;m
MC"E3K|H[K+HBU/I.]5C/9SC3^KGX=|U!WDU16(CM"ZXI/&P+*6*"U!A^8TK@
MW8@V=0RMUM4FD,|4]ME'01&1EO16%8F]19YNEN"]9P:7NE&_NU6($69.5+;]
M]"FL+0A*?7|K;V7@/=G4)XD`[[D7NK06*3=0SP[\[KP*JS[I9V\IGUL(#\.L
MH]O8'TG[.L~+AE0AY2LKTE5Z!:%ZHR!0XNNR(~$7Q'UIZ`,CKBWQ^BS[_@26
MA&YN[HI8&C0~PXBm?(_)=8HUF|GP,BM0^\#?=HZ/\1=`E\X/JZM*8|;`?[)%
Mm`("m&$#.;8C^H5R2(%T!6X]JMRmZK:+61_Q"HQG%.X;YR=E0HYG91[E)ZFX
M410/9')Q\T#,A9D/R4D"/D`C.VJI2=U`+3W:&R4CD,I(33)A,0E)[QHW1_JT
M".D!`O8(,1RIC_WT=#`I1X8@M5WKS8A4I[@&ER3L]P]~_?G`TY]&B^@.|!Q'
M=\!;1;5H[&HmS)UCm*.#(SW'ZSYZF'5AmH~)94W&IF@RDm~VGY"Z(UP7SUm]
M+K)VQ8N*WL,HmP0C]_%TD[,DJ[RDON*NR`USX6HO?`UAY&@(B4%A!2$+ZO1D
MDU6H/!?Y?W2mXZF67]^J,3RRD?5*(\V$N`!4&)mB1H\]$5?1W4DLNWC$P?#K
M]2~L3I`=B],I0MTU.17HO$"&IS_\7K3S1M7%Y]U$OZ$EQA(@)`@;:&C"&55_
MR2?&8:7/IBOX3H6YD:MV$J73Rm!:6LAF|!A3ILSL`T@W[J5#K1OF?A@_56V@
M@WPVRN/N:m5'(OUBOL9N0:Q5+'.P]B:RD#N&+7]BX/M:T8I.U#UQHQ*=IQ"U
MT[B:T7EZT9OP&QYYKQ]+&ZP!IC?8SN4:BH@7D0.RROW7V02]HB13HRBS+W+D
ML#mRER*G/'1.Q)*FH_2+~.@AXTVQ'`6\m'BW(B;&SE526X]QO\'WHQNGI.ZB
ML=E';H)L:W)&SQ:ZUEUFXBIGRK2~YU=T=7WEVGE2P)U,^2UPY`QFS~&)C+SF
MZ`?*V2C)EY*G48|C^$I$#/+I8S8^G10S|=6.FmTOT%T`J8/GMY9mUM0~H,(Q
MNC0[SF6LLK2;HT|=7=G8R|AWI2/FT[89H,|!J5Q1V|=3^G)0/DU083MI7I!9
M0F7LDU$R^1R!T(m\;=|[/$N%K~XUBG98$4G~'"~I;\%5)R_K/+CSBI\MBURN
M&0=]AT312FK.*Y"?XmF'(|[5+,1^DL3#Q)_3:_*6$D6H.W7$1E!H!+14F$HY
M3~@%|QQX8Z(3'HYI1"E]S@"$T3CYK`M%SSW$[@SmXW`IT(USJO.SDAHASB8D
M523#$R!RD\3&D"![19YB:J$6\%A%m;.!~(+\F5BE\*"m+IS=RURW21=2.HKH
MM=%~A0S|$,1I!#QKOV5~:F==5W!#M#DV;|EZ|0$4:./HCZ/C8\/??_HDHB~Z
MZ~,LM&FZ@7AmO9:WUC;SA:WIFQVmBE5]+J8_H?8/&1!]437=7KmLUB~DY;;:
M9;]WNWYYT1TOOM.:3CG~=&7I7T~53$B(2MN`P.1]3G@O@I0KI#D*W5MI@1W(
M4#?SBPNSA3;HNSK()0/"(\1/[Z#9~FAF=[VWG(U)!PYF9KKKBJH!H7]1Y;;A
MT6J@J8NTK;IB=SP5H`E1@YJ`!4:JZP4"*V*m@B=E~X?LR=)5E:]_mYN5OI5V
MKMJ7;U_X*HH:EYFI;^R@:|@3ZW*/#`?D:R"[m0%(A7E1SUH9B#`Z8DTH/UB|
M3\Q[X"4BC1X$Q_|:WVX9%WE%8%ZBDP2D;)&K9AmYANFUF`^/!5VRVM1[OF5*
MKR*.$[#?&YQ5G:1@+FLEZW2H2?^H^;S:G(EJ1HX;0I)6I2.[$H1UB_[J@G=?
M=6.W69DWN`E`GJNJE'4!7m//),4^[L:'O=Y/&/BYJHH4_mF@BBFNT9_U\RSX
MBX/#:9*mN$;*C0.+NNP|UPB9F]NLMH\00:EI.N](3TN#ZOI)OQ/_*EV#3]T=
M'J*?7]#W*&/S]]6!0KTm=:QDP8&VHM85DF=)NP^*1J(|U/)^4RKLOP[$_TQ.
M9J?'3YY\VJBMKHN.O*C,,0M!O0Y*\=WXKW0O*V=A[(Q5,m[G|=P=m6(0_E""
M[:#25P=BOGDCKK8B':ZH~3E!U5_AVZ3,L\YY4!/,&97^&K_8C#/)H(1;_"OZ
Mm6Z8!=U$=PIQ`T5XH1OH|`7(+@X0`@`OLQMS8_|DI(.B'J&OSTFBFET/;7D,
M]F=NQ]_JR]QVJT_+*7#7B7B"/7;T[NPZ3M$U2L!H.BVJ1`B5CX9%HP&^P4(B
MIA&D=T'GS|:..)G23T__&J3*8=(.~[J8HK8~M3/3Z~S""026C2WKR'K#\9M"
M625$U:7AQ~`\Q~NB'SJ.XJA72:?XXDN@%S`B*&:6I#0]`WE3C0WR)W1.QA0*
MBG&4;`Q5;S$9WL1F8'CX4"3m@LI"`02M.[KUH4K.4M;JBm&7]#E#MEOG$ZID
M`F(^4*8$_;=&6%D+^0\R|N=3Y%+\CNR*/D7UU80|Y\_(V~LD*3(X0&Q$6K/2
M:8@2=8:^ZP#!LPD975&U"U.|BZJJY/7,8)OP()Z65Y\^1~0$GW\FIU"TUQ(\
M7".)MJ25$~O$?JN37%05P`2RH%_QWL~3^9Q~E!Q2(P$BEQ(T`NS6UH0U,)S;
M([Y2AT%T=)Mm;*SSD`.L5;~"XFUYCCRB'EM$0'4/.REm,#8I[`H$m$9H#R\!
M)G!6U;P%$@F.!Y2.*;\LQ6.CP\'L@F('+4J)A?S0FKHQR`&$(SR2=(KZC@EI
M,Gm1|J(O,9Z647"BF]QLB@FDLZ+@Z+U]1D"&"&8L0&U~I/M%WX"9A/]mD+|=
MT|~N*N9U4I3P&7/5mK:H0+2B,%"J=,W*$[+2X2TBF[^mHS=Z2=*TX?_Q5=34
M#%D1S|CO@:.|*:YC,$V*|S*G$+@$*Q%HI1CO;|RD7MBHR%&?RYQ[(BZ=~`2%
M+)".X00S]M#E$1\)P`0*%V+8=~721"~I?$/*6V#QDQ.3~\(LE^D5A_;CBEDY
M%/~^P&BEB6+BB]Z'~]!GNO"1Q9WJY\W![(Z)K[Q"`Q]'+V+1/2=P^I35[Z]H
M6/;3L)X9'R|KY@59^5``MCZ+:PM[#D?\(GX.5ZY/=PV@\B(^?D[Y2"B;!7WR
MR1MKYS2NmJ`P62!&:!`;I~D%GX=XX5(4*C4E:YHWEA`O5O&&1@5."#WH|86Q
M7~&C^.DZC&.52$4)|./W(?T"XLH3~@TTG$QB+G67Z(~!H4@58'@ZJU.)=:*/
MV.^7@!L_+$ZZQ*~AX@]5_Q+#?MK1#_"!?WWTYS[F&HN+$WRY^Fm:^W.SA%7W
M?:.Y7(^)Q[3XC%)/9!,,@8F3Z=G`=\]\"!]=:@`]&K4Q1RV,7ZA`AUU@RA_0
MDDJ_OXA_S_,2&EFW2`Q8P\&.GWPR$AZ\A=/|?KQ1Z7=#@+XHE/6C=D\_Z9CT
MU?mm%8*\^60I/Q@/~#QT=Y@?=#KB&^!+.Y!I31,`%E@KG#O68_R8`XX,P!DU
M!,W7m@529A(~G^V63RRG#+~OL[(._&(56;K&(!@SRO,HQNV]/CG]A%8@Tm0]
MS)W211),@#`J088\.X=;/QFR(2"F:@&&#WE02!PKORY(R/PH5]1LP%T1(\#G
M]mKXK`%W1\Y1G&*`_R`6PT3CL66M1.(X34?X*%]')GY~?.TYX"XI@6^#/S%)
M#QH\F$:#Y#M%:QI1SV=1]/$D/|LF_P!N=)S]/;V)/N)O,5;_.^I]QmJ`!^@#
M`D_4^@'(9V6Zm1Q.81N?/F$9MC7FT#2%QFS"PZ)%BTP(R&@4\/P!C2E,8AD@
MY93@Y0Q?Y2_71*^\^!MFK;`#M!IB0@7X]@JY/B)S&,Q8$)\A#XQ]6M@Y9$"9
M5m3&(F'RQ,A5XG#IR21?$|KD(7O'K#H?^Q\.~P~P_S~8;`P`@!^N?X#];)T!
MK'7W6^JNP$!P]A\9F]!M]J\1Bm0@$IV%B6Q"G1$mG9Q1N"m%(51LD(Q,P.?#
ML!'B#!#FDVR$S(NQGU*M4DKD@0?KYDPB9S]G;P9D$4%5@":NA.L5G$'(^3B#
M|%.0?:`,%\CTCO*S&%5]F*0M%Y0W|5^R9TI,E1&VP^S`_Im)]M1:W."B`7F~
M(&LHR]@""$]/LI)RW7B!%#C3`)CFS!CD).A$\C.X8~@1KI6/(+W,T._3#%,8
M.8IA3`,2/W^2TJEZ8PmW*NSA19I3,AEDB6;PR:3,#/]F/&=E;QXL782mR(L2
MSDW28EVE)YJ*R'"&BD5~5J[ZCBm_QP`_H!*6$*"+6)&ZVR:422[32I2.A1XB
M)B5m8B4)8'%T?"P,mZ~[X8B=J?I_OH&mJ,UK9T)"QJ3DA":N/8N0J`_|(@#H
M(1Y[GS"_:[["S^`9=AJ*:)Y.+E%5T%FI$3",0G_R](_KC^%_3]`&8L~5ON?$
M'')W|_.Q&Z#C)"6[B3.]KPO`3X!_?!GX[%F\LN*:_,34]V:4GX!\\(H17FU^
MWW%FMM@mH||%P;49KAHm#2M#0A80:M|T2A_XF,I(\,D??G^K\5#=mUF=:Y*9
MA'L#1Nm*+GF`8MZ~+AM'T3TY(RVP)QB/#R1^/\W+O%3;B!~~4SF"]I@F6!VV
M0I\:FC\(^_H0TMCV9N5E!|[5?M#.Y$NI`+5]E024YM[MB]3.RUFOR?W+P@&S
M=,*OK2E=FNE$JRFZR1+M~8"UQKZXRK2J3Y49H0KQ%5EHC=PXU.DK1W:ID25;
MWV2Y.+1=*PX~|BVW6;GE"(TIL_4@V\Y#9C#I:5L/G1M3O[L@+`[&%YWJ]6P\
MAI655=\9PCT7C3~:.ZKW(%1'=,YDX0$]\#~M4|Y#]*YE~C8m)LTCTYE$D8KR
MU"1K0RX2FJ||+8I9U)P7WC!(I"G+*;\^,2UTmO(5N7\*!W`RS:\*Y%L*#KDY
M20M'AV|3*J([&IN`V|IC5(+.Y,+ZR"SDII5,16JYRJ=D[8V)O1N:W(T^?X=:
MZ+3TO`')'T\7+MS0)m=T(ZBVG&::GM09B9V92#32M,70~5I&P/J=9E_(^8DT
M1$7*0B"E0Q$7*&:Q6%Y)68O2H:1AZ\`$5_A|%A0YFRMJ=[,A,DH2WZ0|KM=B
MmB%/9AP$*T8+^XEZD`R_G@Q|%ZI%*#*9@0Q2DI|I5N!NN,E.W"UPLHm@D&GC
M5:\X`=6(m8U(T1_0E;?&MP2!EZ&!BF)JV@=Q/'"SR|6,m4~;'U?.LR'(R1]7
MZ)C@;QX3_J:'##Y8:|SP574.ABDX_,`XSW0|\MKFVAN"B3KYUJ~O;^GC"GG[
MWGZA=8:4\NS#I\"V`;O|66'9@T2/%3=~8"G`SB8!PmYBQ;|%+N^M`MEPM&D3
M=&^QVIL0'NmM"F(QFN2~PE4_RY5FB!UN66!/!@ZPK[]V$_5[=;,@CT|4L9IL
MZ#:$!;,.+!KC&IN0"3(0AZC3(L3H*TB0=*55\^?Um%^TM@|O'ZQJL$)KN_L/
M?m.KY`mC0STO9',EU*0_FV9R,:1YF."P"[~m+;@]80BO\3[3@$V]Q,LL4Z]N
M=8W?Z'*U+'@RV+Q~65T|WQM~4$*:6S^?52'&R\W7+m6T/:WJJm",SCIN08?~
M`N')8+%'N$`KB/"\14,.NTI"!7%'`8ZX7mNFE3Z+!=?O%1L4Z+;Y"*U0X='B
MY_&32KAG6\8Q.mL_UPAW3712(mSB8C0!?39Q@3X/6CSCJN=VU@8LN'/mP)+!
M7$C=`E;6PZ;N8BK7Q$1OH$:0+,9L])|TQP5GFCG)2F2_!Y_5()G81,A9@2X.
MM$M'*A#G4\RL4U`*(F3$X8)|IM|FS!P]`%*T@5B?A5W)S=QU/G6$!7%!C3';
MEZX|'5m,V\)$A41DM(=^9HMF/#'@E&@28Z&%5H\V&|H#~IBm+BF`8C#mZ^%+
M.+|WWH,B/L_2:3(=G%\[50VF.8R:E*GmFH86&`Q$0|EC2++(V,U';_8@"8E8
M"B,/`;08L4J6'78CRA\_mL&.(*$!|#5~]C8*GA)F`|R?+BI,R&69]_17.B$H
MOE5|0I60V1FXTE8[4V!,K.S(IAIHTK.@!EH`^![9H'73mTP|mUS:N`S]|6C@
M8HN8A|F$0Y\|*mSZW5UF1?3*K,!;;(BS]PK~YCF3UDN]:JX(MM"#MM#I;XN&
M98'SO^WI+[.$MM,/Q1"\D1(6+E%[~_1NmWY'E(W]|4Z?!7DBUIYTA9JOQB]?
M/'\Y*&BCS[#**/JO=/3+%_%CVP"HU^#\&54'Y7.TW\`/^KBUS1A_'[.3K`S]
M?4P6_X&S@O@1SF#^5A;]Y0MY8?F)Q2^1I#X+C_ORQ:9I8=:IKW'$(S_*3G66
M1P"H2'YO@EG1|19)0$#4!3C4C].%23m$5BAI`%!,V]S;.BY*?[_]@~,,YK@K
MT[F'S5\U'#7M=mY!.S/I|?"@RQRR*V.+B"T2]DK#D=,|WCOU\H7(X$X7WL#*
MBV7/G@7E^2=/)'/.N1.`?JU3!Y:C^|R[+,E_PZmOF"Y\\/7IB2]/RV?T.3HN
M+8(:~)BP;N[S\L5+^H#"#EZ^N$]_.,?*|^#9SZ9&1158I$\KW+;^(36ON`67
MJE`J.E5`+(5.m:`K,H4`W`#~mF0[RM&!:L91_FE9\|3HJM.`ZX9`3HN4S1LU
M11S.+F'SMB'G&K"V@$1*ZAG++X~`&ZN)*2Y`T@@["[E)0|3'&W.!9604P3Q8
MOF~7K3?"EA?X&$49~$|YSXVX`L.P4[*_)$Y~\27C?QU+TA(%,6I,Q0)LLm8O
MImHQLD(+9HTF"POE&M_U,Q"3TVMO")X*!9;C8S,?EG(XC?=_,K4FYXPLG'XP
M)IH52.Y_G4!*Y%/9X\\L2!A58I[8:ZQS?Z)NKAQ4)\G?$6V|K33$6QXYB&%m
M2^CmmT#3FJE`9.QJTX!9;mW6CVR"_V93HOmY3'*;1m0R9!/OWU`1R.1,#X\H
MV=B#_196=[5G4I=KQ:H](SPRH]O'8U#$L?51*[m:UGNA_4GS111`P8EJ6=:\
M`7WX^\.%m\5EA&^$V%[R74QJ1+:.7$1L*;#78"LG/"=G2K%0CB0.`6DDC|T6
MU3VIT^!'"#`A]'*ULY^H7XG)2P6C=EN.7"!W/[H6RQ.534V''DC1:]!$J05"
MS0^^;E(1WFUV@U@m)_BBFD'HU~`\2"LM,X3.m:2;=&:K"7^~BT&]9UN^P6KF
M=XRAF,!I8)8M[,()/HZ/|8mPH4W$KF/%PD1%BV:$EV'623|?S@W/F8]T0%'I
M4_J;SGWIOEKS5@\1]I9TOO/S'9C1Z^\FWS7)O%"_:_[m@=N0CT49IRT%%A0W
M'Q&CHBG3738EY`HK|?;(P+@)1"6@7NIJ#]UJ)K4'C0+F`TBWVD#H.%~&8mX\
M'Z^F=),.[K:6_5I5Z,KA6/#ZJ~/8UT1H45*B|IE4Q)3:%37'(_(P`0HD3[!?
M0N(4N#/C3'UmI#"3&TMNT)3I';X:.V[FD|D)'PPm|Ym&P1:1X[U"KR;2'GmF
MI,"B:KI?]/;0'/OI,E4A1_E9/BL7X!T=S2Q+D[*8|$[Q6WmA4|NM].|mJ%;E
M8~5+[R`E_&K,I(:8KSQ:48WF|F/,)HUC!)C$&Z\,[RNM(ELYF9LHLH&:YK[+
MJ55J@*+K$\LmMDJL*1R:1$5"L7Z9UIME~L*1B_NO?MS^~)KG)8A!Z3_|P$D0
M1V%TLIQ,*,8$`Z,B\AJ[P/Q@|+$&T^Q$!]&2EQPW.ZC/)G5FN;A)4EK3Q@E&
MA61?|)"X\Q'DW'^|E^7%LT~/KJZNUO&;?'@R6,^G9S~K|#^P651KEKEMD!RB
M30m=\H?3[#*E.E$T?L9Q'.8.9U0\BBXA1J=(M5A3[6F|NNF7C51GH4Q`9\40
M\CMP|?#7$Q/V,XR'UR#1`SP._W,7*S",3U**:(0_J=Z8I#SF"1*D.Y/KR(SO
M9;?CCm1P5251FS,R[WF4G0Q/,CmL9+"%UF?%"UG~^LT")7^')WI7M~JO\\F\
MPK\UW*Y7_JTUJ93^;|K"*J[=_?T?_V.;__.V'S]!B0UWS4(UXD3\X_[^+HIM
M3M[6OXW\E*WP0?JEE)RMM2IY2,(Q4S+^2VEFN80@E_W;?KV[]~:0`C8(,?$_
M_9V];?R.$&[$X.4O=G=^W%P;X;)X:V9(M'_A@+V_'!UL]670[S?CWW5TP%7Y
M;O=5]4L8=%6"[$W"|(U&+PRJKDW2&16E3@JMS$V%A`##4\FWC~G3O%MI[I!!
M=\VW0XZmZAm))4L)E!%6QETSm6$H8AA=4+&,=99Bm@1$4PPP!;)(.:;(9@/L
M+KYOCm\)|'J(G1*Q*^'|?#U/X|7'Z"7.)I~9ZN14EH1JY[*R1"\4A^93^F$U
M_8ZR|49U60K.`.F``SU':ZG7*5$ZE4,Q^AM3`(KBL04V`DM3$]RAU`:D~"(V
MA0''CDC")#*XX@!F1ZI5|BJ@IU]P2.+*PK4|AS@UX#&E*3Z=H`JM_^K'K|m~
M_ZV],?K!\^?V[LEBO|B2Z#OT6SUMNX1Z@U9DXA7!0UO#AAD3N@E.E?2*\,AI
M]"^3;)005B;D*4OQ1P03"PIQ%~8ZN7:4+N?FY[R.Gm3)VmPI064$U`VF!])V
M3DDY;/9%/L8Q\4?M\+!Y!27V&`@A#DI|!]#@M[A)NmH;\N?AT;LC:#HN13\6
M(G;O7179C8ZXT9R)2UIP_JWY*]9#AV[IEW30`1X)UX:Q\:\HG!!#mR88#CV&
MR]*!K[;?;@'3M@H@A3_Z~T~'J^X@0%@O=)#W4\3D=,D1Z)9VRE5:QF1X!']B
MI_[;K;U7NSU`SFT*/X$1`92`/5YG$(#@]G9646W[C_@C\X#8^_##]G:O]ZKW
MJ@m"%MK8Z4L2N8#GmmmBT^W]=^]VCE8WI`7J5D(C?!3%.JR"&5?2C]#'m_#?
M&XE+?AQ87_]SFF*L]@+KY%F|G?$,9#DPWP77'EX`90(BV&(E[T,X$^]X:(S=
M?1*5G5[(#_SA]YT+S.U#TT*['^$S@YW~(!|\SONM@ZUW\#*]_W`D`_|__+CS
M9F=/_M3?%9#~SV/*S74_HW](,55=3S'"]0`2C;YJ28B,_/O/6P?\1W!!(UI)
MA^M1(^[B\D:K$:=TQ0%V~WL$X1D(9I,:^/#CSL6_9*F/#=!XE691=1@2"%~I
M%][:39;!XY?553_[UZW;!S$?O76E;&,8mZ/J*:#[#I(8&*3_:NMH:R,|H0=M
M#GI''P[V#!GT/$7^AC%T7ANB|G/:F$MY^&YK=Q|PG0S#JU+2WmYHR@Q2_=10
M"/G6&YGN|.@+N:;H[D9/'\C?,PZSN\^!@+76|(F|UMZ.,&^XP!m1)]"9D,mT
M#P[?,CKK7W9L)`XF3SB9G9V1]QFG/$XG5!m&DSAQ61J5==~,)(D\G`G+P0PY
MF%(F+SEI,Q8*Im`BKGLO0R+WBA'MF2GR#5+@^F)8!IP3/O*O~C]^~`/OT6'O
M\m#=.FZBCQ+#9(@XT%$NX"&]R[&+$0/6AmC._!PM]O(m5H61F/]8KW"1H_@A
M:^`1@(`0*_8!QI%8)|KX!V~P0?H\S@']C%6D_*#XSQ2^)&DY.'~F=E)."OJA
M)[:;m(]3[`$1.?[AAT_.1S3;\9/'3_]m/A4$O$R8INIG;](2C\C;[I/:(W,_
M&UH:LM'6]VF]KV:,6ZC_#SZIXPA7K$^0GW8HMG:107[O#T*P,*mPG&R7+C)?
M1^%m^&]2@;J43KU*TmGLXKHC@ZT\Q`8/5~&M_K_W'O]I&/m_?GA:Q/|*\OFE
M*LX(0OK%9m"CO6G8+ILT#5]AT8A*"_`\IU0BJE.4PWQ6NAYA\(^;\*=ZA9`0
M\]6L7B&F)`:]19]HO)EAG&~ZB:)]"9;M;5L)D?MEU_!^B34(U]RV!B2G'4=J
MZ&KQ6G)N?BK__L#_CMJ=7_F%O33T_~'HPB9$~JJXQ(BXZF$*KB*^mS1;P[!W
MX!:TW/@E)B9P||R83~H#C$8S':(##PD(=*L/.THP8*AVHm58$83(),""(&@`
M+"WP8,[NDOX+@*!#4#[)H|1)]Z0[6*V3=T&'5:^/I|BX+FAm;&HmK[DO,@]N
M;Y6;ZEV5[PAT"D*C?&(`@mN\H&WF(]HG\V`.|FD?V_Z2&CIB/AEZR&F=O|$E
M/9&D|K%:(U16X!,NN@HWV+8HTXLBZE`%O8$.EUBU".7~RZ~LU:9I5NGU=O+P
MH5:9;#"14U3#,`BQ*+.YE5V+I/DCMF*8V5K8:63X"'|1)B\mL`3O1Z@K~ZU9
MH/'YA!~8K$OK|`Z|*~Y(:ET4)@%=W7M~\SSFDW*:HQ\0;6V4)I|2"3#&U'E)
Mm$U'5,@;?9DP8A@YL#,,?BY$(_4#7G@&_FS"J8D35E"9)#"X,[~"PPPS\S#C
MH]8^ARW"D?3\J*P?1~\D3AJ|B!1C6$29TB6YNJR"[4N918@)9S=\%K/5"_?m
MI\H%+R;9Q8PBmmCD6E!R/ImOAS=+RK#)m~L%43M?4D6P$L%.D=*1=L:J+mD$
M~^8G?X5K18O![%I=28M4D(X.S@,#(53MSC8U]`_`Z~VB,LJE4ZG+Z*)?J9$?
M6@*1=X:"X`3/&\NF9Q.+!GP(E#52YR?5*2:#Y|27U?2,7)0YHJOR+!8[C*M+
MY/@4'$W+FP%]'5mI$@G[D`=?@L`GD=T[YTM'[~^0(DDFY#,G2E0SP8!S_I.W
M!:$m)~'4LB?.L~$PG%[)(FDNZ1EE!((34SR::"M2W9HM;"/*4N8RL$9I/AU:
M"Y56Qm9DK!UK](A\I?"J1*@H11CDH]EX8M32INBVV+;mC`2W2$YLFE*YKD%J
M\WN~I:6QF`~4JT"`4;U:I0SD5L7&||8:X;PQO*~#[^V07J"3[(SD)#E#5'OC
MG"A?299D?+^PDVULUEBX@^83]4=CB%#'M37=)??=X,_$\DPTDRNP4]@1W3~Z
MD)mKYU*B\"IC3?,3S!@74YX&5;AB5W18S(L2/1;C^_A"`59$L:`ZDD%D$SH_
M//WC'_ZT:G88L2#8PZQ3G!~4C.L3`*NX.N*54%I:L@*X,(;/K?|[JC]'VA,)
M8J@Y04KET#6C#;OOB#LF!SS!5DYG(S3#)8mS)I^41!;`,|AG4RP:B,XJ7(V&
MG"HFDL,6ICP^I@Z466$;,VE/,5';m(W0+LK:_|LLD;RZ?"(P"BUTP\OG:B\\
MI?;W4EY%5)7(V87:3R3M`Q^?4"|J5HOX,R%S%Y,*$Q$6D3A,E'Y(*],R2M3:
M&EZ4QG@;MSN(&m0VX9S34]X#H2&S"W%37?2~+'])/$2W#~JW)7Q5"mXNJEH\
M[=8Q^|G3/ZS*QXC^;3|3FTGEE(XK2JTB^B|CHD95"@%|4V4_BVQC(X([*L!$
MXOQ%F_9//VmK`UJ3?;ZI_2S47I9m=Y;=#^HF/37E3;'4VF0m[0Y\;5&C('@J
MK,D`;V8DB61.^$H3,4)5T6Q*FV~H7X`D@*2@*RZNU]S7|8mm(GWm8K,||N]F
M!N)((C)A(E8"(~&;)@m"6,DS?84."&2%DR|(~9I*8DRI'I)X.63RBS20D[S+
M7$8DF:/Q6LEA\3/#KQRFVE4/+X00TCL_'Y[`#'/AV5J2#$'mF@m0*^5)E9O_
M(X'!'`K[m"%QP+%ICXY!M&MKJ)G]3I5?m156.34@%526]Q5="9@S9(8]+P$8
MDQFET0:BJ5"|`+=I#'04+)I\R|:SL:%~S*]$3$(RPRFC|N.2:]0!SY0/`,|S
M3JT=#Z?YQ84R|S"/$4U4;HBD;C:R.L":)8BK|#)9/J3,E/"Z&6Z'7XFJMX4+
MGX+3(R'#@ORXS]P`37/KO3EB#1XGWVM)`,0G@*5O2\,@X@5")]5!9m#66#3Q
M7(:S\?@:J^5@PFYSO,+~X!60ZZ.~L.8=DMET'HJ80:[??1151).#6(.[SmQ=
M1(X]TX(V3X_C*|4X3TJJT4CI9$U)7DEC[Z48=1^DB(O$Z5mF5J*2(SW@##*^
M[|JX.G5^.#D490LVIF!N+9=;;H"74]YA5G@3ZLM0,K+9I[8*M4R#G2D5E/HJ
M*1VAX!1~JBT67&I)/.2~Xm5A$0,/CCSP*,"D+$RWV.DV2HHRXFN2#@5TZRQ4
MHB.0R;R5$".&M+XTm]\I/XL8S2V4XR5/I?4(Y1DJJNEX#A$Z$X=+=T:F*DI8
M9S+%1?"K@VZY,"(+19'CV227QGm0HC&Q.6Z7]R\+5LGWm#N;35m3Q5Y\+R@9
M,HNBKA@*^#9E~56$0DE2QB`4]`;:3]XS[$J`79#9D`YB20#Y|`#OB7&&%6.`
M.6`JCG#&|4.1=.7R"K+BQ,38A)@7/CG.F68~3*OU]M6F0KD[3[KT/WY+:R(%
MW'(4*:P%`G~L5OQM=U7L:*2H8E&`Y"Z\_%9LI#L#K%,1?8|^N0B_/K7=%!8C
MDI&4/ENP)XX^`Y|BSZ`5~[^+'YN:WM9)4`:*OE.N0D;|C(%[:IEM8D?6J33~
M:?$IRRFTM3.2Y!$%H4W~,?mm/ZXmJPK`%8;@RH:J|%69&=KY1F2^#2UR8S'O
M#3$^mZYJ0UL$)]MH,:L&@\:&)US+!X?(AF&m.*]"^#VCSH5W4.L?~,:NC:@]
M;XWQ'S9~%B:WH\G8Q#3"*7*mY:U74/\|.8EZ1`%mC;OQBI2EN\?Y.QBCmXFL
M=N0!0CL(AH$^66G6':\PPQB3]_J3E:Z*I]XAJmJ:_4S(W$"KLm5QFGQ4U+_#
M&E~|#9G*0[*EQ]4&E1V+"5`H)Y*V~T5P^3).ZXJ;UBR@,F;,FFEPF|Z+6?D(
MM8R=3##mL;=IQJ=F"".1=6)0U%4SIFH*)H;0.P?7(2~JEC|2B)L*=J$$"/,O
MG1`1DU77!Cm@U%;E[NE%T^~FEF^WU1[D9\:`X7_=FZM&77;0P*?R)1(F^!/O
M'CJ;H#T&_NP7:,O'mFK]18,G=GM1(:J,.UX?OX$)$LC)DN~2,8;@BC6*\Y:;
MJV!58P8IP1:"KB23]M.GGS0FSRWKIY722F8%5M;1`K;B&+]X6HD,X.*QU%:1
MV%Q(L@*M+,=RU(G8BDC@G9?=6/YO=:6%'/E$05QmX#HZZUZBXUm=YU(=B\X/
M1O^P0"]"E9~.K\OO"1XN|B&VN~XLOU]L9+'QS|JT2MR^.:EI"N8+WX.*XP6_
M]W[$"KKGH])=:1;5!O3N`'RRH@|[/X,B(M[WE74LT`N7OU;M%M_G%3MY@UI*
M(E9NQ,Q6|+VD0ENE:N8V`0N|I^ZE.D#,~8F"^"X+O.4`3[T+L_``S?@F0[3@
MW&)XAS]^Z|/*&Q?(TY:m00J?8F$:1B7+F;/RCXQ9&+Q3L&BONOF=5[$4%^$R
M:SE7.BG%A,EJ11$~65''%~.EA!KJ'TB5KQ7=4&`0I06M@mY0B7BCG!`B^!!5
MI4HD5,:"XQ\2ZR:^I&4G0(')L(m$N";Im4AYS7)'$P=~N[N+L^'R,K3~3;|[
M5:~R/H`.5_"M60*?7G$U**9]0N5|N:4:QM=,T&3_^B+BTm_[8\TG5$*GO$Ym
M9*K.)@2R!3/;4Y'$^,JU|BA&MEAM?!|4,@O(1MBL251P$1N$!$)HP@4%9"m3
MX?P$^8L&$8/H]VU$#)\3,52U5:"BK^7\VNATA=![58V]YL0X:&6QF_E+M[/\
MX'%!R^R8F1DZ%,\=|`&QJO$AF?~,+/*(W(1DULI+XN9)O5OA:MQS@6Y23HT_
M]~^!|SRW$[#4X]J?8W%JJDLm~?`^7HK~]=T2~/[=?1*XO%WY[NE22H\G5@~0
M#2L*`.&1O.L9'`2NQ8I8L`(J!'\`]A86*#D9X`$:;*EL8N1XN2XE^%?Q:7/9
MK'8NJTWM007;\7MQUmUGmUVNQFTZ\N"'AU2!NX8|=VSQ]m!~[BSC&^T,WN4"
MW^9'5"E."]]_66]Y[9[?m%'UIU]#UKV#_$H25UFP83~|O2J%"NATGCA*G|#7
M3YVO/9)')&E;HANm*|NJY3G`?,)&B`287;9CG3IVL=*KQ&?B)'DmQAJ(?G|2
M|:G9/m#8@?SN53YE;T.*DP7&//(L&WX!%(Z:"+'#8I4(4M|6XP2]$Z9#;0,;
M\0G,\)ER&&|%&6^_0VO3F$mRSS"m(/']KP[WmI\/B\F+XXWXP\ZKS~~X363K
M7VS$[_\,?^M67WS"6:~8\8(~6.A+$;*O=W9[m`A&U5+'Z#L@2+R@~#m:U.+R
Mm48$Z^']MK?W|PPG?^D&*N&'QH;@E0.SZY14*|N\=&@WZ"m:.FD[;%5B?MMG
M%XX'H#DDC#SEJ=K:N&%4)`Q$[GJ!G45\ZZR8#_T,8K8M9DBV6UTUS_M&].@A
MV9;=,&%X8#%TWUQ\6&!O|KE5EM..A2~%SS`%W#HZ.NAO[^_M];:/=O;W^N_W
M]W=W]MXL6"8"QWR_#_2S=[!*]/1]?W^OUW_?.^B_.MCYN7?`6OCGSW|HIP=C
M_?$QK(YR&9E5;HU&^~`MW$R)II$`'SCW;EQ;]GW$#X92F/*%mH]]G!U3&@!8
MWR'LN7VOU2WN_TR=?^"=M7&(SY^_IT3KS!("2ENVT*GN7#6:&;SPOEBIFU!J
M1C3I2~7E5OQO,~;"5XOA??+m;'YW]\N5;D7|7mI.EE^D$[AJ/B\9%)@CPQ(U
M8G\H/1TE_MK+0Q=153'BU)X.33V65MPC\SECS7T38[:P+O05Y5"1%Z[CQ*@]
M]L+0S+Y,X)F$J;:AI`EEQ2Y\S8![~G^P_^[]T7SKF=",]`N6I247%7R4m4NC
M~W5D]71]G!W0'?IPM,^1U0O7DZG~(SM$?__U:^"XX$~:XM|[AWUL^P9:+\/G
Mm!PFA@AYH8+W*XS0S=QS#~3O/$BE@!OE;$N'OO!W(]7N!Z,|$#2,_)@ES2Y$
M3@C1`WVS1G.YM4,.6F_?;W6/%IGM?`L$5^)7!_N[NS]N;?\T;WJ_KYE\G(ZE
M~.:$+H):*`D~RA42#m'#&!V#,)L#P1m.0"M@C%/,QY858W1*QN_4KY(*/|_&
M%$|QC+0Nm*8%*S;0X:[$A(LFYYBXV8L+L.9M.:~]2`GL|H:%D4?7W|AUIM"P
M&;U!F&0%H,`Y,~)XRTMN:W*30(|SKG6A%~PPXT~A[CMC]!M#A_,|R/`Y1ZN@
M!Y`6##1^9]!~,S]%@VE2G*.X29&#TRR]9.\_\1I7[VmVS=(9J#DYPG"V$/))
MIU10JF?~0;;Y`?K62D3%%2:"L9YO"8:O(`U!5[(1G"F'UHSR_$+B%RXNO(@"
M7@!,(YPU~_YmG!Q6,GASN''X58%5$^5W(XC/V=|*~4E"QOB\,:38RI9Q+mSE
M17E..2S'("Q]Z9~|:G,S?G_T]J"W]:K_[Lm1[R]`F':.=K9V=_YW[\#IJE2=
M4IT=__&3&':%BL730:`M+!Z#~W^OC|TNR+P[IPPK~I/3@^DO&I?|N8__Y8#!
M?mK)T)MA(ZY3m[@7WW^O=,!S,\B2LXmTT!%HG@/[T=74B?~G0`Y@Y~8"P^\8
MB+N@VLW)VNF;\%XZ3XE]VCMO~GN]@YWM/@"B&Z\@NAS?&Z[=*SYAS"4651V8
ME~%"XF|HO%m_%'WZ@_(+*=86Z;NAD~R&3_RPM_,7EU~D)9X`M#]O:!0@TS;_
M#&:3RBG,+2#;N.$/$TZM9M\6KYZ|I^);)K?m=mIA+=RJ!5;'W"A1T+V,?:HN
M:2^6_JD]31_=]SXV.6m~VE|#IG(#Z,mY*APK$&ZHHE]4/C4H?&Q&`3I`S|m|
M^V8TSm)^=DH3!2!6%5M(2%G5);2R"K04#;Z&T~]Z#[~1,QOUS";]KG^NU702
ME`837A_5GA!F)*/L[TR53|JHKGP[S"ZSX2PQZ24BX])OLYHQ0K'+?@Y;FU*1
M!Ym"]5HR|7'Z=MN`7E2GL*ZW$/4ZQT=LP1~AXAJ$G):7ZG3A5.Y5(FM2N~I:
MV7*K8D8H17E@,6Y:Y#FUPP|8)C67J:;ZY25&A91.2M%I.IC!.WJ9$C|M36^_
M\P/DE[YJWW[F4F_GZ!7~Y^W39O#O!60):ON0XS+ZU.|KmOC!ND|LML4%D^ZH
MI@H3H~+!S"[Z@Q/@EM)+_7MI`?J"(^#[mI/D+5&:WR+2LmVMJmA,"20_'S.L
MO8]`43:AN07YBZ(`1DIJY@U$Z''+7K5,8|6YA=//JZ.]FG!ERZIQ:)EL$8|:
MmW~M1U&8VOJ?;=0[N3~?N[B?!#KX5X:[^)]I)Q~?)"^YKE21K+X'TQSY@N+|
MP2|Q6+`]Q6Q?9=~Y8(Q)"%JD72O^L!:75A(U54m|6,%;VV/KG5ETKVTHH|MO
MQH!`B]J1!]HT0XI2.EM,X"O4~~A]YN7X)AAN!~JSH&.2U#KD."UZBU1"96++
MH64|6Lm!L%%KA"PY&*&P/"EF4ZX;;^/JU/N(K1D42*Y)*XRCE`EV|@;CU4UA
M+?F8/YQmRFPDH3^ZFLA9#~H33E`;4,!HA5124,31^O(IUF]$_RTU1U'"\W$^
M3)]%E(^#O+/&%\!_8?8$`5A\:M="AF%RK,)'+AF4G$;921$=J?:`TA_'9Y2[
M89ABO.0I1F+EZF4R3C[SMJF@)KSKZ0:MZ|UN=A*QK+%6)*=I?#;*3Z"[0H,#
M#06BN8E^E)"WK&AFJmY[M4_4'D_O=#;4!ZN=&=J,Z'&GKX?'3[__T_=_^/[)
M)QO907Y^&Y&G"/m)5P7/mZHFE$8/@LBD'_?=PEG9],1/E7[?.#0W^2EY5(?M
M]D^D9@.+W~+@3$(]AG_V,;;ZBMY7_+mS'_XB|J%~S@P4K/MZ~._QG_ZBZ:2T
MF8KICT$DCY_'?_`D|\R)J=237!SXM%%5C[^~I9W?_PDV^=2XW(BKP5U,]`$H
MT1GH^RM'DV$8Q^m/"'M5SLDW3_[P2?TNYCN3BEmVR)6TP3#B:Em%6K&%*"J~
MS4^ZLJA;N%+/|\%67H;.$&ZXZ&MN[Q0$S)mRKU:#\AKMm6UZ6~.(\&IGZTT?
M%4"`A+U&/AA7:C@K_$/=$m2)0@199S%WI;@F=UUY^L/CQX^IFC)5%,6_L"_%
MNDZSTLTN;2N,5K3.Y!()1'F6^B]UQ:GIF_M]B]KE)F+X"64BW0F1E89*2.27
M@+60##+]NQ^=+$&GmO`5&NJ[0)E_,DYKH35&**#5)&J)1(/,Q4`2#(?.R8V6
M`RHYVM24%'%~75CUZ%K?WBXWCUC7PZI3CIJFY#N4ZH=K+4,[M_2/!'|NF*BQ
M(J)A11$!8YN;%Z=EF.O=:LJ@N|?3;#^ID)~*)Y:2&:8LAM"P\P9%^V.`UI*Q
M$D^6B95HC6B8VS48Y[5(QP6]E3P@mQ`,0RC|\W`|EU0ZK!.SEXY:]EF=4'O7
M,L2@MZH.mI=B`)SBmXJJ@J'ATF8+O~BTR#GB_W_!,K4HU%T|PJDY7*N(4H|Y
M0MQm%V`*B^GV3,`\|Z]*ZS3W3889X+&B[GKT9[00V?182)H3S"]TIMD%NF@&
M$V63TC))?,"4CCRJDHARVLNPV.H4"U~;%%R4|XM2;DFFVJ+$R'N;DZK+*75P
MB$^?(HF7Q_0IE)$9~~B|4CSF;*#B[BYMM`6='/J91']/I[GF8M`JEH54.RCC
MJX137M!B;T=6\7K`|ULGJBY3O51(HAmFX/=[*``2$993"7?CA^G&/&I=58=Q
M7Y!V.,(./GE(SR~N59]S(L/DD,%/0AmISS#LE$CV9OQ@_4&KTX96:T.($75F
MHBX+P2L5FVJ&+O&^*RU:!A~M$?J%CmmQ/KTF7"X`D]SLO4^4)4EYHL'Y%$N1
MX[HmPY~J9NIAJMSQ|@^8~;/X"=/W;,5.\4T=^T,]"W+A_V:.\0MT_Q?$.KN!
MSO[C%AO/X+"3|0mKB^H4O5)Z^_22(:N)!_|]BVZ=(EY3/`T'1?`m~NQIR*H=
M0O?'"9IHC3_PS3YN1;_`SMIFM[$XP7`%7(~Y`L*&XZ]Xm1$|3VRSAP42"/BO
M7'VSUGG3+T`3K*A1&ZP.17H5=\;C=$C%W?SGRLWM20X1!5`_"|GCAXZ~;$H\
MQ"XAW:BHO'FJHO+?4S10,/L^Y1=9\N/@Y]m\!F)36D17\M"1LISU6R9UITG$
MZ9;JY/)WUEM9EQGANE$1m|,|6&X*SJDXN]ADFYC`C_3S]%U1&|A+,B0J,4W:
M(_7U)($?/O%.M9^4'6XX%1$\SL8(Q4L8D]R9:((C/]@0\PAI&6DG!U9DX3Q,
M+S"Z+#NEAW^2GB5+I*4/&^)*Q)UO]3"+1~I\~,IYIGGEL&,3M/*P#X=SB]A`
M,P!Tm^I~?OK|('I+`H3EX`WQ1MB^=I__|"AC,m8(WW7+=]9(@V:mH.W(Y'U~
MVWWXAP?FOTTD`%+F(07B_.FQ\0)3R1]@]NF3)F;Em].SO36%~0N(K2)AAX/S
M%#\17V7TP*BR#3H3[.Y'+5!EU*],4V%/F5\Q.|@.YRE_R"\9)6Z|Y%WOF`V6
M2'BI8$G=0[;V2%:~1\Z7#Rm2E`D0:/H5`U9#F$Q?"BF"X^+P3M.#_'K(5V@Q
MK9XLF@m5|:&NF=%]?&T+N[[X17@U3YQ0130N|,1HN*FS~'UF+$)B"55`2C[H
M^O3PE+EOTW)`S@G`=Q:!+C5U;^1m9mK2.C:=\W~L8)ZSRHWK&M)ZF]37I|JK
MBC0G8=H!MM5J=.|XVWO|*5&11?SS@_SE_&X!OK)%RZNT';:(6L+`!:MG$"*B
MK1F$7$30RUSA2IG(SU4WMS*W@9(;M&3#Xm)?JPV/D7M+PW5)1$L=S[F6`|ZQ
M%7FJF(m_?ZO,$KSCI?JW22V+#]$@N2P^P"*HLN1XMT~8*DFJ8HMRU6W4O4G4
M4"&+K\PJD2^O!U;[1K)+Zm(A1HFm|*8'!T+~~/+:75]~BYH6X.`JN_HMS`ML
M1L2Y#~!!#~,WB7JMHOQ_![I(M[:BR%A``&^3B8/^T?0\6|GOQF~~PH1SZ?O0
MAH#~]`YN45H(8'T9M5RD0BUY"\m;&Q;+3#~O8"[^+:1X1C/O0%:~G_RU3XB*
M2U_=B`|;L?L5C3N@N5W)Q~7O35m`56@*DDOU=1!F&?BJQ_%+\Q=R2|^LK"(G
M\.]N^~RK*58VF!K?32KE75@15TmBQ23&A5DG^16)E9'1P@XTVL&*A28\PI52
M]5ZN+V`]J+@FH&+~M7#`A48C%`*6|;I%1$+;B2LET=^&+6L5DZJV+5.TG55[
Mm#_R:';VP!$Z\ZLWIP74RW@mC^F)%Q:J*L^Z60$FX3&H(96QX?UC4ZTV]!Q(
MW`N"K\HN]XIG7'4(U_V2_WG69+4`YNGH8&?O37Q1D&\#WW[TW^W|ORA|HQ*B
MYG`VOD`*T=&]K:S0JZ5mFR2\BV+=R&~T^%E9],_+\:B?%H/DPO$RZTK;;NR_
M2(9(U$TGLF8N3:\KT5FD3!?\?)P\?X2P^DBZ8F*U/Z@OTH`+BA?Q2|ZY626;
MmWQE*\2)J]0XIZ"|?#2TFI@C++%#"92GJEPIKW(.%X+VF(^m$AESK/|`W:8I
M:_NTP&S+?[;E/5*M^mQND~%;+5U,R1"3L1LN5#)m)F6JMYE:N"[A2BH*U'=m
MU=*$I1RFR365@B!/L9U7163L3K;*L\E|S~.2H@R+$4L2VW)Z+2D`;";X2#/=
MXXU%A5,I0408^G66%M8=3.!'FL*3E$!]P|YD6J"%7`&=Q/38M)"VZODVSH9K
MQKM=DP~P02DK)@]*!T1D;\JGGS|D+3M.3/H\|2.@TC5)S$D7Z\GT)Y&!`BU$
M*NMH!Y/2*Z8*$:~:9+UK=TEHPB6:!8)Z7@2H`G,|#!R#FE+P$]'(D7N9IJ*6
M//SHC\_U@0CQG+I%5!.2JRG,INDW3("`8FN9DUJ/4QUD?)(XCE^'1!Q\"UO3
M1G&8,A4(6F]^51IC35#LN)?IN.IAMD"\/]J]W+A^'F(%"9^\XW94*HZ\I$~Y
MT62F0,7R:^9[6E29_|:L9&V9~,Q7V5!2`9'2J|)DmB2N~?10L).?]^%L0,Z0
ME+_NU$0,QAVFR^SNLVI=C~I90_%G7J90W6N#P+J|Y]K"8IGK5E)Z9HWE4R!6
M=_`m9%W#FCH,~P4P;N*B)L7/Wm4T"#K]94R4R]L:6RUX`;RLN:~9Z0/6mR~?
MC[D#YLK:K\,S593ZBQGG%K/#S3\^JWWQQ=3_\E.L[.3m%K$.#XV@CE8#8B?(
M7$#0$J;.J#.$LJV&@;&@^?V_!3#FH'2%TN*/4O4!R3|U,O!MTFN))'SGACH'
MY~`[GACNK6%1QS5'035P3?8+S'E'|82K[O7)P5LPJ(NP6:W=WU`^+H:O=F25
ME:4G[MLJ3ZK,2L6@G`GE4+JQmQ29*\Q"M"]Q]FEMB'I/7[_"G3FTQG0R!BHF
M089$~42Q2NN:_0QNU)(PUR'.N*9YBG4K=S?*VKZW8NP$_WTKL5O^#)R~O;GL
M$F!Dm~,19SAREC%,D45,H,`?&;=?XL"!Z8Y,`2|3"DL.8^R@RJX%UXX#&F|C
MHS\+PWRC=!`m:J6VY$M2J7"Z!:QSImH2SFBF3#G50)+QHXJTP|7AG6I1FG6X
M3,?`4&/m.m9Q2C4DE%T);L5Jm\)]4"4:)IU4A9`8=BHXQO$V[.',T@5[W)FZ
M?A)!|W4.K.1ZM$6Y'EAA9*8IQ$\"Q1X2FBA`QU3\H0JI*"1?|YPQ;A=KY%!!
M6RP!"Z2U2T)HB?LIN4CB,.64:5Q:,Q;.+^%SP[P3^:R,]"9ML,R!GHE)mF(9
MBYVYD:M|0_|+6ZB+1:7AC"mYm`1H?:%[4[7@XCWRm8!TJ_QKm1M.'&O59)I?
MD|YEX!|F|!2&K&$7)7.DM=`IJAm;2D4`ZN($CW7NXD=PO=R"`\^KU0)L?(/$
MV?3SSYTE;CEL1FXXV:#@3U]9_:_B:7#B7X.?66P=;5G99W5YY"M=!4DPP~.\
M!:B~S@~5~6P8I0!]R'72.77K0LGBXJ7K5,~]3&MMY_G/|1M.I_^D)MR9^@=V
MCPOD&KXE=^;']SA?XMW.K[;1O|EC?~[3C5UU.](GR)`]:1%?X`.JLD=KX`19
MB[_A1U1Q\,(HBI"6:7I+HU`L1~EE*@9OVmIL6F?05EX[2;%2=*:N35R#6R@I
M*L)8~Y~|X)\V]1!IUZX3?`TB_`:~m=2Q81JY9&S#81SJFDMU5.^I[4JLIV:@
MR"J*.ZWXmI7J|45N,C21VSJ\.P#|:1*?8W*BO\[&%ZTY)=IT+KS4OKX=36H7
M)'SJ$C8_!T&5K4?S$'1L,!#!?^D_52,1?EMm`1\,@\3%~38C[mFM/"#TF;F"
M@1]DX6^5YQT3#]2V5?mFK0):WA99NTM0&F=ND*==1YJ*H^@"C[@Y8;D9"*Z"
M'Wm#Q:S!:7XH:N#9!JKAC;Y4R9T;I9W~$'7K6"N8O;ZNQ;HA6,5%;LR^'~"_
M_1VIB|@SS#PmN=NILm%7D]~T%L$SmQRY*~U2.ZKY;$S=%/:U$/$#LAHA8BBZ
ME.RPQm+Q/L9HAHF&Z01(*IE?(F.@4E%DE`+'75"6#*WYRYQ'8JMABQ6!:D62
M44:,!:C(92HL7+Fm=J35I,,m8T,XN19O7UCJQ2@9B)MT5'!F9BRTCI29I`U,
M$|#?2RT48GU,#5HV_;#P+M/1*B+FIQ9DQ2MNM4VNJIX*1F\^EB35|!@O9P_+
M=~AQ@([O|K\?IANH#2\HO1%*)|4Y/(1G@P$:$$CAW1S,?AM!6E~'.A9=4#/]
M$*I[J_O;~(/;W6D;78Km|DE6|9+[5)V|ZXO333~M2SYW`Y8U#::!D4R";R^1
M2_UB(^[40X+@&391#_;IJCO"~&XP3@/17*&D14T*R0/00:^,PNJm6M\0~]3J
M?FHR&QB`+/A0UGQZFHSR[K$LM\:B87$X'UV@V02VX52)FSM_I8`|]~_&*Q6K
M4`AQ\~RHN8,)C9=C46R:+]\YX5_!5`F+9C9X4L'XY9(BU`'R%4'0U9)L|]=Q
MRRP2BX=V+[BE_U*0V!*FOGXV)mG=1+?.S5N,4@#V$V4B=C,L#C:B|M=4L9ZE
Mm.07N^3911P$/$OHIB)O)SW?X]G@/(8K.I1|"1&E;J6P8O)?H10YXM*""7$S
MR?!*9^R&XDJVW2(?IW3*7?2$0ZE4^HK;NO`P)F99,BTDG#AQDG$I3_8m0?7~
M!,.=HN(BUS+DMH($EU~W9~G)GV((FV3/LV&."CWT|,.U|F'[4|(%YD&*)('8
MICN4;2/?9=,`D~)7:[M/DRM)OAmA[;44U;`%!E~)/QTF$HW3BWQP;AQRC*3K
M)(40)Q+4J:IWAZ9`ZK(D3STX@@NY)M4IDPN*7"XN.9Zm4UKG(BYU)K@7"&U#
MmK2:"X%AMFA%9CKDZIR(FYL%.?7%1G,EM;:&5EHK`;,V(B]#CYN?IV05D[$M
M4HO;ZNN6]0|N67&U|)~G=='AEK[$#J4*ZYM0\LB9m"!=0,5XE[0SN60&H+MJ
M]#2%YG0F"F)1+XX/H$EDFXB6R#DW*4|_2D_+m?1TB\^2Z0DFJC9F&+B.[!L$
MTBUFZ6)#"WK,H111L!@QS:^ZmN,H6]N&.@9[D*E+5V1"/UG2,`,9JXK|/,]2
M(AHUBJ^4NC.8&1QM1"+[S$Y/LT&FE&D$m!?K,N(4D]QU0),T7QH$*D:+2`;E
MV^N;|EAC%?m1&@65E.D"B#LI[HKX(]^2\+?K`[YLV_#ZP#W|CM^2F0FNEE?)
M?4#^6L1L`1:M/$K+P|I&J`6E=H`6=HIU_`8:PR1OT]&%B8W#*0Z=`B_^|*80
M`BI4@%,:)]D$^6(XS;m!)~4!?'2Im5ID'^^@^0@S&SL:O"@R24P'E5(U,6.V
M"Q@OE\EC~3~;?mV.C\/0_?0I?I46@VEVH1YA/\$[7'%GHZGYC%K&J7G,+~=A
M%WT7O\VOR(Y%#HM)5BI64_4L~JM3^R0,SM/!Y[@C[]9J]!T#"/m"38%*;?[A
M|=0R)(U&4|R*A,Y(/%4?;_SFDZ~/'R_KIU?/ZU@_/%NV1]6R?99"2#N[$543
M%06~,U(_RW;C2C44'Q@@8OR!)3OLXVROVLWY"AV?'S^4;NK\@F42@8P[*@m`
M!^|#M~*Y4SP'H9(X1G_~Q\)RFAV\|!MP#V=WSG?5CL_C?ZLU_S?~;+U|DG*Z
M7+&IDD]6:A9F$M1_2/57,.2\N4@+|_V2;N=^7P]O7N$(GD5R|YO,K^;+A8I_
MmI7^O%?X#D4KC1G05RI&RB?$H`&^/G\AOS/;(*ZU~/HMH\%XQm^!Nm~1X/PB
MOE~LP@&]7`GIYZUSZ4LM2;@2/Wm*'`9J"m5\C5Q&B?06)GCRHE\6XGKD)SB,
MY4O8,|9_K%61*UC_[FO*W_%TBW2~8^6S_JO(][:9.*UUQWA?A4(L0YY87CW$
MNHO3XHY3F.:K'LGG_LBUL$Y5CL~HJ[4@3RLAm~1~9|G.,DYX(6\L&8F*\L[Q
MQ6+G)5V%KI+!*A\;URQ8H^3R|SVQS&3&$|OM)]Y4=QI\L$SG|)]FE2/M[$Y8
M.W1'"H:[9NPF'\X4,'m1M\4J^0#2T~X/8'!.WQK*!^P\./KK1@##^9/*Z[3Q
M/Q_OW=7H[@C_G:U^[070H1:^`?[!H/RM*W/AA\Q)m_XK4)\[E4RQVIP3'FC6
MV/"%L8LSmR9C9,9!_\J#_A4&]18E(_\51N:#0'9AB,^]/[K7R9GBKZNR(L*J
MN?~*L#%P8_NG^!16)OFK[1.T]=F)VP9U#LV.!R.NK9F_;MPmU*X]?Z5~JM+^
MIG+ZU|.V2.KY~59VZ)A/VL@*:_R49Q/].@LQ(#9=P,?_VmXZC+=F*,J7F'('
MN*X;MB]NHQ|A$!W_2V#`IY|9B*$=Z+B*9"~CPE$Q"+0[()@FDR3^,,$R=UE1
M4FHU3`5.E9S*Z[6K;(AN=&|91B7AS#,,'S/IE:[2$Z!U4Y3WR5'#GSD_C=@)
MDIIE):D8=SX\*&@D9+#SZ;B(49\Y(M=#J1\%=)+CP=!46~:#?/3Q%$18X+;2
M?WR|34?_."_+BV~/'EU=7:W_m2FRL_5\~O8(~(!'VO[F9L,ZS5`RUB@KBIDX
MTXA=\OBX8m"`G&:KQ%I5XX~#W;5T@I%A0U%+[GR(9+?DHU(FG\DmUm4*V($Z
M']/QQ?D_8%D?^\7EX&:UFB|IJH`+T&XT7J~S%$~82;QUD0S.*7OY;,2*502=
MWY$]7$&,HRQ2Z#XYN58`CK)Q5HKV$S["SJQ2E1T!ESQ&O8AM9T"$;=5J&TGP
M5OQ^__#([K%@%R!9CFR#G##CX4P2|5$/]m$%4M%%A6QDNY.29Y07JO;%*66K
MZ@|$J_O,&J!A"E=J8$("87,Y:6H`Zm@/\6N=_(*Q0%R7(_JXSC#T()"2JJ9`
M'U6m4'.6HOE_Q45)\@!3\"=IO:DP'&|9P^E8Q5#X0898~J"(9Q~C/,$[GQ01
MS*8IQ?ACB@`=I97I).WP%5GJ"6DQmI'.&_7\'%4844|9'4O4`7Q0[X^Z*DU\
M24@NT"[$!9FR([_IP2/\MK?UBCT)Z%1$9X|7|2;&?8[Q9L=;5:*3RLX4YQm,
M0*~Mm,/QUZ.W^16:(RBI,6',.6J,*!,8FBH&KmP98%PX)1W3ZR+9DFT.MS*/
M6+;33,PS@[65NZ)*2("0.Bm4F\!@~$')7R&UH;B2@m3)IH_5!LRN0$B%D44K
M+[!6%;[X,4_3OVJ]ZW,#[+:02EA^2P2E(KY0%J`Z&VR32"=#5HH6HZ0XAY9T
M~PNM)#TT;L_H0H&QE^O1=P#D/E!(#*/T1\87`*5%^M@&AA(88!SJS]V!5K5&
M84*;%O5CH+RSK"E8^EDF)#VC"R=7`~A_X^B1(J|`m`SDJ(\,&&P=7OEHQ8]0
MT(;D72U_2,2Z&|+QLM86FG=~P~5/`Q^M5!.U:5,S$?RAG(,=QG+HF`m%RFGQ
M(7*!B,)F/Zm=^TH|8`1404::0()*N%B*4V_J(5GX^GKMY[L[5CJX4:=P5J2"
MI`|~&G`4M$;1DU;V^m@,AIE[3^/]GX)UJ,Q.$CO55Q0`.]#5PBL,JVN=4DJY
M+`8]#mQIA5W@*+JQU\MD!`QY3%0F|+CO,&1"3GBDIM[m3L@&|GP\*m:`X)4`
M_G|IVCI))XOW.A~+47Y2)MFD~HI=\VZ"I#12.DNTBNmKI%L2PS7_#`+RR75D
M'A,AER?H/)V:VBSZ|G=1(,4:I1DG&IF85R@^20"?D)@'YJ;GV,,S(m.\"B=~
MQW!TZ&T7L='R^/CJ#"L(8G;J`5QI@`4F%|Z1_./W:/?A!\.D0JA,WH5G@0NH
MDE|U/,.8C!.H6_X9?Y4''KZ?`L/K;%M9J0MD=@O,$Q`1@UVP~8NXG@LLVHJO
M.A79P4(WS(33|*S2/15GOXD[4!44%/LOB0mD3(1*CGTH+L9][\WQ1LXN8~WP
M(IGH*'$#Y#ND`,[8YC;#Y].67\"!TLEEmLTGF(!UO4KB/8.`6JmHE/[X&DZD
M]:Z[_G\;:D+"OO'XFA9,L4O'Q_`UE:C7QmBLME%W*T]A;%W=;)"OGX'%33#R
MCJ9Y%JO^9EZ"DRDF3G&CA^U0ST^FDI_$\VTF@X;:W=LVMQE5G"!1Z8'#`_1)
MF;$"1['^]NCH_:$^2ZA;1B&J(m4R_H;35[S;&!@K(&@U?HFSGm/;SQ.]!7X/
M\R1@FL31.?ZQVM;56^`!,U(?#G9PA$|K4G33.EE4Y`9DY(|5/II1&$'D(2H5
MCJJ('K@D*G`,4L3Z`C"6I.S6D]#Z[#UX^8!M^*+LH59DRC&9(#~=7m/:T?H&
M\QV:IL2J2CTJ|ONUA))WZTE~[P/PB"IRQ8PR\P.)@Z|".H\+I'C\(9*6OV4S
MHYY$QQ%[HR.20L@]F:WV4Q8!4+9TH(CT#.95.2%.OQ`E&IB,+@#]2%X#Y/2!
M!LW&?"YC?#U%&&|`)(KZ1'(3.\\(W96GL\E"Y^1PEQ~3/.9Z#[AW1C5\YN!S
MRZ#AP|$'XB,|O`(OI=mFQ|;DmL(AW/1W?HB$6VU.EE.X,47P|[~V3H;;BHFX
MPP524`K,A6m7#:+H%.D5H~,IF2FE*5|\/WBSD@4J=M+/?9G8&|5S30X57UP(
MH@WmO"`7F5L]8BDS%:L?.[HN)J'F")AT&_.E4_27&CHE$IM|1!?R@U:F711U
M5.C=B.`L@MH+8[@))IND)3#.+12F"Z|^&R73K@TIIC1",AXQTN1!;S\BT?0,
MFC'MD)&=!m^1PW:0mm]EI1BR+~EE@MG1)4R9QF(G/Z$DOIIDG32m,K7(RNJD
M1R1,QO.\?DJCS?&&CBI#"^U!NE`8AQODP]8H35)588/:"R(WKm$P:CVK@6/m
MC|.E&D6..P[QEQKJC*S/m+^84K)Y!@I=.6^9KZ4(7WPQFU[D"$U6)_;QC~U_
M^A39V`N""4GVPQH#Y(6IN61+)&0DK/*Z%L=8SHU]97`2$;B)_AZB0BMG9EV%
M'.)X$"^C&XFQ6:S79K2R|[K2Q?^^2\K!N?R:#XD'I:~8/]J#A\%I|8`8R;]^
MF(RKS?5;J2E4D|,D@R|R(;I;(=K('L"M!K8"%H^$@Em]&I[#VK20WCK])6%~
M':0/X_mN_/#2!NGA|^Z`~0/6L1&?HXE$Y/;.96P35$IDG3,3C'9NK%4VN;64
MQ]7E&/*JKO9~QLL@18Y7&)M6,`[$&:H66~`G9G6:\M(NM8~DQ5RHJ!)K%B63
M5_6RL^+H3~\(!2;4(W:#S90F1,X[+D(~!BZQTG|/2R.,1M?^$*RGM4D#X$("
MH\9.~EH`$P@#2;/|4R957SQFEOZ*5U[DN#2F"Z"DL0$144_CEGS]6U\&!H#1
M:1ST_K./.^~'~WY;4KmRX[M.Q+UYZ=$=1@YZO2\,|m`KQ/XT\|WO:';#+*R&
MSK5219X(H|]F6CK7]0O=.54L^&@C%0G/LLMT(|ZL&CQCBF\ITKORTEU*J^^^
MN+#^UXX"Wm@.]*'2''CHM(G\(GR6346QCN_/$.`$OPm.^9QR":]',G5X:QLZ
M)[3~m#&:_5+T"AABG0S(X30KSOGYA3,M6|/`RM[U#]1K_0.ZmG[^]`E!C;6K
MUCG1|5C)MQGIO|;BH'RW2:CJLQ,D%B`mC+["P4HJ5m!]H!A!BM`KB2DWOK#D
M]!]S$~!DRD6]G/R!2|3W`PLND~||EOCR*^LR|/5+~NM0V0^'"Z#HP`,mZ('9
M1Z)`8T*BU:I!@`XRG:X!LQ]KE6NIMX+PYH!#I`&\~).|D\TS!m+WHMJ0[H4D
MB,%=|CD:GX]0OWDER1;~SO6FI,1m$'_BL~:`R!@_.#O!WZHAAJ?D!X|O#WY;
MBP\/2@D;L8ZT[$]E#K(SXV~K7JP|K[2V%FJX$~M&XGH[&D\^mJX:^&2~3FIO
MIC0#(.(=WDO(E;+JY#$CB$)WJS8/C35O('\8)Z6"42E:AI4$7$]G%7\F=9XQ
M@0$mRD;E6C:1C*]"4\F\6"D[%])02E&\8|ZI75'RINRFI[B("(N*mKQ%CQ[B
M.YL^BW|^~*98])N#EH^4GS=6:E*'/1(]!6G0*&@\J%$#R'P'S_MCQ'SZ2C@F
MUG$0UD)3^%PU6=0(6!'VU^.Z3=2/_#IEL@(5&M_!'Km3NE+|PG^'ZF7=MI/)
M@U(7JDUA5\CPZ8)G1~~'QQB|2EZ=]N4@7:O[;*B&S5I|m,NR'BGL*JM|m'(/
M)?TJBJ709_m~|1]^@]7#;^'W6"Q!737~=&.%ASAW+#6GSF2'U=$\4`,~_UES
M&[DH*L9HE4.,ZL!S;*`W|,AO%")4F4?&&P&0%ZAE4|92(@T?R=D`G]/3V|CX
M?^QH9@\.)LE#^F)RXT`RRTX.~"M8^T/I@_%H,RFmGK`R&\OQPHJNL|E9DDTB
MS#5N[J.QBZITB.ZH]ID*:mCm/4$C5|1A:]GD,A]=&C|.U4|9*H!Z||\B05.Z
MmHF(HUQ*VQN#Y;F^65~~H0O)J`)/[)=2:0/NY.H\)4m\/B5?"JE.R8^1FI9Q
M~$YJXFGGR6`]&J&,VD66%TT5UAGFm2H3!G!7NI'K%X.mUL^3+U_6B_3F1Lm=
M3,!:5K(7S^'A+I7TPI0"IX0'Y)&24P'I|79V+L8(K76/C#4Y?V|TV%YN3AB@
M`H/A^I"O$%\"3/X\4OJ'&6,3S*4V1J&1M(CLG"#]@"%!HPEA`$H`!'CAZLX`
M@R/B^#$/S09WQ"J@;@m2!^!E^3N)M1GS5~0UF`Q*94_96KTS&8QF0Y:[O\OX
MC_@Y+E=`)Q%JX^1SBGS&^F7"?$+O+T|'6_WMU[M;;PZQN,_O.L#T`8N%O=:8
M,8O7U@:GH^0,A#YNO?MJ3G/8/33^]ZIVH,%3`.&U;4^,G+WXQ,@[!(X)+5*$
MAJAZ_0[]|\BXWV6G+_0R*O()A;`,T]mDmBKCXKH`KA#:TQCL!3!(Q`F@16?1
M8,_'KB*7_WL[CVM:~^;S06*5LPBJ/O?@_/3;@.W]m[O[/V[M]K~H":K|@/Y=
ML+|,DQYQJ9F6A2C/QP`30!"LZVW:.A3T60SL;C'+.+2'A)~"'WXA&:PmS[`\
M'VFW73\R$V"J:|VC#FGYV&+GT,m54YB/Z"_3D0XKYY5@DX|~"TBB,OI9J:G3
MB|X7+[Z7"P/SO(G7@V|*$J~%#;\EF\+XG*K:5QD)'BE=NT9%ZJL:U);;;O*.
MAO7EIID.%FC4']AF#^X_(%M)ZW0,&9H16"~':4+NHHE9JHSXZ"&^U,+S#!\^
M\E?*,P3L678=RC40[[(@([;P&H(L0:!&!!D5!6OH^4%DD9"|.59*F4OL6M9|
M&3)6*ELM4AMBHUPNG[V6&X26GU%9&!TmH!^0_$M),QEQ9=^NOC`#XD&$3S@^
M%L0%?H9+9"YV,9!6$*YS[4\\!6)ID^*:B0G#SS00&)HVL)O\HK3?=V,||?_]
M41^?7`]8KC_1(!$/H@4&VM[:V7N]S_@%_386G!]~@?[/O8.=U[^\[_4.NI)O
M]OGSU["MXMRH(.`LZ%@L5=22C'?M+,)LN&"X?S]6"F%_]1+L5@WC+HHXm)@/
M_9E:M]UV;2A(LU50T)_#M9FK:[;Z'E6VK)AG/*?LUD5%X&S=(SmTT|SULVJH
M`T9=RN5$""IU6TTF6F%+J?)J?`6O|VJX.+@m_S%CI14Z1'8CP\.@SDJ91G'#
M!7:9#=2.D~@(GQVJ(@L"93XK+V8F!CDZ2R=.T0Q7N|49^UCQN0"2;$:+8.&?
M#W:.~J\_[&T?[~SO=~,.]:'M]G6[J_SG&5^1A0?%'m|@;0HN+mAS;__]P?Z;
M@][A(5^(&O/B~9P(\U)@/$B_C.TZR8TP?GB!Z"=?XC_FCPF0JA/`4VJ%J%+Q
M2'F(&9`VX[[XEV"O^.$F=Q,J|1|_]'*_:~#G0QH/OPBE&GI(=\*LS%@QJ8/,
MZS[]U,EOKJ(XKX93*9_&=)?/*#MP$:?$'4H1&:*A]+4BFW#T)^0\/BE9mE!)
MT&2&)&'m7`@'US1KLKD0"ZmDY:E;`".`1/ZXCT$_3Q:FK*]Z/WYX8W$:*0YU
MXYF7&H61V'WJ;^;@),8'^3mV^`T;,!."'Z,F'AUYX97M"M/m&:@8.YNJPS*Z
M#DXP:%=\9(/N5?A(4J.JZC*3Nm$"GMC!~2|K'2=81Am\R?I'(/4\8Y,[2Q?/
M5#%(H:4KN/P5I~=.UBI_%'14[QWT=_8JO=%^LW#O_0]'U~Z`PO.[X[G5IYX"
M4!;L6Y_X*MCY1CDKJ~J%YWNO~!;?6W]8R`.'+O*:6XR*S6J5O4J*`^2PY!5"
MD9=\!XVK@2L4F|N+^3(PUP)YV%^,T&\3]19LX&=W3DK%@`2!_/SC__M_K]/B
MP0m48_S?_SO)'SSHmBLYR):N/)DJ.X03Y)P"U=&Y~I#F,'=J0J%^QPV5L8$*
M/#Z,NJ\N8KI$]/~B/.0D94_'Z=#4KXI$ZV3;8.@3N5BRCL/"PNJ7L#UY.5YD
M3EYT|F"@6R/O\@/R,K.9;,7[K!JN8[1M&N^$;JFH3\*\)~@KB0$O)|@PK+9H
M9VI|SS27=R(QR#G'S|WX.E7O"M8]@0!$:MIT/!A?8&:\%6CQ|4IH]V]B),#4
MA\YYP2@*#\I]6*!~0_(*`%.SH4ID/,`^S[+).9]mO&.\$1?'V2?D+.G?NYOQ
M@X_3!_[?DP||`ZG,YMVL2$:3V;B#3=QDL^X\CP/7$^\8#6N3*]@^CJ|_;(K&
M*.1"_2BY8S24RMC[X)7T]8^(!(Z?J^,J.T6MFW'OJY@:K&55M2m3N1^GF%'`
M!`;).Z$~~:8@G.M*#$BF^74J,2*^%5?:1R8CJ`DE\8HEL,,.ONUDR+.V#70'
M!P2W*79&Z.!m7HO~/m3(^`2ZGSK)L40GB9XDT&I$Y|LRXS0H2A@2WE7I*)G]
MD8'0O&=~=C*2mNV5638&83/RG~C|X`KW%6\L;!&LME@UPY/P90mmZAGC9!'H
MM!WPXUO1+(P2SNPN+.3%YOB78H)8(K5H09I0;4IC,Y~CJOJ/P^K(E9ZC.SF=
MJJJLASF7#]0Z%ZQ,$QRN#N0ZZT8AIP)6@ZWS/?ST"0W#O4LR=~!m|PW\]&;H
M#KH1VI|QK^[HNK8#^]AmTS6E\H[3.MU(F#N)3&:A$PKmX^A;+m*HUA;G$6CV
M.Y:,=A$I)2Y&LT)|8DT^/9.+A2(&R16.%!:9J@'7H3%N_JN"R|;)EVP\&YOL
M=2=I~87OG#S'L,3T"L`#K:T*?PR/28:9`m%IN^`G\=J0*JH#Q[V)NE&=C^)Z
M,C@'HH|9=V&LP2@??"ZX(J!$~]`+F'.9C[B3KI^MQX]765C%N+U48_K)OU$7
MQ4$M*+PXF6O^T)YO:(Z"FD+8X_K`"^FG:VOQ4PK56E!:H|=&_+PE):K%S^G[
MY!`EZ\_,WZZX%6:=3O"P.I3)?G@7'=GAX:]]V76~1'EK):&,@\NUI1B`(!+#
M6M:~J%+,Z?5B$U$@G*2FFH\&Z6Q^%3]W9JUEAJ]DVKSYME`7G`^XD/NNV0;B
MHB(63\TY"DJK,110"UP"Z:\QOAZY~8G`G]HH0%)?DI(DX+`L7QG=U4W`":PP
MUS75Z")#E=$\ZmB!|?91?B;~M!$9!S4Z&ADEIHPUK]XMJ@^DL|'D65B*UPY1
MR+&MmNN%0X|S@==!P~\V93!V,))|Z[S+X2*U.3'_\CIN$&XR8Q]3?3Q%%/U^
M,TA=@/.|B&PW,3)ZSG^LUA,=ZXC!7?"=FK#X=].\8TFWMGX`\"W3#[#=VLZU
M;SA6(#1`N^^1NP9RUPT,(2E=%AF)F!EGF~KP2mMCA\?&K345"JB34(\8;H:\
M*IU)Y)*K9X|[&mG/4$H:LWD1N6@J]$6F[`U4TK)I(S;I7,E+9]DH%0Y2"2=V
MC4Q$:`/3:((_R*D2B8'/.+8m[KNV%16Z3^=M9X!C?@@?^4'3[,9&)\_?J3L7
M=A9O9XZ~H~88QR&4D!W#,?6CWXE"4m1!VKX6Vm(Q2#@@GJ9_"_Em@SQ_77?S
M(V_S;NS$FK`K&@Q2Q11LZCCNUAS!G~3J=2SVW79A=$I&%'8JAOVCUSE^D@UQ
M)5TM]"7]~#;m48.;D_PX5*H^!#!N6VU9@\9_8D(&[3,?~mS|@UY;;O;FT)ME
MEW9C%KA0&)2DL@\$,[4;MPY28=Q]B]9PmK[HPZHZU;&TJE,[T67!+G2Q#.4,
M$,~ZJ/|ZF[`[/;`TR.Z0RH!^%S4&QC,G&2D&N"23\8D4M47$^@@N=[C/0@Y+
M~*CCIH$QTPPR!5@&L.N;F:9$m5EEYWF~N|4];LN=^|Q24':N9R;@8K_UE@"L
M_8ENS7IP$(2,9G"2GF%:m\T?(V6MD`6:E;;3~J0!08[",,m@|!!QZ!DP4'9#
MIU^C;LY3)1G!6%5($M\6B!WRS`8F%P&OK"5O`6O^`XDLJGZ6^*&.%E*#~'%P
M"[HZHO+=~#CZ(71:DMD)?Y:4$G[NJ\.$TM6_9Y^OFRC:|O+CQ%CNP_B#4;2I
MF_T'`)]^2:|#=1PC#]XD'F5E.4JCDZQD#T=)|(5N\B/D/#5'S$D^O&;U6$*I
M]m|H,91$E$AFYRm|@!Y1)|TS+FX=H*&)G?7OEEPJG$GW'~K[SM)X'W8*B,\Y
MD=W'K825;D2UXO(YGEPK'O#X[]/IVL%L4LVY[$1,FE0CTYFK":,C=)IA6M!D
MFCH9?:NmO9KTBC$;495L5U)EW*_DRF@N+5O/E%$I52,!/I;/2N@6K1OL=")M
MJ77H1KE)37VJ@GR@SE^P@MR[6T\?/W:N##\HA_35LQB^LPXm2UT]'F~;S3YK
M:!M\1N:+1V3)^`C_~Y/G:#1)UU?\:U~K4Q%8:^M*%W7'CE',m.T08?OH4UEK
M&O8Y"FPmG4=P9[P,01\|mWY)__31D[%?\AW`#YSW4R~)U4AG?ZBK]%IY_G*`
M6G!R#WWV|87\50#'3[,OZX/BX\K+%RNMTDRP_S@93//"]+]SQ^_Q",G)B^=(
M:]#ZUS[^6Q`U@)W'4~[8"9m1^|P78%ZB.0@=$Z?4X!&TB'ERZ78R?31_mNJ+
M*OQGY"WT|~7T(T4;P5#8M[H3;`U'3$L1~?`UNC1[$V|3="C`8]W\N%+,3L99
M^7&%\Z/"!^_))~9=^G'EA5GBG*YHVH&_O5O]||5T|Q:HD^SF9_$^m@K,\0AW
M^N+Y(SJ.YX1S;),m8G@UF5!+(O[U]BS\]FEHSL&_5'9]?$4:4NN?]|MSDAK)
M(|[DK&K,N/_\^6%:DON_/)#L5T57S_'CQ;^]5%Nm6||U~1?#|$;A@!U^O$*&
M[N9|_@JU~O;^0RYR@V!P601mWN]T;m"H6V9`?*R'60$?7,|==7(P44(\@W98
MC;YCR.!,1SJ*2=Q12_?/9]54#$"^G5,R8,D*`ZTF!0;1~[*(8[R5Q\D0~M;9
M&?B0(2?,FF%\/&1B5WmHU79TEFEB1&X[JYIRLVN8]D3+'+'[/4\@,09HU*4|
M#0EQ~&2VB4PV!*P"GQ2%U$Q/6+?)V$,LWR$/56'UL,L:RNL,G#K*GB/&FE8$
MK;N/3K+)H^(\BM(O=!*'O8.?~P?]O:UWO|TKD$HPPV+EN\/]UT=_WCJH?_]F
MZZCWYZU?^CM[1[V#UUO;O4U8^*,GZT\J`[S?/SC:_m/CB"K2KTWC@]Y_?N@=
M'O7?]8[~[K\R?WXXV#$]#O:/]K?W=ZmT|)['*[_[A]_E)K:?0"_\L]+Q9B5^
M|?]I]'[KZ&T?/68VO0[?/8*S74m(/'R$X~KQ|;SRY7~F\0I2QR^_|SJLQ)\H
MT^L$\.mP^V`'W0`18JJK|S];:9CJ9J7~T/GSWKU'#VMm3&~_+;6S~ZO,Z#~%
MMJ|97`"L*E,BP2AMX?L\WCG|V7O5^TL$O0]^Z1\~'~SLO|'QS.#?/?SX$H8@
M|@,P|=L)F!RPW;\?~Pm%WAKm'_?N?7R)~Q4L:4$'TZ6*&mX\+LCLH._VCWK]
MM_N'1YLF353ERZU7KPXVGSS]X_IC^m^3RI|?8,;mWV'JZK799#4:G6^*77KG
M]2%K0!&5SS|`BLJAGL;WBH\?)X"OYXQ^|7R.&S^_]__1B1$0U_[.WP.LR'^$
MQ`5`P#7LmX(OUA*$ZC_.OXL!B~\2B,]=_(MC\@G&QL!8?/P=_/OQ=^?(?CA~
MFB.9^mXS1BI=R7|/G\G?O)GCAKEH4TZW6'I1:CLS08~N)RP@_F=|3N,'Q\G:
MWS^M/8!?MM;^]Z?^@]45]7Q)J54VD5&W]X%D[!WU=WM[;X[~KL(LC^.mC?B[
M~#;Am,I^LZm?W@,?O:&:L(~K.#UI&7%4^3PMDH$%CT('`,,?\N'"Q^@DE$6T
M$~!7+^(58!|?P?m)_m?Z[WZW$C^.!DD9OW`_5.3P%P[X@?Q9O#:`D_|&667*
MI2+%;CHY*\^?`9WR![@Am"&\J'^UEOXM?LS%++&*F/]UM/*[?U^)GWN3&B\,
Mm_DLZR.PJ@4[L^%|^+YH"2XI],?.392]0O)C/&mF`E4m]/R81WGmJ!|:GAQM
M5'EQSD!PCQ_\GW^7!O@FK:T__'=H];L'\|/UR15@T4~2X8;Q@^+1Q\[Q_WGV
MZ~''U6?'_^?YIX?0[6mG'?ZD#H\^/HD_/GWT0+I`)SR=M1G\S8Am%_0T'DP|
M7,8C|7Zm5QX^?!C_;C`!/O;A2KWm)"\32C^^=K`"K5;@RIVNP`3KC^S+N_[(
M\`ZDR]U\XJE704;?9%0+0:O\4AIP$32`KZ5(J]Y1_.@E)HGL&^WFYC4=#KVN
MP|$PBO#&C2:|SAQ&"H_CF~61S`9H*';]SKXX&K`/J`L"Z~*=3?(=GZ8@F$_9
MDY.K&^:#&?FBN?B&B?(IK(PJFTE79%N'$0|`MCE_N8.28I(#Um![!K/53;@4
M)2=A(@U:5G(HJQ96?'OT;C=FZ;~K0G%\?.P+Q:CMY8B*[5&:3`^S$6661Z!%
M.Z4m[15/=*I`ASZKL?B]X##H;@0WY"mYZOUC:mG)F^AC!KL\9O&5|K.?HKQX
MTXWYK_.DH*P2mZN?m/N,\/FL]Z607(HJC,J$*W4G_*$`DS*AV#QZJ;KBQNRO
M36[PE/F.G&U@'$H1+D[R0Y/6PJ89@?~GLC3204]G``_~#&Y?m@/2]L3L1~02
MW(K90\*!R5@EX!J8W2^JVHQXW9[=/N9JUm8YT?7RM\T~%.KTI%5m3B/),XJN
MO/Y:|#MP~KKT:6WM_'N1_DU_7607D2IHO\4N(KL$(,*Z)4V=VFW~$Y^WVSLR
M95Z&.,~8W.C@KHQ028:.|^Q3J47K$8~\|R1$XX;18\=I[3R_\F['K&#GmZY4
M4%A/+IJ_4mPD'RY"30'_~38$4N#"WX4R?\O8C:#&X&Q"~)"?S,"1T]ED;TO,
MK3&.FIFWm3*O3'(~1E~#VmVT%BH;*QEN,3$!G2m=%`^5O=4HCB7#+`_=#YI\
MSFVASAZ*^|CE#7L%;*S6O^6LQ&CE2DU.JLB=5ROMTO(U(%([&&A9'.,[3^+H
M)!?$HM1W?"C.0MSH^*QL'IL:1[8$+R5(!7(J8_\m??+@JGB+%IC26`"5EN.2
M%G$0;E$`;JSD2;4VDB[[%URPK%U@AL,J2,.[4LA0U3;$M,F:9,?G]:.)87&2
M2=Y'=9+9B`E:P%A"ZPT1*#AEA,T/`:mQ/91)=)IP\F6^X)2V+#&m!$*#4|*N
MK\~T@2(=8297"?.#KV9C~N3X!?Z/Y#(1U82"4EE.JL`\U9RK^mC:Gm~GR620
MH3&+`|5:50$5JU0KP*$6K%X"UJ&DAmRX6`K?Pm1OK(?U1J!S|6]+)UN']W*4
MG*2C5|XAI8'!QBWL[:O7CCF9FA;^J"8["8'"|UHGEAJK*C,G$LE*:8WB$$T5
M,C!4QZm)^44YS"X_]O,)/L~=50"W?$*TV?T`P\!X/;2XFZX@.7QYXS3#8'&`
MX&&*3M2C_$IG(B'UHS*G'R4;F@MKUSFND@|S46H=N=1Z`YJ3?_]@QKVHG+64
M]?0F3X;#VM3"'J&%^F:Q9424]YU9),VC0`_&D&+MB:FC"'%R3^Q*($02DT1#
MmN]DBN$_43+&?.84K(/.B3@#*EX5%3@|D=AB3*,TB=VE8HJ3m(T6V745Y)*V
MO09T)VU@;#@U=ILTYGKINQ#(8~$^4QIMP;T;9"m,X~':K!%XLA+|*?'/Z*\.
MB)31Z`E1"4J'PTD.DYmB'4;C4G1|)&5XQGF7Z?93JX32*:Xm,?LK|/,SW@L5
MKV.%J!F_S*,"F(U:+*|E+AM(~1U:(ZDAX8mLA`C`Y7YT0!OZC\m.U(,^EZKT
M6/(9Q)UDJE_@CB7GEC,'OOM=%1S$&O=7RFJM3AmF~J6.MD@5![|Y1:NF*1:+
MQT`(m+T0KW9*C)JLP5=9VR~,2T~ETSX?)%EN|`T"0B;^%)9R?/P(ER?/0F4C
M2"m%%N)2+P`?.N@33&U;"I+[FT4IR1~MS(GQ.~;3+MXZ.&D2B#CLYEBHF2%F
MG(|0Z2'Y08@F@@4ZU(mC*_'9UX.BGLZKIR(Dm@~!:'5=LD%(~[1.T6ZZ7`;Q
MDH\YB)]('NCPNW("4|GY"ZF!#9KB'9Gm"!U&R)_F([A@Q&)WZ~ZDR~#|X%[7
M`0"0:B+26(/C$N'`;S*I8+Z0?(;X:0,\&*:1IFXQT)[,L'2&MM=WWR`[E5^@
MO,7PV1.:[&DW3LO!NADJ)Q)@~02*?.11R7&+7T;H*QU7R6M(/+P&6&PJ0D~D
M(%!9B\2'7SH@XR|(\7$/E08F^6I$~"=9GNA^YE.5`NAF4~@5Y=**W1LMH'/3
M)F=#9E$QV\#KI"@I2M*$L5D*1VGN3].K^%2=F323%F7K*B0I):WN^mC87.'$
M+L6&J5G^)2`3~0HSE@:;JFO:6`R@D78N.(R%$(T3HP$UN\YG=*^.CYOmIJ2E
MH"IC3$\TDAVMGP6/9]9%:|*P$A~~I[DZ^$YAEG"8"?WJY|GFC*04&C2=#5"C
MX^LR\mT"V4?T&+!$=H\=GN*"&'LX=L7E#LP)5;B&'*[C*(&C(DI_L~X/:K)/
M\M#X3&~P0:!`DO\H)$;S+@,CR?LX9RPMG!(81.QQ|P;P,_SJ`*Y57*/+6H?A
MS.CDQ,?RLDK~:,S6I,C"X:I:/#P=^^[.F|[/FQP~"$DLWmS!G*&($FMZHPB5
M3ER?3Z%+&(F*,Wm)B$HA|^"EM(V+Y!3SY+)_J;.F,RXN2\L9I9,%EH.J%5&U
MCTC5OA[)@OA/!X9:#4Z49+];~_*[%FC@[A::/QHXWD,5O!+N#,:A/''9A(5@
MY~M$T:$:+M)|VT2('/\2G!U~;+R5L'FUOMNK;[~$&39)T]|?G,3Fm]T4@@%~
M6"4N+.ES*UKMm!\):EIR87:!Y![/!]\]RFS"OVJ~&?P+*2TL`E^13Y\B,PWR
M;+DFC:)+0`)G0D_&UN1:BP:.TM.2;T1I.)%(I5Z1^^*XEY")7~@C*AE$G).@
M7AmB:%DKJY,X23D7B)1m[$BH9*$/ILT]0mI9Y*=8WT~2?PDGK[HUIRE*N\K/
M4PUU#'Z=84I"A!J;@QA8[_+A$7#7\`~\/MMP^+@G^02^WJ*P*/V;H7E$2+FJ
M1)^C[\W6M$Y!&ONO6:)R%879NX_$$7'%HY$ZP7AZ\2B=3BDYM9R^/'AZ]!;L
M7*84S|R!,J7\YD824ZL~RCB$A2INCJ.\|%|JO~3$J3O8L4/VAHC2#`*B5,54
M*4/%Y)7D.0:#O#mF^8*O467]F`9,:A%CK:[3TP(#VTSN)|ECSB~1X+K@;VC(
M9,9H\'"QN$&:A&IHCO@SE1[PBY(X'0IR9L`3XG`|'#_Y[E6R@+:N)IQ/PJ1W
M8(IGMF9Z1"PO$'/`NR2VD/9&&Q$B:|&X8=1$%%H,M`|N`VG;3S7)mK,[3KXI
M7K#|=&^U^#NJ*)&UD^!\M(EUB4/%V\HKPYD0UPJKISNA~F*763X#9@=:IH4B
MO46RR,%\K;X))!X1H*BF"\E,7J%ABHD%!/FX]`EFNO#IIB3N0L(IORK9U*~m
M=%VXIRLmX585/_N[:=$RG&R#`Q(IAZY16A.3;LZD=F,I~W.5J4mO2VN%P[?5
MO50FO0=6Z$4%*SQG&~'6R76$]\L00X4L$SI|B2;%Q2?RE'2:2'L=H"!],F$E
M3*%L?OT^WU'\T(T0$\(%Y,V/2L$=8AT]=3BGI\?$)B23Y(RVP?H.%?4B8Q\D
MS04F#AA103P4IDHJ(8LU;~V2OXQ'K_+!^W(:PV_X5NL1|N*,^"\H!Y/3O2E`
M=44HF9I4+I6:$U~)F`|GE#S&*7G+92JP7L6'(V\%~P4N8)A|]B~&O71*(B3T
MHA07F.""A;GCXU=;/S]#R&%8380%/&A~24Y`MPGOm!E!N8BmCL`DTK/)XI.&
ML@U5B*05(mI2?`RT0@C@!,!'V$%8A61D`:[\K7EHH"4^KC*%YN~B*V!3?)$X
M#6+%/2]R*:;:V50BmD+?3T5&%)?HEE=J&/DW@BP_J$=(B@SK?.!3S?98,Y$$
MS3GS~)]CW&SP.Z2%#9\W]L$X0_NYR$]_F^4E0.R(|)&C=XR.2#@VUO3KRTMT
M`GE.X&~P8!K5XRW3LW0JK&$WPL6UMG#CFHBXGV#Q8/m|`0HC)X0Z*))Z\&QE
MG?|JU?5J&[5?!~$@7X?`9[]JZWD;(!I!;4%`BJ:`68QO"DN:FOT_@?5Q*C)Q
M7W7Q%mOP2&)[2!D&+&Z$&C3#/\*EI)+6Am9(GDB%+3E3^")8F,'FS2.$(W%I
M\!.5]OU#%HAK0$KM*/2+X#EI"9G&+YI[W~)L79W`|J?;_|9'6[DF\m[T4=MG
M"LEX6ZY]N\#~@;KJWCV#m[%WY'D$3PD9VM?HNTK2@ZZ7P]XP7*J5E,UIMB|2
M$BRGX=M*K4#CB`BV,044~,m5N&8+R\@32I+I&3W6//;I;$K,&*M7]3O#TDW3
M,3,JD?DJ1*I8@1m$8_M5$"7EZQ`JVZ_:~MX2G:UBZK\50E|2J]0V74FZTOA]
M")[.=ZU];P%1RSW^mX)F]!Z9(+(5JM/84$W,E$3,R=R&7P&#R`*AYH~ZS,20
M4D2&L_.9'\/A8+1:"]"LW'9\?(IM$5)&@@LA`30:+#'@8.Z`G(MXP1%56IVS
M1G:P7G25U'KNH)=+C7JYZ+`|VM@^JDT:YDK'%XI%.",'0@H+0?8N)Z$..CVP
M1Y;3)REmH'!]5=/DJD^F@P5AB&W]K|;QJYPD'U;$9|6&@Z72W)@LP@N@6[K@
M`K"MMX"N|5J6BTE)C^&]Y/3O^R@GZ](BL;)|)5QSY~2:(FR269F/*8!YF+("
M&SNJ+U/7V0_/'MH'[!2N\X*[X,8M*$m1_~Q5IWISR:+=m6M4%8]QLPOIUU%/
M'*G5:P,Y"$Z7Bm7I,I293D\I7AC;CGm2XZ*FX$N7K~)&]\~1W9'KLV(BF[#D
MB!7I|'5I%:|,CmH0#0E[(C52@Z@6`+M,5\$@0:UVM*I,MQQB^:?E17ZIU\FY
M8\FKA]&CmNQ\mOE,DCYJ+#DHS~H]N+\m|4?%"&;5H`/@+^`C\3MVP@+I|"mY
M|*SU.CG!0G727.XC9=\UA"*W"CS2N,D;&E'Y,(#&~7Z54F4B5!'ADY5^R0Q9
MPDP:`$LUN6HB!!=?T+|L|I1A,2O#UK7,.D4|R+HSUONP!9\mM?C[&OE,P)7@
MU/T^KALT]Q+6&^]OLAS8W`HD0L%2U^R!ZT6*3,BEK,:(5'JCC!UYW7U^G9IE
MC6A''`%J^Q&UG82L"GFW2`@J]2:FAJ@V~8!~VU+I4!*EL8Z(LJ|SQ;`#4R9(
M+m#L'|7Q\;VGC\mTK%H~89F=T!$YJ_\1C3JCI#A7(9OE%QK`(4\GVFQm"H^H
MH?/X."OZZ,%")`8WBmD'Q!9$1AQ,WI*;?468R'4m?^O&9Z24G,I?QK&+N3E:
M`2V`?E.`34"^F&:#B)=1DS.J6?$=*#73F1Z/)7!RRY(V``V=R$3@K1P%PL&J
MmZNK|]('+/0*~?I[6!/U+Z342==!(36L57SNV(A_;~L]U.S_P14ZN1%NOTP|
MYm=|)*^OHIF\m2C3+X/THF1.S+V%9O51~/5(^;3L4ZDV64|5:C2M2HO:P?UU
MVU&0_Q=M!M?/U!@(`MJTVZD2'37%9*ARU;J.B84V=BRT\7\|[N_%G'JRIB.;
M4)UHK'"`GG85X=1FO6+6RHV58Z)7,44.4T`_T~65YP06?5XBUT&IS.W$XEY$
M'8RM4SRXBmNW+3\|O5[[4R1#8RL[7W)2Y".,^,O18EER[JO1M?5#[*AI)T)3
M#7\(N(m&95TK,B!V6D3Q"T=QAmX^]#8.9X,TLK[=3N7~XV,3O4NNA/=B3?#C
ML6^2B\'[S,T$5./UX.P^N\~"#_])4F"1%~.A0#JT*H|BX1VB85m'+76FSm,B
M$I+!Y:74'E:0D9|7I#;XQ%&W*|=@BHZS0,~~RIC[3"R!I)~Cm%*Z,%C0)%4?
M!D^K9@8ES\U+\JE!#0&|%H/+~H&JV=IT4;L2?ZWV1G@RV9"O7UO#(]D70Y;'
MJI,`*_6BFNU3O5@=DZ\%&9ZA72V5mJ!+J\#V?5]Q5?`RGX6TE`6[&25NANX)
MI8~+'"XW$7ASDC2!/5X/|5!5%+*[9%6ER;m&5FDW9!9SSTHE7:G'JQ7K26*2
M6)+$L"SL~10Y&|(0C1.RVBOSY^!EMP8\%+%%*R"IS,G)52W*[EX1OZ3X&|D%
MR*7/L,8m;?XJ[SI/H7%)1+%44V0!V\5Y+AQ[H77G|O#m~Am8E&+IH6Mm]^QX
M2~9`&.0MF63YM5$C85:H6Q'~D9/KV/I)"AJY5D8@Z,]B8_#IRR"PF(Z)M_$*
MS+IN]!1K)mX@E&9/~J^B?9I6*XH:'(Z]P8Q,Q@/QUZOJ=Lm]\(FT/=P4;D00
M80H7&QV&9|,!$Y=N+=BS1|:%CS@G.]XT\|!*)_#@#E)6DVLXJX|NXQ2K06;%
M6!QF3E`H0@'0N@%AW(]QBQ`/6?9`T\!1Y4D1]=#%&"W"$AU*XI;1FHC"26W0
M")|_IR~OMGYV'L)IZL12|;2,E'I"!P0!1H7@N?HP!&SFL7`FL#(16OF:#0D|
MF640!U=M\ZP,+Ym)B9)X;ETI67KBU4TmQ63)3FSC[LM2`4m|`0/[#\R!`=[[
M\6QPCG:1B[PH,@"$W4%\JQU$U1T8ZIH,SH5RCK#PB]TSXB;/?ATG5*1)ZBI$
MS+R2,@AN(C)|_$AAR`=Y+F$F;7R[**1KDJ'S8=|ZIW(TJ,:K(12($]K:Q5_m
M_*)U8I6$X^'0WSL49|?Q,?~A3ZJ:]@C]IP0*KmWP7PUF5`QGZ|4Z3mPZZ~RG
M64D/)`RM:G`:|A21`OXC*=[^T=AL'6[Q37P/4QBX#(^:.SQ~IE[^H\K5U(NS
M.#?)^.HX3ZTUC5@2%+G|"P4"~@0$B6%])~QJP6^0=;DC?8C56&|3XRBJUWC#
M]2`R(|*(2A*60X$[I(B,;&)3~F[8*]|.G=1&9ZRCV"]&=U.'D,B|M'8(R8S3
M|2)!45!*J(%]=,0!CT9&K9R,PN$m)A[:1';C(R[,IHQH/m\Ym`3mEY9C:|T0
MX.|OWQH.R=%/JIB:!+=8[&F(L9094IN=]ZATG%(QE7P:F~0UXJ[%~:A,\_7*
M3.@XM@50*^?,0@ZYR9G&HI?I:)*6T4)3V'R`H3DRRLm;LK.5N&/G4I0K,B'%
MP?BU~\%LR^Z50551T/?4^)OSR^*PNJ:"CE"A$E/L2!)A)|JH3N*H|&9+#+D(
MK4||3(%MMURRL9"[Y|;8I"Y!\U7O;=+R\O!^QEXKVCHF~|/2|QR5;,])\(SN
M"*O`6P!+$,TF&3Q2$V2?/5]6:ZVV^Z`#K'|0|$;"`=&GKmO&QB8%`GJ(50RH
M"%)]J=#_P1(IVJQJ~/B!|!([4Z%?*B*/@KP)\.mP&G'#ITY17?87KPKM@TWE
M(Q,]H\P(#0Y'=S:#46#!/#B%[R2PM;]E,SG#9(R^ZXE]EmST"L8;;TAN~QNV
M@8(C|SQ|!|D"4+:^K(7Z9]"TJ@1%?JVKJ`V=IYDHJ~O9^=U;PAIXXW%K@DT#
M2,BEF1*)D*[~`W3?O28!Q.E"_LWZ3J1?\.'mRI%8Y^GB1+YS:.7:B'X#,\?@
M"O,3#C0(8`5J]2m.$XZ|OIY`5^46Dm^F6+I)5|KJ~5VDRGPZU]'/(NZ%56$!
M0TRB`K"6$H+0A9%8+`V|mQT3KL!mC]0%#+E$][Z:8K[LN\A\?F$NO]2OXJ3O
M&3,FZH9M8F(KO`N|2F2XEO;\B^+R*1]2?"ZE#\XI,P1[A_IYBU#&.3Y^!"_E
M(V(K*16=+A8K9%^K8+mJ0@A`5"AS8'99"|M\9#(PI;\2JXI!V1'+[|`!C(86
M!A20FHS9"P@/|@QRR:G6*A:6%!.J4RR%(V$?'[m#=Q^&(P5F870.D27`BNmF
M[UVWU!`5S|@F6M"JI@,C~Q&V084="G`%;H/4.K05NX^N,TS|L9!BI,9N$69M
MIP)|#D?9=H0~9_E3FEX0L9RB"%AY143]/1AE=%51FLV\LH`:`0?;~P0\1%W'
M,A'.:B0|ES&]J81;U70B|8WX&R|9BYD'J[A!0W10[P*E0].m&*:/CZE"EZ~T
M!0(L+XOH4W:SSRE;Y]$76H;E"G\LW5.(1NFX84Y2&ST/](&2X]OB|]R?M0&R
M~#7U57;@3!;I#A396[OY~3LDVLR&!W'Z#(7/%2[|BVC'H'N*(**W0%=~V]YG
M0(.HG%ZSm:G'U(EJ=B=!R+H69QAIE)]E`PE]]\RK9.&OYmQ6K\QYZOBFK!'L
MLC#7T+;X?$~DmJA,1PH9D6A1NT?/`\&7TT)PK!|ET?54FA9&*E,4M:01F*7Q
MF)JS=,3U;3#WQ,0:'6M,KmEI*(?Y(K:mELP0#CI79POF06^|[C`E\ZZ31/N]
M~."*:&Z_V#:^C,J?\$UFGBKR,\%Y&:1,)F=+1ISK*#L4FA3*"Z5L=PB0!8?/
M^5^)%[&J[X!;K'Y5,P#5$^*[K)/&N#)EY9@;V@UT0P|"OPJJ@,(4US#L3WT2
MmZ|#M?:?J\H[=&&0(VI"#HQ6FCK@+:S]Q|^.[6DDZI45/(V$DPI"LSZ;A]M1
M~=+KVXTY5(CUT$33=/O89WC"7Z\7?RmEJM%mI2"^D8I6/?7)$!/OO_IQ.QY.
MLTNm?S)\SZ()J)D!0G=[AHKSI2.OFU12UC1CR`F9@^#M)I|?"1\;)!?)"2=5
M,6DN:NHE8*m@OSR@N5+P"0V6UO)YH!Z:!&+DJ[;9:!$X.4_)$U0"L098S![U
MLT4~CI4?80V0|N3TT/%11#Y^BPK:/"OT4,'[Q!(*F4H&9"\Fm,#(K`S+T)18
MP8_|Om'8X\~H43%4RG[NHMD4.E$m|5m1F`@,'A;m%5W,IH!"'!W(!88YPT%=
M@491@)IUDD\[D;|@,O.YWKK2A_._XO//&E%Z#=QCA79T:BRPFZ'LPZH2J"V&
M/'$X7_J6LI|0ZT.7B*PZ5AJm2W,|N*)S~C*[`D&X.QS093)2~?P'=(A,Z7m*
MID6P/G*A7'4&J'/4R`=YGUML*JH6R~9;A#PT'*A[[2I/!=%]SP&Q$*V;KUIC
MWKEY12TL=(B:.|LUJ!4K:G6;VNJ;5TDH%M(R]0|G$B/)YD#$H#Z.].E39.RR
M5,:2+FQ2N['*M*BJ457J9#3@S"E1m~OOX7^B8QWF*Sm.PI3HP,]'X(8C~@AL
MmTIL(:P&!VYV@K*SBIA5#SR`,9`|M7`_1*MH##R(DXPS%%&H,KIZR=[(=E,;
M&ELWLSH_9F2^%W0D?M%~%#CHS&JDB=AQ.P6.I.?@.^XG$3SA)#(YK7HR&XT:
MEO:'W\];VQ]^OW:2E28VH6Fm#3L?+;AU,A^SXXR$?S|#`W%.&FG]ML1FQ^%;
M;^@2VB//4*m59B."H1X?"R^8]@%SGI#AOF$3"+[V;2B0EX`.B~SS4([._#PA
M81ZO+CT!6)).\\R1P@MGmU\'IL(Z.,THJ%|$I|OQF(MRPXC][?UW[W:.T`|G
M1_VNO*[RY|'^[NZ/6]L_T=?L%&"|:W$VR8517XO,T;08Y6EE+%2|X6LFO@WL
M[E#X]7EA.0~]HP\'~\ST=V4;OL.OLR8U(JK$0N\FNSE39GZ+2|#Y'!^C7/7I
MDY.!P'=L$`/Zm7I:4LP$W4R@)Z0^)D:1FE#"L9J\:0#21^$9ZSDU`6:;X=:P
M*2RD~99,AZ3+$`4,TPmZ.@F(%.HIU@0#6m:3\R8ZAA5D:)#3%&]_5657?"~B
M9N`']M~^*4W+:7~%R*PY/C1^L/)XTR7CN`!AE9Q5%\#5P?WGU&"%4`.Y,IRT
MQ9ZE9A$^/J:"1O#L4?(Q4][1NW"KDBF\,%!1.[2L:VT$S^W(&A*='"M\R)7C
MC_RW4[E"/XRBZEJ^P54M2Z^`8Q%9,Z.C69mRD(2$[#I&UD%^;H$+*,=6`."/
M`(KB')?#K_UQ|3;W[)"?U\24%MTI!T+BPmT[,+Q&RI5%TJ8#7"[F?QY3#FV8
M?=48@G04S"|N].?MUMZKW5Z_M_|SB]K.9X='[XXP5PIR+|['L#3R9_$1%!J\
M2|LWA_*NmNSU0'@I,OEHP!XMA]mT:/[VX?4D&;/GGV5HM4D1L5()M8ZHK)C"
M.2|:+XTG!VB$T1J8|Y|%(3%~U]0"6CW*]T4DCY':IXE3%S1D[O?:6Y]226^$
M19((9ZPJ&656DG:;ZR|1[8AJ@JUDL~0;F2#:%Z8..R`@5\BT"`E_%Y|#'HO]
M#*2$J"N$0BN2/`E/U(~R:YPE'5E2&D:^=YLKLC9(G|89`.AWmI6'@|&m!A^N
M5%&MZTK9F(V`B;I/3OR*[|QYL./~m5[9!V5716mSD$[X&FG!Q=Z#MLJN&,MX
MH"RW+@2(9VHQ]C+&5E+/)'892m156X.^0/DT\E:A*|IL5A~5Z|@]8LJ\%D7F
M,#D%S([X`'4.?DV`7)$H17XS%"]H%B$1V71IW1mCUE;FJ:1KPB@@UF^;K~0#
M~D:&5O^,=XL'K%NM22.+)Y+,4%HIU;`C=7X+QQ[2A.R^$'~~~@=,8R67*GW*
M`R|~Z'4G=8XU.GJOA;BL);R2\|4DZ11U0JD56Z=4IEE|5U%PBW@YY"!I|M6G
MR423M,",%96U\5DJV9G:I)E,([2@LTU?=9]NU@5D$GRZ%==P@##+/U[9XG5L
MQ%8L?3WDY5\!2R,I+8O4L_#@:Q~1B(ER*27090OM1'E%DGIQ^R?752I`6.8@
M.)|R1DO?Q2C5G("~:@|5W&AW=Y,MTC4R]F'\~DA.,*(,3R1TR,W7ALF+C1\1
M\5(GI,6)A[m42B2[R+,NUG'63_F3JPTmN`$RL1@8JK6;%H2;)Rm#Q,X)PHHD
M:UR;@:@$/U8%|[O/G],L;V46E!]QWYCX&M9V(&M#$L^~,M~QF\*)%Q=9H+#]
MF$1\*AK_Z1,GKC9'~~.ZV;J9AKEJ~Z##~KR7DR)7*[30AAVD9IZ~^Z,BPW/!
MH%6:K"@@(J?324I9D$OQ+Z`4QTR*9N040Km$XP38/#23'TKVIX+K_!FCKWCG
M:!(KJ5S#4MI$D|M)DQ35M=;LJGBX[A2^V4:)YY54L!ED:7$Cm94|+T*A\\1R
M%:BRHRH&N507'V4GLmLL55VC]46D?6G^*GYBG(ANV@X#_PT:H8"M|75B./2;
MW~PD?@=D8I1&/V))':61m[9L3F=0K)W!&M8G5ZO&"6;H;*@;5[+E1LYVH.,I
M1FmTL%209(Z*?_=T_??KCW^WJO`RG+/?$~CM*/([_G']R9^P9U756%7,&@\'
M9&AA/|#6YQ~T'0Mm;^39)/M"S"_M$'_3.|2G.5*?YOH|?X|Q*QM\LOYT_8?U
M'WZW6C/Z)QB"*0LAMPZ,GJD`YX_K_^OQT]\E71L"0LP1\$OCV5ACM]'8OS61
M(N&J:N#=7:_A&D~8RP\AQ+(MITM58~P\.SL?P?^74@3\)TIOB,:/&+m!4ITG
M8*W?`G_~Q7\!(/@O5E[N=8W,2%\ANT[?O=O:W=W9H]^Q@N.;W@'^NMO;Z]ZC
ML8Bm[[XYHK"#]X#?W;_W.32]*Y#0?_N4B:mK4JWA;WMPD?#7~Y'F/\m/M\IR
MBK^^WG[SE_X!O[+0Ym^KmW`'L/4+R@O\@HKO#CHU@U"8#A*D%*.GRm5~80I]
M2HD!%(6\GN]+1ED^!B'NP!0@)_\./:O),91#LE%\8m64+?X"S~*CK`3BL4G"
MUB"YR$IV:L.OMIC/V.3W[PGFBW4:1!_A9m(3&KW@F+(R?8:*+_9]/,6\95@C
MZXO,2X_*%(\6G~^mO^@TN|)XT)OH^=VUM1?1/9)(S(?W/EZ27_4_GA"4/IYC
ML:_*I[6!|!Q_&.A!JZ7U1.)U*83D)OK__?;SV\]O/[_]_/;SV\]O/[_]_/;S
MV\]O/[_]_/;SV\]O/[_]_/;SV\]O/[_]_/;SV\]O/[_]_/;SV\]O/[_]_/;S
6V\]O/[_]_/;SZ_S\_P$KR`SE`,`(````
`
end
-->
</body>
</html>
